{"version":3,"file":"static/css/9702.8120d02e2700f3c29018.css","mappings":"AAiIA,qCAEA,mBADA,WAEA,CCsUA,gCACA,GACA,mBACA,CAEA,GACA,uBACA,CACA,CAGA,4CACA,WASA,CAPA,kEAKA,kDAHA,aAEA,YAHA,kBAEA,UAGA","sources":["webpack://job/./src/views/ticket-manage/list/components/related-ticket.vue","webpack://job/./src/views/ticket-manage/list/index.vue"],"sourcesContent":["<template>\r\n    <div class=\"related-ticket\">\r\n        <jb-search-select\r\n            ref=\"search\"\r\n            class=\"search-select-style\"\r\n            @on-change=\"handleSearch\"\r\n            :parse-url=\"false\"\r\n            :data=\"searchSelect\"\r\n            :placeholder=\"'搜索文件源别名...'\" />\r\n        <render-list\r\n            ref=\"fileSourcelist\"\r\n            :data-source=\"fetchFileSourceList\"\r\n            :search-control=\"() => $refs.search\">\r\n            <bk-table-column width=\"60\">\r\n                <template slot-scope=\"{ row }\">\r\n                    <span v-html=\"row.publicFlagHtml\" />\r\n                </template>\r\n            </bk-table-column>\r\n            <bk-table-column\r\n                :label=\"'文件源别名'\"\r\n                sortable\r\n                align=\"left\"\r\n                show-overflow-tooltip>\r\n                <template slot-scope=\"{ row }\">\r\n                    <auth-router-link\r\n                        v-if=\"row.isAvailable\"\r\n                        auth=\"file_source/view\"\r\n                        :permission=\"row.canView\"\r\n                        :resource-id=\"row.id\"\r\n                        :to=\"{\r\n                            name: 'fileList',\r\n                            query: {\r\n                                fileSourceId: 4 || row.id,\r\n                            },\r\n                        }\"\r\n                        target=\"_blank\">\r\n                        {{ row.alias }}\r\n                    </auth-router-link>\r\n                    <span\r\n                        v-else\r\n                        v-bk-tooltips=\"'接入点异常，暂时不可用'\">\r\n                        <bk-button disabled text>{{ row.alias }}</bk-button>\r\n                    </span>\r\n                </template>\r\n            </bk-table-column>\r\n            <bk-table-column\r\n                :label=\"'文件源标识'\"\r\n                sortable\r\n                align=\"left\"\r\n                width=\"160\"\r\n                show-overflow-tooltip\r\n                prop=\"code\" />\r\n            <bk-table-column\r\n                width=\"80\"\r\n                :label=\"'状态'\">\r\n                <template slot-scope=\"{ row }\">\r\n                    <Icon :type=\"row.statusIcon\" svg />\r\n                    {{ row.statusText }}\r\n                </template>\r\n            </bk-table-column>\r\n            <bk-table-column\r\n                width=\"120\"\r\n                :label=\"'更新人'\"\r\n                prop=\"lastModifyUser\" />\r\n            <bk-table-column\r\n                width=\"180\"\r\n                :label=\"'更新时间'\"\r\n                prop=\"lastModifyTime\" />\r\n        </render-list>\r\n    </div>\r\n</template>\r\n<script>\r\n       import FileManageService from '@service/file-source-manage';\r\n    import JbSearchSelect from '@components/jb-search-select';\r\n    import RenderList from '@components/render-list';\r\n\r\n    export default {\r\n        name: 'RelatedTicket',\r\n        components: {\r\n            JbSearchSelect,\r\n            RenderList,\r\n        },\r\n        props: {\r\n            credentialId: {\r\n                type: String,\r\n            },\r\n        },\r\n        data () {\r\n            return {\r\n                sourceFileList: [{},{},{}],\r\n            };\r\n        },\r\n        mounted () {\r\n            this.fetchData();\r\n        },\r\n        created () {\r\n            this.fetchFileSourceList = FileManageService.fetchFileSourceList;\r\n            this.searchSelect = [\r\n                {\r\n                    name: '文件源别名',\r\n                    id: 'alias',\r\n                },\r\n            ];\r\n        },\r\n        methods: {\r\n            /**\r\n             * @desc 获取被引用文件源列表\r\n             */\r\n            fetchData () {\r\n                this.$refs.fileSourcelist.$emit('onFetch', {\r\n                    ...this.searchParams,\r\n                    credentialId: this.credentialId,\r\n                });\r\n            },\r\n            /**\r\n             * @desc 过滤表格数据\r\n             * @param {Array} payload 用户输入的过滤数据\r\n             *\r\n             * 重新拉取数据\r\n             */\r\n            handleSearch (payload) {\r\n                this.searchParams = payload;\r\n                this.fetchData();\r\n            },\r\n        },\r\n    };\r\n</script>\r\n<style lang=\"postcss\">\r\n    .related-ticket {\r\n        .search-select-style {\r\n            width: 480px;\r\n            margin-bottom: 20px;\r\n        }\r\n    }\r\n</style>\r\n","<template>\r\n    <div class=\"ticket-manage-page\" v-bkloading=\"{ isLoading }\">\r\n        <list-action-layout>\r\n            <auth-button\r\n                theme=\"primary\"\r\n                auth=\"ticket/create\"\r\n                @click=\"handleCreate\"\r\n                class=\"w120\"\r\n                v-test=\"{ type: 'button', value: 'createTicket' }\">\r\n                {{ '新建' }}\r\n            </auth-button>\r\n            <template #right>\r\n                <jb-search-select\r\n                    ref=\"search\"\r\n                    @on-change=\"handleSearch\"\r\n                    :data=\"searchSelect\"\r\n                    :placeholder=\"'搜索 ID、名称、描述、创建人、更新人...'\"\r\n                    style=\"width: 480px;\" />\r\n            </template>\r\n        </list-action-layout>\r\n        <render-list\r\n            ref=\"list\"\r\n            :data-source=\"getTicketList\"\r\n            :size=\"tableSize\"\r\n            :search-control=\"() => $refs.search\"\r\n            v-test=\"{ type: 'list', value: 'ticket' }\">\r\n            <bk-table-column\r\n                v-if=\"allRenderColumnMap.id\"\r\n                :label=\"'凭证ID'\"\r\n                width=\"300\"\r\n                prop=\"id\"\r\n                key=\"id\"\r\n                align=\"left\">\r\n                <template slot-scope=\"{ row }\">\r\n                    <span>{{ row.id }}</span>\r\n                </template>\r\n            </bk-table-column>\r\n            <bk-table-column\r\n                :label=\"'凭证名称'\"\r\n                sortable\r\n                prop=\"name\"\r\n                key=\"name\"\r\n                align=\"left\"\r\n                min-width=\"200\"\r\n                show-overflow-tooltip>\r\n                <template slot-scope=\"{ row }\">\r\n                    <span class=\"ticket-name\">{{ row.name }}</span>\r\n                </template>\r\n            </bk-table-column>\r\n            <bk-table-column\r\n                :label=\"'类型'\"\r\n                prop=\"type\"\r\n                key=\"type\"\r\n                align=\"left\"\r\n                width=\"180\"\r\n                :filters=\"sourceFilters\"\r\n                :filter-method=\"handelFilterType\">\r\n                <template slot-scope=\"{ row }\">\r\n                    <span>{{ typeMap[row.type] }}</span>\r\n                </template>\r\n            </bk-table-column>\r\n            <bk-table-column\r\n                v-if=\"allRenderColumnMap.description\"\r\n                :label=\"'描述'\"\r\n                prop=\"description\"\r\n                key=\"description\"\r\n                min-width=\"150\"\r\n                align=\"left\">\r\n                <template slot-scope=\"{ row }\">\r\n                    <span>{{ row.description }}</span>\r\n                </template>\r\n            </bk-table-column>\r\n            <bk-table-column\r\n                v-if=\"allRenderColumnMap.related\"\r\n                :label=\"'被引用'\"\r\n                prop=\"related\"\r\n                key=\"related\"\r\n                width=\"100\"\r\n                align=\"right\">\r\n                <template slot-scope=\"{ row }\">\r\n                    <div\r\n                        v-if=\"row.isRelatedLoading\"\r\n                        class=\"sync-fetch-relate-nums\">\r\n                        <div class=\"related-nums-loading\">\r\n                            <Icon\r\n                                type=\"sync-pending\"\r\n                                svg\r\n                                style=\"color: #3a84ff;\" />\r\n                        </div>\r\n                    </div>\r\n                    <bk-button\r\n                        v-else\r\n                        text\r\n                        @click=\"handleShowRelated(row.id)\">\r\n                        {{ row.relatedNums }}\r\n                    </bk-button>\r\n                </template>\r\n            </bk-table-column>\r\n            <bk-table-column\r\n                v-if=\"allRenderColumnMap.creator\"\r\n                :label=\"'创建人'\"\r\n                width=\"120\"\r\n                prop=\"creator\"\r\n                key=\"creator\"\r\n                align=\"left\" />\r\n            <bk-table-column\r\n                v-if=\"allRenderColumnMap.createTime\"\r\n                :label=\"'创建时间'\"\r\n                prop=\"createTime\"\r\n                key=\"createTime\"\r\n                width=\"180\"\r\n                align=\"left\" />\r\n            <bk-table-column\r\n                v-if=\"allRenderColumnMap.lastModifyUser\"\r\n                :label=\"'更新人'\"\r\n                prop=\"lastModifyUser\"\r\n                key=\"lastModifyUser\"\r\n                width=\"120\"\r\n                align=\"left\" />\r\n            <bk-table-column\r\n                v-if=\"allRenderColumnMap.lastModifyTime\"\r\n                :label=\"'更新时间'\"\r\n                prop=\"lastModifyTime\"\r\n                key=\"lastModifyTime\"\r\n                width=\"180\"\r\n                align=\"left\" />\r\n            <bk-table-column\r\n                :label=\"'操作'\"\r\n                :resizable=\"false\"\r\n                key=\"action\"\r\n                fixed=\"right\"\r\n                width=\"100\"\r\n                align=\"left\">\r\n                <template slot-scope=\"{ row }\">\r\n                    <auth-button\r\n                        auth=\"ticket/edit\"\r\n                        :resource-id=\"row.id\"\r\n                        :permission=\"row.canManage\"\r\n                        text\r\n                        class=\"mr10\"\r\n                        @click=\"handleEdit(row)\"\r\n                        v-test=\"{ type: 'list', value: 'editTicket' }\">\r\n                        {{ '编辑' }}\r\n                    </auth-button>\r\n                    <jb-popover-confirm\r\n                        :title=\"'确定删除该凭证？'\"\r\n                        :content=\"'正在被文件源使用的凭证无法删除，如需删除请先解除引用关系。'\"\r\n                        :confirm-handler=\"() => handleDelete(row.id)\">\r\n                        <auth-button\r\n                            auth=\"ticket/edit\"\r\n                            :permission=\"row.canManage\"\r\n                            :resource-id=\"row.id\"\r\n                            text\r\n                            v-test=\"{ type: 'list', value: 'deleteTicket' }\">\r\n                            {{ '删除' }}\r\n                        </auth-button>\r\n                    </jb-popover-confirm>\r\n                </template>\r\n            </bk-table-column>\r\n            <bk-table-column type=\"setting\">\r\n                <bk-table-setting-content\r\n                    :fields=\"tableColumn\"\r\n                    :selected=\"selectedTableColumn\"\r\n                    :size=\"tableSize\"\r\n                    @setting-change=\"handleSettingChange\" />\r\n            </bk-table-column>\r\n        </render-list>\r\n        <jb-sideslider\r\n            :is-show.sync=\"showRelatedSideslider\"\r\n            :show-footer=\"false\"\r\n            :width=\"900\"\r\n            :title=\"'被引用'\">\r\n            <related-ticket\r\n                :credential-id=\"credentialId\" />\r\n        </jb-sideslider>\r\n        <jb-sideslider\r\n            :is-show.sync=\"showOpertionSideslider\"\r\n            :width=\"600\"\r\n            v-bind=\"operationSidesliderInfo\">\r\n            <ticket-opertion\r\n                :data=\"ticketDetailInfo\"\r\n                @on-change=\"handleChange\" />\r\n        </jb-sideslider>\r\n    </div>\r\n</template>\r\n<script>\r\n       import TicketService from '@service/ticket-manage';\r\n    import NotifyService from '@service/notify';\r\n    import { listColumnsCache } from '@utils/cache-helper';\r\n    import RenderList from '@components/render-list';\r\n    import JbSearchSelect from '@components/jb-search-select';\r\n    import JbPopoverConfirm from '@components/jb-popover-confirm';\r\n    import ListActionLayout from '@components/list-action-layout';\r\n    import RelatedTicket from './components/related-ticket';\r\n    import TicketOpertion from './components/opertion';\r\n\r\n    const TABLE_COLUMN_CACHE = 'ticket_list_columns';\r\n\r\n    export default {\r\n        name: 'TicketList',\r\n        components: {\r\n            ListActionLayout,\r\n            JbSearchSelect,\r\n            RenderList,\r\n            TicketOpertion,\r\n            JbPopoverConfirm,\r\n            RelatedTicket,\r\n        },\r\n        data () {\r\n            return {\r\n                isLoading: false,\r\n                tableSize: 'small',\r\n                selectedTableColumn: [],\r\n                searchParams: {},\r\n                showRelatedSideslider: false,\r\n                showOpertionSideslider: false,\r\n                ticketDetailInfo: {},\r\n                credentialId: 0,\r\n                relatedNum: [],\r\n            };\r\n        },\r\n        computed: {\r\n            isSkeletonLoading () {\r\n                return this.isLoading;\r\n            },\r\n            allRenderColumnMap () {\r\n                return this.selectedTableColumn.reduce((result, item) => {\r\n                    result[item.id] = true;\r\n                    return result;\r\n                }, {});\r\n            },\r\n            operationSidesliderInfo () {\r\n                if (!this.ticketDetailInfo.id) {\r\n                    return {\r\n                        title: '新建凭证',\r\n                        okText: '提交',\r\n                        \r\n                    };\r\n                }\r\n                return {\r\n                    title: '编辑凭证',\r\n                    okText: '保存',\r\n                };\r\n            },\r\n        },\r\n        created () {\r\n            this.getTicketList = TicketService.fetchListWithRelate;\r\n            this.sourceFilters = [\r\n                {\r\n                    value: 'APP_ID_SECRET_KEY',\r\n                    text: 'AppID+SecretKey',\r\n                },\r\n                {\r\n                    value: 'PASSWORD',\r\n                    text: '单一密码',\r\n                },\r\n                {\r\n                    value: 'USERNAME_PASSWORD',\r\n                    text: '用户名+密码',\r\n                },\r\n                {\r\n                    value: 'SECRET_KEY',\r\n                    text: '单一SecretKey',\r\n                },\r\n            ];\r\n            this.searchSelect = [\r\n                {\r\n                    id: 'id',\r\n                    name: 'ID',\r\n                    description: '将覆盖其它条件',\r\n                },\r\n                {\r\n                    id: 'name',\r\n                    name: '名称',\r\n                    default: true,\r\n                },\r\n                {\r\n                    name: '描述',\r\n                    id: 'description',\r\n                },\r\n                {\r\n                    name: '创建人',\r\n                    id: 'creator',\r\n                    remoteMethod: NotifyService.fetchUsersOfSearch,\r\n                    inputInclude: true,\r\n                },\r\n                {\r\n                    name: '更新人',\r\n                    id: 'lastModifyUser',\r\n                    remoteMethod: NotifyService.fetchUsersOfSearch,\r\n                    inputInclude: true,\r\n                },\r\n            ];\r\n            this.tableColumn = [\r\n                {\r\n                    id: 'id',\r\n                    label: '凭证ID',\r\n                },\r\n                {\r\n                    id: 'name',\r\n                    label: '名称',\r\n                    disabled: true,\r\n                },\r\n                {\r\n                    id: 'type',\r\n                    label: '类型',\r\n                    disabled: true,\r\n                },\r\n                {\r\n                    id: 'description',\r\n                    label: '描述',\r\n                },\r\n                {\r\n                    id: 'related',\r\n                    label: '被引用',\r\n                },\r\n                {\r\n                    id: 'creator',\r\n                    label: '创建人',\r\n                },\r\n                {\r\n                    id: 'createTime',\r\n                    label: '创建时间',\r\n                },\r\n                {\r\n                    id: 'lastModifyUser',\r\n                    label: '更新人',\r\n                },\r\n                {\r\n                    id: 'lastModifyTime',\r\n                    label: '更新时间',\r\n                },\r\n            ];\r\n            this.typeMap = {\r\n                APP_ID_SECRET_KEY: 'AppID+SecretKey',\r\n                PASSWORD: '单一密码',\r\n                USERNAME_PASSWORD: '用户名+密码',\r\n                SECRET_KEY: '单一SecretKey',\r\n            };\r\n\r\n            const columnsCache = listColumnsCache.getItem(TABLE_COLUMN_CACHE);\r\n            if (columnsCache) {\r\n                this.selectedTableColumn = Object.freeze(columnsCache.columns);\r\n                this.tableSize = columnsCache.size;\r\n            } else {\r\n                this.selectedTableColumn = Object.freeze([\r\n                    { id: 'id' },\r\n                    { id: 'name' },\r\n                    { id: 'type' },\r\n                    { id: 'description' },\r\n                    { id: 'related' },\r\n                    { id: 'lastModifyUser' },\r\n                    { id: 'lastModifyTime' },\r\n                ]);\r\n            }\r\n        },\r\n        methods: {\r\n\r\n            /**\r\n             * @desc 获取凭证数据列表\r\n             */\r\n            fetchData () {\r\n                this.$refs.list.$emit('onFetch', {\r\n                    ...this.searchParams,\r\n                });\r\n            },\r\n\r\n            /**\r\n             * @desc 新建凭证\r\n             *\r\n             * 显示新建凭证模板\r\n             */\r\n            handleCreate () {\r\n                this.showOpertionSideslider = true;\r\n                this.ticketDetailInfo = {};\r\n            },\r\n\r\n            /**\r\n             * @desc 查看被引用模板\r\n             * @param {Number} id 凭证id\r\n             *\r\n             * 显示被引用模板详情\r\n             */\r\n            handleShowRelated (id) {\r\n                this.credentialId = id;\r\n                this.showRelatedSideslider = true;\r\n            },\r\n\r\n            /**\r\n             * @desc 过滤表格数据\r\n             * @param {Object} searchParams 用户输入的过滤数据\r\n             *\r\n             * 重新拉取数据\r\n             */\r\n            handleSearch (searchParams) {\r\n                this.searchParams = searchParams;\r\n                this.fetchData();\r\n            },\r\n\r\n            /**\r\n             * @desc 设置表格显示列/表格size\r\n             */\r\n            handleSettingChange ({ fields, size }) {\r\n                this.selectedTableColumn = Object.freeze(fields);\r\n                this.tableSize = size;\r\n                listColumnsCache.setItem(TABLE_COLUMN_CACHE, {\r\n                    columns: fields,\r\n                    size,\r\n                });\r\n            },\r\n\r\n            /**\r\n             * @desc 新建、编辑凭证成功\r\n             *\r\n             * 重新拉取列表数据\r\n             */\r\n            handleChange () {\r\n                this.fetchData();\r\n                this.relatedNum = [];\r\n                this.fetchCitedNum();\r\n            },\r\n\r\n            handelFilterType (value, row, column) {\r\n                const { property } = column;\r\n                return row[property] === value;\r\n            },\r\n\r\n            /**\r\n             * @desc 编辑凭证数据\r\n             * @param {Object} payload 选中凭证的详细数据\r\n             *\r\n             * 显示编辑凭证数据模板\r\n             */\r\n            handleEdit (payload) {\r\n                this.ticketDetailInfo = payload;\r\n                this.showOpertionSideslider = true;\r\n            },\r\n\r\n            /**\r\n             * @desc 删除凭证\r\n             * @param {Number} id 凭证id\r\n             *\r\n             * 删除成功重新拉取列表数据\r\n             */\r\n            handleDelete (id) {\r\n                TicketService.remove({\r\n                    id,\r\n                }).then(() => {\r\n                    this.messageSuccess('删除成功');\r\n                    this.fetchData();\r\n                    this.relatedNum = [];\r\n                    this.fetchCitedNum();\r\n                });\r\n            },\r\n        },\r\n    };\r\n</script>\r\n<style lang=\"postcss\">\r\n    @keyframes related-nums-loading {\r\n        0% {\r\n            transform: rotateZ(0);\r\n        }\r\n\r\n        100% {\r\n            transform: rotateZ(360deg);\r\n        }\r\n    }\r\n\r\n    .ticket-manage-page {\r\n        .sync-fetch-relate-nums {\r\n            height: 13px;\r\n\r\n            .related-nums-loading {\r\n                position: absolute;\r\n                display: flex;\r\n                width: 13px;\r\n                height: 13px;\r\n                animation: related-nums-loading 1s linear infinite;\r\n            }\r\n        }\r\n    }\r\n</style>\r\n"],"names":[],"sourceRoot":""}