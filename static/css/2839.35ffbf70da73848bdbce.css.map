{"version":3,"file":"static/css/2839.35ffbf70da73848bdbce.css","mappings":"AAgFA,gCACA,iBA2JA,CAzJA,+CACA,kBA+BA,CA7BA,sEAEA,WADA,cAEA,CAEA,qEAMA,eAJA,YAGA,gBADA,kBADA,cAIA,kBANA,UAOA,CAEA,8DAEA,yBADA,aAEA,CAEA,gEAEA,mBADA,aAEA,CAEA,4DAEA,gBADA,eAEA,CAGA,uDACA,aACA,kBACA,CAEA,6CAIA,yBAHA,aAEA,eADA,sBAGA,8DAyDA,CAvDA,gEAIA,gCADA,aAEA,CAEA,+HA9DA,mBADA,aAIA,eAFA,YACA,iBA2GA,CA/CA,+DAKA,gBACA,gCAHA,cACA,cA2CA,CAvCA,sEAEA,6BADA,aAMA,CAHA,sFACA,aACA,CAGA,qEACA,kBACA,CAEA,qEACA,gBACA,gBACA,uBACA,kBACA,CAEA,4EAQA,mBAFA,mBACA,kBAFA,WAJA,aAEA,YAMA,uBALA,gBAFA,UAQA,CAEA,+EAKA,cAJA,aAGA,eADA,iBADA,iBAIA,CAIA,iDAEA,yBACA,yBAFA,aAIA,OADA,qBA+BA,CA5BA,8DAEA,gCADA,YAEA,CAEA,mEAQA,mBAFA,+BAFA,cACA,eAlIA,aAoIA,eAhIA,eAFA,YAoIA,uBAnIA,kBA6HA,cAaA,CALA,0EAEA,gBACA,6BAFA,aAGA,CAGA,kEAEA,gBACA,OAFA,gBAGA,CAGA,oDAKA,cAFA,eACA,iBAHA,iBACA,kBAIA,oBACA,CAEA,4CAEA,kBADA,WAEA,CCyCA,2DACA,WACA,CAEA,wDAMA,yBAFA,eAHA,YAIA,iBAFA,gBADA,cAKA,CAIA,0FACA,cACA,CAKA,+EACA,aACA,eACA,CAGA,6DACA,aACA,CAEA,4DAQA,mBAFA,cADA,eAHA,YAEA,iBADA,cAIA,kBANA,UAQA,CAEA,4DAEA,yBADA,aAEA,CAEA,4DAUA,mBAFA,gBACA,6BAPA,SAEA,aAEA,YAKA,yBARA,OAIA,mBANA,eAIA,UAOA","sources":["webpack://job/./script-detail.vue","webpack://job/./src/views/script-manage/sync-confirm/index.vue"],"sourcesContent":["<template>\n    <jb-sideslider\n        :is-show=\"isShow\"\n        :show-footer=\"false\"\n        @update:isShow=\"handleCancel\"\n        :quick-close=\"true\"\n        :width=\"900\"\n        :title=\"'查看脚本'\">\n        <div v-if=\"isShow\" v-bkloading=\"{ isLoading }\">\n            <script-detail v-if=\"!isLoading\" :script-info=\"scriptInfo\" :offset-bottom=\"0\" />\n        </div>\n    </jb-sideslider>\n</template>\n<script>\n    import ScriptService from '@service/script-manage';\n    import PublicScriptService from '@service/public-script-manage';\n    import {\n        checkPublicScript,\n    } from '@utils/assist';\n    import ScriptDetail from '../../common/detail';\n\n    export default {\n        name: '',\n        components: {\n            ScriptDetail,\n        },\n        props: {\n            isShow: {\n                type: Boolean,\n                default: false,\n            },\n            scriptVersionId: {\n                type: Number,\n                required: true,\n            },\n        },\n        data () {\n            return {\n                isLoading: false,\n                scriptInfo: {},\n            };\n        },\n        watch: {\n            isShow (isShow) {\n                if (isShow && this.scriptVersionId > 0) {\n                    this.fetchScriptDetail();\n                }\n            },\n        },\n        created () {\n            this.publicScript = checkPublicScript(this.$route);\n            this.serviceHandler = this.publicScript ? PublicScriptService : ScriptService;\n        },\n        methods: {\n            fetchScriptDetail () {\n                this.isLoading = true;\n                this.serviceHandler.versionDetail({\n                    id: this.scriptVersionId,\n                }).then((data) => {\n                    this.scriptInfo = Object.freeze(data);\n                })\n                    .finally(() => {\n                        this.isLoading = false;\n                    });\n            },\n            handleCancel () {\n                this.$emit('update:isShow', false);\n            },\n        },\n    };\n</script>\n<style lang='postcss' scoped>\n    %tab-item {\n        display: flex;\n        align-items: center;\n        height: 43px;\n        padding-left: 20px;\n        font-size: 12px;\n    }\n\n    .script-detail {\n        position: relative;\n\n        .detail-layout {\n            margin-bottom: 20px;\n\n            .script-detail-version {\n                font-size: 18px;\n                color: #000;\n            }\n\n            .script-detail-status {\n                width: 46px;\n                height: 16px;\n                padding: 0 5px;\n                margin-right: 10px;\n                margin-left: 8px;\n                font-size: 12px;\n                text-align: center;\n            }\n\n            .status-online {\n                color: #45c272;\n                background-color: #e5f6ea;\n            }\n\n            .status-disabled {\n                color: #9fa2ac;\n                background: #f0f1f5;\n            }\n\n            .detail-item {\n                margin-top: 10px;\n                margin-bottom: 0;\n            }\n        }\n\n        .render-script-version {\n            display: flex;\n            margin-bottom: 60px;\n        }\n\n        .version-tab {\n            display: flex;\n            flex-direction: column;\n            flex: 0 0 280px;\n            border: 1px solid #dcdee5;\n            user-select: none;\n\n            .version-tab-title {\n                @extend %tab-item;\n\n                color: #313238;\n                border-bottom: 1px solid #dcdee5;\n            }\n\n            .version-tab-item {\n                @extend %tab-item;\n\n                color: #63656e;\n                cursor: pointer;\n                background: #fff;\n                border-bottom: 1px solid #dcdee5;\n\n                &.active {\n                    color: #3a84ff;\n                    background: #f0f1f5 !important;\n\n                    .version-active {\n                        display: block;\n                    }\n                }\n\n                &:hover {\n                    background: #fafbfd;\n                }\n\n                .text {\n                    max-width: 150px;\n                    overflow: hidden;\n                    text-overflow: ellipsis;\n                    white-space: normal;\n                }\n\n                .online-flag {\n                    display: flex;\n                    width: 50px;\n                    height: 16px;\n                    margin-left: 8px;\n                    color: #fff;\n                    background: #ea3636;\n                    border-radius: 8px;\n                    align-items: center;\n                    justify-content: center;\n                }\n\n                .version-active {\n                    display: none;\n                    margin-right: 12px;\n                    margin-left: auto;\n                    font-size: 14px;\n                    color: #979ba5;\n                }\n            }\n        }\n\n        .version-content {\n            display: flex;\n            background-color: #f0f1f5;\n            border: 1px solid #dcdee5;\n            flex-direction: column;\n            flex: 1;\n\n            .content-tab {\n                display: flex;\n                border-bottom: 1px solid #dcdee5;\n            }\n\n            .content-tab-item {\n                @extend %tab-item;\n\n                padding-left: 0;\n                color: #313238;\n                cursor: pointer;\n                border-right: 1px solid #dcdee5;\n                flex: 0 0 120px;\n                align-items: center;\n                justify-content: center;\n\n                &.active {\n                    color: #3a84ff;\n                    background: #fff;\n                    border-top: 2px solid #3a84ff;\n                }\n            }\n\n            .content-dispaly {\n                min-height: 300px;\n                background: #fff;\n                flex: 1;\n            }\n        }\n\n        .render-version-log {\n            min-height: 480px;\n            padding: 12px 10px;\n            font-size: 12px;\n            line-height: 20px;\n            color: #63656e;\n            white-space: pre-line;\n        }\n\n        .action-btn {\n            width: 100px;\n            margin-right: 10px;\n        }\n    }\n</style>\n","<template>\n    <div class=\"script-manage-sync-confirm\" v-bkloading=\"{ isLoading }\">\n        <bk-input\n            class=\"search-input\"\n            :placeholder=\"'搜索作业模板'\"\n            :clearable=\"true\"\n            right-icon=\"bk-icon icon-search\"\n            @change=\"handleInputChange\"\n            v-model=\"value\" />\n        <div class=\"table-top\">\n            <span>{{ '同步作业模板' }}</span>\n            <span class=\"table-selected\"> ({{ '已选' }} {{ selectedList.length }}/{{ data.length }}个)</span>\n        </div>\n        <bk-table\n            :data=\"tableData\"\n            row-class-name=\"template-script-record\"\n            @selection-change=\"handleSelectionChange\">\n            <bk-table-column type=\"selection\" width=\"60\" />\n            <bk-table-column\n                :label=\"'作业模板名称'\"\n                prop=\"name\"\n                sortable>\n                <template slot-scope=\"{ row }\">\n                    <bk-button\n                        text\n                        class=\"job-template-name\"\n                        @click=\"handleGoTemplateDetail(row.templateId)\">\n                        {{ row.templateName }}\n                        <Icon type=\"edit\" class=\"template-link\" />\n                    </bk-button>\n                </template>\n            </bk-table-column>\n            <bk-table-column\n                :label=\"'步骤名称'\"\n                prop=\"stepName\" />\n            <bk-table-column\n                :label=\"'引用的版本号'\"\n                prop=\"version\">\n                <template slot-scope=\"{ row }\">\n                    <bk-button\n                        text\n                        @click=\"handleShowScriptDetail(row.scriptVersionId)\">\n                        {{ row.scriptVersion }}\n                    </bk-button>\n                </template>\n            </bk-table-column>\n            <bk-table-column\n                :label=\"'引用版本状态'\"\n                prop=\"status\"\n                :filters=\"statusFilters\"\n                :filter-method=\"statusFilterMethod\"\n                :filter-multiple=\"true\">\n                <template slot-scope=\"{ row }\">\n                    <span v-html=\"row.statusHtml\" />\n                </template>\n            </bk-table-column>\n            <bk-table-column\n                :label=\"'操作'\"\n                width=\"150\">\n                <template slot-scope=\"{ row }\">\n                    <bk-button\n                        text\n                        @click=\"handleComparison(row)\">\n                        {{ '版本对比' }}\n                    </bk-button>\n                </template>\n            </bk-table-column>\n        </bk-table>\n        <div class=\"footer-action\">\n            <bk-button\n                class=\"mr10\"\n                @click=\"handleCancel\">\n                {{ '取消' }}\n            </bk-button>\n            <bk-button\n                class=\"w120\"\n                theme=\"primary\"\n                \n                @click=\"handleSync\">\n                {{ '立即同步' }}\n            </bk-button>\n        </div>\n        <element-teleport v-if=\"lastVersionScriptInfo.version\">\n            <span> - {{ '同步至' }}</span>\n            <span>{{ lastVersionScriptInfo.version }}</span>\n        </element-teleport>\n        <script-detail\n            :is-show.sync=\"showSideslider\"\n            :script-version-id=\"selectScriptVersionId\" />\n        <jb-diff\n            v-if=\"showDiff\"\n            :title=\"'版本对比'\"\n            :data=\"diffList\"\n            :old-version-id=\"selectScriptVersionId\"\n            :new-version-id=\"lastVersionScriptInfo.scriptVersionId\"\n            @close=\"handleDiffClose\" />\n    </div>\n</template>\n<script>\n    import _ from 'lodash';\n       import ScriptService from '@service/script-manage';\n    import PublicScriptService from '@service/public-script-manage';\n    import { checkPublicScript } from '@utils/assist';\n    import JbDiff from '@components/jb-diff';\n    import ScriptDetail from './components/script-detail';\n\n    export default {\n        components: {\n            ScriptDetail,\n            JbDiff,\n        },\n        data () {\n            return {\n                isLoading: false,\n                data: [{},{},{}],\n                selectedList: [{},{},{}],\n                filterData: [],\n                diffList: [{},{},{}],\n                showSideslider: false,\n                scriptVersionId: null,\n                selectScriptVersionId: 0,\n                showDiff: false,\n                lastVersionScriptInfo: {},\n                value: '',\n            };\n        },\n        computed: {\n            tableData () {\n                if (this.value.length) {\n                    return this.filterData;\n                }\n                return this.data;\n            },\n        },\n        created () {\n            this.publicScript = checkPublicScript(this.$route);\n            this.serviceHandler = this.publicScript ? PublicScriptService : ScriptService;\n            this.scriptId = this.$route.params.scriptId;\n            this.scriptVersionId = this.$route.params.scriptVersionId;\n            this.statusFilters = [\n                { value: 0, text: '未上线' },\n                { value: 1, text: '已上线' },\n                { value: 2, text: '已下线' },\n                { value: 3, text: '已禁用' },\n            ];\n            this.fetchData();\n            this.fetchLastScriptVersionDetail();\n        },\n        methods: {\n            /**\n             * @desc 获取引用脚本的模板\n             */\n            fetchData () {\n                this.isLoading = true;\n                this.serviceHandler.scriptRefTemplateSteps({\n                    id: this.scriptId,\n                    scriptVersionId: this.scriptVersionId,\n                }).then((data) => {\n                    this.data = Object.freeze(data);\n                })\n                    .finally(() => {\n                        this.isLoading = false;\n                    });\n            },\n            /**\n             * @desc 最新脚本版本数据\n             */\n            fetchLastScriptVersionDetail () {\n                this.serviceHandler.versionDetail({\n                    id: this.$route.params.scriptVersionId,\n                }).then((data) => {\n                    this.lastVersionScriptInfo = Object.freeze(data);\n                });\n            },\n            /**\n             * @desc 列表搜索\n             */\n            handleInputChange: _.throttle(function () {\n                this.filterData = this.data.filter(item => item.templateName.includes(this.value));\n            }, 300),\n            /**\n             * @desc 跳转模板详情\n             * @param {Number} id 模板ID\n             */\n            handleGoTemplateDetail (id) {\n                const routerUrl = this.$router.resolve({\n                    name: 'templateDetail',\n                    params: {\n                        id,\n                    },\n                });\n                window.open(routerUrl.href, '_blank');\n            },\n            /**\n             * @desc 列表行选择\n             */\n            handleSelectionChange (selection) {\n                this.selectedList = Object.freeze(selection);\n            },\n            /**\n             * @desc 脚本对比\n             * @param {Object}  row 脚本数据\n             */\n            handleComparison (row) {\n                this.serviceHandler.versionDetail({\n                    id: 4 || row.scriptVersionId,\n                }).then((data) => {\n                    this.selectScriptVersionId = data.scriptVersionId;\n                    this.diffList = Object.freeze([\n                        data,\n                        this.lastVersionScriptInfo,\n                    ]);\n                    this.showDiff = true;\n                });\n            },\n            /**\n             * @desc 关闭脚本对比\n             */\n            handleDiffClose () {\n                this.showDiff = false;\n            },\n            /**\n             * @desc 取消\n             */\n            handleCancel () {\n                this.routerBack();\n            },\n            /**\n             * @desc 跳转到同步任务页面\n             */\n            handleSync () {\n                const stepList = this.selectedList.map(({ templateId, stepId }) => ({\n                    templateId,\n                    stepId,\n                }));\n                const routerName = this.publicScript ? 'scriptPublicSyncTask' : 'scriptSyncTask';\n                this.$router.push({\n                    name: routerName,\n                    params: {\n                        scriptId: this.scriptId,\n                        scriptVersionId: this.scriptVersionId,\n                    },\n                });\n                localStorage.setItem('SYNC_TEMPLATE_STEP_SCRIPT', JSON.stringify(stepList));\n            },\n            /**\n             * @desc 列表过滤\n             */\n            statusFilterMethod (value, row, column) {\n                return row.scriptStatus === value;\n            },\n            /**\n             * @desc 显示脚本详情\n             * @param {Number} scriptVersionId 脚本版本id\n             */\n            handleShowScriptDetail (scriptVersionId) {\n                this.selectScriptVersionId = scriptVersionId;\n                this.showSideslider = true;\n            },\n            /**\n             * @desc 路由回退\n             */\n            routerBack () {\n                const routerName = this.publicScript ? 'publicScriptVersion' : 'scriptVersion';\n                this.$router.push({\n                    name: routerName,\n                    params: {\n                        id: this.scriptId,\n                    },\n                });\n            },\n        },\n    };\n</script>\n<style lang=\"postcss\" scoped>\n    .script-manage-sync-confirm {\n        .search-input {\n            width: 500px;\n        }\n\n        .table-top {\n            height: 42px;\n            padding: 0 20px;\n            margin-top: 16px;\n            font-size: 12px;\n            line-height: 42px;\n            background-color: #f0f1f5;\n        }\n\n        .template-script-record {\n            &:hover {\n                .template-link {\n                    display: inline;\n                }\n            }\n        }\n\n        .job-template-name {\n            .template-link {\n                display: none;\n                margin-left: 5px;\n            }\n        }\n\n        .table-selected {\n            color: #a3a6af;\n        }\n\n        .status-action {\n            width: 46px;\n            height: 16px;\n            padding: 0 5px;\n            margin-left: 10px;\n            font-size: 12px;\n            color: #9fa2ac;\n            text-align: center;\n            background: #f0f1f5;\n        }\n\n        .status-online {\n            color: #45c272;\n            background-color: #e5f6ea;\n        }\n\n        .footer-action {\n            position: fixed;\n            bottom: 0;\n            left: 0;\n            display: flex;\n            width: 100%;\n            height: 52px;\n            padding-right: 24px;\n            background: #fff;\n            border-top: 1px solid #e2e2e2;\n            align-items: center;\n            justify-content: flex-end;\n        }\n    }\n</style>\n"],"names":[],"sourceRoot":""}