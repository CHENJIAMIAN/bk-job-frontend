{"version":3,"file":"static/css/3243.994bf68dd3cb3eafc15b.css","mappings":"AAwEA,uCAEA,yBADA,UAyJA,CAtJA,oFAKA,8BAFA,eADA,YAEA,iBAEA,CAEA,0CAIA,cADA,gBADA,aADA,iBAQA,CAHA,sDACA,WACA,CAGA,0CAEA,6BADA,aAEA,CAEA,qDACA,YACA,eAaA,CAXA,2DAMA,gCACA,WAFA,YAFA,WAFA,kBACA,MAMA,wBACA,+BALA,WAMA,CAGA,mDAEA,qBADA,kBAGA,kBADA,UAYA,CATA,2DAEA,SADA,QAEA,CAEA,4DAEA,UADA,QAEA,CAGA,qDAKA,yBACA,kBAFA,eADA,eADA,cADA,kBAMA,qBAYA,CAVA,4DACA,oBACA,CAEA,qEAGA,mBAFA,aACA,sBAEA,sBACA,CAGA,qDACA,WACA,CAEA,sDACA,kBAEA,UADA,OAEA,CAEA,qDAGA,cADA,eADA,cAGA,CAEA,uDAKA,mBAJA,aAGA,eAFA,YAIA,uBAHA,eAqBA,CAhBA,iEAEA,cACA,eAFA,YAGA,CAGA,uEACA,oBACA,CAEA,mJAEA,YACA,CAIA,qDAEA,cACA,eAFA,cAGA,CAEA,oDAEA,yBADA,aAqBA,CAlBA,kEACA,aACA,CAGA,oFACA,YACA,CAEA,6KAEA,oBACA,CAGA,kEACA,aACA,CC7MA,eAIA,mBADA,gBADA,kBADA,iBA4BA,CAvBA,yBAQA,gCACA,kCAFA,mCADA,SAHA,UAFA,kBACA,SAGA,QADA,SAkBA,CAXA,8BAQA,gCACA,kCAFA,mCAHA,cAEA,SAHA,UAFA,kBACA,QAGA,OAKA,CCKA,2BACA,aACA,gBAgCA,CA9BA,yCAKA,cACA,eAFA,eAHA,kBAEA,UADA,QAKA,CAEA,kCAEA,cADA,cAEA,CAEA,yCACA,eAKA,CAHA,yDACA,YACA,CAGA,2CAEA,YADA,eAEA,CAEA,wDACA,YACA,CCsFA,uBACA,YAyBA,CAvBA,yEAEA,MACA,CAEA,oCAEA,eADA,kBAYA,CATA,0CACA,cAEA,gBADA,mBAEA,CAEA,yCACA,aACA,CAGA,qCACA,0BACA,CAGA,sBAEA,gBADA,iBAaA,CAVA,wCACA,iBACA,gBACA,CAEA,sCACA,kBAEA,QADA,SAEA,CAGA,iBACA,kBACA,CAEA,sBACA,YAKA,CAHA,iCACA,gBACA,CAIA,0CACA,YACA,CC3BA,oBACA,aACA,uBAEA,oBADA,gBAsBA,CAnBA,4BACA,WACA,CAEA,iCACA,kBACA,CAEA,8BACA,eAKA,CAHA,mCACA,gCACA,CAGA,gCACA,eACA,CAIA,sBACA,aACA,CAEA,4BACA,gBACA,CAGA,eACA,iBACA,CCtJA,uBACA,aAEA,uBADA,cAoBA,CAjBA,+BACA,WACA,CAEA,sCACA,kBACA,CAEA,qCAGA,cADA,eADA,eAGA,CAEA,mCACA,eACA,CCbA,mBACA,aACA,uBAEA,oBADA,gBAoCA,CAjCA,2BACA,kBACA,CAEA,kCAEA,mBAGA,cAJA,aAEA,yBACA,kBAoBA,CAjBA,wCACA,cACA,CAEA,oDAEA,iBADA,WAEA,CAEA,wCAEA,qBADA,WAEA,CAEA,yCACA,cACA,CAGA,+BACA,eACA,CCcA,oBACA,aACA,uBAEA,oBADA,gBAkDA,CA/CA,4BACA,kBACA,CAEA,8BACA,eAKA,CAHA,mCACA,gCACA,CAGA,iCAEA,mBADA,kBAEA,CAEA,gCACA,eACA,CAEA,2BAGA,uBAFA,aACA,2BAEA,kBAqBA,CAnBA,qCACA,eACA,CAEA,yCAEA,mBADA,YAEA,CAEA,kCAEA,gBADA,cAEA,CAGA,2DACA,gBACA,CAKA,uBACA,kBACA,iBAMA,CAJA,sCAEA,aADA,WAEA,CC3BA,yBACA,aACA,uBACA,cAgCA,CA9BA,uCACA,YACA,CAEA,oCAGA,mBACA,4BACA,yBAHA,iBADA,UAKA,CAEA,8CACA,YASA,CAPA,oEACA,MAKA,CAHA,0FACA,UACA,CAIA,0CAIA,cAFA,eACA,iBAFA,gBAIA,CCzJA,8CACA,YACA,CAGA,mCAIA,gBAEA,yCAJA,iBACA,gBAFA,UAMA,CAEA,oCACA,kBAEA,WADA,SAEA,CAEA,iCAKA,cAHA,eACA,gBACA,cAHA,kBAKA,CAEA,iCACA,UACA,2BACA,CAEA,wCACA,6CACA,CAMA,yEACA,YACA","sources":["webpack://job/./src/views/global-setting/index/components/notify-channel-table.vue","webpack://job/./src/components/render-strategy/index.vue","webpack://job/./src/views/global-setting/index/components/internal-variable.vue","webpack://job/./src/views/global-setting/index/components/edit-of-template.vue","webpack://job/./src/views/global-setting/index/pages/notify-manage.vue","webpack://job/./src/views/global-setting/index/pages/storage-strategy.vue","webpack://job/./src/views/global-setting/index/pages/account-rule.vue","webpack://job/./src/views/global-setting/index/pages/platform-info.vue","webpack://job/./src/views/global-setting/index/pages/file-upload.vue","webpack://job/./src/views/global-setting/index/index.vue"],"sourcesContent":["\r\n\r\n<template>\r\n    <table class=\"notify-channel-table\">\r\n        <thead>\r\n            <tr>\r\n                <th>\r\n                    <div class=\"split-header\">\r\n                        <span class=\"split-item channel\">{{ $t('setting.渠道') }}</span>\r\n                        <span class=\"split-item template\">{{ $t('setting.模板') }}</span>\r\n                    </div>\r\n                </th>\r\n                <th v-for=\"(channel, index) in channleList\" :key=\"index\" @click.stop=\"handleToggleChannel(channel.code)\"\r\n                    :class=\"['channel-item', { 'un-selected': !channelCode.includes(channel.code) }]\">\r\n                    <div class=\"channel-wraper\">\r\n                        <img class=\"channel-icon\" :src=\"channel.icon\" alt=\"\">\r\n                        <p class=\"channel-name\">{{ channel.name }}</p>\r\n                    </div>\r\n                    <bk-checkbox class=\"channel-check\" :checked=\"channelCode.includes(channel.code)\" />\r\n                </th>\r\n            </tr>\r\n        </thead>\r\n        <tbody>\r\n            <tr v-for=\"(template, index) in templateList\" :key=\"index\">\r\n                <td>{{ template.name }}</td>\r\n                <td v-for=\"(channl, colIndex) in channleList\" :key=\"colIndex\"\r\n                    :class=\"{ 'un-selected': !channelCode.includes(channl.code) }\">\r\n                    <div class=\"setting-detail\">\r\n                        <Icon v-if=\"getConfigStatus(channl.templateInfoList, template.code)\" type=\"check\" class=\"setting-flag\" />\r\n                        <span v-else class=\"un-set-up\">{{ $t('setting.未设置') }}</span>\r\n                        <span class=\"edit-btn\" @click.stop=\"handleEditTemplate(channl.code, template.code)\">\r\n                            <Icon type=\"edit-2\" class=\"edit-icon\" />{{ $t('setting.编辑模板') }}\r\n                        </span>\r\n                    </div>\r\n                </td>\r\n            </tr>\r\n        </tbody>\r\n    </table>\r\n</template>\r\n\r\n<script>\r\n    export default {\r\n        props: {\r\n            channleList: {\r\n                type: Array,\r\n                default: () => [],\r\n            },\r\n            channelCode: {\r\n                type: Array,\r\n                default: () => [],\r\n            },\r\n            handleToggleChannel: {\r\n                type: Function,\r\n            },\r\n            handleEditTemplate: {\r\n                type: Function,\r\n            },\r\n        },\r\n        computed: {\r\n            templateList () {\r\n                return this.channleList.length && (this.channleList[0].templateInfoList || []);\r\n            },\r\n        },\r\n        methods: {\r\n            getConfigStatus (templateList, code) {\r\n                return templateList.some(template => template.code === code && template.isConfiged);\r\n            },\r\n        },\r\n    };\r\n</script>\r\n\r\n<style lang='postcss' scoped>\r\n    .notify-channel-table {\r\n        width: 100%;\r\n        border: 1px solid #dcdee5;\r\n\r\n        th,\r\n        td {\r\n            height: 42px;\r\n            font-size: 12px;\r\n            text-align: center;\r\n            border-left: 1px solid #dcdee5;\r\n        }\r\n\r\n        th {\r\n            position: relative;\r\n            height: 100px;\r\n            font-weight: normal;\r\n            color: #313238;\r\n\r\n            &:first-child {\r\n                width: 202px;\r\n            }\r\n        }\r\n\r\n        td {\r\n            color: #63656e;\r\n            border-top: 1px solid #dcdee5;\r\n        }\r\n\r\n        .split-header {\r\n            height: 100%;\r\n            text-align: left;\r\n\r\n            &::after {\r\n                position: absolute;\r\n                top: 0;\r\n                left: -12px;\r\n                width: 224px;\r\n                height: 49px;\r\n                border-bottom: 1px solid #dcdee5;\r\n                content: \"\";\r\n                transform: rotateZ(26deg);\r\n                transform-origin: bottom center;\r\n            }\r\n        }\r\n\r\n        .split-item {\r\n            position: relative;\r\n            display: inline-block;\r\n            width: 100%;\r\n            text-align: center;\r\n\r\n            &.channel {\r\n                top: 18px;\r\n                left: 14%;\r\n            }\r\n\r\n            &.template {\r\n                top: 48px;\r\n                right: 14%;\r\n            }\r\n        }\r\n\r\n        .channel-item {\r\n            position: relative;\r\n            margin: 0 10px;\r\n            font-size: 40px;\r\n            cursor: pointer;\r\n            border: 1px solid #dcdee5;\r\n            border-radius: 4px;\r\n            transition: border 0.1s;\r\n\r\n            &.active {\r\n                border-color: #3a84ff;\r\n            }\r\n\r\n            .channel-wraper {\r\n                display: flex;\r\n                flex-direction: column;\r\n                align-items: center;\r\n                justify-content: center;\r\n            }\r\n        }\r\n\r\n        .channel-icon {\r\n            height: 40px;\r\n        }\r\n\r\n        .channel-check {\r\n            position: absolute;\r\n            top: 8px;\r\n            right: 8px;\r\n        }\r\n\r\n        .channel-name {\r\n            margin-top: 8px;\r\n            font-size: 12px;\r\n            color: #63656e;\r\n        }\r\n\r\n        .setting-detail {\r\n            display: flex;\r\n            height: 100%;\r\n            min-width: 100px;\r\n            font-size: 12px;\r\n            align-items: center;\r\n            justify-content: center;\r\n\r\n            .edit-btn {\r\n                display: none;\r\n                color: #3a84ff;\r\n                cursor: pointer;\r\n            }\r\n\r\n            &:hover {\r\n                .edit-btn {\r\n                    display: inline-block;\r\n                }\r\n\r\n                .setting-flag,\r\n                .un-set-up {\r\n                    display: none;\r\n                }\r\n            }\r\n        }\r\n\r\n        .setting-flag {\r\n            font-size: 26px;\r\n            color: #979ba5;\r\n            cursor: pointer;\r\n        }\r\n\r\n        .un-selected {\r\n            color: #d6d9e0;\r\n            background-color: #fafbfd;\r\n\r\n            .channel-name {\r\n                color: #d6d9e0;\r\n            }\r\n\r\n            .setting-detail:hover {\r\n                .edit-btn {\r\n                    display: none;\r\n                }\r\n\r\n                .setting-flag,\r\n                .un-set-up {\r\n                    display: inline-block;\r\n                }\r\n            }\r\n\r\n            .setting-flag {\r\n                color: #d6d9e0;\r\n            }\r\n        }\r\n    }\r\n</style>\r\n","\r\n\r\n<template>\r\n    <div class=\"strategy-item\" :style=\"{ width: `${width}px` }\">\r\n        <div class=\"triangle\" :style=\"{ left: `${left}px` }\" />\r\n        <div>\r\n            <slot />\r\n        </div>\r\n    </div>\r\n</template>\r\n<script>\r\n    export default {\r\n        props: {\r\n            width: String,\r\n            left: String,\r\n        },\r\n    };\r\n</script>\r\n<style lang=\"postcss\">\r\n    .strategy-item {\r\n        position: relative;\r\n        padding: 16px 20px;\r\n        margin-top: 10px;\r\n        background: #f0f1f5;\r\n\r\n        .triangle {\r\n            position: absolute;\r\n            top: -7px;\r\n            left: 84px;\r\n            z-index: 1;\r\n            width: 0;\r\n            height: 0;\r\n            border-right: 7px solid transparent;\r\n            border-bottom: 7px solid #f0f1f5;\r\n            border-left: 7px solid transparent;\r\n\r\n            span {\r\n                position: absolute;\r\n                top: 2px;\r\n                left: -9px;\r\n                display: block;\r\n                width: 0;\r\n                height: 0;\r\n                border-right: 6px solid transparent;\r\n                border-bottom: 6px solid #fafbfd;\r\n                border-left: 6px solid transparent;\r\n            }\r\n        }\r\n    }\r\n</style>\r\n","\r\n\r\n<template>\r\n    <div class=\"internal-variable-wrapper\">\r\n        <Icon type=\"close\" class=\"close-dialog\" @click.stop=\"handleClose(false)\" />\r\n        <header>{{ $t('setting.内置变量列表') }}</header>\r\n        <bk-tab :active=\"variableType\"\r\n            type=\"unborder-card\"\r\n            class=\"variable-tab\"\r\n            :before-toggle=\"handleTabChange\">\r\n            <bk-tab-panel name=\"general\" :label=\"$t('setting.通用变量')\" />\r\n            <bk-tab-panel name=\"job\" :label=\"$t('setting.作业变量')\" />\r\n            <bk-tab-panel name=\"cron\" :label=\"$t('setting.定时任务变量')\" />\r\n        </bk-tab>\r\n        <bk-table class=\"variable-table\" :data=\"renderList\">\r\n            <bk-table-column :label=\"$t('setting.变量名称')\" prop=\"name\" />\r\n            <bk-table-column :label=\"$t('setting.含义')\" prop=\"meaning\" />\r\n            <bk-table-column :label=\"$t('setting.示例')\" :width=\"320\" prop=\"examples\" />\r\n        </bk-table>\r\n    </div>\r\n</template>\r\n<script>\r\n    import {\r\n        InternalVariables,\r\n    } from './variables';\r\n\r\n    export default {\r\n        props: {\r\n            handleClose: {\r\n                type: Function,\r\n            },\r\n        },\r\n        data () {\r\n            return {\r\n                variableType: 'general',\r\n            };\r\n        },\r\n        computed: {\r\n            renderList () {\r\n                return InternalVariables[this.variableType];\r\n            },\r\n        },\r\n        methods: {\r\n            handleTabChange (tab) {\r\n                this.variableType = tab;\r\n            },\r\n        },\r\n    };\r\n</script>\r\n\r\n<style lang=\"postcss\">\r\n    .internal-variable-wrapper {\r\n        height: 586px;\r\n        padding-top: 16px;\r\n\r\n        .close-dialog {\r\n            position: absolute;\r\n            top: 10px;\r\n            right: 6px;\r\n            font-size: 28px;\r\n            color: #979ba5;\r\n            cursor: pointer;\r\n        }\r\n\r\n        header {\r\n            font-size: 20px;\r\n            color: #313238;\r\n        }\r\n\r\n        .variable-tab {\r\n            margin-top: 10px;\r\n\r\n            .bk-tab-section {\r\n                display: none;\r\n            }\r\n        }\r\n\r\n        .variable-table {\r\n            margin-top: 20px;\r\n            border: none;\r\n        }\r\n\r\n        .bk-table-outer-border::after {\r\n            display: none;\r\n        }\r\n    }\r\n</style>\r\n","\r\n\r\n<template>\r\n    <div>\r\n        <div class=\"detail-layout-wrapper\">\r\n            <div class=\"channel-detail-layout\">\r\n                <div class=\"layout-left\">\r\n                    <div class=\"detail-item\">\r\n                        <label>{{ $t('setting.渠道类型：') }}</label>\r\n                        <span>{{ formData.name }}</span>\r\n                    </div>\r\n                    <div class=\"detail-item\">\r\n                        <label>{{ $t('setting.消息类型：') }}</label>\r\n                        <span>{{ formData.messageTypeLabel }}</span>\r\n                    </div>\r\n                </div>\r\n                <div class=\"layout-right\">\r\n                    <div class=\"detail-item\">\r\n                        <label>{{ $t('setting.最近修改人：') }}</label>\r\n                        <span>{{ formData.lastModifier }}</span>\r\n                    </div>\r\n                    <div class=\"detail-item\">\r\n                        <label>{{ $t('setting.最近修改时间：') }}</label>\r\n                        <span>{{ formData.lastModifyTime }}</span>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n        <jb-form class=\"notify-template-form\" ref=\"templateForm\" :model=\"formData\" form-type=\"vertical\" :rules=\"rules\">\r\n            <jb-form-item v-if=\"formData.code === 'mail'\" :label=\"$t('setting.邮件主题')\" required :property=\"'title'\">\r\n                <bk-input\r\n                    v-model=\"formData.title\"\r\n                    @change=\"value => handleChange(value, 'title')\" />\r\n            </jb-form-item>\r\n            <jb-form-item :label=\"$t('setting.模板内容')\" required :property=\"'content'\">\r\n                <bk-button text @click=\"toggleShowVariable(true)\">{{ $t('setting.内置变量') }}</bk-button>\r\n                <bk-input\r\n                    v-model=\"formData.content\"\r\n                    type=\"textarea\"\r\n                    @change=\"value => handleChange(value, 'content')\" />\r\n            </jb-form-item>\r\n        </jb-form>\r\n        <div class=\"message-preview\">\r\n            <bk-button text @click=\"isShowPreviewSend = !isShowPreviewSend\">{{ $t('setting.消息预览') }}</bk-button>\r\n            <render-strategy left=\"20\" v-if=\"isShowPreviewSend\">\r\n                <div class=\"send-message-content\">\r\n                    <jb-user-selector\r\n                        :placeholder=\"$t('setting.请输入接收消息预览的用户名（请确保接受人对应的账号配置正常）')\"\r\n                        class=\"input\"\r\n                        :user=\"reciverList\"\r\n                        :show-role=\"false\"\r\n                        @on-change=\"handleApprovalUserChange\" />\r\n                    <bk-button\r\n                        theme=\"primary\"\r\n                        :loading=\"isLoading\"\r\n                        \r\n                        @click=\"handleSend\">\r\n                        {{ $t('setting.发送') }}\r\n                    </bk-button>\r\n                </div>\r\n            </render-strategy>\r\n        </div>\r\n        <jb-dialog\r\n            v-model=\"isShowVariable\"\r\n            class=\"internal-variable-dialog\"\r\n            :width=\"960\"\r\n            :show-footer=\"false\">\r\n            <internalVariable :handle-close=\"toggleShowVariable\" />\r\n        </jb-dialog>\r\n    </div>\r\n</template>\r\n\r\n<script>\r\n    import I18n from '@/i18n';\r\n    import GlobalSettingService from '@service/global-setting';\r\n    import RenderStrategy from '@components/render-strategy';\r\n    import InternalVariable from './internal-variable';\r\n    import JbUserSelector from '@components/jb-user-selector';\r\n\r\n    const getDefaultData = () => ({\r\n        // 渠道code\r\n        code: '',\r\n        // 消息模板正文\r\n        content: '',\r\n        // 最近修改人\r\n        lastModifier: '',\r\n        // 最近修改时间\r\n        lastModifyTime: '',\r\n        // 消息类型\r\n        messageTypeCode: '',\r\n        // 消息类型名称\r\n        messageTypeLabel: '',\r\n        // 渠道名称\r\n        name: '',\r\n        // 消息模板标题\r\n        title: '',\r\n    });\r\n\r\n    export default {\r\n        components: {\r\n            RenderStrategy,\r\n            InternalVariable,\r\n            JbUserSelector,\r\n        },\r\n        props: {\r\n            data: {\r\n                type: Object,\r\n                default: () => ({}),\r\n            },\r\n        },\r\n        data () {\r\n            return {\r\n                isShowPreviewSend: false,\r\n                isShowVariable: false,\r\n                isLoading: false,\r\n                reciverList: [{},{},{}],\r\n                formData: getDefaultData(),\r\n            };\r\n        },\r\n        watch: {\r\n            data (newVal) {\r\n                if (newVal) this.formData = newVal;\r\n            },\r\n        },\r\n        created () {\r\n            this.formData = this.data || {};\r\n            this.rules = {\r\n                content: [\r\n                    { required: true, message: I18n.t('setting.模板内容必填'), trigger: 'blur' },\r\n                ],\r\n            };\r\n            if (this.formData.code === 'mail') {\r\n                this.rules.title = [\r\n                    { required: true, message: I18n.t('setting.邮件主题必填'), trigger: 'blur' },\r\n                ];\r\n            }\r\n        },\r\n        methods: {\r\n            toggleShowVariable (isShow) {\r\n                this.isShowVariable = isShow;\r\n            },\r\n            handleChange (value) {\r\n                this.$emit('on-change', value);\r\n            },\r\n            handleApprovalUserChange (user, role) {\r\n                this.reciverList = user;\r\n            },\r\n            handleSend () {\r\n                const { code, messageTypeCode, content, title } = this.formData;\r\n                const params = {\r\n                    channelCode: code,\r\n                    messageTypeCode,\r\n                    content,\r\n                    title,\r\n                    receiverStr: this.reciverList.join(','),\r\n                };\r\n                this.isLoading = true;\r\n                GlobalSettingService.sendNotifyPreview(params)\r\n                    .then((data) => {\r\n                        this.messageSuccess(I18n.t('setting.发送成功'));\r\n                    })\r\n                    .finally(() => {\r\n                        this.isLoading = false;\r\n                    });\r\n            },\r\n        },\r\n    };\r\n</script>\r\n\r\n<style lang=\"postcss\">\r\n    .channel-detail-layout {\r\n        display: flex;\r\n\r\n        .layout-left,\r\n        .layout-right {\r\n            flex: 1;\r\n        }\r\n\r\n        .detail-item {\r\n            margin-bottom: 20px;\r\n            font-size: 14px;\r\n\r\n            label {\r\n                color: #b2b5bd;\r\n                word-break: keep-all;\r\n                white-space: pre;\r\n            }\r\n\r\n            span {\r\n                color: #63656e;\r\n            }\r\n        }\r\n\r\n        .detail-label {\r\n            justify-content: flex-start;\r\n        }\r\n    }\r\n\r\n    .notify-template-form {\r\n        position: relative;\r\n        margin-top: 20px;\r\n\r\n        .bk-form-textarea {\r\n            max-height: 400px;\r\n            min-height: 280px;\r\n        }\r\n\r\n        .bk-button-text {\r\n            position: absolute;\r\n            top: -32px;\r\n            right: 0;\r\n        }\r\n    }\r\n\r\n    .message-preview {\r\n        margin-bottom: 20px;\r\n    }\r\n\r\n    .send-message-content {\r\n        display: flex;\r\n\r\n        .bk-button {\r\n            margin-left: 10px;\r\n        }\r\n    }\r\n\r\n    .internal-variable-dialog {\r\n        .bk-dialog-tool {\r\n            display: none;\r\n        }\r\n    }\r\n</style>\r\n","\r\n\r\n<template>\r\n    <div class=\"notify-set-manange\" v-bkloading=\"{ isLoading }\">\r\n        <jb-form v-if=\"!isLoading\" :model=\"formData\" class=\"wraper\">\r\n            <div class=\"block-title\">{{ $t('setting.用户可选择的通知渠道') }}：</div>\r\n            <notify-channel\r\n                :channle-list=\"channleList\"\r\n                :channel-code=\"formData.channelCode\"\r\n                :handle-toggle-channel=\"handleToggleChannel\"\r\n                :handle-edit-template=\"handleEditTemplate\" />\r\n            <div class=\"backlist block-title\">\r\n                <span v-bk-tooltips=\"backlistConfig\">{{ $t('setting.通讯黑名单') }}:</span>\r\n            </div>\r\n            <div>\r\n                <jb-user-selector\r\n                    :placeholder=\"$t('setting.请输入')\"\r\n                    :user=\"formData.users\"\r\n                    :show-role=\"false\"\r\n                    @on-change=\"handleBlackListChange\" />\r\n            </div>\r\n            <div class=\"action-box\">\r\n                <bk-button\r\n                    theme=\"primary\"\r\n                    :loading=\"isSubmiting\"\r\n                    class=\"w120 mr10\"\r\n                    @click=\"handleSave\">\r\n                    {{ $t('setting.保存') }}\r\n                </bk-button>\r\n                <bk-button @click=\"handleReset\">{{ $t('setting.重置') }}</bk-button>\r\n            </div>\r\n        </jb-form>\r\n        <jb-sideslider :is-show.sync=\"showTemplateEdit\" :title=\"$t('setting.消息模板编辑')\" :width=\"680\">\r\n            <edit-of-template ref=\"editTemplate\" :data=\"templateDetail\" @on-change=\"handleNotifyContent\" />\r\n            <template #footer>\r\n                <bk-button\r\n                    theme=\"primary\"\r\n                    class=\"slider-action\"\r\n                    :loading=\"isSaveLoading\"\r\n                    @click=\"handleTriggerSave\">\r\n                    {{ $t('setting.保存') }}\r\n                </bk-button>\r\n                <bk-button class=\"slider-action\" @click=\"handleTriggerReset\">{{ $t('setting.重置') }}</bk-button>\r\n                <bk-button class=\"slider-action\" @click=\"handleTriggerInit\">{{ $t('setting.初始化') }}</bk-button>\r\n            </template>\r\n        </jb-sideslider>\r\n    </div>\r\n</template>\r\n<script>\r\n    import I18n from '@/i18n';\r\n    import _ from 'lodash';\r\n    import GlobalSettingService from '@service/global-setting';\r\n    import NotifyChannel from '../components/notify-channel-table';\r\n    import JbSideslider from '@components/jb-sideslider';\r\n    import editOfTemplate from '../components/edit-of-template';\r\n    import JbUserSelector from '@components/jb-user-selector';\r\n\r\n    export default {\r\n        name: 'NotifyManage',\r\n        components: {\r\n            JbUserSelector,\r\n            NotifyChannel,\r\n            JbSideslider,\r\n            editOfTemplate,\r\n        },\r\n        data () {\r\n            return {\r\n                isLoading: true,\r\n                isSubmiting: false,\r\n                isSaveLoading: false,\r\n                showTemplateEdit: false,\r\n                formData: {\r\n                    channelCode: [],\r\n                    users: [],\r\n                },\r\n                templateDetail: {},\r\n                currentTemplate: {},\r\n                currentDefaultTemplate: {},\r\n                channleList: [{},{},{}],\r\n                channelCode: [],\r\n                users: [],\r\n            };\r\n        },\r\n        created () {\r\n            this.backlistConfig = {\r\n                width: 202,\r\n                placement: 'top',\r\n                content: I18n.t('setting.「通讯黑名单」的人员将不会接收到任何来自作业平台的消息'),\r\n            };\r\n            this.fetchAllChannelConfig();\r\n            this.fetchAllUserBlacklist();\r\n            this.channelCodeMemo = [];\r\n            this.usersMemo = [];\r\n        },\r\n        methods: {\r\n            fetchAllChannelConfig () {\r\n                GlobalSettingService.fetchAllNotifyChannelConfig({}, {\r\n                    permission: 'page',\r\n                }).then((data) => {\r\n                    this.channleList = data;\r\n                    this.formData.channelCode = data.reduce((result, item) => {\r\n                        if (item.isActive) {\r\n                            result.push(item.code);\r\n                        }\r\n                        return result;\r\n                    }, []);\r\n                    this.channelCodeMemo = [...this.channelCode];\r\n                })\r\n                    .finally(() => {\r\n                        this.isLoading = false;\r\n                    });\r\n            },\r\n            fetchAllUserBlacklist () {\r\n                GlobalSettingService.fetchAllUserBlacklist({}, {\r\n                    permission: 'page',\r\n                }).then((data) => {\r\n                    this.formData.users = data.map(item => item.username);\r\n                    this.usersMemo = [...this.users];\r\n                });\r\n            },\r\n            handleBlackListChange (user, role) {\r\n                this.formData.users = user;\r\n            },\r\n            handleToggleChannel (code) {\r\n                const index = this.formData.channelCode.indexOf(code);\r\n                if (index > -1) {\r\n                    this.formData.channelCode.splice(index, 1);\r\n                } else {\r\n                    this.formData.channelCode.push(code);\r\n                }\r\n            },\r\n            handleEditTemplate (channel, template) {\r\n                GlobalSettingService.fetchChannelTemplate({\r\n                    channelCode: channel,\r\n                    messageTypeCode: template,\r\n                }).then((data) => {\r\n                    const { currentTemplate, defaultTemplate } = data;\r\n                    this.templateDetail = _.cloneDeep(currentTemplate || defaultTemplate);\r\n                    this.currentTemplate = _.cloneDeep(currentTemplate || defaultTemplate);\r\n                    this.currentDefaultTemplate = _.cloneDeep(defaultTemplate);\r\n                })\r\n                    .finally(() => {\r\n                        this.showTemplateEdit = true;\r\n                    });\r\n            },\r\n            handleSave () {\r\n                this.isSubmiting = true;\r\n                Promise.all([\r\n                    GlobalSettingService.updateNotifyChannel({\r\n                        channelCodeStr: this.formData.channelCode.join(','),\r\n                    }).catch(() => {\r\n                        this.messageError(I18n.t('setting.保存通知渠道失败'));\r\n                    }),\r\n                    GlobalSettingService.updateUserBlacklist({\r\n                        usersStr: this.formData.users.join(','),\r\n                    }).catch(() => {\r\n                        this.messageError(I18n.t('setting.保存黑名单失败'));\r\n                    }),\r\n                ]).then(() => {\r\n                    window.changeAlert = false;\r\n                    this.messageSuccess(I18n.t('setting.保存成功'));\r\n                })\r\n                    .finally(() => {\r\n                        this.isSubmiting = false;\r\n                    });\r\n            },\r\n            handleReset () {\r\n                this.formData.channelCode = [...this.channelCodeMemo];\r\n                this.formData.users = [...this.usersMemo];\r\n            },\r\n            handleNotifyContent (value, filed) {\r\n                this.templateDetail[filed] = value;\r\n            },\r\n            handleTriggerSave () {\r\n                this.$refs.editTemplate.$refs.templateForm.validate().then(() => {\r\n                    const { code, messageTypeCode, content, title } = this.templateDetail;\r\n                    const params = {\r\n                        channelCode: code,\r\n                        messageTypeCode,\r\n                        content,\r\n                        title,\r\n                    };\r\n                    GlobalSettingService.updateNotifyTemplate(params)\r\n                        .then((data) => {\r\n                            this.showTemplateEdit = false;\r\n                            this.messageSuccess(I18n.t('setting.保存成功'));\r\n                        })\r\n                        .finally(() => {\r\n                            this.isSaveLoading = false;\r\n                        });\r\n                });\r\n            },\r\n            handleTriggerReset () {\r\n                this.templateDetail = _.cloneDeep(this.currentTemplate);\r\n            },\r\n            handleTriggerInit () {\r\n                this.templateDetail = _.cloneDeep(this.currentDefaultTemplate);\r\n            },\r\n        },\r\n    };\r\n</script>\r\n<style lang='postcss'>\r\n    .notify-set-manange {\r\n        display: flex;\r\n        justify-content: center;\r\n        padding-top: 40px;\r\n        padding-bottom: 40px;\r\n\r\n        .wraper {\r\n            width: 960px;\r\n        }\r\n\r\n        .block-title {\r\n            margin-bottom: 12px;\r\n        }\r\n\r\n        .backlist {\r\n            margin-top: 38px;\r\n\r\n            span {\r\n                border-bottom: 1px dashed #c4c6cc;\r\n            }\r\n        }\r\n\r\n        .action-box {\r\n            margin-top: 30px;\r\n        }\r\n    }\r\n\r\n    .member-item {\r\n        &.disabled {\r\n            color: #c4c6cc;\r\n        }\r\n\r\n        .job-icon-user {\r\n            margin-right: 8px;\r\n        }\r\n    }\r\n\r\n    .slider-action {\r\n        margin-right: 10px;\r\n    }\r\n</style>\r\n","\r\n\r\n<template>\r\n    <div class=\"page-storage-strategy\" v-bkloading=\"{ isLoading }\">\r\n        <div class=\"wraper\">\r\n            <div class=\"execute-block\">\r\n                <div class=\"block-title\">{{ $t('setting.执行历史保留') }}：</div>\r\n                <jb-form ref=\"form\" :model=\"formData\" :rules=\"rules\" form-type=\"vertical\">\r\n                    <jb-form-item property=\"days\">\r\n                        <bk-input v-model=\"formData.days\" type=\"number\" :min=\"1\">\r\n                            <template slot=\"append\">\r\n                                <div class=\"group-text\">{{ $t('setting.天') }}</div>\r\n                            </template>\r\n                        </bk-input>\r\n                    </jb-form-item>\r\n                </jb-form>\r\n            </div>\r\n            <div class=\"action-box\">\r\n                <bk-button\r\n                    class=\"w120 mr10\"\r\n                    theme=\"primary\"\r\n                    :loading=\"isSubmiting\"\r\n                    @click=\"handleSave\">\r\n                    {{ $t('setting.保存') }}\r\n                </bk-button>\r\n                <bk-button @click=\"handleReset\">{{ $t('setting.重置') }}</bk-button>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</template>\r\n<script>\r\n    import I18n from '@/i18n';\r\n    import GlobalSettingService from '@service/global-setting';\r\n\r\n    export default {\r\n        name: '',\r\n\r\n        data () {\r\n            return {\r\n                isLoading: false,\r\n                isSubmiting: false,\r\n                formData: {\r\n                    days: 0,\r\n                },\r\n            };\r\n        },\r\n        created () {\r\n            this.fetchData();\r\n            this.memoDay = 0;\r\n            this.rules = {\r\n                days: [\r\n                    {\r\n                        validator: value => value >= 1,\r\n                        message: I18n.t('setting.保留天数必须大于0'),\r\n                        trigger: 'blur',\r\n                    },\r\n                ],\r\n            };\r\n        },\r\n        methods: {\r\n            fetchData () {\r\n                this.isLoading = true;\r\n                GlobalSettingService.fetchHistroyExpire()\r\n                    .then((data) => {\r\n                        this.formData.days = data;\r\n                        this.memoDay = data;\r\n                    })\r\n                    .finally(() => {\r\n                        this.isLoading = false;\r\n                    });\r\n            },\r\n            handleSave () {\r\n                this.$refs.form.validate().then(() => {\r\n                    this.isSubmiting = true;\r\n                    GlobalSettingService.updateHistroyExpire({\r\n                        ...this.formData,\r\n                    }).then(() => {\r\n                        this.messageSuccess(I18n.t('setting.设置执行保留时间成功'));\r\n                    })\r\n                        .finally(() => {\r\n                            this.isSubmiting = false;\r\n                        });\r\n                });\r\n            },\r\n            handleReset () {\r\n                this.formData.days = this.memoDay;\r\n            },\r\n        },\r\n    };\r\n</script>\r\n<style lang='postcss'>\r\n    .page-storage-strategy {\r\n        display: flex;\r\n        padding: 40px 0;\r\n        justify-content: center;\r\n\r\n        .wraper {\r\n            width: 600px;\r\n        }\r\n\r\n        .storage-block {\r\n            margin-bottom: 40px;\r\n        }\r\n\r\n        .storage-tips {\r\n            margin-top: 10px;\r\n            font-size: 12px;\r\n            color: #63656e;\r\n        }\r\n\r\n        .action-box {\r\n            margin-top: 10px;\r\n        }\r\n    }\r\n</style>\r\n","\r\n\r\n<template>\r\n    <div class=\"page-account-rule\" v-bkloading=\"{ isLoading }\">\r\n        <smart-action offset-target=\"expression-input\">\r\n            <div class=\"wraper\">\r\n                <div v-for=\"(rule, index) in currentRules\" :key=\"index\" class=\"account-block\">\r\n                    <div class=\"name\">{{ rule.osTypeText }}</div>\r\n                    <div class=\"expression-input\">\r\n                        <bk-input\r\n                            :value=\"rule.expression\"\r\n                            :placeholder=\"$t('setting.请输入命名规则')\"\r\n                            @change=\"value => handleChange('expression', value, index)\" />\r\n                    </div>\r\n                    <div class=\"rule\">\r\n                        <bk-input\r\n                            :value=\"rule.description\"\r\n                            :placeholder=\"$t('setting.请输入命名规则提醒文案')\"\r\n                            @change=\"value => handleChange('description', value, index)\" />\r\n                    </div>\r\n                    <bk-button text class=\"reset\" @click=\"handleReset(index)\">{{ $t('setting.恢复默认') }}</bk-button>\r\n                </div>\r\n            </div>\r\n            <template #action>\r\n                <bk-button\r\n                    theme=\"primary\"\r\n                    :loading=\"isSubmitting\"\r\n                    class=\"w120 mr10\"\r\n                    @click=\"handleSave\">{{ $t('setting.保存') }}</bk-button>\r\n                <bk-button @click=\"handleResetAll\">{{ $t('setting.重置') }}</bk-button>\r\n            </template>\r\n        </smart-action>\r\n    </div>\r\n</template>\r\n<script>\r\n    import I18n from '@/i18n';\r\n    import _ from 'lodash';\r\n    import GlobalSettingService from '@service/global-setting';\r\n    import SmartAction from '@components/smart-action';\r\n\r\n    export default {\r\n        name: '',\r\n        components: {\r\n            SmartAction,\r\n        },\r\n        data () {\r\n            return {\r\n                isLoading: false,\r\n                isSubmitting: false,\r\n                currentRules: [{},{},{},{}],\r\n            };\r\n        },\r\n        created () {\r\n            this.fetchData();\r\n            this.defaultRules = [];\r\n            this.selfLastRules = [];\r\n        },\r\n        methods: {\r\n            fetchData () {\r\n                this.isLoading = true;\r\n                GlobalSettingService.fetchAllNameRule()\r\n                    .then((data) => {\r\n                        const { currentRules, defaultRules } = data;\r\n                        this.currentRules = currentRules;\r\n                        this.selfLastRules = _.cloneDeep(currentRules);\r\n                        this.defaultRules = defaultRules;\r\n                    })\r\n                    .finally(() => {\r\n                        this.isLoading = false;\r\n                    });\r\n            },\r\n            handleChange (field, value, index) {\r\n                window.changeAlert = true;\r\n                this.currentRules[index][field] = value;\r\n                this.currentRules = [...this.currentRules];\r\n            },\r\n            handleReset (index) {\r\n                const currentRule = _.cloneDeep(this.defaultRules[index]);\r\n                this.currentRules.splice(index, 1, currentRule);\r\n            },\r\n            handleSave () {\r\n                this.isSubmitting = true;\r\n                GlobalSettingService.updateNameRules({\r\n                    rules: this.currentRules,\r\n                }).then(() => {\r\n                    window.changeAlert = false;\r\n                    this.messageSuccess(I18n.t('setting.账号命名规则保存成功'));\r\n                })\r\n                    .finally(() => {\r\n                        this.isSubmitting = false;\r\n                    });\r\n            },\r\n            handleResetAll () {\r\n                this.currentRules = _.cloneDeep(this.selfLastRules);\r\n            },\r\n        },\r\n    };\r\n</script>\r\n<style lang='postcss'>\r\n    .page-account-rule {\r\n        display: flex;\r\n        justify-content: center;\r\n        padding-top: 40px;\r\n        padding-bottom: 40px;\r\n\r\n        .wraper {\r\n            margin-bottom: 30px;\r\n        }\r\n\r\n        .account-block {\r\n            display: flex;\r\n            align-items: center;\r\n            justify-content: flex-end;\r\n            margin-bottom: 20px;\r\n            color: #63656e;\r\n\r\n            .name {\r\n                font-size: 14px;\r\n            }\r\n\r\n            .expression-input {\r\n                width: 300px;\r\n                margin-left: 24px;\r\n            }\r\n\r\n            .rule {\r\n                width: 400px;\r\n                margin: 0 14px 0 10px;\r\n            }\r\n\r\n            .reset {\r\n                font-size: 12px;\r\n            }\r\n        }\r\n\r\n        .action-box {\r\n            margin-top: 30px;\r\n        }\r\n    }\r\n</style>\r\n","\r\n\r\n<template>\r\n    <div class=\"page-platform-info\" v-bkloading=\"{ isLoading }\">\r\n        <smart-action offset-target=\"bk-form-content\">\r\n            <div class=\"wraper\">\r\n                <jb-form ref=\"platformForm\" :model=\"formData\" :rules=\"rules\">\r\n                    <bk-popover placement=\"top\" :width=\"320\" theme=\"light\" :distance=\"-10\">\r\n                        <div class=\"backlist block-title\">\r\n                            <span>{{ $t('setting.网页 Title 设置:') }}</span>\r\n                        </div>\r\n                        <div slot=\"content\" class=\"title-example-popover\">\r\n                            <img src=\"/static/images/title-example.png\" class=\"example-image\">\r\n                        </div>\r\n                    </bk-popover>\r\n                    <hgroup>\r\n                        <jb-form-item\r\n                            :label=\"$t('setting.平台名称')\"\r\n                            required\r\n                            property=\"titleHead\">\r\n                            <jb-input\r\n                                style=\"width: 240px;\"\r\n                                v-model=\"formData.titleHead\" />\r\n                        </jb-form-item>\r\n                        <jb-form-item\r\n                            :label=\"$t('setting.分隔符')\"\r\n                            required\r\n                            property=\"titleSeparator\"\r\n                            class=\"title-separator-item\">\r\n                            <jb-input\r\n                                style=\"width: 240px;\"\r\n                                v-model=\"formData.titleSeparator\" />\r\n                        </jb-form-item>\r\n                        <bk-button\r\n                            text\r\n                            size=\"small\"\r\n                            class=\"reset\"\r\n                            @click=\"handleRestore\">\r\n                            {{ $t('setting.恢复默认') }}\r\n                        </bk-button>\r\n                    </hgroup>\r\n                    <div class=\"block-title\">\r\n                        <span>{{ $t('setting.页脚信息设置') }}:</span>\r\n                    </div>\r\n                    <jb-form-item :label=\"$t('setting.联系方式')\">\r\n                        <jb-input\r\n                            style=\"width: 680px;\"\r\n                            v-model=\"formData.footerLink\" />\r\n                    </jb-form-item>\r\n                    <jb-form-item :label=\"$t('setting.版权信息')\">\r\n                        <jb-input\r\n                            v-model=\"formData.footerCopyRight\" />\r\n                    </jb-form-item>\r\n                </jb-form>\r\n            </div>\r\n            <template #action>\r\n                <bk-button\r\n                    theme=\"primary\"\r\n                    :loading=\"isSubmitting\"\r\n                    class=\"w120 mr10\"\r\n                    @click=\"handleSave\">{{ $t('setting.保存') }}</bk-button>\r\n                <bk-button @click=\"handleReset\">{{ $t('setting.重置') }}</bk-button>\r\n            </template>\r\n        </smart-action>\r\n    </div>\r\n</template>\r\n<script>\r\n    import I18n from '@/i18n';\r\n    import _ from 'lodash';\r\n    import GlobalSettingService from '@service/global-setting';\r\n    import SmartAction from '@components/smart-action';\r\n    import JbInput from '@components/jb-input';\r\n\r\n    const getDefaultData = () => ({\r\n        titleHead: '',\r\n        titleSeparator: '',\r\n        footerLink: '',\r\n        footerCopyRight: '',\r\n    });\r\n\r\n    export default {\r\n        name: '',\r\n        components: {\r\n            SmartAction,\r\n            JbInput,\r\n        },\r\n        data () {\r\n            return {\r\n                isLoading: false,\r\n                isSubmitting: false,\r\n                formData: getDefaultData(),\r\n                currentTitleFooter: {},\r\n                defaultTitleFooter: {},\r\n            };\r\n        },\r\n        created () {\r\n            this.fetchTitleAndFooter();\r\n            this.rules = {\r\n                titleHead: [\r\n                    {\r\n                        required: true,\r\n                        message: I18n.t('setting.平台名称必填'),\r\n                        trigger: 'blur',\r\n                    },\r\n                ],\r\n                titleSeparator: [\r\n                    {\r\n                        required: true,\r\n                        message: I18n.t('setting.分隔符必填'),\r\n                        trigger: 'blur',\r\n                    },\r\n                ],\r\n            };\r\n        },\r\n        methods: {\r\n            fetchTitleAndFooter () {\r\n                this.isLoading = true;\r\n                GlobalSettingService.fetchTitleAndFooterConfig()\r\n                    .then((data) => {\r\n                        this.defaultTitleFooter = _.cloneDeep(data.defaultTitleFooter);\r\n                        this.currentTitleFooter = _.cloneDeep(data.currentTitleFooter);\r\n                        this.formData = { ...this.formData, ...data.currentTitleFooter };\r\n                    })\r\n                    .finally(() => {\r\n                        this.isLoading = false;\r\n                    });\r\n            },\r\n            handleRestore () {\r\n                this.formData = _.cloneDeep(this.defaultTitleFooter);\r\n            },\r\n            handleReset () {\r\n                this.formData = _.cloneDeep(this.currentTitleFooter);\r\n            },\r\n            handleSave () {\r\n                this.$refs.platformForm.validate()\r\n                    .then((validator) => {\r\n                        this.isSubmitting = true;\r\n                        GlobalSettingService.updateTitleAndFooterConfig(this.formData)\r\n                            .then(() => {\r\n                                window.changeAlert = false;\r\n                                this.messageSuccess(I18n.t('setting.保存成功'));\r\n                            })\r\n                            .finally(() => {\r\n                                this.isSubmitting = false;\r\n                            });\r\n                    });\r\n            },\r\n        },\r\n    };\r\n</script>\r\n<style lang='postcss'>\r\n    .page-platform-info {\r\n        display: flex;\r\n        justify-content: center;\r\n        padding-top: 10px;\r\n        padding-bottom: 40px;\r\n\r\n        .wraper {\r\n            margin-bottom: 10px;\r\n        }\r\n\r\n        .backlist {\r\n            margin-top: 38px;\r\n\r\n            span {\r\n                border-bottom: 1px dashed #c4c6cc;\r\n            }\r\n        }\r\n\r\n        .block-title {\r\n            padding-bottom: 6px;\r\n            margin-bottom: 12px;\r\n        }\r\n\r\n        .action-box {\r\n            margin-top: 30px;\r\n        }\r\n\r\n        hgroup {\r\n            display: flex;\r\n            justify-content: flex-start;\r\n            align-items: self-start;\r\n            margin-bottom: 20px;\r\n\r\n            .bk-label {\r\n                text-align: left;\r\n            }\r\n\r\n            .bk-form-item {\r\n                margin-top: 0;\r\n                margin-bottom: 10px;\r\n            }\r\n\r\n            .reset {\r\n                margin-top: 4px;\r\n                margin-left: 2px;\r\n            }\r\n\r\n            .title-separator-item {\r\n                .bk-label {\r\n                    text-align: right;\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    .title-example-popover {\r\n        padding: 20px 10px;\r\n        text-align: center;\r\n\r\n        .example-image {\r\n            width: 270px;\r\n            height: 100px;\r\n        }\r\n    }\r\n</style>\r\n","\r\n\r\n<template>\r\n    <div\r\n        class=\"file-upload-manage-page\"\r\n        v-bkloading=\"{ isLoading }\">\r\n        <smart-action offset-target=\"input-wraper\">\r\n            <jb-form style=\"width: 480px; margin-bottom: 20px;\">\r\n                <div class=\"block-title\">\r\n                    {{ $t('setting.本地文件上传大小限制') }}:\r\n                </div>\r\n                <jb-form-item>\r\n                    <div class=\"input-wraper\">\r\n                        <bk-input v-model=\"info.amount\" />\r\n                        <bk-select\r\n                            v-model=\"info.unit\"\r\n                            class=\"unit-item\"\r\n                            :clearable=\"false\">\r\n                            <bk-option id=\"GB\" name=\"GB\" />\r\n                            <bk-option id=\"MB\" name=\"MB\" />\r\n                        </bk-select>\r\n                    </div>\r\n                </jb-form-item>\r\n                <div class=\"block-title\">\r\n                    {{ $t('setting.本地文件上传后缀限制') }}:\r\n                </div>\r\n                <jb-form-item style=\"margin-bottom: 10px;\">\r\n                    <bk-radio-group\r\n                        v-model=\"info.restrictMode\"\r\n                        class=\"restrict-mode-radio\"\r\n                        @change=\"handleRestSuffixError\">\r\n                        <bk-radio-button :value=\"-1\">\r\n                            {{ $t('setting.不限制') }}\r\n                        </bk-radio-button>\r\n                        <bk-radio-button :value=\"1\">\r\n                            {{ $t('setting.设置允许范围') }}\r\n                        </bk-radio-button>\r\n                        <bk-radio-button :value=\"0\">\r\n                            {{ $t('setting.设置禁止范围') }}\r\n                        </bk-radio-button>\r\n                    </bk-radio-group>\r\n                </jb-form-item>\r\n                <div v-if=\"info.restrictMode > -1\">\r\n                    <jb-form-item>\r\n                        <bk-tag-input\r\n                            v-model=\"info.suffixList\"\r\n                            allow-create\r\n                            has-delete-icon\r\n                            :key=\"info.restrictMode\"\r\n                            @change=\"handleRestSuffixError\" />\r\n                    </jb-form-item>\r\n                    <div class=\"form-item-error\" v-html=\"suffixError\" />\r\n                </div>\r\n            </jb-form>\r\n            <template #action>\r\n                <bk-button\r\n                    class=\"w120\"\r\n                    theme=\"primary\"\r\n                    :loading=\"isSubmiting\"\r\n                    @click=\"handleSubmit\">\r\n                    {{ $t('setting.保存') }}\r\n                </bk-button>\r\n            </template>\r\n        </smart-action>\r\n    </div>\r\n</template>\r\n<script>\r\n    import GlobalSettingService from '@service/global-setting';\r\n    import I18n from '@/i18n';\r\n\r\n    const checkSuffixError = (suffixList) => {\r\n        if (suffixList.length < 1) {\r\n            return I18n.t('setting.不允许为空');\r\n        }\r\n        const errorStack = [];\r\n        const renameStack = [];\r\n        const lengthStack = [];\r\n        const ruleMap = [];\r\n        suffixList.forEach((rule) => {\r\n            // . 开头，后面跟上不超过24个英文字符\r\n            if (rule.length > 25) {\r\n                lengthStack.push(rule);\r\n                return;\r\n            }\r\n            const realRule = rule.toLowerCase();\r\n            // . 开头，中间不允许出现空格\r\n            if (!/^\\.[a-z]+(.[a-z]+)*$/.test(realRule)) {\r\n                errorStack.push(realRule);\r\n                return;\r\n            }\r\n            // 大小写不敏感\r\n            if (!ruleMap[realRule]) {\r\n                ruleMap[realRule] = [];\r\n            } else {\r\n                renameStack.push(ruleMap[realRule]);\r\n            }\r\n            ruleMap[realRule].push(rule);\r\n        });\r\n        let suffixError = '';\r\n        if (lengthStack.length > 0) {\r\n            suffixError += `${lengthStack.join(',')};`;\r\n        }\r\n        if (errorStack.length > 0) {\r\n            suffixError += `${errorStack.join(',')};`;\r\n        }\r\n        if (renameStack.length > 0) {\r\n            const renameError = renameStack.reduce((result, item) => {\r\n                result.push(item.join(','));\r\n                return result;\r\n            }, []).join('；');\r\n            suffixError += renameError;\r\n        }\r\n        return suffixError ? `${I18n.t('setting..开头，后面跟上不超过24个英文字符，中间不允许出现空格：')}${suffixError}` : '';\r\n    };\r\n\r\n    export default {\r\n        data () {\r\n            return {\r\n                isLoading: true,\r\n                isSubmiting: false,\r\n                info: {\r\n                    amount: 0,\r\n                    unit: '',\r\n                    restrictMode: -1,\r\n                    suffixList: [{},{},{}],\r\n                },\r\n                suffixError: '',\r\n            };\r\n        },\r\n        created () {\r\n            this.fetchJobConfig();\r\n        },\r\n        methods: {\r\n            /**\r\n             * @desc 获取配置信息\r\n             */\r\n            fetchJobConfig () {\r\n                this.isLoading = true;\r\n                GlobalSettingService.fetchFileUpload()\r\n                    .then((data) => {\r\n                        this.info = data;\r\n                        if (!data.suffixList || data.suffixList.length < 1) {\r\n                            this.info = {\r\n                                ...this.info,\r\n                                restrictMode: -1,\r\n                                suffixList: [{},{},{}],\r\n                            };\r\n                        }\r\n                    })\r\n                    .finally(() => {\r\n                        this.isLoading = false;\r\n                    });\r\n            },\r\n            handleRestSuffixError () {\r\n                this.suffixError = '';\r\n            },\r\n            /**\r\n             * @desc 提交修改\r\n             */\r\n            handleSubmit () {\r\n                const params = { ...this.info };\r\n\r\n                this.suffixError = '';\r\n                if (params.restrictMode === -1) {\r\n                    params.suffixList = [];\r\n                } else {\r\n                    this.suffixError = checkSuffixError(params.suffixList);\r\n                }\r\n                \r\n                if (this.suffixError) {\r\n                    return;\r\n                }\r\n\r\n                this.isSubmiting = true;\r\n                GlobalSettingService.saveFileUpload(params)\r\n                    .then(() => {\r\n                        this.messageSuccess(I18n.t('setting.保存成功'));\r\n                    })\r\n                    .finally(() => {\r\n                        this.isSubmiting = false;\r\n                    });\r\n            },\r\n        },\r\n    };\r\n</script>\r\n<style lang='postcss'>\r\n    .file-upload-manage-page {\r\n        display: flex;\r\n        justify-content: center;\r\n        padding: 40px 0;\r\n\r\n        .input-wraper {\r\n            display: flex;\r\n        }\r\n\r\n        .unit-item {\r\n            width: 80px;\r\n            margin-left: -2px;\r\n            background: #f5f7fa;\r\n            border-bottom-left-radius: 0;\r\n            border-top-left-radius: 0;\r\n        }\r\n\r\n        .restrict-mode-radio {\r\n            display: flex;\r\n\r\n            .bk-form-radio-button {\r\n                flex: 1;\r\n\r\n                .bk-radio-button-text {\r\n                    width: 100%;\r\n                }\r\n            }\r\n        }\r\n\r\n        .form-item-error {\r\n            margin: -18px 0 0;\r\n            font-size: 12px;\r\n            line-height: 18px;\r\n            color: #ea3636;\r\n        }\r\n    }\r\n</style>\r\n","\r\n\r\n<template>\r\n    <div class=\"page-global-set-up\">\r\n        <bk-tab :active=\"page\" :before-toggle=\"handleTabChange\" class=\"page-tab\">\r\n            <bk-tab-panel name=\"notify\" :label=\"$t('setting.通知设置')\" />\r\n            <!-- <bk-tab-panel name=\"strategy\" :label=\"$t('setting.存储策略')\" /> -->\r\n            <bk-tab-panel name=\"account\" :label=\"$t('setting.账号命名规则')\" />\r\n            <bk-tab-panel name=\"platform\" :label=\"$t('setting.平台信息')\" />\r\n            <bk-tab-panel name=\"fileUpload\" :label=\"$t('setting.文件上传设置')\" />\r\n        </bk-tab>\r\n        <div class=\"set-up-wraper\">\r\n            <transition name=\"slide\">\r\n                <component ref=\"page\" :is=\"pageCom\" class=\"set-up-content\" />\r\n            </transition>\r\n        </div>\r\n    </div>\r\n</template>\r\n<script>\r\n    import { leaveConfirm } from '@utils/assist';\r\n    import NotifyManage from './pages/notify-manage';\r\n    import StorageStrategy from './pages/storage-strategy';\r\n    import AccountRule from './pages/account-rule';\r\n    import PlatformInfo from './pages/platform-info';\r\n    import FileUpload from './pages/file-upload';\r\n\r\n    export default {\r\n        name: '',\r\n        components: {\r\n            NotifyManage,\r\n            StorageStrategy,\r\n            AccountRule,\r\n            PlatformInfo,\r\n            FileUpload,\r\n        },\r\n        data () {\r\n            return {\r\n                page: 'notify',\r\n            };\r\n        },\r\n        computed: {\r\n            isSkeletonLoading () {\r\n                return this.$refs.page.isLoading;\r\n            },\r\n            pageCom () {\r\n                const pageMap = {\r\n                    notify: NotifyManage,\r\n                    strategy: StorageStrategy,\r\n                    account: AccountRule,\r\n                    platform: PlatformInfo,\r\n                    fileUpload: FileUpload,\r\n                };\r\n                return pageMap[this.page];\r\n            },\r\n        },\r\n        methods: {\r\n            handleTabChange (value) {\r\n                return leaveConfirm().then(() => {\r\n                    this.page = value;\r\n                });\r\n            },\r\n        },\r\n    };\r\n</script>\r\n<style lang='postcss'>\r\n    .page-global-set-up {\r\n        .page-tab {\r\n            .bk-tab-section {\r\n                display: none;\r\n            }\r\n        }\r\n\r\n        .set-up-wraper {\r\n            width: 100%;\r\n            min-height: 300px;\r\n            overflow: hidden;\r\n            background: #fff;\r\n            border: 1px solid #dcdee5;\r\n            border-top: none;\r\n        }\r\n\r\n        .set-up-content {\r\n            position: relative;\r\n            z-index: 2;\r\n            width: 100%;\r\n        }\r\n\r\n        .block-title {\r\n            margin-bottom: 14px;\r\n            font-size: 14px;\r\n            font-weight: bold;\r\n            line-height: 1;\r\n            color: #63656e;\r\n        }\r\n\r\n        .slide-enter {\r\n            opacity: 0%;\r\n            transform: translateX(200px);\r\n        }\r\n\r\n        .slide-enter-active, {\r\n            transition: all 0.5s cubic-bezier(0, 0, 0.19, 1.16);\r\n        }\r\n\r\n        .slide-leave {\r\n            display: none;\r\n        }\r\n\r\n        .slide-leave-active {\r\n            display: none;\r\n        }\r\n    }\r\n</style>\r\n"],"names":[],"sourceRoot":""}