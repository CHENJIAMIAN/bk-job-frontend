{"version":3,"file":"static/css/4247.bf0d1abf1f7a1f6b0e2a.css","mappings":"AAoQA,oFACA,cACA,CAKA,uFACA,wBACA,CAGA,uEAEA,yBADA,cAEA,CAEA,gCAEA,mBACA,eAFA,YASA,CAJA,oDACA,aACA,CAIA,kCACA,aACA,CAEA,0CAQA,sBAPA,qBAGA,eACA,gBAFA,YAGA,iBACA,kBALA,UAOA,CAEA,6BAEA,yBADA,aAEA,CAEA,8BAEA,sBADA,aAEA,CAEA,4BAEA,yBADA,aAEA,CAEA,8BACA,wBACA,CAEA,mDACA,aACA","sources":["webpack://job/./src/views/service-state/list/index.vue"],"sourcesContent":["\n<template>\n    <div class=\"service-state-info\" v-bkloading=\"{ isLoading }\">\n        <bk-table\n            :data=\"serviceData\"\n            :size=\"tableSize\"\n            row-key=\"name\"\n            ext-cls=\"service-table\"\n            :expand-row-keys=\"expandRow\"\n            @row-click=\"toggleRowExpansion\">\n            <bk-table-column\n                type=\"expand\"\n                key=\"expand\"\n                :before-expand-change=\"onBeforeExpandChange\">\n                <template slot-scope=\"{ row }\">\n                    <bk-table\n                        ext-cls=\"service-expand-table\"\n                        :data=\"row.instanceList\"\n                        :outer-border=\"false\"\n                        :header-border=\"false\">\n                        <bk-table-column\n                            key=\"index\"\n                            width=\"60\"\n                            :label=\"'序号'\">\n                            <template slot-scope=\"{ $index }\">\n                                #{{ $index + 1 }}\n                            </template>\n                        </bk-table-column>\n                        <bk-table-column\n                            prop=\"name\"\n                            key=\"name\"\n                            width=\"420\"\n                            :label=\"'实例名'\">\n                            <template slot-scope=\"scope\">\n                                {{ scope.row.name }}\n                            </template>\n                        </bk-table-column>\n                        <bk-table-column\n                            prop=\"version\"\n                            key=\"version\"\n                            width=\"310\"\n                            :label=\"'版本号'\" />\n                        <bk-table-column\n                            prop=\"status\"\n                            key=\"status\"\n                            :label=\"'状态'\">\n                            <template slot-scope=\"scope\">\n                                <Icon :type=\"statusIcon(scope.row)\" svg />\n                                <span v-html=\"statusHtml(scope.row)\" />\n                            </template>\n                        </bk-table-column>\n                        <bk-table-column\n                            prop=\"ip\"\n                            key=\"ip\"\n                            width=\"150\"\n                            :label=\"'绑定IP'\">\n                            <template slot-scope=\"scope\">\n                                <span class=\"service-ip\" @click=\"handleCopyIp(scope.row.ip)\">\n                                    {{ scope.row.ip }}\n                                    <Icon class=\"ml5 copy-ip-icon\" type=\"step-copy\" svg />\n                                    <!-- <Icon class=\"skip-icon\" type=\"edit\" svg /> -->\n                                </span>\n                            </template>\n                        </bk-table-column>\n                        <bk-table-column\n                            prop=\"port\"\n                            key=\"port\"\n                            width=\"100\"\n                            :label=\"'端口'\" />\n                    </bk-table>\n                </template>\n            </bk-table-column>\n            <bk-table-column\n                :label=\"'服务名'\"\n                prop=\"name\"\n                width=\"480\"\n                key=\"name\"\n                align=\"left\" />\n            <bk-table-column\n                :label=\"'版本号'\"\n                prop=\"version\"\n                width=\"310\"\n                key=\"version\"\n                align=\"left\">\n                <template slot-scope=\"{ row }\">\n                    <span v-html=\"row.versionHtml\" />\n                </template>\n            </bk-table-column>\n            <bk-table-column\n                :label=\"'实例状态'\"\n                prop=\"instanceList\"\n                key=\"instanceList\"\n                align=\"left\">\n                <template slot-scope=\"{ row }\">\n                    <div v-bk-tooltips=\"instanceTips(row)\">\n                        <span class=\"service-instance-num abnormal\" v-if=\"row.abnormalNum\">{{ row.abnormalNum }}</span>\n                        <span class=\"service-instance-num unknown\" v-if=\"row.unknownNum\">{{ row.unknownNum }}</span>\n                        <span class=\"service-instance-num normal\" v-if=\"row.normalNum\">{{ row.normalNum }}</span>\n                    </div>\n                </template>\n            </bk-table-column>\n        </bk-table>\n    </div>\n</template>\n \n<script>\n       import ServiceStateService from '@service/service-state';\n    import {\n        execCopy,\n    } from '@utils/assist';\n\n    export default {\n        name: 'Service',\n        data () {\n            return {\n                isLoading: false,\n                tableSize: 'small',\n                serviceData: [],\n                expandRow: [],\n                timer: null,\n                showFirstExpandRow: true,\n            };\n        },\n        computed: {\n            isSkeletonLoading () {\n                return this.isLoading;\n            },\n        },\n        created () {\n            this.fetchData();\n        },\n        destroyed () {\n            clearInterval(this.timer);\n        },\n        methods: {\n            /**\n             * @desc 获取服务运行状态数据,每三秒轮询一次\n             */\n            fetchData () {\n                // ServiceStateService.serviceList({}, {\n                //     permission: 'page',\n                // })\n                //     .then((data) => {\n                const data = [{}, {}, {}];\n                if (data.length < 1) {\n                    return;\n                }\n                this.serviceData = Object.freeze(data);\n                // 折叠表格默认展开第一个\n                if (this.showFirstExpandRow) {\n                    this.expandRow.push(this.serviceData[0].name);\n                }\n                this.serviceData.forEach((service) => {\n                    let abnormalNum = 0;\n                    let normalNum = 0;\n                    let unknownNum = 0;\n                    service.instanceList.forEach((instance) => {\n                        if (instance.status === 1) {\n                            normalNum += 1;\n                        } else if (instance.status === -1) {\n                            unknownNum += 1;\n                        } else if (instance.status === 0) {\n                            abnormalNum += 1;\n                        }\n                    });\n                    const statusMap = {\n                        abnormalNum,\n                        normalNum,\n                        unknownNum,\n                    };\n                    Object.assign(service, statusMap);\n                    this.showFirstExpandRow = false;\n                    clearInterval(this.timer);\n                    this.timer = setInterval(() => {\n                        this.fetchData();\n                    }, 3000);\n                });\n                    \n                // })\n                //     .finally(() => {\n                this.isLoading = false;\n                // });\n            },\n\n            /**\n             * @desc 控制折叠表格只能展开一项\n             * @param {Object} row 表格当前行数据\n             */\n            toggleRowExpansion (row) {\n                if (this.expandRow.includes(row.name)) {\n                    this.expandRow = [];\n                } else {\n                    this.expandRow = [\n                        row.name,\n                    ];\n                }\n            },\n\n            /**\n             * @desc 控制折叠表格只能展开一项\n             * @param {Object} row 表格当前行数据\n             */\n            onBeforeExpandChange ({ row }) {\n                this.toggleRowExpansion(row);\n            },\n\n            /**\n             * @desc 自定义表格状态内容\n             */\n            statusHtml (row) {\n                const styles = 'color: #aaacb5';\n                const statusHtmlMap = {\n                    0: `<span>${'异常'}<span style=\"${styles}\"> #SERVICE UNAVAILABLE (503)</span></span>`,\n                    1: `<span>${'正常'}</span>`,\n                    '-1': `<span>${'未知'}<span style=\"${styles}\"> #NO MAPPING</span></span>`,\n                };\n                return statusHtmlMap[row.status];\n            },\n\n            /**\n             * @desc 自定义表格状态图标\n             */\n            statusIcon (row) {\n                const statusIcomMap = {\n                    0: 'abnormal',\n                    1: 'normal',\n                    '-1': 'unknown',\n                };\n                return statusIcomMap[row.status];\n            },\n\n            /**\n             * @desc 自定义实例状态tooltips内容\n             */\n            instanceTips (row) {\n                let tipsStr = '';\n                if (row.abnormalNum) {\n                    tipsStr = `${'异常'}: ${row.abnormalNum}`;\n                }\n                if (row.unknownNum) {\n                    tipsStr += ` ${'未知'}: ${row.unknownNum}`;\n                }\n                if (row.normalNum) {\n                    tipsStr += ` ${'正常'}: ${row.normalNum}`;\n                }\n                return { content: tipsStr, placement: 'top' };\n            },\n\n            /**\n             * @desc 复制IP\n             */\n            handleCopyIp (ip) {\n                execCopy(ip, `${'复制成功'}`);\n            },\n        },\n    };\n</script>\n\n<style lang=\"postcss\">\n    .service-state-info {\n        .service-table > .bk-table-body-wrapper > table > tbody > .bk-table-row {\n            cursor: pointer;\n        }\n\n        .service-expand-table {\n            background-color: #fafbfd;\n\n            tr {\n                background-color: #fafbfd;\n            }\n        }\n\n        .bk-table .bk-table-body td.bk-table-expanded-cell {\n            padding: 0 48px;\n            background-color: #fafbfd;\n        }\n\n        .service-ip {\n            display: flex;\n            align-items: center;\n            cursor: pointer;\n\n            &:hover {\n                .copy-ip-icon {\n                    color: #3a84ff;\n                }\n            }\n        }\n\n        .copy-ip-icon {\n            color: #979ba5;\n        }\n\n        .service-instance-num {\n            display: inline-block;\n            width: 20px;\n            height: 20px;\n            font-size: 12px;\n            font-weight: 700;\n            line-height: 18px;\n            text-align: center;\n            border: 1px solid #fff;\n        }\n\n        .unknown {\n            color: #979ba5;\n            background-color: #e6e8f0;\n        }\n\n        .abnormal {\n            color: #ea3536;\n            background-color: #fdd;\n        }\n\n        .normal {\n            color: #14a568;\n            background-color: #dff0e4;\n        }\n\n        .expanded {\n            background-color: #f0f1f5;\n        }\n\n        .bk-table-expand-icon-expanded {\n            color: #979ba5;\n        }\n    }\n</style>\n"],"names":[],"sourceRoot":""}