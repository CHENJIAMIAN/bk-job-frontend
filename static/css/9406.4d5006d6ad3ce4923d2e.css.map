{"version":3,"file":"static/css/9406.4d5006d6ad3ce4923d2e.css","mappings":"AAgFA,gCACA,iBA2JA,CAzJA,+CACA,kBA+BA,CA7BA,sEAEA,WADA,cAEA,CAEA,qEAMA,eAJA,YAGA,gBADA,kBADA,cAIA,kBANA,UAOA,CAEA,8DAEA,yBADA,aAEA,CAEA,gEAEA,mBADA,aAEA,CAEA,4DAEA,gBADA,eAEA,CAGA,uDACA,aACA,kBACA,CAEA,6CAIA,yBAHA,aAEA,eADA,sBAGA,8DAyDA,CAvDA,gEAIA,gCADA,aAEA,CAEA,+HA9DA,mBADA,aAIA,eAFA,YACA,iBA2GA,CA/CA,+DAKA,gBACA,gCAHA,cACA,cA2CA,CAvCA,sEAEA,6BADA,aAMA,CAHA,sFACA,aACA,CAGA,qEACA,kBACA,CAEA,qEACA,gBACA,gBACA,uBACA,kBACA,CAEA,4EAQA,mBAFA,mBACA,kBAFA,WAJA,aAEA,YAMA,uBALA,gBAFA,UAQA,CAEA,+EAKA,cAJA,aAGA,eADA,iBADA,iBAIA,CAIA,iDAEA,yBACA,yBAFA,aAIA,OADA,qBA+BA,CA5BA,8DAEA,gCADA,YAEA,CAEA,mEAQA,mBAFA,+BAFA,cACA,eAlIA,aAoIA,eAhIA,eAFA,YAoIA,uBAnIA,kBA6HA,cAaA,CALA,0EAEA,gBACA,6BAFA,aAGA,CAGA,kEAEA,gBACA,OAFA,gBAGA,CAGA,oDAKA,cAFA,eACA,iBAHA,iBACA,kBAIA,oBACA,CAEA,4CAEA,kBADA,WAEA,CC+BA,uEACA,SACA,CAIA,6CACA,eACA,SACA,CAEA,yCAEA,mBADA,aAEA,yBACA,kBACA,CAEA,yCAMA,yBAFA,eAHA,YAIA,iBAFA,gBADA,cAKA,CAEA,2CACA,aACA,CAEA,6CAOA,yBAFA,cAJA,qBAGA,eADA,YAGA,kBAJA,UAMA,CAEA,kDACA,gCACA,CAEA,wCACA,gBACA,iBACA,CAEA,wCACA,YACA,CAEA,6CAUA,mBAFA,gBACA,6BAPA,SAEA,aAEA,YAKA,yBARA,OAIA,mBANA,eAIA,UAOA","sources":["webpack://job/./src/views/script-manage/sync-task/components/script-detail.vue","webpack://job/./src/views/script-manage/sync-task/index.vue"],"sourcesContent":["<template>\n    <jb-sideslider\n        :is-show=\"isShow\"\n        :show-footer=\"false\"\n        @update:isShow=\"handleCancel\"\n        :quick-close=\"true\"\n        :width=\"900\"\n        :title=\"'查看脚本'\">\n        <div v-if=\"isShow\" v-bkloading=\"{ isLoading }\">\n            <script-detail v-if=\"!isLoading\" :script-info=\"scriptInfo\" :offset-bottom=\"0\" />\n        </div>\n    </jb-sideslider>\n</template>\n<script>\n    import ScriptService from '@service/script-manage';\n    import PublicScriptService from '@service/public-script-manage';\n    import {\n        checkPublicScript,\n    } from '@utils/assist';\n    import ScriptDetail from '../../common/detail';\n\n    export default {\n        name: '',\n        components: {\n            ScriptDetail,\n        },\n        props: {\n            isShow: {\n                type: Boolean,\n                default: false,\n            },\n            scriptVersionId: {\n                type: Number,\n                required: true,\n            },\n        },\n        data () {\n            return {\n                isLoading: false,\n                scriptInfo: {},\n            };\n        },\n        watch: {\n            isShow (isShow) {\n                if (isShow && this.scriptVersionId > 0) {\n                    this.fetchScriptDetail();\n                }\n            },\n        },\n        created () {\n            this.publicScript = checkPublicScript(this.$route);\n            this.serviceHandler = this.publicScript ? PublicScriptService : ScriptService;\n        },\n        methods: {\n            fetchScriptDetail () {\n                this.isLoading = true;\n                this.serviceHandler.versionDetail({\n                    id: this.scriptVersionId,\n                }).then((data) => {\n                    this.scriptInfo = Object.freeze(data);\n                })\n                    .finally(() => {\n                        this.isLoading = false;\n                    });\n            },\n            handleCancel () {\n                this.$emit('update:isShow', false);\n            },\n        },\n    };\n</script>\n<style lang='postcss' scoped>\n    %tab-item {\n        display: flex;\n        align-items: center;\n        height: 43px;\n        padding-left: 20px;\n        font-size: 12px;\n    }\n\n    .script-detail {\n        position: relative;\n\n        .detail-layout {\n            margin-bottom: 20px;\n\n            .script-detail-version {\n                font-size: 18px;\n                color: #000;\n            }\n\n            .script-detail-status {\n                width: 46px;\n                height: 16px;\n                padding: 0 5px;\n                margin-right: 10px;\n                margin-left: 8px;\n                font-size: 12px;\n                text-align: center;\n            }\n\n            .status-online {\n                color: #45c272;\n                background-color: #e5f6ea;\n            }\n\n            .status-disabled {\n                color: #9fa2ac;\n                background: #f0f1f5;\n            }\n\n            .detail-item {\n                margin-top: 10px;\n                margin-bottom: 0;\n            }\n        }\n\n        .render-script-version {\n            display: flex;\n            margin-bottom: 60px;\n        }\n\n        .version-tab {\n            display: flex;\n            flex-direction: column;\n            flex: 0 0 280px;\n            border: 1px solid #dcdee5;\n            user-select: none;\n\n            .version-tab-title {\n                @extend %tab-item;\n\n                color: #313238;\n                border-bottom: 1px solid #dcdee5;\n            }\n\n            .version-tab-item {\n                @extend %tab-item;\n\n                color: #63656e;\n                cursor: pointer;\n                background: #fff;\n                border-bottom: 1px solid #dcdee5;\n\n                &.active {\n                    color: #3a84ff;\n                    background: #f0f1f5 !important;\n\n                    .version-active {\n                        display: block;\n                    }\n                }\n\n                &:hover {\n                    background: #fafbfd;\n                }\n\n                .text {\n                    max-width: 150px;\n                    overflow: hidden;\n                    text-overflow: ellipsis;\n                    white-space: normal;\n                }\n\n                .online-flag {\n                    display: flex;\n                    width: 50px;\n                    height: 16px;\n                    margin-left: 8px;\n                    color: #fff;\n                    background: #ea3636;\n                    border-radius: 8px;\n                    align-items: center;\n                    justify-content: center;\n                }\n\n                .version-active {\n                    display: none;\n                    margin-right: 12px;\n                    margin-left: auto;\n                    font-size: 14px;\n                    color: #979ba5;\n                }\n            }\n        }\n\n        .version-content {\n            display: flex;\n            background-color: #f0f1f5;\n            border: 1px solid #dcdee5;\n            flex-direction: column;\n            flex: 1;\n\n            .content-tab {\n                display: flex;\n                border-bottom: 1px solid #dcdee5;\n            }\n\n            .content-tab-item {\n                @extend %tab-item;\n\n                padding-left: 0;\n                color: #313238;\n                cursor: pointer;\n                border-right: 1px solid #dcdee5;\n                flex: 0 0 120px;\n                align-items: center;\n                justify-content: center;\n\n                &.active {\n                    color: #3a84ff;\n                    background: #fff;\n                    border-top: 2px solid #3a84ff;\n                }\n            }\n\n            .content-dispaly {\n                min-height: 300px;\n                background: #fff;\n                flex: 1;\n            }\n        }\n\n        .render-version-log {\n            min-height: 480px;\n            padding: 12px 10px;\n            font-size: 12px;\n            line-height: 20px;\n            color: #63656e;\n            white-space: pre-line;\n        }\n\n        .action-btn {\n            width: 100px;\n            margin-right: 10px;\n        }\n    }\n</style>\n","<template>\n    <div class=\"script-manage-sync-task-page\" v-bkloading=\"{ isLoading }\">\n        <div class=\"retry-btn\">\n            <bk-button  @click=\"handleAllRetry\">{{ '全部重试' }}</bk-button>\n        </div>\n        <div class=\"table-top\">\n            {{ '同步作业模板' }}\n            <span class=\"version-sum\">\n                （{{ '共' }} {{ data.length }} {{ '个'}}）\n            </span>\n        </div>\n        <bk-table :data=\"data\" row-class-name=\"sync-script-record\">\n            <bk-table-column\n                :label=\"'作业模板名称'\"\n                prop=\"name\"\n                sortable>\n                <template slot-scope=\"{ row }\">\n                    <router-link\n                        target=\"_blank\"\n                        :to=\"{\n                            name: 'templateDetail',\n                            params: {\n                                id: 4 || row.templateId,\n                            },\n                        }\">\n                        {{ row.templateName }}\n                        <Icon type=\"edit\" class=\"template-link\" />\n                    </router-link>\n                </template>\n            </bk-table-column>\n            <bk-table-column :label=\"'步骤名称'\" prop=\"stepName\" />\n            <bk-table-column :label=\"'引用的版本号'\" prop=\"version\">\n                <template slot-scope=\"{ row }\">\n                    <bk-button\n                        text\n                        @click=\"handleShowDetail(row.scriptVersionId)\">\n                        {{ row.scriptVersion }}\n                    </bk-button>\n                </template>\n            </bk-table-column>\n            <bk-table-column\n                :label=\"'引用版本状态'\"\n                prop=\"status\"\n                :filters=\"statusFilters\"\n                :filter-method=\"statusFilterMethod\"\n                :filter-multiple=\"true\">\n                <template slot-scope=\"{ row }\">\n                    <span v-html=\"row.statusHtml\" />\n                </template>\n            </bk-table-column>\n            <bk-table-column\n                :label=\"'状态'\"\n                width=\"350\"\n                prop=\"syncStatus\">\n                <template slot-scope=\"{ row, $index }\">\n                    <Icon :type=\"row.syncIcon\" svg class=\"mr10\" />\n                    <span>{{ row.syncStatusMsg }}</span>\n                    <bk-button\n                        v-if=\"row.isSyncFailed\"\n                        :tippy-tips=\"row.failMsg\"\n                        text\n                        style=\"margin-left: 15px;\"\n                        @click=\"handleRetry(row, $index)\">\n                        {{ '重试' }}\n                    </bk-button>\n                </template>\n            </bk-table-column>\n        </bk-table>\n        <div class=\"footer-action\">\n            <bk-button\n                class=\"w120\"\n                theme=\"primary\"\n                @click=\"handleFinish\">\n                {{ '完成' }}\n            </bk-button>\n        </div>\n        <script-detail :is-show.sync=\"isShowDetail\" :script-version-id=\"selectScriptVersionId\" />\n        <element-teleport v-if=\"lastVersionScriptInfo.version\">\n            <span> - {{ '同步至' }}</span>\n            <span>{{ lastVersionScriptInfo.version }}</span>\n        </element-teleport>\n    </div>\n</template>\n<script>\n       import {\n        checkPublicScript,\n        leaveConfirm,\n    } from '@utils/assist';\n    import ScriptService from '@service/script-manage';\n    import PublicScriptService from '@service/public-script-manage';\n    import TaskPlanService from '@service/task-plan';\n    import ScriptDetail from './components/script-detail';\n\n    export default {\n        components: {\n            ScriptDetail,\n        },\n        data () {\n            return {\n                data: [{},{},{}],\n                isLoading: false,\n                isShowDetail: false,\n                selectScriptVersionId: 0,\n                lastVersionScriptInfo: {},\n            };\n        },\n        computed: {\n            isRetryAllDisable () {\n                // eslint-disable-next-line no-plusplus\n                for (let i = 0; i < this.data.length; i++) {\n                    if (this.data[i].isSyncFailed) {\n                        return false;\n                    }\n                }\n                return true;\n            },\n        },\n        created () {\n            this.statusFilters = [\n                { value: 0, text: '未上线' },\n                { value: 1, text: '已上线' },\n                { value: 2, text: '已下线' },\n                { value: 3, text: '已禁用' },\n            ];\n            this.publicScript = checkPublicScript(this.$route);\n            this.serviceHandler = this.publicScript ? PublicScriptService : ScriptService;\n            this.scriptId = this.$route.params.scriptId;\n            this.scriptVersionId = this.$route.params.scriptVersionId;\n            this.stepList = JSON.parse(localStorage.getItem('SYNC_TEMPLATE_STEP_SCRIPT'));\n            if (this.stepList.length < 1) {\n                this.messageError('请先选择作业模板步骤');\n                return;\n            }\n            this.fetchData();\n            this.fetchLastScriptVersionDetail();\n        },\n        methods: {\n            /**\n             * @desc 开始同步脚本\n             */\n            fetchData () {\n                this.isLoading = true;\n                this.serviceHandler.scriptVersionSync({\n                    scriptId: this.scriptId,\n                    scriptVersionId: this.scriptVersionId,\n                    steps: this.stepList,\n                }).then((data) => {\n                    this.data = data;\n                })\n                    .finally(() => {\n                        this.isLoading = false;\n                    });\n            },\n            /**\n             * @desc 脚本的最新版本信息\n             */\n            fetchLastScriptVersionDetail () {\n                this.serviceHandler.versionDetail({\n                    id: this.$route.params.scriptVersionId,\n                }).then((data) => {\n                    this.lastVersionScriptInfo = Object.freeze(data);\n                });\n            },\n            /**\n             * @desc 脚本详情\n             * @param { Number } id\n             */\n            handleShowDetail (id) {\n                this.selectScriptVersionId = id;\n                this.isShowDetail = true;\n            },\n            /**\n             * @desc 全部重试\n             */\n            handleAllRetry () {\n                this.fetchData();\n            },\n            /**\n             * @desc 单个重试\n             */\n            handleRetry (row, index) {\n                this.serviceHandler.scriptVersionSync({\n                    scriptId: this.scriptId,\n                    scriptVersionId: this.scriptVersionId,\n                    steps: [\n                        {\n                            templateid: 4 || row.templateId,\n                            stepid: 4 || row.stepId,\n                        },\n                    ],\n                }).then((data) => {\n                    this.data.splice(index, 1, data[0]);\n                });\n            },\n            /**\n             * @desc 数据过滤\n             * @param {Number} value 选中的状态\n             * @param {Object} row 单条数据\n             */\n            statusFilterMethod (value, row) {\n                return row.scriptStatus === value;\n            },\n            /**\n             * @desc 完成同步任务\n             */\n            handleFinish () {\n                this.routerBack();\n            },\n            /**\n             * @desc 路由回退\n             */\n            routerBack () {\n                window.changeAlert = !this.isRetryAllDisable;\n                this.isSyncPlanLoading = false;\n                leaveConfirm('部分作业模板同步失败，请留意')\n                    .then(() => {\n                        this.$bkInfo({\n                            title: '是否需要进行执行方案同步？',\n                            closeIcon: false,\n                            subHeader: (() => (\n                                <div>\n                                    <span>{ '点击' }</span>\n                                    <span style=\"font-weight: bold\"> { '“立即前往”' } </span>\n                                    <span>{ '将进入关联的执行方案同步确认页面，点击' }</span>\n                                    <span style=\"font-weight: bold\"> { '“暂时不用”' } </span>\n                                    <span>{ '结束本次操作并退出。' }</span>\n                                </div>\n                            ))(),\n                            okText: '立即前往',\n                            cancelText: '暂时不用',\n                            // 获取同步的作业模板对应的执行方案列表，批量同步需要同步的执行方案\n                            confirmFn: () => TaskPlanService.fetchBatchTaskPlan({\n                                templateIds: this.stepList.map(({ templateId }) => templateId).join(','),\n                            }).then((planList) => {\n                                // 跳转批量同步执行方案页面\n                                this.$router.push({\n                                    name: 'syncPlanBatch',\n                                    query: {\n                                        planIds: planList.reduce((result, plan) => {\n                                            if (plan.needUpdate) {\n                                                result.push(plan.id);\n                                            }\n                                            return result;\n                                        }, []).join(','),\n                                    },\n                                });\n                            }),\n                            cancelFn: () => {\n                                const routerName = this.publicScript ? 'publicScriptVersion' : 'scriptVersion';\n                                this.$router.push({\n                                    name: routerName,\n                                    params: {\n                                        id: this.scriptId,\n                                    },\n                                });\n                            },\n                        });\n                    });\n            },\n        },\n    };\n</script>\n<style lang=\"postcss\">\n    .script-manage-sync-task-page {\n        .sync-script-record {\n            &:hover {\n                .template-link {\n                    opacity: 100%;\n                }\n            }\n        }\n\n        .template-link {\n            font-size: 12px;\n            opacity: 0%;\n        }\n\n        .retry-btn {\n            display: flex;\n            align-items: center;\n            justify-content: flex-end;\n            margin-bottom: 20px;\n        }\n\n        .table-top {\n            height: 42px;\n            padding: 0 20px;\n            margin-top: 16px;\n            font-size: 12px;\n            line-height: 42px;\n            background-color: #f0f1f5;\n        }\n\n        .version-sum {\n            color: #a3a6af;\n        }\n\n        .status-action {\n            display: inline-block;\n            width: 46px;\n            height: 16px;\n            font-size: 12px;\n            color: #9fa2ac;\n            text-align: center;\n            background-color: #f0f1f5;\n        }\n\n        .failed-sync-status {\n            border-bottom: 1px dashed #c4c6cc;\n        }\n\n        .try-show {\n            display: visible;\n            padding-left: 10px;\n        }\n\n        .try-hide {\n            display: none;\n        }\n\n        .footer-action {\n            position: fixed;\n            bottom: 0;\n            left: 0;\n            display: flex;\n            width: 100%;\n            height: 52px;\n            padding-right: 24px;\n            background: #fff;\n            border-top: 1px solid #e2e2e2;\n            align-items: center;\n            justify-content: flex-end;\n        }\n    }\n</style>\n"],"names":[],"sourceRoot":""}