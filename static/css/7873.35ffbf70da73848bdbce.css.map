{"version":3,"file":"static/css/7873.35ffbf70da73848bdbce.css","mappings":"AAkFA,gCACA,iBA2JA,CAzJA,+CACA,kBA+BA,CA7BA,sEAEA,WADA,cAEA,CAEA,qEAMA,eAJA,YAGA,gBADA,kBADA,cAIA,kBANA,UAOA,CAEA,8DAEA,yBADA,aAEA,CAEA,gEAEA,mBADA,aAEA,CAEA,4DAEA,gBADA,eAEA,CAGA,uDACA,aACA,kBACA,CAEA,6CAIA,yBAHA,aAEA,eADA,sBAGA,8DAyDA,CAvDA,gEAIA,gCADA,aAEA,CAEA,+HA9DA,mBADA,aAIA,eAFA,YACA,iBA2GA,CA/CA,+DAKA,gBACA,gCAHA,cACA,cA2CA,CAvCA,sEAEA,6BADA,aAMA,CAHA,sFACA,aACA,CAGA,qEACA,kBACA,CAEA,qEACA,gBACA,gBACA,uBACA,kBACA,CAEA,4EAQA,mBAFA,mBACA,kBAFA,WAJA,aAEA,YAMA,uBALA,gBAFA,UAQA,CAEA,+EAKA,cAJA,aAGA,eADA,iBADA,iBAIA,CAIA,iDAEA,yBACA,yBAFA,aAIA,OADA,qBA+BA,CA5BA,8DAEA,gCADA,YAEA,CAEA,mEAQA,mBAFA,+BAFA,cACA,eAlIA,aAoIA,eAhIA,eAFA,YAoIA,uBAnIA,kBA6HA,cAaA,CALA,0EAEA,gBACA,6BAFA,aAGA,CAGA,kEAEA,gBACA,OAFA,gBAGA,CAGA,oDAKA,cAFA,eACA,iBAHA,iBACA,kBAIA,oBACA,CAEA,4CAEA,kBADA,WAEA,CC0CA,2DACA,WACA,CAEA,wDAMA,yBAFA,eAHA,YAIA,iBAFA,gBADA,cAKA,CAIA,0FACA,cACA,CAKA,+EACA,aACA,eACA,CAGA,6DACA,aACA,CAEA,4DAQA,mBAFA,cADA,eAHA,YAEA,iBADA,cAIA,kBANA,UAQA,CAEA,4DAEA,yBADA,aAEA,CAEA,4DAUA,mBAFA,gBACA,6BAPA,SAEA,aAEA,YAKA,yBARA,OAIA,mBANA,eAIA,UAOA","sources":["webpack://job/./src/views/script-manage/sync-confirm/components/script-detail.vue","webpack://job/./src/views/script-manage/sync-confirm/index.vue"],"sourcesContent":["\r\n\r\n<template>\r\n    <jb-sideslider\r\n        :is-show=\"isShow\"\r\n        :show-footer=\"false\"\r\n        @update:isShow=\"handleCancel\"\r\n        :quick-close=\"true\"\r\n        :width=\"900\"\r\n        :title=\"$t('script.查看脚本')\">\r\n        <div v-if=\"isShow\" v-bkloading=\"{ isLoading }\">\r\n            <script-detail v-if=\"!isLoading\" :script-info=\"scriptInfo\" :offset-bottom=\"0\" />\r\n        </div>\r\n    </jb-sideslider>\r\n</template>\r\n<script>\r\n    import ScriptService from '@service/script-manage';\r\n    import PublicScriptService from '@service/public-script-manage';\r\n    import {\r\n        checkPublicScript,\r\n    } from '@utils/assist';\r\n    import ScriptDetail from '../../common/detail';\r\n\r\n    export default {\r\n        name: '',\r\n        components: {\r\n            ScriptDetail,\r\n        },\r\n        props: {\r\n            isShow: {\r\n                type: Boolean,\r\n                default: false,\r\n            },\r\n            scriptVersionId: {\r\n                type: Number,\r\n                required: true,\r\n            },\r\n        },\r\n        data () {\r\n            return {\r\n                isLoading: false,\r\n                scriptInfo: {},\r\n            };\r\n        },\r\n        watch: {\r\n            isShow (isShow) {\r\n                if (isShow && this.scriptVersionId > 0) {\r\n                    this.fetchScriptDetail();\r\n                }\r\n            },\r\n        },\r\n        created () {\r\n            this.publicScript = checkPublicScript(this.$route);\r\n            this.serviceHandler = this.publicScript ? PublicScriptService : ScriptService;\r\n        },\r\n        methods: {\r\n            fetchScriptDetail () {\r\n                this.isLoading = true;\r\n                this.serviceHandler.versionDetail({\r\n                    id: this.scriptVersionId,\r\n                }).then((data) => {\r\n                    this.scriptInfo = Object.freeze(data);\r\n                })\r\n                    .finally(() => {\r\n                        this.isLoading = false;\r\n                    });\r\n            },\r\n            handleCancel () {\r\n                this.$emit('update:isShow', false);\r\n            },\r\n        },\r\n    };\r\n</script>\r\n<style lang='postcss' scoped>\r\n    %tab-item {\r\n        display: flex;\r\n        align-items: center;\r\n        height: 43px;\r\n        padding-left: 20px;\r\n        font-size: 12px;\r\n    }\r\n\r\n    .script-detail {\r\n        position: relative;\r\n\r\n        .detail-layout {\r\n            margin-bottom: 20px;\r\n\r\n            .script-detail-version {\r\n                font-size: 18px;\r\n                color: #000;\r\n            }\r\n\r\n            .script-detail-status {\r\n                width: 46px;\r\n                height: 16px;\r\n                padding: 0 5px;\r\n                margin-right: 10px;\r\n                margin-left: 8px;\r\n                font-size: 12px;\r\n                text-align: center;\r\n            }\r\n\r\n            .status-online {\r\n                color: #45c272;\r\n                background-color: #e5f6ea;\r\n            }\r\n\r\n            .status-disabled {\r\n                color: #9fa2ac;\r\n                background: #f0f1f5;\r\n            }\r\n\r\n            .detail-item {\r\n                margin-top: 10px;\r\n                margin-bottom: 0;\r\n            }\r\n        }\r\n\r\n        .render-script-version {\r\n            display: flex;\r\n            margin-bottom: 60px;\r\n        }\r\n\r\n        .version-tab {\r\n            display: flex;\r\n            flex-direction: column;\r\n            flex: 0 0 280px;\r\n            border: 1px solid #dcdee5;\r\n            user-select: none;\r\n\r\n            .version-tab-title {\r\n                @extend %tab-item;\r\n\r\n                color: #313238;\r\n                border-bottom: 1px solid #dcdee5;\r\n            }\r\n\r\n            .version-tab-item {\r\n                @extend %tab-item;\r\n\r\n                color: #63656e;\r\n                cursor: pointer;\r\n                background: #fff;\r\n                border-bottom: 1px solid #dcdee5;\r\n\r\n                &.active {\r\n                    color: #3a84ff;\r\n                    background: #f0f1f5 !important;\r\n\r\n                    .version-active {\r\n                        display: block;\r\n                    }\r\n                }\r\n\r\n                &:hover {\r\n                    background: #fafbfd;\r\n                }\r\n\r\n                .text {\r\n                    max-width: 150px;\r\n                    overflow: hidden;\r\n                    text-overflow: ellipsis;\r\n                    white-space: normal;\r\n                }\r\n\r\n                .online-flag {\r\n                    display: flex;\r\n                    width: 50px;\r\n                    height: 16px;\r\n                    margin-left: 8px;\r\n                    color: #fff;\r\n                    background: #ea3636;\r\n                    border-radius: 8px;\r\n                    align-items: center;\r\n                    justify-content: center;\r\n                }\r\n\r\n                .version-active {\r\n                    display: none;\r\n                    margin-right: 12px;\r\n                    margin-left: auto;\r\n                    font-size: 14px;\r\n                    color: #979ba5;\r\n                }\r\n            }\r\n        }\r\n\r\n        .version-content {\r\n            display: flex;\r\n            background-color: #f0f1f5;\r\n            border: 1px solid #dcdee5;\r\n            flex-direction: column;\r\n            flex: 1;\r\n\r\n            .content-tab {\r\n                display: flex;\r\n                border-bottom: 1px solid #dcdee5;\r\n            }\r\n\r\n            .content-tab-item {\r\n                @extend %tab-item;\r\n\r\n                padding-left: 0;\r\n                color: #313238;\r\n                cursor: pointer;\r\n                border-right: 1px solid #dcdee5;\r\n                flex: 0 0 120px;\r\n                align-items: center;\r\n                justify-content: center;\r\n\r\n                &.active {\r\n                    color: #3a84ff;\r\n                    background: #fff;\r\n                    border-top: 2px solid #3a84ff;\r\n                }\r\n            }\r\n\r\n            .content-dispaly {\r\n                min-height: 300px;\r\n                background: #fff;\r\n                flex: 1;\r\n            }\r\n        }\r\n\r\n        .render-version-log {\r\n            min-height: 480px;\r\n            padding: 12px 10px;\r\n            font-size: 12px;\r\n            line-height: 20px;\r\n            color: #63656e;\r\n            white-space: pre-line;\r\n        }\r\n\r\n        .action-btn {\r\n            width: 100px;\r\n            margin-right: 10px;\r\n        }\r\n    }\r\n</style>\r\n","\r\n\r\n<template>\r\n    <div class=\"script-manage-sync-confirm\" v-bkloading=\"{ isLoading }\">\r\n        <bk-input\r\n            class=\"search-input\"\r\n            :placeholder=\"$t('script.搜索作业模板')\"\r\n            :clearable=\"true\"\r\n            right-icon=\"bk-icon icon-search\"\r\n            @change=\"handleInputChange\"\r\n            v-model=\"value\" />\r\n        <div class=\"table-top\">\r\n            <span>{{ $t('script.同步作业模板') }}</span>\r\n            <span class=\"table-selected\"> ({{ $t('script.已选') }} {{ selectedList.length }}/{{ data.length }}个)</span>\r\n        </div>\r\n        <bk-table\r\n            :data=\"tableData\"\r\n            row-class-name=\"template-script-record\"\r\n            @selection-change=\"handleSelectionChange\">\r\n            <bk-table-column type=\"selection\" width=\"60\" />\r\n            <bk-table-column\r\n                :label=\"$t('script.作业模板名称')\"\r\n                prop=\"name\"\r\n                sortable>\r\n                <template slot-scope=\"{ row }\">\r\n                    <bk-button\r\n                        text\r\n                        class=\"job-template-name\"\r\n                        @click=\"handleGoTemplateDetail(row.templateId)\">\r\n                        {{ row.templateName }}\r\n                        <Icon type=\"edit\" class=\"template-link\" />\r\n                    </bk-button>\r\n                </template>\r\n            </bk-table-column>\r\n            <bk-table-column\r\n                :label=\"$t('script.步骤名称')\"\r\n                prop=\"stepName\" />\r\n            <bk-table-column\r\n                :label=\"$t('script.引用的版本号')\"\r\n                prop=\"version\">\r\n                <template slot-scope=\"{ row }\">\r\n                    <bk-button\r\n                        text\r\n                        @click=\"handleShowScriptDetail(row.scriptVersionId)\">\r\n                        {{ row.scriptVersion }}\r\n                    </bk-button>\r\n                </template>\r\n            </bk-table-column>\r\n            <bk-table-column\r\n                :label=\"$t('script.引用版本状态')\"\r\n                prop=\"status\"\r\n                :filters=\"statusFilters\"\r\n                :filter-method=\"statusFilterMethod\"\r\n                :filter-multiple=\"true\">\r\n                <template slot-scope=\"{ row }\">\r\n                    <span v-html=\"row.statusHtml\" />\r\n                </template>\r\n            </bk-table-column>\r\n            <bk-table-column\r\n                :label=\"$t('script.操作')\"\r\n                width=\"150\">\r\n                <template slot-scope=\"{ row }\">\r\n                    <bk-button\r\n                        text\r\n                        @click=\"handleComparison(row)\">\r\n                        {{ $t('script.版本对比') }}\r\n                    </bk-button>\r\n                </template>\r\n            </bk-table-column>\r\n        </bk-table>\r\n        <div class=\"footer-action\">\r\n            <bk-button\r\n                class=\"mr10\"\r\n                @click=\"handleCancel\">\r\n                {{ $t('script.取消') }}\r\n            </bk-button>\r\n            <bk-button\r\n                class=\"w120\"\r\n                theme=\"primary\"\r\n                :disabled=\"selectedList.length === 0\"\r\n                @click=\"handleSync\">\r\n                {{ $t('script.立即同步') }}\r\n            </bk-button>\r\n        </div>\r\n        <element-teleport v-if=\"lastVersionScriptInfo.version\">\r\n            <span> - {{ $t('script.同步至') }}</span>\r\n            <span>{{ lastVersionScriptInfo.version }}</span>\r\n        </element-teleport>\r\n        <script-detail\r\n            :is-show.sync=\"showSideslider\"\r\n            :script-version-id=\"selectScriptVersionId\" />\r\n        <jb-diff\r\n            v-if=\"showDiff\"\r\n            :title=\"$t('script.版本对比')\"\r\n            :data=\"diffList\"\r\n            :old-version-id=\"selectScriptVersionId\"\r\n            :new-version-id=\"lastVersionScriptInfo.scriptVersionId\"\r\n            @close=\"handleDiffClose\" />\r\n    </div>\r\n</template>\r\n<script>\r\n    import _ from 'lodash';\r\n    import I18n from '@/i18n';\r\n    import ScriptService from '@service/script-manage';\r\n    import PublicScriptService from '@service/public-script-manage';\r\n    import { checkPublicScript } from '@utils/assist';\r\n    import JbDiff from '@components/jb-diff';\r\n    import ScriptDetail from './components/script-detail';\r\n\r\n    export default {\r\n        components: {\r\n            ScriptDetail,\r\n            JbDiff,\r\n        },\r\n        data () {\r\n            return {\r\n                isLoading: false,\r\n                data: [],\r\n                selectedList: [],\r\n                filterData: [],\r\n                diffList: [],\r\n                showSideslider: false,\r\n                scriptVersionId: null,\r\n                selectScriptVersionId: 0,\r\n                showDiff: false,\r\n                lastVersionScriptInfo: {},\r\n                value: '',\r\n            };\r\n        },\r\n        computed: {\r\n            tableData () {\r\n                if (this.value.length) {\r\n                    return this.filterData;\r\n                }\r\n                return this.data;\r\n            },\r\n        },\r\n        created () {\r\n            this.publicScript = checkPublicScript(this.$route);\r\n            this.serviceHandler = this.publicScript ? PublicScriptService : ScriptService;\r\n            this.scriptId = this.$route.params.scriptId;\r\n            this.scriptVersionId = this.$route.params.scriptVersionId;\r\n            this.statusFilters = [\r\n                { value: 0, text: I18n.t('script.未上线') },\r\n                { value: 1, text: I18n.t('script.已上线') },\r\n                { value: 2, text: I18n.t('script.已下线') },\r\n                { value: 3, text: I18n.t('script.已禁用') },\r\n            ];\r\n            this.fetchData();\r\n            this.fetchLastScriptVersionDetail();\r\n        },\r\n        methods: {\r\n            /**\r\n             * @desc 获取引用脚本的模板\r\n             */\r\n            fetchData () {\r\n                this.isLoading = true;\r\n                this.serviceHandler.scriptRefTemplateSteps({\r\n                    id: this.scriptId,\r\n                    scriptVersionId: this.scriptVersionId,\r\n                }).then((data) => {\r\n                    this.data = Object.freeze(data);\r\n                })\r\n                    .finally(() => {\r\n                        this.isLoading = false;\r\n                    });\r\n            },\r\n            /**\r\n             * @desc 最新脚本版本数据\r\n             */\r\n            fetchLastScriptVersionDetail () {\r\n                this.serviceHandler.versionDetail({\r\n                    id: this.$route.params.scriptVersionId,\r\n                }).then((data) => {\r\n                    this.lastVersionScriptInfo = Object.freeze(data);\r\n                });\r\n            },\r\n            /**\r\n             * @desc 列表搜索\r\n             */\r\n            handleInputChange: _.throttle(function () {\r\n                this.filterData = this.data.filter(item => item.templateName.includes(this.value));\r\n            }, 300),\r\n            /**\r\n             * @desc 跳转模板详情\r\n             * @param {Number} id 模板ID\r\n             */\r\n            handleGoTemplateDetail (id) {\r\n                const routerUrl = this.$router.resolve({\r\n                    name: 'templateDetail',\r\n                    params: {\r\n                        id,\r\n                    },\r\n                });\r\n                window.open(routerUrl.href, '_blank');\r\n            },\r\n            /**\r\n             * @desc 列表行选择\r\n             */\r\n            handleSelectionChange (selection) {\r\n                this.selectedList = Object.freeze(selection);\r\n            },\r\n            /**\r\n             * @desc 脚本对比\r\n             * @param {Object}  row 脚本数据\r\n             */\r\n            handleComparison (row) {\r\n                this.serviceHandler.versionDetail({\r\n                    id: row.scriptVersionId,\r\n                }).then((data) => {\r\n                    this.selectScriptVersionId = data.scriptVersionId;\r\n                    this.diffList = Object.freeze([\r\n                        data,\r\n                        this.lastVersionScriptInfo,\r\n                    ]);\r\n                    this.showDiff = true;\r\n                });\r\n            },\r\n            /**\r\n             * @desc 关闭脚本对比\r\n             */\r\n            handleDiffClose () {\r\n                this.showDiff = false;\r\n            },\r\n            /**\r\n             * @desc 取消\r\n             */\r\n            handleCancel () {\r\n                this.routerBack();\r\n            },\r\n            /**\r\n             * @desc 跳转到同步任务页面\r\n             */\r\n            handleSync () {\r\n                const stepList = this.selectedList.map(({ templateId, stepId }) => ({\r\n                    templateId,\r\n                    stepId,\r\n                }));\r\n                const routerName = this.publicScript ? 'scriptPublicSyncTask' : 'scriptSyncTask';\r\n                this.$router.push({\r\n                    name: routerName,\r\n                    params: {\r\n                        scriptId: this.scriptId,\r\n                        scriptVersionId: this.scriptVersionId,\r\n                    },\r\n                });\r\n                localStorage.setItem('SYNC_TEMPLATE_STEP_SCRIPT', JSON.stringify(stepList));\r\n            },\r\n            /**\r\n             * @desc 列表过滤\r\n             */\r\n            statusFilterMethod (value, row, column) {\r\n                return row.scriptStatus === value;\r\n            },\r\n            /**\r\n             * @desc 显示脚本详情\r\n             * @param {Number} scriptVersionId 脚本版本id\r\n             */\r\n            handleShowScriptDetail (scriptVersionId) {\r\n                this.selectScriptVersionId = scriptVersionId;\r\n                this.showSideslider = true;\r\n            },\r\n            /**\r\n             * @desc 路由回退\r\n             */\r\n            routerBack () {\r\n                const routerName = this.publicScript ? 'publicScriptVersion' : 'scriptVersion';\r\n                this.$router.push({\r\n                    name: routerName,\r\n                    params: {\r\n                        id: this.scriptId,\r\n                    },\r\n                });\r\n            },\r\n        },\r\n    };\r\n</script>\r\n<style lang=\"postcss\" scoped>\r\n    .script-manage-sync-confirm {\r\n        .search-input {\r\n            width: 500px;\r\n        }\r\n\r\n        .table-top {\r\n            height: 42px;\r\n            padding: 0 20px;\r\n            margin-top: 16px;\r\n            font-size: 12px;\r\n            line-height: 42px;\r\n            background-color: #f0f1f5;\r\n        }\r\n\r\n        .template-script-record {\r\n            &:hover {\r\n                .template-link {\r\n                    display: inline;\r\n                }\r\n            }\r\n        }\r\n\r\n        .job-template-name {\r\n            .template-link {\r\n                display: none;\r\n                margin-left: 5px;\r\n            }\r\n        }\r\n\r\n        .table-selected {\r\n            color: #a3a6af;\r\n        }\r\n\r\n        .status-action {\r\n            width: 46px;\r\n            height: 16px;\r\n            padding: 0 5px;\r\n            margin-left: 10px;\r\n            font-size: 12px;\r\n            color: #9fa2ac;\r\n            text-align: center;\r\n            background: #f0f1f5;\r\n        }\r\n\r\n        .status-online {\r\n            color: #45c272;\r\n            background-color: #e5f6ea;\r\n        }\r\n\r\n        .footer-action {\r\n            position: fixed;\r\n            bottom: 0;\r\n            left: 0;\r\n            display: flex;\r\n            width: 100%;\r\n            height: 52px;\r\n            padding-right: 24px;\r\n            background: #fff;\r\n            border-top: 1px solid #e2e2e2;\r\n            align-items: center;\r\n            justify-content: flex-end;\r\n        }\r\n    }\r\n</style>\r\n"],"names":[],"sourceRoot":""}