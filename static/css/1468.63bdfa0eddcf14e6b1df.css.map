{"version":3,"file":"static/css/1468.63bdfa0eddcf14e6b1df.css","mappings":"AAuUA,+CACA,iBASA,CAPA,yDAKA,cADA,eADA,UAFA,kBACA,SAIA,CC9NA,4BACA,YA0GA,CAvGA,kDACA,cACA,CAGA,oCACA,iBAeA,CAbA,iDACA,iBACA,CAGA,iEACA,wBACA,CAGA,kDACA,gBACA,CAGA,yCAGA,gBAGA,cAFA,0BAHA,kBAIA,oBAHA,SAuCA,CAjCA,sDACA,kBACA,CAEA,0DACA,aACA,CAEA,wDAcA,mBAJA,mBAEA,+BADA,4BAHA,WACA,eALA,aAGA,eADA,YASA,uBAdA,kBAEA,YADA,QAWA,2BARA,UAeA,CAHA,8DACA,kBACA,CAGA,uDACA,uBACA,CAGA,0CAIA,gBACA,kBAEA,OALA,iBACA,gBAFA,kBAKA,mBA8BA,CA3BA,wDACA,UACA,kBAKA,CAHA,+DACA,SACA,CAGA,qDAWA,mBADA,kBAFA,cACA,eALA,aAGA,eADA,YAMA,uBAXA,kBAEA,UADA,QAGA,UAYA,CAHA,2DACA,wBACA,CCjDA,0BAKA,gBACA,uCAJA,aACA,aACA,kBAHA,iBAiDA,CA1CA,4CACA,cACA,iBAMA,CAJA,gDAEA,YADA,UAEA,CAGA,yCACA,aAEA,sBADA,gBAyBA,CAtBA,8CACA,MACA,CAEA,qDAEA,cADA,aAEA,CAEA,qDAIA,cAHA,OAEA,mBADA,OAUA,CANA,+DACA,YACA,gBACA,uBACA,kBACA,CAIA,sCACA,YACA,CCqCA,gBAOA,yBAHA,SACA,OACA,eALA,eAEA,QADA,KA2JA,CApJA,wBAGA,mBAFA,aACA,WAwEA,CArEA,+BAEA,cADA,cAEA,CAEA,mCAMA,mBALA,aAGA,eACA,gBAFA,iBADA,kBA6DA,CAvDA,0IAKA,eAFA,aACA,iBAEA,8DACA,CAEA,6CACA,aASA,CAPA,qDACA,kBACA,CAEA,oDACA,kBACA,CAGA,gDACA,aASA,CAPA,wDACA,kBACA,CAEA,uDACA,kBACA,CAGA,6CACA,aASA,CAPA,qDACA,kBACA,CAEA,oDACA,kBACA,CAGA,qFAGA,WADA,SAEA,CAEA,0CAEA,gBADA,gBAEA,CAIA,uCAIA,mBACA,0BAJA,aACA,YACA,cAqBA,CAjBA,2GAKA,mBAHA,aAEA,aADA,cAGA,CAEA,qDACA,8BACA,CAEA,kDAEA,mBACA,qBAFA,aAGA,CAGA,kCACA,WACA,CAEA,gCAEA,mBADA,6BAEA,CAEA,kCACA,WACA,CAEA,8BAEA,yBADA,iBAEA,CAEA,0CACA,gBAYA,CAVA,wDAMA,gBACA,kBACA,WAPA,WAEA,YAEA,iBADA,eAFA,UAOA,CAGA,4BAKA,cACA,eAFA,eAHA,kBAEA,UADA,QAKA,kBAKA,CAHA,kCACA,uBACA,CCkkBA,iDACA,eACA,CAIA,sEACA,kBACA,CAIA,iMACA,4BACA,CAEA,yMACA,4BACA,CAEA,2MACA,4BACA,CAIA,8DAGA,cAFA,YACA,cAEA","sources":["webpack://job/./src/views/script-manage/common/copy-create.vue","webpack://job/./src/views/script-manage/version/components/layout.vue","webpack://job/./src/views/script-manage/version/components/script-basic.vue","webpack://job/./src/views/script-manage/version/components/diff.vue","webpack://job/./src/views/script-manage/version/index.vue"],"sourcesContent":["\r\n\r\n<template>\r\n    <layout class=\"script-manage-copy-create-box\">\r\n        <div slot=\"title\">{{ '新建脚本' }}</div>\r\n        <template slot=\"sub-header\">\r\n            <Icon\r\n                type=\"upload\"\r\n                @click=\"handleUploadScript\"\r\n                v-bk-tooltips=\"'上传脚本'\"\r\n                v-test=\"{ type: 'button', value: 'uploadScript' }\" />\r\n            <Icon\r\n                type=\"history\"\r\n                @click.stop=\"handleShowHistory\"\r\n                v-bk-tooltips=\"'历史缓存'\"\r\n                v-test=\"{ type: 'button', value: 'scriptEditHistory' }\" />\r\n            <Icon\r\n                type=\"full-screen\"\r\n                v-bk-tooltips=\"'全屏'\"\r\n                @click=\"handleFullScreen\"\r\n                v-test=\"{ type: 'button', value: 'scriptEditFullscreen' }\" />\r\n        </template>\r\n        <div slot=\"left\">\r\n            <jb-form\r\n                ref=\"form\"\r\n                :model=\"formData\"\r\n                form-type=\"vertical\"\r\n                :rules=\"rules\"\r\n                v-test=\"{ type: 'form', value: 'copyCreateScript' }\">\r\n                <jb-form-item\r\n                    :label=\"'版本号'\"\r\n                    required\r\n                    property=\"version\">\r\n                    <div class=\"script-version\">\r\n                        <jb-input\r\n                            :value=\"formData.version\"\r\n                            :placeholder=\"'输入版本号'\"\r\n                            :maxlength=\"30\"\r\n                            property=\"version\"\r\n                            @change=\"handleVersionChange\" />\r\n                        <Icon type=\"new-dark\" svg class=\"new-flag\" />\r\n                    </div>\r\n                </jb-form-item>\r\n                <jb-form-item :label=\"'版本日志'\">\r\n                    <bk-input\r\n                        v-model=\"formData.versionDesc\"\r\n                        type=\"textarea\"\r\n                        :maxlength=\"100\"\r\n                        :rows=\"5\" />\r\n                </jb-form-item>\r\n            </jb-form>\r\n        </div>\r\n        <div ref=\"content\">\r\n            <ace-editor\r\n                v-if=\"contentHeight > 0\"\r\n                ref=\"aceEditor\"\r\n                v-model=\"formData.content\"\r\n                :lang=\"formData.typeName\"\r\n                :height=\"contentHeight\"\r\n                :options=\"formData.typeName\"\r\n                @on-mode-change=\"handleTypeChange\" />\r\n        </div>\r\n        <template #footer>\r\n            <bk-button\r\n                class=\"w120 mr10\"\r\n                :loading=\"isSubmiting\"\r\n                theme=\"primary\"\r\n                @click=\"handleSubmit\"\r\n                v-test=\"{ type: 'button', value: 'copyCreateScriptSubmit' }\">\r\n                {{ '提交' }}\r\n            </bk-button>\r\n            <bk-button\r\n                class=\"mr10\"\r\n                @click=\"handleDebugScript\"\r\n                v-test=\"{ type: 'button', value: 'debugScript' }\">\r\n                {{ '调试' }}\r\n            </bk-button>\r\n            <bk-button\r\n                @click=\"handleCancel\"\r\n                v-test=\"{ type: 'button', value: 'copyCreateScriptCancel' }\">\r\n                {{ '取消' }}\r\n            </bk-button>\r\n        </template>\r\n    </layout>\r\n</template>\r\n<script>\r\n    import _ from 'lodash';\r\n       import ScriptManageService from '@service/script-manage';\r\n    import PublicScriptManageService from '@service/public-script-manage';\r\n    import JbInput from '@components/jb-input';\r\n    import AceEditor from '@components/ace-editor';\r\n    import {\r\n        formatScriptTypeValue,\r\n        genDefaultScriptVersion,\r\n        checkPublicScript,\r\n        getOffset,\r\n        leaveConfirm,\r\n        scriptErrorAlert,\r\n    } from '@utils/assist';\r\n    import { debugScriptCache } from '@utils/cache-helper';\r\n    import { scriptVersionRule } from '@utils/validator';\r\n    import Layout from './components/layout';\r\n\r\n    const genDefaultFormData = () => ({\r\n        id: '',\r\n        typeName: 'Shell',\r\n        version: genDefaultScriptVersion(),\r\n        versionDesc: '',\r\n        type: 1,\r\n        content: '',\r\n    });\r\n\r\n    export default {\r\n        name: '',\r\n        components: {\r\n            JbInput,\r\n            AceEditor,\r\n            Layout,\r\n        },\r\n        inheritAttrs: false,\r\n        props: {\r\n            scriptInfo: {\r\n                type: Object,\r\n                required: true,\r\n            },\r\n            scriptVersionList: {\r\n                type: Array,\r\n                default: () => [],\r\n            },\r\n        },\r\n        data () {\r\n            return {\r\n                isLoading: true,\r\n                isSubmiting: false,\r\n                formData: genDefaultFormData(),\r\n                contentHeight: 0,\r\n            };\r\n        },\r\n        computed: {\r\n            versionMap () {\r\n                return this.scriptVersionList.reduce((result, item) => {\r\n                    if (item.scriptVersionId < 1) {\r\n                        return result;\r\n                    }\r\n                    result[item.version] = true;\r\n                    return result;\r\n                }, {});\r\n            },\r\n        },\r\n        watch: {\r\n            scriptInfo: {\r\n                handler (scriptInfo) {\r\n                    if (!scriptInfo.id) {\r\n                        return;\r\n                    }\r\n                    const {\r\n                        content,\r\n                        id,\r\n                        name,\r\n                        versionDesc,\r\n                        type,\r\n                        typeName,\r\n                    } = scriptInfo;\r\n                    this.formData = {\r\n                        ...genDefaultFormData(),\r\n                        id,\r\n                        name,\r\n                        versionDesc,\r\n                        type,\r\n                        typeName,\r\n                        content,\r\n                    };\r\n                },\r\n                immediate: true,\r\n            },\r\n        },\r\n        created () {\r\n            this.publicScript = checkPublicScript(this.$route);\r\n            this.scriptManageServiceHandler = this.publicScript ? PublicScriptManageService : ScriptManageService;\r\n            this.rules = {\r\n                version: [\r\n                    {\r\n                        required: true,\r\n                        message: '版本号必填',\r\n                        trigger: 'blur',\r\n                    },\r\n                    {\r\n                        validator: scriptVersionRule.validator,\r\n                        message: scriptVersionRule.message,\r\n                        trigger: 'blur',\r\n                    },\r\n                    {\r\n                        validator: value => !this.versionMap[value],\r\n                        message: '版本号已存在，请重新输入',\r\n                        trigger: 'blur',\r\n                    },\r\n                ],\r\n                content: [\r\n                    {\r\n                        required: true,\r\n                        message: '脚本内容不能为空',\r\n                        trigger: 'change',\r\n                    },\r\n                    {\r\n                        validator: value => ScriptManageService.getScriptValidation({\r\n                            content: value,\r\n                            scriptType: this.formData.type,\r\n                        }).then((data) => {\r\n                            // 高危语句报错状态需要全局保存\r\n                            this.$store.commit('setScriptCheckError', data.some(_ => _.isDangerous));\r\n                            return true;\r\n                        }),\r\n                        message: '脚本内容检测失败',\r\n                        trigger: 'blur',\r\n                    },\r\n                ],\r\n            };\r\n        },\r\n        mounted () {\r\n            this.calcContentHeight();\r\n            const handleResize = _.throttle(this.calcContentHeight, 60);\r\n            window.addEventListener('resize', handleResize);\r\n            this.$once('hook:beforeDestroy', () => {\r\n                window.removeEventListener('resize', handleResize);\r\n            });\r\n        },\r\n        methods: {\r\n            /**\r\n             * @desc 计算内容去高度\r\n             */\r\n            calcContentHeight () {\r\n                const contentOffsetTop = getOffset(this.$refs.content).top;\r\n                this.contentHeight = window.innerHeight - contentOffsetTop - 66;\r\n            },\r\n            handleUploadScript () {\r\n                this.$refs.aceEditor.handleUploadScript();\r\n            },\r\n            handleShowHistory () {\r\n                this.$refs.aceEditor.handleShowHistory();\r\n            },\r\n            handleFullScreen () {\r\n                this.$refs.aceEditor.handleFullScreen();\r\n            },\r\n            /**\r\n             * @desc 脚本版本修改\r\n             */\r\n            handleVersionChange: _.debounce(function (value) {\r\n                this.formData.version = value;\r\n                const { scriptVersionId } = this.scriptInfo;\r\n                this.$emit('on-create-change', scriptVersionId, {\r\n                    version: value,\r\n                });\r\n            }, 100),\r\n            /**\r\n             * @desc 脚本语言\r\n             * @param {String} scriptType 脚本语言\r\n             */\r\n            handleTypeChange (scriptType) {\r\n                this.formData.type = formatScriptTypeValue(scriptType);\r\n            },\r\n            /**\r\n             * @desc 保存脚本\r\n             */\r\n            handleSubmit () {\r\n                if (!this.formData.content) {\r\n                    this.messageError('脚本内容不能为空');\r\n                    return;\r\n                }\r\n                this.isSubmiting = true;\r\n                Promise.all([\r\n                    // 验证表单\r\n                    this.$refs.form.validate(),\r\n                    // 脚本高危语句检测\r\n                    ScriptManageService.getScriptValidation({\r\n                        content: this.formData.content,\r\n                        scriptType: this.formData.type,\r\n                    }).then((data) => {\r\n                        // 高危语句报错状态需要全局保存\r\n                        this.$store.commit('setScriptCheckError', data.some(_ => _.isDangerous));\r\n                        return true;\r\n                    }),\r\n                ]).then(() => {\r\n                    if (this.$store.state.scriptCheckError) {\r\n                        scriptErrorAlert();\r\n                        return;\r\n                    }\r\n                    this.scriptManageServiceHandler.scriptUpdate({\r\n                        ...this.formData,\r\n                    }).then((data) => {\r\n                        this.$emit('on-create', {\r\n                            scriptVersionId: data.scriptVersionId,\r\n                        });\r\n                        window.changeAlert = false;\r\n                        this.messageSuccess('操作成功');\r\n                    });\r\n                })\r\n                    .finally(() => {\r\n                        this.isSubmiting = false;\r\n                    });\r\n            },\r\n            /**\r\n             * @desc 跳转到快速执行脚本页面执行\r\n             */\r\n            handleDebugScript () {\r\n                debugScriptCache.setItem(this.formData.content);\r\n                const { href } = this.$router.resolve({\r\n                    name: 'fastExecuteScript',\r\n                    query: {\r\n                        model: 'debugScript',\r\n                    },\r\n                });\r\n                window.open(href);\r\n            },\r\n            /**\r\n             * @desc 取消新建\r\n             */\r\n            handleCancel () {\r\n                leaveConfirm()\r\n                    .then(() => {\r\n                        this.$emit('on-create-cancel');\r\n                    });\r\n            },\r\n        },\r\n    };\r\n</script>\r\n<style lang='postcss'>\r\n    .script-manage-copy-create-box {\r\n        .script-version {\r\n            position: relative;\r\n\r\n            .new-flag {\r\n                position: absolute;\r\n                top: -32px;\r\n                left: 55px;\r\n                font-size: 32px;\r\n                color: #7d6b50;\r\n            }\r\n        }\r\n    }\r\n</style>\r\n","\r\n\r\n<template>\r\n    <div\r\n        ref=\"layout\"\r\n        class=\"script-version-page-layout\"\r\n        :class=\"{\r\n            'is-flod': flod,\r\n            toggled: isOpen,\r\n        }\">\r\n        <div class=\"layout-left\">\r\n            <div class=\"left-wraper\" :style=\"styles\">\r\n                <slot />\r\n            </div>\r\n            <div v-if=\"isShowRight\" class=\"toggle-button\" @click=\"handleToggle\">\r\n                <Icon type=\"down-small\" class=\"toggle-arrow\" />\r\n            </div>\r\n        </div>\r\n        <div v-if=\"flod\" class=\"layout-right\" :style=\"rightStyles\">\r\n            <div class=\"right-wraper\" :class=\"{ active: isShowRight }\">\r\n                <slot v-if=\"isShowRight\" name=\"flod\" />\r\n            </div>\r\n            <div class=\"close-btn\" @click=\"handleClose\">\r\n                <Icon type=\"close-big\" />\r\n            </div>\r\n        </div>\r\n    </div>\r\n</template>\r\n<script>\r\n    import {\r\n        getOffset,\r\n        leaveConfirm,\r\n    } from '@utils/assist';\r\n\r\n    export default {\r\n        name: '',\r\n        props: {\r\n            flod: {\r\n                type: Boolean,\r\n                default: false,\r\n            },\r\n        },\r\n        data () {\r\n            return {\r\n                isShowRight: false,\r\n                isOpen: false,\r\n                layoutWidth: 'auto',\r\n                layoutOffsetTop: 0,\r\n            };\r\n        },\r\n        computed: {\r\n            styles () {\r\n                if (this.flod) {\r\n                    return {\r\n                        width: '360px',\r\n                    };\r\n                }\r\n                return {\r\n                    width: this.layoutWidth,\r\n                };\r\n            },\r\n            rightStyles () {\r\n                const paddingBottom = 20;\r\n                return {\r\n                    height: `calc(100vh -  ${this.layoutOffsetTop + paddingBottom}px)`,\r\n                };\r\n            },\r\n        },\r\n        watch: {\r\n            flod: {\r\n                handler (flod) {\r\n                    if (flod) {\r\n                        setTimeout(() => {\r\n                            this.isShowRight = flod;\r\n                        }, 110);\r\n                    } else {\r\n                        this.isShowRight = false;\r\n                    }\r\n                },\r\n                immediate: true,\r\n            },\r\n        },\r\n        mounted () {\r\n            this.init();\r\n            window.addEventListener('resize', this.init);\r\n            this.$once('hook:beforeDestroy', () => {\r\n                window.removeEventListener('resize', this.init);\r\n            });\r\n        },\r\n        methods: {\r\n            /**\r\n             * @desc 根据屏幕尺寸动态计算 layout 的位置信息\r\n             */\r\n            init () {\r\n                const layoutWidth = this.$refs.layout.getBoundingClientRect().width;\r\n                this.layoutWidth = `${layoutWidth}px`;\r\n                const offsetTop = getOffset(this.$refs.layout).top;\r\n                this.layoutOffsetTop = offsetTop;\r\n            },\r\n            handleToggle () {\r\n                this.isOpen = !this.isOpen;\r\n            },\r\n            handleClose () {\r\n                leaveConfirm()\r\n                    .then(() => {\r\n                        this.isOpen = false;\r\n                        this.$emit('on-flod');\r\n                        this.$emit('update:flod', false);\r\n                    });\r\n            },\r\n        },\r\n    };\r\n</script>\r\n<style lang='postcss'>\r\n    .script-version-page-layout {\r\n        display: flex;\r\n\r\n        &.is-flod {\r\n            .bk-table-row {\r\n                cursor: pointer;\r\n            }\r\n        }\r\n\r\n        &.toggled {\r\n            margin-left: -24px;\r\n\r\n            .left-wraper {\r\n                width: 0 !important;\r\n            }\r\n\r\n            .toggle-button {\r\n                .toggle-arrow {\r\n                    transform: rotateZ(-90deg);\r\n                }\r\n            }\r\n\r\n            .layout-right {\r\n                margin-left: 24px;\r\n            }\r\n        }\r\n\r\n        .layout-left {\r\n            position: relative;\r\n            z-index: 9;\r\n            background: #fff;\r\n            outline: 1px solid #dfe0e5;\r\n            transition: all 0.15s;\r\n            flex: 0 0 auto;\r\n\r\n            .left-wraper {\r\n                transition: all 0.1s;\r\n            }\r\n\r\n            .bk-table::before {\r\n                content: unset;\r\n            }\r\n\r\n            .toggle-button {\r\n                position: absolute;\r\n                top: 50%;\r\n                right: -14px;\r\n                display: flex;\r\n                width: 14px;\r\n                height: 64px;\r\n                font-size: 24px;\r\n                color: #fff;\r\n                cursor: pointer;\r\n                background: #dcdee5;\r\n                border-top-right-radius: 6px;\r\n                border-bottom-right-radius: 6px;\r\n                transform: translateY(-50%);\r\n                align-items: center;\r\n                justify-content: center;\r\n\r\n                &:hover {\r\n                    background: #c4c6cc;\r\n                }\r\n            }\r\n\r\n            .toggle-arrow {\r\n                transform: rotateZ(90deg);\r\n            }\r\n        }\r\n\r\n        .layout-right {\r\n            position: relative;\r\n            margin-left: 16px;\r\n            overflow: hidden;\r\n            background: #fff;\r\n            border-radius: 2px;\r\n            transition: all 0.15s;\r\n            flex: 1;\r\n\r\n            .right-wraper {\r\n                opacity: 0%;\r\n                transition: all 0.5s;\r\n\r\n                &.active {\r\n                    opacity: 100%;\r\n                }\r\n            }\r\n\r\n            .close-btn {\r\n                position: absolute;\r\n                top: 8px;\r\n                right: 8px;\r\n                display: flex;\r\n                width: 26px;\r\n                height: 26px;\r\n                font-size: 16px;\r\n                color: #c4c6cc;\r\n                cursor: pointer;\r\n                border-radius: 50%;\r\n                align-items: center;\r\n                justify-content: center;\r\n\r\n                &:hover {\r\n                    background-color: #4d4d4d;\r\n                }\r\n            }\r\n        }\r\n    }\r\n</style>\r\n","\r\n\r\n<template>\r\n    <div\r\n        ref=\"wraper\"\r\n        class=\"script-version-basic-box\"\r\n        v-bkloading=\"{ isLoading }\">\r\n        <template v-if=\"data.id\">\r\n            <div class=\"script-type-flag\">\r\n                <img :src=\"`/static/images/script/${data.typeName}.svg`\">\r\n            </div>\r\n            <div class=\"detail-column\" style=\"width: 270px;\">\r\n                <div class=\"detail-col\">\r\n                    <div class=\"item-label\">{{ '脚本名：' }}</div>\r\n                    <div class=\"item-value\">\r\n                        <auth-component\r\n                            auth=\"script/edit\"\r\n                            :resource-id=\"data.id\">\r\n                            <jb-edit-input\r\n                                style=\"width: 100%;\"\r\n                                field=\"scriptName\"\r\n                                :value=\"data.name\"\r\n                                :remote-hander=\"val => handleUpdateScript('scriptName', val)\" />\r\n                            <div slot=\"forbid\">{{ data.name }}</div>\r\n                        </auth-component>\r\n                    </div>\r\n                </div>\r\n                <div class=\"detail-col\">\r\n                    <div class=\"item-label\">{{ '更新人：' }}</div>\r\n                    <div class=\"item-value\">\r\n                        <div class=\"text-box\" v-bk-overflow-tips>{{ data.lastModifyUser }}</div>\r\n                    </div>\r\n                </div>\r\n                <div class=\"detail-col\">\r\n                    <div class=\"item-label\">{{ '创建人：' }}</div>\r\n                    <div class=\"item-value\">\r\n                        <div class=\"text-box\" v-bk-overflow-tips>{{ data.creator }}</div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n            <div class=\"detail-column\" style=\"width: 282px;\">\r\n                <div class=\"detail-col\">\r\n                    <div class=\"item-label\">{{ '脚本语言：' }}</div>\r\n                    <div class=\"item-value\">\r\n                        <div class=\"text-box\">{{ data.typeName }}</div>\r\n                    </div>\r\n                </div>\r\n                <div class=\"detail-col\">\r\n                    <div class=\"item-label\">{{ '更新时间：' }}</div>\r\n                    <div class=\"item-value\">\r\n                        <div class=\"text-box\" v-bk-overflow-tips>{{ data.lastModifyTime }}</div>\r\n                    </div>\r\n                </div>\r\n                <div class=\"detail-col\">\r\n                    <div class=\"item-label\">{{ '创建时间：' }}</div>\r\n                    <div class=\"item-value\" v-bk-overflow-tips>\r\n                        <div class=\"text-box\">{{ data.createTime }}</div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n            <div class=\"detail-column last\">\r\n                <div class=\"detail-col\">\r\n                    <div class=\"item-label\">{{ '场景标签：' }}</div>\r\n                    <div class=\"item-value\">\r\n                        <auth-component\r\n                            auth=\"script/edit\"\r\n                            :resource-id=\"data.id\">\r\n                            <jb-edit-tag\r\n                                class=\"input\"\r\n                                field=\"scriptTags\"\r\n                                :rows=\"1\"\r\n                                :value=\"data.tags\"\r\n                                :remote-hander=\"val => handleUpdateScript('scriptTags', val)\" />\r\n                            <div slot=\"forbid\">{{ data.tagText }}</div>\r\n                        </auth-component>\r\n                    </div>\r\n                </div>\r\n                <div class=\"detail-col\">\r\n                    <div class=\"item-label\">{{ '脚本描述：' }}</div>\r\n                    <div class=\"item-value\">\r\n                        <jb-edit-textarea\r\n                            field=\"scriptDesc\"\r\n                            single-row-render\r\n                            :placeholder=\"'在此处标注该脚本的备注和使用说明'\"\r\n                            :maxlength=\"500\"\r\n                            :rows=\"1\"\r\n                            :value=\"data.description\"\r\n                            :remote-hander=\"val => handleUpdateScript('scriptDesc', val)\" />\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </template>\r\n    </div>\r\n</template>\r\n<script>\r\n    import ScriptService from '@service/script-manage';\r\n    import PublicScriptService from '@service/public-script-manage';\r\n    import { checkPublicScript } from '@utils/assist';\r\n    import JbEditInput from '@components/jb-edit/input';\r\n    import JbEditTag from '@components/jb-edit/tag';\r\n    import JbEditTextarea from '@components/jb-edit/textarea';\r\n\r\n    export default {\r\n        name: '',\r\n        components: {\r\n            JbEditInput,\r\n            JbEditTag,\r\n            JbEditTextarea,\r\n        },\r\n        data () {\r\n            return {\r\n                isLoading: true,\r\n                data: {},\r\n            };\r\n        },\r\n        created () {\r\n            this.publicScript = checkPublicScript(this.$route);\r\n            this.serviceHandler = this.publicScript ? PublicScriptService : ScriptService;\r\n            this.scriptId = this.$route.params.id;\r\n            this.fetchScriptBasic();\r\n        },\r\n        methods: {\r\n            /**\r\n             * @desc 获取脚本基本信息\r\n             */\r\n            fetchScriptBasic () {\r\n                this.isLoading = true;\r\n                this.serviceHandler.fetchBasicInfo({\r\n                    id: this.scriptId,\r\n                }).then((data) => {\r\n                    this.data = Object.freeze(data);\r\n                    this.calcLableWidth();\r\n                })\r\n                    .finally(() => {\r\n                        this.isLoading = false;\r\n                    });\r\n            },\r\n            /**\r\n             * @desc 计算脚本lable的宽度\r\n             */\r\n            calcLableWidth () {\r\n                this.$refs.wraper.querySelectorAll('.detail-column').forEach((columnEl) => {\r\n                    const $lableEles = columnEl.querySelectorAll('.item-label');\r\n                    let maxWidth = 0;\r\n                    $lableEles.forEach((ele) => {\r\n                        const { width } = ele.getBoundingClientRect();\r\n                        maxWidth = Math.max(maxWidth, width);\r\n                    });\r\n                    $lableEles.forEach((ele) => {\r\n                        ele.style.width = `${maxWidth + 2}px`;\r\n                    });\r\n                });\r\n            },\r\n            /**\r\n             * @desc 更新脚本基本信息\r\n             * @param {String} field 指定更新的字段名\r\n             * @param {Object} payload 更新的字段key和value\r\n             */\r\n            handleUpdateScript (field, payload) {\r\n                return this.serviceHandler.scriptUpdateMeta({\r\n                    id: this.scriptId,\r\n                    ...payload,\r\n                    updateField: field,\r\n                });\r\n            },\r\n        },\r\n    };\r\n</script>\r\n<style lang='postcss'>\r\n    .script-version-basic-box {\r\n        position: relative;\r\n        display: flex;\r\n        height: 128px;\r\n        padding: 16px 24px;\r\n        background: #fff;\r\n        box-shadow: 0 1px 2px 0 rgb(0 0 0 / 16%);\r\n\r\n        .script-type-flag {\r\n            flex: 0 0  auto;\r\n            margin-right: 20px;\r\n\r\n            img {\r\n                width: 100%;\r\n                height: 100%;\r\n            }\r\n        }\r\n\r\n        .detail-column {\r\n            display: flex;\r\n            line-height: 30px;\r\n            flex-direction: column;\r\n\r\n            &.last {\r\n                flex: 1;\r\n            }\r\n\r\n            .item-label {\r\n                flex: 0 0 auto;\r\n                color: #b2b5bd;\r\n            }\r\n\r\n            .item-value {\r\n                flex: 1;\r\n                width: 0;\r\n                padding-right: 20px;\r\n                color: #63656e;\r\n\r\n                .text-box {\r\n                    height: 32px;\r\n                    overflow: hidden;\r\n                    text-overflow: ellipsis;\r\n                    white-space: nowrap;\r\n                }\r\n            }\r\n        }\r\n\r\n        .detail-col {\r\n            display: flex;\r\n        }\r\n    }\r\n</style>\r\n","\r\n\r\n<template>\r\n    <div class=\"jb-diff-layout\"\r\n        :style=\"{\r\n            'z-index': zIndex,\r\n        }\">\r\n        <div class=\"header\">\r\n            <div class=\"title\">{{ title }}</div>\r\n            <div class=\"diff-info\">\r\n                <div class=\"diff-del\" @click=\"handleViewDel\">\r\n                    <span class=\"before\" />\r\n                    <span class=\"after\" />\r\n                    <span>{{ '删除' }}（{{ del }}）</span>\r\n                </div>\r\n                <div class=\"diff-change\" @click=\"handleViewChange\">\r\n                    <span class=\"before\" />\r\n                    <span class=\"after\" />\r\n                    <span>{{ '变换' }}（{{ change }}）</span>\r\n                </div>\r\n                <div class=\"diff-ins\" @click=\"handleViewIns\">\r\n                    <span class=\"before\" />\r\n                    <span class=\"after\" />\r\n                    <span>{{ '新增'}}（{{ ins }}）</span>\r\n                </div>\r\n            </div>\r\n        </div>\r\n        <div class=\"version-select-layout\">\r\n            <div class=\"version-left\">\r\n                <bk-select class=\"version-selector\" :clearable=\"false\" v-model=\"oldVersion\">\r\n                    <bk-option\r\n                        v-for=\"item in data\"\r\n                        :key=\"item.scriptVersionId\"\r\n                        :id=\"item.scriptVersionId\"\r\n                        :name=\"item.version\"\r\n                         />\r\n                </bk-select>\r\n            </div>\r\n            <div class=\"version-right\">\r\n                <bk-select class=\"version-selector\" :clearable=\"false\" v-model=\"newVersion\">\r\n                    <bk-option\r\n                        v-for=\"item in data\"\r\n                        :key=\"item.scriptVersionId\"\r\n                        :id=\"item.scriptVersionId\"\r\n                        :name=\"item.version\"\r\n                         />\r\n                </bk-select>\r\n            </div>\r\n        </div>\r\n        <scroll-faker class=\"content-wraper\">\r\n            <jb-diff\r\n                class=\"diff-details\"\r\n                format=\"side-by-side\"\r\n                theme=\"dark\"\r\n                ref=\"diff\"\r\n                :language=\"language\"\r\n                :context=\"Infinity\"\r\n                :old-content=\"oldContent\"\r\n                :new-content=\"newContent\" />\r\n        </scroll-faker>\r\n        <i class=\"bk-icon icon-close\" @click=\"handleClose\" />\r\n    </div>\r\n</template>\r\n<script>\r\n    import _ from 'lodash';\r\n    import { Base64 } from 'js-base64';\r\n\r\n    export default {\r\n        props: {\r\n            data: {\r\n                type: Array,\r\n                required: true,\r\n            },\r\n            title: {\r\n                type: String,\r\n                default: '',\r\n            },\r\n            oldVersionId: {\r\n                type: Number,\r\n                required: true,\r\n            },\r\n            newVersionId: {\r\n                type: Number,\r\n                required: true,\r\n            },\r\n        },\r\n        data () {\r\n            return {\r\n                oldVersion: this.oldVersionId,\r\n                newVersion: this.newVersionId,\r\n                zIndex: 'auto',\r\n                del: 0,\r\n                ins: 0,\r\n                change: 0,\r\n            };\r\n        },\r\n        computed: {\r\n            language () {\r\n                if (this.data.length < 1) {\r\n                    return '';\r\n                }\r\n                return this.data[0].typeName.toLocaleLowerCase();\r\n            },\r\n            oldContent () {\r\n                const script = _.find(this.data, _ => _.scriptVersionId === this.oldVersion);\r\n                if (script) {\r\n                    return Base64.decode(script.content);\r\n                }\r\n                return '';\r\n            },\r\n            newContent () {\r\n                const script = _.find(this.data, _ => _.scriptVersionId === this.newVersion);\r\n                if (script) {\r\n                    return Base64.decode(script.content);\r\n                }\r\n                return '';\r\n            },\r\n        },\r\n        watch: {\r\n            oldContent () {\r\n                this.statisticsDiff();\r\n            },\r\n            newContent () {\r\n                this.statisticsDiff();\r\n            },\r\n        },\r\n        created () {\r\n            this.scrollTopMemo = 0;\r\n            this.insElements = [];\r\n            this.insIndex = 0;\r\n            this.delElements = [];\r\n            this.delIndex = 0;\r\n            this.changeElements = [];\r\n            this.changeIndex = 0;\r\n        },\r\n        mounted () {\r\n            this.zIndex = window.__bk_zIndex_manager.nextZIndex(); // eslint-disable-line no-underscore-dangle\r\n            document.body.append(this.$el);\r\n            window.addEventListener('keydown', this.handleEsc);\r\n            this.resetBodyStyle();\r\n            this.statisticsDiff();\r\n            this.$once('hook:beforeDestroy', () => {\r\n                window.removeEventListener('keydown', this.handleEsc);\r\n                try {\r\n                    document.body.removeChild(this.$el);\r\n                } catch {}\r\n            });\r\n        },\r\n        methods: {\r\n            statisticsDiff () {\r\n                this.$nextTick(() => {\r\n                    const $contentTarget = this.$refs.diff.$el.querySelectorAll('.d2h-file-side-diff');\r\n                    const $newTarget = $contentTarget[1];// eslint-disable-line prefer-destructuring\r\n                    const $allChangeElemennts = Array.from($newTarget.querySelectorAll('td.d2h-code-side-linenumber.d2h-ins'));\r\n                    $allChangeElemennts.pop();\r\n\r\n                    this.insElements = [];\r\n                    this.ins = 0;\r\n                    this.insIndex = 0;\r\n                    this.changeElements = [];\r\n                    this.change = 0;\r\n                    this.changeIndex = 0;\r\n\r\n                    $allChangeElemennts.forEach((ele) => {\r\n                        if (ele.classList.contains('d2h-change')) {\r\n                            this.changeElements.push(ele);\r\n                            this.change += 1;\r\n                        } else {\r\n                            this.insElements.push(ele);\r\n                            this.ins += 1;\r\n                        }\r\n                    });\r\n                    \r\n                    const $dels = $newTarget.querySelectorAll('td.d2h-code-side-linenumber.d2h-code-side-emptyplaceholder');\r\n                    this.delElements = $dels;\r\n                    this.del = $dels.length;\r\n                    this.delIndex = 0;\r\n\r\n                    this.lineElements = $newTarget.querySelectorAll('td.d2h-code-side-linenumber');\r\n                });\r\n            },\r\n            lineViewReset () {\r\n                this.lineElements.forEach((item) => {\r\n                    item.classList.remove('active');\r\n                });\r\n            },\r\n            handleViewDel () {\r\n                this.lineViewReset();\r\n                if (this.del < 1) {\r\n                    return;\r\n                }\r\n                const $target = this.delElements[this.delIndex];\r\n                $target.scrollIntoView();\r\n                $target.classList.add('active');\r\n                this.changeIndex = 0;\r\n                this.insIndex = 0;\r\n                this.delIndex += 1;\r\n                if (this.delIndex >= this.del) {\r\n                    this.delIndex = 0;\r\n                }\r\n            },\r\n            handleViewChange () {\r\n                this.lineViewReset();\r\n                if (this.change < 1) {\r\n                    return;\r\n                }\r\n                const $target = this.changeElements[this.changeIndex];\r\n                $target.scrollIntoView();\r\n                $target.classList.add('active');\r\n                this.insIndex = 0;\r\n                this.delIndex = 0;\r\n                this.changeIndex += 1;\r\n                if (this.changeIndex >= this.change) {\r\n                    this.changeIndex = 0;\r\n                }\r\n            },\r\n            handleViewIns () {\r\n                this.lineViewReset();\r\n                if (this.ins < 1) {\r\n                    return;\r\n                }\r\n                const $target = this.insElements[this.insIndex];\r\n                $target.scrollIntoView();\r\n                $target.classList.add('active');\r\n                this.delIndex = 0;\r\n                this.changeIndex = 0;\r\n                this.insIndex += 1;\r\n                if (this.insIndex >= this.ins) {\r\n                    this.insIndex = 0;\r\n                }\r\n            },\r\n            handleEsc (event) {\r\n                if (event && event.code === 'Escape') {\r\n                    this.handleClose();\r\n                }\r\n            },\r\n            handleClose () {\r\n                this.$emit('on-change', {\r\n                    [this.oldVersion]: true,\r\n                    [this.newVersion]: true,\r\n                });\r\n                this.$emit('close');\r\n            },\r\n            resetBodyStyle () {\r\n                this.scrollTopMemo = document.scrollingElement.scrollTop;\r\n                document.scrollingElement.style.overflow = 'hidden';\r\n            },\r\n            recoveryBodyStyle () {\r\n                document.scrollingElement.style.overflow = 'initial';\r\n                document.scrollingElement.scrollTop = this.scrollTopMemo;\r\n            },\r\n        },\r\n    };\r\n</script>\r\n<style lang=\"postcss\">\r\n    .jb-diff-layout {\r\n        position: fixed;\r\n        top: 0;\r\n        right: 0;\r\n        bottom: 0;\r\n        left: 0;\r\n        padding: 0 40px;\r\n        background-color: #fafbfd;\r\n\r\n        .header {\r\n            display: flex;\r\n            height: 40px;\r\n            align-items: center;\r\n\r\n            .title {\r\n                font-size: 14px;\r\n                color: #313238;\r\n            }\r\n\r\n            .diff-info {\r\n                display: flex;\r\n                margin-right: 114px;\r\n                margin-left: auto;\r\n                font-size: 12px;\r\n                line-height: 1em;\r\n                align-items: center;\r\n\r\n                .diff-del,\r\n                .diff-change,\r\n                .diff-ins {\r\n                    display: flex;\r\n                    margin-left: 30px;\r\n                    cursor: pointer;\r\n                    user-select: none;\r\n                }\r\n\r\n                .diff-del {\r\n                    color: #bd5c58;\r\n\r\n                    .before {\r\n                        background: #b1615b;\r\n                    }\r\n\r\n                    .after {\r\n                        background: #dcdcdc;\r\n                    }\r\n                }\r\n\r\n                .diff-change {\r\n                    color: #63656e;\r\n\r\n                    .before {\r\n                        background: #b1615b;\r\n                    }\r\n\r\n                    .after {\r\n                        background: #9aad76;\r\n                    }\r\n                }\r\n\r\n                .diff-ins {\r\n                    color: #9aad76;\r\n\r\n                    .before {\r\n                        background: #dcdcdc;\r\n                    }\r\n\r\n                    .after {\r\n                        background: #9aad76;\r\n                    }\r\n                }\r\n\r\n                .before,\r\n                .after {\r\n                    width: 1em;\r\n                    height: 1em;\r\n                }\r\n\r\n                .after {\r\n                    margin-right: 6px;\r\n                    margin-left: 1px;\r\n                }\r\n            }\r\n        }\r\n\r\n        .version-select-layout {\r\n            display: flex;\r\n            height: 51px;\r\n            margin: 6px 0 0;\r\n            background: #2f3033;\r\n            border-radius: 2px 2px 0 0;\r\n\r\n            .version-left,\r\n            .version-right {\r\n                display: flex;\r\n                padding: 0 10px;\r\n                flex: 0 0 50%;\r\n                align-items: center;\r\n            }\r\n\r\n            .version-left {\r\n                border-right: 1px solid #dcdee5;\r\n            }\r\n\r\n            .bk-select {\r\n                color: #dcdee5;\r\n                background: #393a3d;\r\n                border-color: #393a3d;\r\n            }\r\n        }\r\n\r\n        .version-selector {\r\n            width: 300px;\r\n        }\r\n\r\n        .content-wraper {\r\n            max-height: calc(100vh - 92px);\r\n            background: #1d1d1d;\r\n        }\r\n\r\n        .d2h-file-wrapper {\r\n            border: none;\r\n        }\r\n\r\n        .diff-details {\r\n            position: relative;\r\n            background-color: #272822;\r\n        }\r\n\r\n        .d2h-code-side-linenumber {\r\n            line-height: 20px;\r\n\r\n            &.active::before {\r\n                float: left;\r\n                width: 10px;\r\n                height: 10px;\r\n                margin-top: 5px;\r\n                margin-left: 13px;\r\n                background: #666;\r\n                border-radius: 50%;\r\n                content: \"\";\r\n            }\r\n        }\r\n\r\n        .icon-close {\r\n            position: absolute;\r\n            top: 8px;\r\n            right: 8px;\r\n            font-size: 28px;\r\n            color: #313238;\r\n            cursor: pointer;\r\n            transition: all 0.1s;\r\n\r\n            &:hover {\r\n                transform: rotateZ(90deg);\r\n            }\r\n        }\r\n    }\r\n</style>\r\n","\r\n\r\n<template>\r\n    <div class=\"script-manage-version-page\">\r\n        <script-basic />\r\n        <div class=\"version-list-wraper\">\r\n            <list-action-layout>\r\n                <bk-button\r\n                    ref=\"newVersion\"\r\n                    @click=\"handlNewVersion\">\r\n                    {{ '新建版本' }}\r\n                </bk-button>\r\n                <bk-button\r\n                    \r\n                    @click=\"handlShowDiff\">\r\n                    {{ '版本对比' }}\r\n                </bk-button>\r\n                <template #right>\r\n                    <jb-search-select\r\n                        @on-change=\"handleSearch\"\r\n                        :data=\"searchSelect\"\r\n                        :placeholder=\"'直接输入 版本号 或 更新人 进行全局模糊搜索'\"\r\n                        :show-condition=\"false\"\r\n                        style=\"width: 420px;\" />\r\n                </template>\r\n            </list-action-layout>\r\n            <div ref=\"list\">\r\n                <layout :flod=\"isListFlod\" @on-flod=\"handleLayoutFlod\">\r\n                    <bk-table\r\n                        v-if=\"tableHeight\"\r\n                        class=\"script-version-list\"\r\n                        :data=\"renderList\"\r\n                        :outer-border=\"false\"\r\n                        :max-height=\"tableHeight\"\r\n                        @row-click=\"handleRowSelect\"\r\n                        @sort-change=\"handleSortChange\"\r\n                        :size=\"tableSize\"\r\n                        :row-class-name=\"rowClassName\">\r\n                        <bk-table-column\r\n                            key=\"selection\"\r\n                            width=\"47\"\r\n                            align=\"center\"\r\n                            :resizable=\"false\">\r\n                            <template slot-scope=\"{ row }\">\r\n                                <bk-checkbox\r\n                                    \r\n                                    :checked=\"isRowChecked(row)\"\r\n                                    @change=\"checked => handleSelectionChange(row, checked)\" />\r\n                            </template>\r\n                        </bk-table-column>\r\n                        <bk-table-column\r\n                            v-if=\"allColumnMap.scriptVersionId\"\r\n                            :label=\"'版本 ID'\"\r\n                            prop=\"scriptVersionId\"\r\n                            key=\"scriptVersionId\"\r\n                            align=\"left\"\r\n                            width=\"100\" />\r\n                        <bk-table-column\r\n                            v-if=\"allColumnMap.version\"\r\n                            :label=\"'版本号'\"\r\n                            prop=\"version\"\r\n                            key=\"version\"\r\n                            align=\"left\"\r\n                            show-overflow-tooltip\r\n                            :sortable=\"true\">\r\n                            <template slot-scope=\"{ row }\">\r\n                                <a @click=\"handleShowDetail(row)\">{{ row.version || '--' }}</a>\r\n                            </template>\r\n                        </bk-table-column>\r\n                        <bk-table-column\r\n                            v-if=\"allColumnMap.relatedTaskNum\"\r\n                            :label=\"'被引用'\"\r\n                            prop=\"relatedTaskNum\"\r\n                            key=\"relatedTaskNum\"\r\n                            :render-header=\"renderHeader\"\r\n                            align=\"right\"\r\n                            width=\"150\">\r\n                            <template slot-scope=\"{ row }\">\r\n                                <bk-button\r\n                                    class=\"mr20\"\r\n                                    text\r\n                                    v-bk-tooltips.allowHtml=\"`\r\n                                    <div>${'作业模板引用'}: ${row.relatedTaskTemplateNum}</div>\r\n                                    <div>${'执行方案引用'}: ${row.relatedTaskPlanNum}</div>`\"\r\n                                    @click=\"handleShowRelated(row)\">\r\n                                    <span>\r\n                                        {{ row.relatedTaskTemplateNum }}\r\n                                    </span>\r\n                                    <span> / </span>\r\n                                    <span>\r\n                                        {{ row.relatedTaskPlanNum }}\r\n                                    </span>\r\n                                </bk-button>\r\n                            </template>\r\n                        </bk-table-column>\r\n                        <bk-table-column\r\n                            v-if=\"allColumnMap.lastModifyUser\"\r\n                            :label=\"'更新人'\"\r\n                            prop=\"lastModifyUser\"\r\n                            key=\"lastModifyUser\"\r\n                            align=\"left\"\r\n                            width=\"160\" />\r\n                        <bk-table-column\r\n                            v-if=\"allColumnMap.lastModifyTime\"\r\n                            :label=\"'更新时间'\"\r\n                            prop=\"lastModifyTime\"\r\n                            key=\"lastModifyTime\"\r\n                            align=\"left\"\r\n                            width=\"200\"\r\n                            :sortable=\"true\" />\r\n                        <bk-table-column\r\n                            v-if=\"allColumnMap.statusDesc\"\r\n                            :label=\"'状态'\"\r\n                            prop=\"statusDesc\"\r\n                            key=\"statusDesc\"\r\n                            align=\"left\"\r\n                            width=\"120\"\r\n                            :sortable=\"true\">\r\n                            <template slot-scope=\"{ row }\">\r\n                                <span v-html=\"row.statusHtml\" />\r\n                                <Icon\r\n                                    v-show=\"row.scriptVersionId === selectVersionId\"\r\n                                    class=\"select-flag\"\r\n                                    type=\"arrow-full-right\" />\r\n                            </template>\r\n                        </bk-table-column>\r\n                        <bk-table-column\r\n                            v-if=\"!isListFlod\"\r\n                            :label=\"'操作'\"\r\n                            prop=\"action\"\r\n                            key=\"action\"\r\n                            align=\"left\"\r\n                            width=\"400\">\r\n                            <div slot-scope=\"{ row }\" @click.stop=\"\">\r\n                                <jb-popover-confirm\r\n                                    v-if=\"!row.isOnline\"\r\n                                    class=\"mr10\"\r\n                                    :title=\"'确定上线该版本？'\"\r\n                                    :content=\"'上线后，之前的线上版本将被置为「已下线」状态，但不影响作业使用'\"\r\n                                    \r\n                                    :confirm-handler=\"() => handleOnline(row.id, row.scriptVersionId)\">\r\n                                    <auth-button\r\n                                        :permission=\"row.canManage\"\r\n                                        :resource-id=\"row.id\"\r\n                                        auth=\"script/edit\"\r\n                                        \r\n                                        text>\r\n                                        {{ '上线' }}\r\n                                    </auth-button>\r\n                                </jb-popover-confirm>\r\n                                <jb-popover-confirm\r\n                                    class=\"mr10\"\r\n                                    :title=\"'确定禁用该版本？'\"\r\n                                    :content=\"'一旦禁用成功，线上引用该版本的作业脚本步骤都会执行失败，请务必谨慎操作！'\"\r\n                                    :confirm-handler=\"() => handleOffline(row.id, row.scriptVersionId)\">\r\n                                    <auth-button\r\n                                        :permission=\"row.canManage\"\r\n                                        :resource-id=\"row.id\"\r\n                                        auth=\"script/edit\"\r\n                                        text>\r\n                                        {{ '禁用' }}\r\n                                    </auth-button>\r\n                                </jb-popover-confirm>\r\n                                <auth-button\r\n                                    class=\"mr10\"\r\n                                    :permission=\"row.canManage\"\r\n                                    :resource-id=\"row.id\"\r\n                                    auth=\"script/edit\"\r\n                                    text\r\n                                    @click=\"handleEdit(row)\">\r\n                                    {{ '编辑' }}\r\n                                </auth-button>\r\n                                <span\r\n                                    class=\"mr10\"\r\n                                    :tippy-tips=\"isCopyCreateDisabled ? '已有[未上线]版本' : ''\">\r\n                                    <auth-button\r\n                                        :permission=\"row.canClone\"\r\n                                        :resource-id=\"row.id\"\r\n                                        auth=\"script/clone\"\r\n                                        \r\n                                        text\r\n                                        @click=\"handleToggleCopyCreate(row)\">\r\n                                        {{ '复制并新建' }}\r\n                                    </auth-button>\r\n                                </span>\r\n                                <auth-button\r\n                                    text\r\n                                    :permission=\"row.canManage\"\r\n                                    auth=\"script/execute\"\r\n                                    :resource-id=\"row.id\"\r\n                                    \r\n                                    @click=\"handleGoExce(row)\">\r\n                                    {{ '去执行' }}\r\n                                </auth-button>\r\n                                <span :tippy-tips=\"!row.syncEnabled ? '所有关联作业模板已是当前版本' : ''\">\r\n                                    <auth-button\r\n                                        :permission=\"row.canManage\"\r\n                                        :resource-id=\"row.id\"\r\n                                        auth=\"script/edit\"\r\n                                        class=\"ml10\"\r\n                                        \r\n                                        @click=\"handleSync(row)\"\r\n                                        text>\r\n                                        {{ '同步' }}\r\n                                    </auth-button>\r\n                                </span>\r\n                                <jb-popover-confirm\r\n                                    :title=\"'确定删除该版本？'\"\r\n                                    :content=\"'删除后不可恢复，请谨慎操作！'\"\r\n                                    :confirm-handler=\"() => handleRemove(row.scriptVersionId)\">\r\n                                    <auth-button\r\n                                        :permission=\"row.canManage\"\r\n                                        :resource-id=\"row.id\"\r\n                                        auth=\"script/delete\"\r\n                                        text>\r\n                                        {{ '删除' }}\r\n                                    </auth-button>\r\n                                </jb-popover-confirm>\r\n                            </div>\r\n                        </bk-table-column>\r\n                        <bk-table-column type=\"setting\">\r\n                            <bk-table-setting-content\r\n                                :fields=\"tableColumn\"\r\n                                :selected=\"selectedTableColumn\"\r\n                                :size=\"tableSize\"\r\n                                @setting-change=\"handleSettingChange\" />\r\n                        </bk-table-column>\r\n                    </bk-table>\r\n                    <template slot=\"flod\">\r\n                        <component\r\n                            :is=\"curCom\"\r\n                            :script-version-list=\"data\"\r\n                            :script-info=\"selectVersion\"\r\n                            @on-edit-change=\"handleScriptChangeSubmit\"\r\n                            @on-go-copy-create=\"handleToggleCopyCreate\"\r\n                            @on-go-edit=\"handleToggleEdit\"\r\n                            @on-delete=\"handleDeleteSubmit\"\r\n                            @on-create-change=\"handleCreateValueChange\"\r\n                            @on-create=\"handleCreateSubmit\"\r\n                            @on-create-cancel=\"handleCreateCancel\"\r\n                            @on-edit=\"handleEditSubmit\"\r\n                            @on-edit-cancel=\"handleEditCancel\" />\r\n                    </template>\r\n                </layout>\r\n            </div>\r\n        </div>\r\n        <div style=\"display: none;\">\r\n            <div id=\"newVersionDisableActions\" style=\"padding: 16px 12px;\">\r\n                <div style=\"margin-bottom: 17px; font-size: 14px; line-height: 22px; color: #313238;\">\r\n                    {{ '已有[未上线]版本' }}\r\n                </div>\r\n                <div>\r\n                    <bk-button\r\n                        theme=\"primary\"\r\n                        size=\"small\"\r\n                        style=\"margin-right: 8px;\"\r\n                        @click=\"handleEditDraftVersion\">\r\n                        {{ '前往编辑' }}\r\n                    </bk-button>\r\n                    <bk-button\r\n                        size=\"small\"\r\n                        @click=\"handleNewVersionClose\">\r\n                        {{ '取消' }}\r\n                    </bk-button>\r\n                </div>\r\n            </div>\r\n        </div>\r\n        <element-teleport v-if=\"currentVersionName\">\r\n            <span> - {{ currentVersionName }}</span>\r\n        </element-teleport>\r\n        <Diff\r\n            v-if=\"showDiff\"\r\n            :title=\"'版本对比'\"\r\n            :data=\"dataMemo\"\r\n            :old-version-id=\"diffInfo.oldVersionId\"\r\n            :new-version-id=\"diffInfo.newVersionId\"\r\n            @on-change=\"handleDiffVersionChange\"\r\n            @close=\"handleDiffClose\" />\r\n        <jb-sideslider\r\n            :is-show.sync=\"showRelated\"\r\n            :show-footer=\"false\"\r\n            quick-close\r\n            :title=\"'被引用'\"\r\n            :width=\"695\">\r\n            <script-related-info\r\n                :info=\"relatedScriptInfo\"\r\n                mode=\"scriptVersionList\" />\r\n        </jb-sideslider>\r\n        <jb-dialog\r\n            v-model=\"isShowNewVersion\"\r\n            header-position=\"left\"\r\n            :title=\"'新建版本'\"\r\n            :ok-text=\"'确定'\"\r\n            :mask-close=\"false\"\r\n            :width=\"480\">\r\n            <new-version\r\n                :version-list=\"data\"\r\n                @on-close=\"handleNewVersionClose\"\r\n                @on-create=\"handleToggleCopyCreate\" />\r\n        </jb-dialog>\r\n    </div>\r\n</template>\r\n<script>\r\n    import _ from 'lodash';\r\n    import Tippy from 'bk-magic-vue/lib/utils/tippy';\r\n       import ScriptService from '@service/script-manage';\r\n    import PublicScriptService from '@service/public-script-manage';\r\n    import NotifyService from '@service/notify';\r\n    import ScriptModel from '@model/script/script';\r\n    import JbSearchSelect from '@components/jb-search-select';\r\n    import ListActionLayout from '@components/list-action-layout';\r\n    import JbPopoverConfirm from '@components/jb-popover-confirm';\r\n    import {\r\n        checkPublicScript,\r\n        leaveConfirm,\r\n        getOffset,\r\n        genDefaultScriptVersion,\r\n        encodeRegexp,\r\n    } from '@utils/assist';\r\n    import { listColumnsCache } from '@utils/cache-helper';\r\n    import ScriptRelatedInfo from '../common/script-related-info';\r\n    import DetailScript from '../common/detail/index';\r\n    import Edit from '../common/edit';\r\n    import CopyCreate from '../common/copy-create';\r\n    import Layout from './components/layout';\r\n    import ScriptBasic from './components/script-basic';\r\n    import Diff from './components/diff';\r\n    import NewVersion from './components/new-version';\r\n\r\n    const TABLE_COLUMN_CACHE = 'script_version_list_columns';\r\n\r\n    export default {\r\n        name: 'ScriptVersion',\r\n        components: {\r\n            ListActionLayout,\r\n            JbPopoverConfirm,\r\n            JbSearchSelect,\r\n            ScriptRelatedInfo,\r\n            Diff,\r\n            Layout,\r\n            DetailScript,\r\n            Edit,\r\n            CopyCreate,\r\n            ScriptBasic,\r\n            NewVersion,\r\n        },\r\n        data () {\r\n            return {\r\n                isLoading: false,\r\n                isListFlod: false,\r\n                isShowNewVersion: false,\r\n                showDiff: false,\r\n                data: [{},{},{}],\r\n                dataAppendList: [{},{},{}],\r\n                scriptDetailInfo: {},\r\n                tableHeight: '',\r\n                selectedTableColumn: [],\r\n                selectVersionId: '',\r\n                choosedMap: {},\r\n                showRelated: false,\r\n                relatedScriptInfo: [],\r\n                displayCom: '',\r\n                tableSize: 'small',\r\n            };\r\n        },\r\n        computed: {\r\n            /**\r\n             * @desc 骨架屏 Loading\r\n             * @returns { Boolean }\r\n             */\r\n            isSkeletonLoading () {\r\n                return this.isLoading;\r\n            },\r\n            /**\r\n             * @desc 脚本展示状态组件\r\n             * @returns { Object }\r\n             */\r\n            curCom () {\r\n                if (!this.displayCom) {\r\n                    return 'div';\r\n                }\r\n                const comMap = {\r\n                    detail: DetailScript,\r\n                    edit: Edit,\r\n                    copyCreate: CopyCreate,\r\n                };\r\n                return comMap[this.displayCom];\r\n            },\r\n            /**\r\n             * @desc 列表数据\r\n             * @returns { Array }\r\n             */\r\n            renderList () {\r\n                return [\r\n                    ...this.dataAppendList,\r\n                    ...this.data,\r\n                ];\r\n            },\r\n            /**\r\n             * @desc 已存在未上线版本不允许新建版本\r\n             * @returns { Boolean }\r\n             */\r\n            isCopyCreateDisabled () {\r\n                return !!_.find(this.dataMemo, scriptVersion => scriptVersion.isDraft);\r\n            },\r\n            /**\r\n             * @desc 选中的脚本版本\r\n             * @returns { Object }\r\n             */\r\n            selectVersion () {\r\n                const current = _.find(this.renderList, _ => _.scriptVersionId === this.selectVersionId);\r\n                if (!current) {\r\n                    return {};\r\n                }\r\n                return current;\r\n            },\r\n            /**\r\n             * @desc 需要选中两个脚本才能对比\r\n             * @returns { Boolean }\r\n             */\r\n            disableDiff () {\r\n                return Object.keys(this.choosedMap).length < 2;\r\n            },\r\n            /**\r\n             * @desc 将要对比的脚本数据\r\n             * @returns { Object }\r\n             */\r\n            diffInfo () {\r\n                const diffVersion = Object.keys(this.choosedMap);\r\n                return {\r\n                    oldVersionId: parseInt(diffVersion[0], 10) || '',\r\n                    newVersionId: parseInt(diffVersion[1], 10) || '',\r\n                };\r\n            },\r\n            /**\r\n             * @desc 当前脚本版本的 name\r\n             * @returns { String }\r\n             */\r\n            currentVersionName () {\r\n                if (this.dataMemo.length < 1) {\r\n                    return '';\r\n                }\r\n                return this.dataMemo[0].name;\r\n            },\r\n            /**\r\n             * @desc 展示的列表列\r\n             * @returns { Object }\r\n             */\r\n            allColumnMap () {\r\n                if (this.isListFlod) {\r\n                    return {\r\n                        version: true,\r\n                        statusDesc: true,\r\n                    };\r\n                }\r\n                return this.selectedTableColumn.reduce((result, item) => {\r\n                    result[item.id] = true;\r\n                    return result;\r\n                }, {});\r\n            },\r\n        },\r\n        watch: {\r\n            displayCom (displayCom) {\r\n                // 当右侧详情面板切换时，需要重置dataAppendList\r\n                if (displayCom !== 'copyCreate') {\r\n                    this.dataAppendList = [];\r\n                }\r\n            },\r\n        },\r\n        created () {\r\n            // 缓存状态切换中的中间状态\r\n            this.lastSelectScriptVersionId = '';\r\n            // 缓存脚本版本的完整数据列表——用于脚本搜索\r\n            this.dataMemo = [];\r\n\r\n            this.publicScript = checkPublicScript(this.$route);\r\n            this.serviceHandler = this.publicScript ? PublicScriptService : ScriptService;\r\n            this.scriptId = this.$route.params.id;\r\n\r\n            this.fetchData(true);\r\n            \r\n            this.searchSelect = [\r\n                {\r\n                    name: '版本号',\r\n                    id: 'version',\r\n                    default: true,\r\n                },\r\n                {\r\n                    name: '更新人',\r\n                    id: 'lastModifyUser',\r\n                    remoteMethod: NotifyService.fetchUsersOfSearch,\r\n                    inputInclude: true,\r\n                },\r\n            ];\r\n            this.tableColumn = [\r\n                {\r\n                    id: 'scriptVersionId',\r\n                    label: '版本 ID',\r\n                },\r\n                {\r\n                    id: 'version',\r\n                    label: '版本号',\r\n                    disabled: true,\r\n                },\r\n                {\r\n                    id: 'relatedTaskNum',\r\n                    label: '被引用',\r\n                    disabled: true,\r\n                },\r\n                {\r\n                    id: 'lastModifyUser',\r\n                    label: '更新人',\r\n                },\r\n                {\r\n                    id: 'lastModifyTime',\r\n                    label: '更新时间',\r\n                },\r\n                {\r\n                    id: 'statusDesc',\r\n                    label: '状态',\r\n                    disabled: true,\r\n                },\r\n            ];\r\n            const columnsCache = listColumnsCache.getItem(TABLE_COLUMN_CACHE);\r\n            if (columnsCache) {\r\n                this.selectedTableColumn = Object.freeze(columnsCache.columns);\r\n                this.tableSize = columnsCache.size;\r\n            } else {\r\n                this.selectedTableColumn = Object.freeze([\r\n                    { id: 'version' },\r\n                    { id: 'relatedTaskNum' },\r\n                    { id: 'lastModifyUser' },\r\n                    { id: 'lastModifyTime' },\r\n                    { id: 'statusDesc' },\r\n                ]);\r\n            }\r\n        },\r\n        mounted () {\r\n            this.calcTableHeight();\r\n            window.addEventListener('resize', this.calcTableHeight);\r\n            this.$once('hook:beforeDestroy', () => {\r\n                window.removeEventListener('resize', this.calcTableHeight);\r\n            });\r\n        },\r\n        methods: {\r\n            /**\r\n             * @desc 获取脚本版本列表数据\r\n             * @param {Boolean} isFirst 第一次调用\r\n             *\r\n             * 需要解析url参数\r\n             */\r\n            fetchData (isFirst) {\r\n                this.isLoading = true;\r\n                return this.serviceHandler.scriptVersionList({\r\n                    id: this.scriptId,\r\n                }, {\r\n                    permission: 'page',\r\n                }).then((data) => {\r\n                    this.dataMemo = Object.freeze([\r\n                        ...data,\r\n                    ]);\r\n                    this.data = Object.freeze(data);\r\n\r\n                    if (isFirst) {\r\n                        this.parseUrl();\r\n                    }\r\n                })\r\n                    .finally(() => {\r\n                        this.isLoading = false;\r\n                    });\r\n            },\r\n            /**\r\n             * @desc URL链接指定了脚本版本\r\n             *\r\n             * 进入脚本详情模式\r\n             */\r\n            parseUrl () {\r\n                const scriptVersionId = parseInt(this.$route.query.scriptVersionId, 10);\r\n                if (scriptVersionId) {\r\n                    this.handleShowDetail({\r\n                        scriptVersionId,\r\n                    });\r\n                }\r\n            },\r\n            /**\r\n             * @desc 计算表格高度\r\n             */\r\n            calcTableHeight () {\r\n                const { top } = getOffset(this.$refs.list);\r\n                const windowHeight = window.innerHeight;\r\n                this.tableHeight = windowHeight - top - 20;\r\n            },\r\n            \r\n            rowClassName ({ row }) {\r\n                return row.scriptVersionId === this.selectVersionId ? 'active' : '';\r\n            },\r\n            /**\r\n             * @desc 新建脚本版本\r\n             */\r\n            handlNewVersion () {\r\n                if (!this.isCopyCreateDisabled) {\r\n                    this.isShowNewVersion = true;\r\n                    return;\r\n                }\r\n                // 已有未上线脚本给出提示\r\n                if (!this.newVersionPopperInstance) {\r\n                    this.newVersionPopperInstance = Tippy(this.$refs.newVersion.$el, {\r\n                        arrow: true,\r\n                        width: 192,\r\n                        placement: 'bottom-start',\r\n                        trigger: 'manual',\r\n                        theme: 'light',\r\n                        interactive: true,\r\n                        animation: 'slide-toggle',\r\n                        content: document.querySelector('#newVersionDisableActions'),\r\n                        boundary: 'window',\r\n                        distance: 20,\r\n                        zIndex: window.__bk_zIndex_manager.nextZIndex(), // eslint-disable-line no-underscore-dangle\r\n                    });\r\n                    this.$once('hook:beforeDestroy', () => {\r\n                        this.newVersionPopperInstance.hide();\r\n                        this.newVersionPopperInstance.destroy();\r\n                    });\r\n                }\r\n                this.newVersionPopperInstance.show();\r\n            },\r\n            /**\r\n             * @desc 编辑最新的未上线脚本版本\r\n             */\r\n            handleEditDraftVersion () {\r\n                const lastestDraftScriptVersion = _.find(this.dataMemo, scriptVersion => scriptVersion.isDraft);\r\n                this.handleEdit(lastestDraftScriptVersion);\r\n                this.newVersionPopperInstance.hide();\r\n            },\r\n            /**\r\n             * @desc 取消新建版本\r\n             */\r\n            handleNewVersionClose () {\r\n                this.newVersionPopperInstance && this.newVersionPopperInstance.hide();\r\n                this.isShowNewVersion = false;\r\n            },\r\n            /**\r\n             * @desc 列表搜索\r\n             * @param {Object} payload 搜索字段\r\n             */\r\n            handleSearch (payload) {\r\n                let list = this.dataMemo;\r\n                Object.keys(payload).forEach((key) => {\r\n                    const reg = new RegExp(encodeRegexp(payload[key]));\r\n                    list = list.filter(item => reg.test(item[key]));\r\n                });\r\n                this.data = Object.freeze(list);\r\n                this.handleLayoutFlod();\r\n            },\r\n            /**\r\n             * @desc 列表排序\r\n             * @param {Object} payload 排序字段\r\n             */\r\n            handleSortChange (payload) {\r\n                if (payload.prop) {\r\n                    const key = payload.prop;\r\n                    const list = [\r\n                        ...this.data,\r\n                    ];\r\n                    list.sort((preItem, nextItem) => {\r\n                        if (payload.order === 'descending') {\r\n                            return preItem[key] - nextItem[key];\r\n                        }\r\n                        return nextItem[key] - preItem[key];\r\n                    });\r\n                }\r\n            },\r\n            /**\r\n             * @desc 自定义列表配置\r\n             */\r\n            handleSettingChange ({ fields, size }) {\r\n                this.selectedTableColumn = Object.freeze(fields);\r\n                this.tableSize = size;\r\n                listColumnsCache.setItem(TABLE_COLUMN_CACHE, {\r\n                    columns: fields,\r\n                    size,\r\n                });\r\n            },\r\n            /**\r\n             * @desc 布局切换\r\n             */\r\n            handleLayoutFlod () {\r\n                this.displayCom = '';\r\n                this.isListFlod = false;\r\n                if (this.selectVersionId === -1) {\r\n                    // 还原复制并新建的占位数据\r\n                    this.handleCreateCancel();\r\n                }\r\n                this.selectVersionId = '';\r\n            },\r\n            /**\r\n             * @desc 选中一行\r\n             * @param {Object} payload 脚本数据\r\n             * @param {Boolean} checked 选择状态\r\n             */\r\n            handleSelectionChange (payload, checked) {\r\n                if (checked) {\r\n                    this.choosedMap[payload.scriptVersionId] = true;\r\n                } else {\r\n                    delete this.choosedMap[payload.scriptVersionId];\r\n                }\r\n                this.choosedMap = { ...this.choosedMap };\r\n            },\r\n            /**\r\n             * @desc 点击版本名查看详情\r\n             * @param {Object} row 脚本数据\r\n             */\r\n            handleShowDetail (row) {\r\n                leaveConfirm()\r\n                    .then(() => {\r\n                        this.selectVersionId = row.scriptVersionId;\r\n                        this.isListFlod = true;\r\n                        this.displayCom = 'detail';\r\n                    });\r\n            },\r\n            /**\r\n             * @desc 鼠标选中一行\r\n             * @param {Object} row 脚本数据\r\n             */\r\n            handleRowSelect (row) {\r\n                if (this.isListFlod) {\r\n                    this.handleShowDetail(row);\r\n                }\r\n            },\r\n            /**\r\n             * @desc 下线\r\n             * @param {Number} id 脚本id\r\n             * @param {String} versionId\r\n             */\r\n            handleOffline (id, versionId) {\r\n                return this.serviceHandler.scriptVersionOffline({\r\n                    id,\r\n                    versionId,\r\n                }).then(() => {\r\n                    this.messageSuccess('操作成功');\r\n                    this.fetchData();\r\n                });\r\n            },\r\n            /**\r\n             * @desc 上线\r\n             * @param {Number} id 脚本id\r\n             * @param {String} versionId 脚本版本id\r\n             */\r\n            handleOnline (id, versionId) {\r\n                return this.serviceHandler.scriptVersionOnline({\r\n                    id,\r\n                    versionId,\r\n                }).then(() => {\r\n                    this.messageSuccess('操作成功');\r\n                    this.fetchData();\r\n                });\r\n            },\r\n            /**\r\n             * @desc 删除\r\n             * @param {String} versionId 脚本版本id\r\n             */\r\n            handleRemove (versionId) {\r\n                return this.serviceHandler.scriptVersionRemove({\r\n                    versionId,\r\n                }).then(() => {\r\n                    this.messageSuccess('删除成功');\r\n                    this.fetchData();\r\n                });\r\n            },\r\n            /**\r\n             * @desc 执行\r\n             * @param {Object} payload 脚本数据\r\n             */\r\n            handleGoExce (payload) {\r\n                this.$router.push({\r\n                    name: 'fastExecuteScript',\r\n                    params: {\r\n                        taskInstanceId: 0,\r\n                        scriptVersionId: payload.scriptVersionId,\r\n                    },\r\n                    query: {\r\n                        from: 'scriptDetail',\r\n                    },\r\n                });\r\n            },\r\n            /**\r\n             * @desc 同步\r\n             * @param {Object} row 脚本数据\r\n             */\r\n            handleSync (row) {\r\n                const routerName = this.publicScript ? 'scriptPublicSync' : 'scriptSync';\r\n                \r\n                this.$router.push({\r\n                    name: routerName,\r\n                    params: {\r\n                        scriptId: 4 || row.id,\r\n                        scriptVersionid: 4 || row.scriptVersionId,\r\n                    },\r\n                });\r\n            },\r\n            /**\r\n             * @desc 编辑脚本版本\r\n             * @param {Object} scriptInfo 脚本数据\r\n             */\r\n            handleEdit (scriptInfo) {\r\n                this.selectVersionId = scriptInfo.scriptVersionId;\r\n                this.displayCom = 'edit';\r\n                this.isListFlod = true;\r\n                this.isShowNewVersion = false;\r\n            },\r\n            /**\r\n             * @desc 显示脚本引用列表\r\n             * @param {String} mode 引用的模板、执行方案\r\n             * @param {Object} payload 脚本数据\r\n             */\r\n            handleShowRelated (payload) {\r\n                this.showRelated = true;\r\n                this.relatedScriptInfo = payload;\r\n            },\r\n            /**\r\n             * @desc 显示脚本差异弹层\r\n             * @param {Object} payload\r\n             */\r\n            handlShowDiff () {\r\n                this.showDiff = true;\r\n            },\r\n            /**\r\n             * @desc 脚本对比版本切换\r\n             * @param {Object} payload\r\n             */\r\n            handleDiffVersionChange (payload) {\r\n                this.choosedMap = payload;\r\n            },\r\n            /**\r\n             * @desc 关闭脚本对比弹层\r\n             */\r\n            handleDiffClose () {\r\n                this.showDiff = false;\r\n            },\r\n            /**\r\n             * @desc 编辑成功刷新列表\r\n             */\r\n            handleScriptChangeSubmit () {\r\n                this.fetchData();\r\n            },\r\n            /**\r\n             * @desc 删除成功\r\n             *\r\n             * 更新布局、刷新列表\r\n             */\r\n            handleDeleteSubmit () {\r\n                this.handleLayoutFlod();\r\n                this.fetchData();\r\n            },\r\n            /**\r\n             * @desc 切换到复制并新建状态\r\n             */\r\n            handleToggleCopyCreate ({ scriptVersionId }) {\r\n                this.selectVersionId = scriptVersionId;\r\n                const currentScriptVersion = _.find(this.dataMemo, _ => _.scriptVersionId === scriptVersionId);\r\n                const newScriptVersion = new ScriptModel({\r\n                    ...currentScriptVersion,\r\n                    scriptVersionId: -1,\r\n                    status: -1,\r\n                    version: genDefaultScriptVersion(),\r\n                });\r\n                this.isListFlod = true;\r\n                this.lastSelectScriptVersionId = this.selectVersionId;\r\n                this.selectVersionId = -1;\r\n                this.displayCom = 'copyCreate';\r\n                this.dataAppendList = Object.freeze([\r\n                    newScriptVersion,\r\n                ]);\r\n            },\r\n            /**\r\n             * @desc 编辑脚本\r\n             */\r\n            handleToggleEdit () {\r\n                this.displayCom = 'edit';\r\n            },\r\n            /**\r\n             * @desc 取消新建脚本版本\r\n             */\r\n            handleCreateCancel () {\r\n                this.displayCom = 'detail';\r\n                this.selectVersionId = this.lastSelectScriptVersionId;\r\n            },\r\n            /**\r\n             * @desc 新建成功\r\n             *\r\n             * 并选中新版本\r\n             */\r\n            handleCreateSubmit ({ scriptVersionId }) {\r\n                this.fetchData()\r\n                    .then(() => {\r\n                        setTimeout(() => {\r\n                            this.displayCom = 'detail';\r\n                            this.selectVersionId = scriptVersionId;\r\n                        });\r\n                    });\r\n            },\r\n            /**\r\n             * @desc 新建脚本过程中字段值改变\r\n             * @param {Number} scriptVersionId 脚本版本id\r\n             * @param {Object} payload 脚本数据\r\n             */\r\n            handleCreateValueChange (scriptVersionId, payload) {\r\n                const data = [\r\n                    ...this.dataAppendList,\r\n                ];\r\n                const currentScriptVersion = _.find(data, _ => _.scriptVersionId === scriptVersionId);\r\n                if (currentScriptVersion) {\r\n                    Object.assign(currentScriptVersion, payload);\r\n                    this.dataAppendList = Object.freeze(data);\r\n                }\r\n            },\r\n            /**\r\n             * @desc 编辑成功\r\n             *\r\n             * 显示脚本详情\r\n             * 刷新列表数据\r\n             */\r\n            handleEditSubmit () {\r\n                this.displayCom = 'detail';\r\n                this.fetchData();\r\n            },\r\n            /**\r\n             * @desc 编辑取消\r\n             */\r\n            handleEditCancel () {\r\n                this.displayCom = 'detail';\r\n            },\r\n            \r\n            /**\r\n             * @desc 判断是否可以选中\r\n             * @param {Object} row 脚本数据\r\n             */\r\n            isRowSelectable (row) {\r\n                if (this.disableDiff) {\r\n                    return true;\r\n                }\r\n                return this.choosedMap[row.scriptVersionId];\r\n            },\r\n            /**\r\n             * @desc 判断是否选中\r\n             * @param {Object} row 脚本数据\r\n             */\r\n            isRowChecked (row) {\r\n                return this.choosedMap[row.scriptVersionId];\r\n            },\r\n            /**\r\n             * @desc 自定义表头\r\n             */\r\n            renderHeader (h, data) {\r\n                return (\r\n                    <span>\r\n                        <span>{ data.column.label }</span>\r\n                        <bk-popover>\r\n                            <icon\r\n                                type=\"circle-italics-info\"\r\n                                style=\"margin-left: 8px; font-size: 12px;\" />\r\n                            <div slot=\"content\">\r\n                                <div>{ '显示被作业引用的次数' }</div>\r\n                                <div>{ '显示被执行方案引用的次数' }</div>\r\n                            </div>\r\n                        </bk-popover>\r\n                    </span>\r\n                );\r\n            },\r\n            /**\r\n             * @desc 路由回退\r\n             */\r\n            routerBack () {\r\n                if (this.publicScript) {\r\n                    this.$router.push({\r\n                        name: 'publicScriptList',\r\n                    });\r\n                    return;\r\n                }\r\n                this.$router.push({\r\n                    name: 'scriptList',\r\n                });\r\n            },\r\n        },\r\n    };\r\n</script>\r\n<style lang='postcss'>\r\n    .script-manage-version-page {\r\n        .version-list-wraper {\r\n            margin-top: 20px;\r\n        }\r\n\r\n        .script-version-list {\r\n            .bk-table-row {\r\n                &.active {\r\n                    background: #eff5ff;\r\n                }\r\n\r\n                &.active,\r\n                &.hover-row {\r\n                    span[data-script-status] {\r\n                        background: #e6e7eb !important;\r\n                    }\r\n\r\n                    span[data-script-status=\"1\"] {\r\n                        background: #daebde !important;\r\n                    }\r\n\r\n                    span[data-script-status=\"-1\"] {\r\n                        background: #ffe8c3 !important;\r\n                    }\r\n                }\r\n            }\r\n\r\n            .select-flag {\r\n                float: right;\r\n                margin-top: 3px;\r\n                color: #a3c5fd;\r\n            }\r\n        }\r\n    }\r\n</style>\r\n"],"names":[],"sourceRoot":""}