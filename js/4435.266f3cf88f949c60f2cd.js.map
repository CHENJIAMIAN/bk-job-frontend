{"version":3,"file":"js/4435.266f3cf88f949c60f2cd.js","mappings":"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","sources":["webpack://job/src/views/fast-execution/exec-script/index.vue","webpack://job/./src/views/fast-execution/exec-script/index.vue?86d2","webpack://job/./src/views/fast-execution/exec-script/index.vue?af22","webpack://job/./src/views/fast-execution/exec-script/index.vue?d92a","webpack://job/./src/views/fast-execution/exec-script/index.vue?c8b7"],"sourcesContent":["<template>\r\n    <div class=\"exec-script-page\" v-bkloading=\"{ isLoading }\">\r\n        <smart-action offset-target=\"bk-form-content\">\r\n            <jb-form\r\n                class=\"fast-execution-script-form\"\r\n                ref=\"execScriptForm\"\r\n                v-test=\"{ type: 'form', value: 'executeScript' }\"\r\n                :model=\"formData\">\r\n                <item-factory\r\n                    name=\"scriptName\"\r\n                    field=\"name\"\r\n                    :label=\"'脚本名称'\"\r\n                    :placeholder=\"'取一个便于记忆的任务名，方便后续在历史记录中快速定位...'\"\r\n                    :form-data=\"formData\"\r\n                    @on-change=\"handleChange\" />\r\n                <item-factory\r\n                    name=\"scriptSourceOfExecution\"\r\n                    script-source-field=\"scriptSource\"\r\n                    content-field=\"content\"\r\n                    language-field=\"scriptLanguage\"\r\n                    script-id-field=\"scriptId\"\r\n                    script-version-id-field=\"scriptVersionId\"\r\n                    :form-data=\"formData\"\r\n                    @on-reset=\"handleReset\" />\r\n                <item-factory\r\n                    :key=\"reset\"\r\n                    name=\"scriptContent\"\r\n                    script-source-field=\"scriptSource\"\r\n                    content-field=\"content\"\r\n                    language-field=\"scriptLanguage\"\r\n                    :form-data=\"formData\"\r\n                    @on-change=\"handleChange\" />\r\n                <item-factory\r\n                    name=\"scriptParam\"\r\n                    param-field=\"scriptParam\"\r\n                    secure-field=\"secureParam\"\r\n                    :form-data=\"formData\"\r\n                    @on-change=\"handleChange\" />\r\n                <item-factory\r\n                    name=\"scriptTimeout\"\r\n                    field=\"timeout\"\r\n                    :form-data=\"formData\"\r\n                    @on-change=\"handleChange\" />\r\n                <item-factory\r\n                    name=\"scriptAccount\"\r\n                    field=\"account\"\r\n                    script-language-field=\"scriptLanguage\"\r\n                    :form-data=\"formData\"\r\n                    @on-change=\"handleChange\" />\r\n                <item-factory\r\n                    name=\"executeTargetOfExecution\"\r\n                    field=\"targetServers\"\r\n                    :form-data=\"formData\"\r\n                    @on-change=\"handleChange\" />\r\n            </jb-form>\r\n            <template #action>\r\n                <div style=\"display: flex;\">\r\n                    <bk-button\r\n                        class=\"w120 mr10\"\r\n                        :loading=\"isSubmiting\"\r\n                        theme=\"primary\"\r\n                        @click=\"handleSubmit\"\r\n                        v-test=\"{ type: 'button', value: 'fastExecuteScriptSubmit' }\">\r\n                        {{ '执行' }}\r\n                    </bk-button>\r\n                    <bk-button\r\n                        @click=\"handleCancel\"\r\n                        v-test=\"{ type: 'button', value: 'fastExecuteScriptCancel' }\">\r\n                        {{ '重置' }}\r\n                    </bk-button>\r\n                </div>\r\n            </template>\r\n        </smart-action>\r\n        <div v-if=\"historyList.length > 0\" class=\"execution-history\" :class=\"{ active: isShowHistory }\">\r\n            <div class=\"toggle-btn\" @click=\"handleShowHistory\">\r\n                <Icon class=\"toggle-flag\" type=\"angle-double-left\" />\r\n                <div class=\"recent-result\">{{ '最近结果' }}</div>\r\n            </div>\r\n            <div class=\"history-content\">\r\n                <div\r\n                    v-for=\"item in historyList\"\r\n                    class=\"item\"\r\n                    :key=\"item.id\"\r\n                    @click=\"handleGoHistoryDetail(item)\">\r\n                    {{ item.name }}\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</template>\r\n<script>\r\n    import _ from 'lodash';\r\n       import TaskExecuteService from '@service/task-execute';\r\n    import TaskStepModel from '@model/task/task-step';\r\n    import TaskHostNodeModel from '@model/task-host-node';\r\n    import ItemFactory from '@components/task-step/script/item-factory';\r\n    import {\r\n        genDefaultName,\r\n        scriptErrorAlert,\r\n    } from '@utils/assist';\r\n    import {\r\n        execScriptHistory,\r\n        debugScriptCache,\r\n    } from '@utils/cache-helper';\r\n\r\n    const getDefaultData = () => ({\r\n        isScriptContentLoading: false,\r\n        // 快速执行name\r\n        name: genDefaultName('快速执行脚本'),\r\n        // 脚本来源\r\n        scriptSource: TaskStepModel.scriptStep.TYPE_SOURCE_LOCAL,\r\n        // 脚本类型，默认shell\r\n        scriptLanguage: 1,\r\n        // 引用脚本的id\r\n        scriptId: '',\r\n        // 引用脚本的版本id\r\n        scriptVersionId: '',\r\n        // 脚本内容\r\n        content: '',\r\n        // 脚本参数\r\n        scriptParam: '',\r\n        // 敏感参数 0-关闭 1-开启\r\n        secureParam: 0,\r\n        // 超时\r\n        timeout: 7200,\r\n        // 账号\r\n        account: '',\r\n        // 目标服务器\r\n        targetServers: new TaskHostNodeModel({}),\r\n    });\r\n\r\n    export default {\r\n        name: '',\r\n        components: {\r\n            ItemFactory,\r\n        },\r\n        data () {\r\n            return {\r\n                reset: 0,\r\n                isLoading: false,\r\n                formData: getDefaultData(),\r\n                historyList: [{},{},{}],\r\n                isSubmiting: false,\r\n                isShowHistory: false,\r\n            };\r\n        },\r\n        created () {\r\n            this.parseUrlParams();\r\n        },\r\n        mounted () {\r\n            window.IPInputScope = 'SCRIPT_EXECUTE';\r\n            this.$once('hook:beforeDestroy', () => {\r\n                window.IPInputScope = '';\r\n            });\r\n        },\r\n        /**\r\n         * @desc 销毁时清空脚本调试的数据\r\n         */\r\n        beforeDestroy () {\r\n            debugScriptCache.clearItem();\r\n        },\r\n        methods: {\r\n            /**\r\n             * @desc 重做时获取任务详细信息\r\n             */\r\n            fetchData () {\r\n                this.$request(TaskExecuteService.fetchTaskInstance({\r\n                    id: this.taskInstanceId,\r\n                }), () => {\r\n                    this.isLoading = true;\r\n                }).then((data) => {\r\n                    const {\r\n                        account,\r\n                        content,\r\n                        ignoreError,\r\n                        scriptId,\r\n                        scriptLanguage,\r\n                        scriptParam,\r\n                        scriptSource,\r\n                        scriptVersionId,\r\n                        secureParam,\r\n                        timeout,\r\n                        executeTarget,\r\n                    } = data.stepInfo.scriptStepInfo;\r\n\r\n                    this.formData = {\r\n                        ...this.formData,\r\n                        name: data.stepInfo.name,\r\n                        account,\r\n                        content,\r\n                        ignoreError,\r\n                        scriptId,\r\n                        scriptLanguage,\r\n                        scriptParam,\r\n                        scriptSource,\r\n                        scriptVersionId,\r\n                        secureParam,\r\n                        timeout,\r\n                        targetServers: executeTarget,\r\n                    };\r\n                })\r\n                    .finally(() => {\r\n                        this.isLoading = false;\r\n                    });\r\n            },\r\n            /**\r\n             * @desc 解析url参数\r\n             *\r\n             * 有多种类型的url风格\r\n             * 1，脚本管理，调试脚本内容\r\n             * 2，从步骤执行详情页面回退，回填执行的任务数据\r\n             * 3，执行列表重做任务\r\n             * 4，脚本管理，执行指定版本脚本\r\n             */\r\n            parseUrlParams () {\r\n                const { model } = this.$route.query;\r\n                // 调试脚本模式\r\n                if (model === 'debugScript') {\r\n                    const debugScriptContent = debugScriptCache.getItem();\r\n                    if (debugScriptContent) {\r\n                        this.formData.content = debugScriptContent;\r\n                    }\r\n                    return;\r\n                }\r\n                this.taskInstanceId = parseInt(this.$route.params.taskInstanceId, 10);\r\n                this.scriptVersionId = parseInt(this.$route.params.scriptVersionId, 10);\r\n                const { from } = this.$route.query;\r\n                \r\n                this.timeTravel();\r\n\r\n                // 步骤执行详情历史编辑——从历史缓存数据中查找对应数据的formData\r\n                if (from === 'historyStep') {\r\n                    let historyRecord = null;\r\n                    if (this.taskInstanceId) {\r\n                        // 有指定taskInstanceId\r\n                        historyRecord = _.find(this.historyList, _ => _.taskInstanceId === this.taskInstanceId);\r\n                    } else {\r\n                        // 没有指定taskInstanceId，默认取第一个\r\n                        historyRecord = _.head(this.historyList);\r\n                    }\r\n                    // 历史缓存中有数据使用缓存数据\r\n                    if (historyRecord) {\r\n                        this.formData = historyRecord.formData;\r\n                        return;\r\n                    }\r\n                }\r\n                // 执行历史——通过taskInstanceId重做\r\n                if (this.taskInstanceId > 0) {\r\n                    this.fetchData();\r\n                    return;\r\n                }\r\n                \r\n                // 执行指定版本的脚本\r\n                if (this.scriptVersionId > 0) {\r\n                    this.formData.scriptVersionId = this.scriptVersionId;\r\n                    this.formData.scriptSource = TaskStepModel.scriptStep.TYPE_SOURCE_PUBLIC;\r\n                }\r\n            },\r\n            /**\r\n             * @desc 读取执行历史\r\n             */\r\n            timeTravel () {\r\n                this.historyList = Object.freeze(execScriptHistory.getItem());\r\n            },\r\n            /**\r\n             * @desc 缓存执行历史\r\n             */\r\n            pushLocalStorage (history) {\r\n                const historyList = execScriptHistory.getItem();\r\n                historyList.unshift(history);\r\n                execScriptHistory.setItem(historyList);\r\n            },\r\n            /**\r\n             * @desc 展开执行历史面板\r\n             */\r\n            handleShowHistory () {\r\n                this.isShowHistory = !this.isShowHistory;\r\n            },\r\n            /**\r\n             * @desc 定位到历史执行任务详情\r\n             * @param {Object} task 历史执行任务数据\r\n             */\r\n            handleGoHistoryDetail (task) {\r\n                this.$router.push({\r\n                    name: 'historyStep',\r\n                    params: {\r\n                        taskInstanceId: task.taskInstanceId,\r\n                    },\r\n                    query: {\r\n                        stepInstanceId: task.stepInstanceId,\r\n                        from: 'fastExecuteScript',\r\n                    },\r\n                });\r\n            },\r\n            /**\r\n             * @desc 表单字段更新\r\n             * @param {String} field 字段名\r\n             * @param {Any} value 字段值\r\n             */\r\n            handleChange (field, value) {\r\n                this.formData[field] = value;\r\n            },\r\n            /**\r\n             * @desc 批量更新字段\r\n             * @param {Object} payload 将要更新的字段值\r\n             */\r\n            handleReset (payload) {\r\n                this.formData = {\r\n                    ...this.formData,\r\n                    ...payload,\r\n                };\r\n            },\r\n            /**\r\n             * @desc 执行任务\r\n             */\r\n            handleSubmit () {\r\n                this.isSubmiting = true;\r\n                this.$refs.execScriptForm.validate()\r\n                    .then(() => {\r\n                        if (this.$store.state.scriptCheckError) {\r\n                            scriptErrorAlert();\r\n                            return;\r\n                        }\r\n                        const {\r\n                            name,\r\n                            scriptSource,\r\n                            scriptId,\r\n                            scriptVersionId,\r\n                            scriptLanguage,\r\n                            content,\r\n                            scriptParam,\r\n                            secureParam,\r\n                            timeout,\r\n                            account,\r\n                            targetServers,\r\n                        } = this.formData;\r\n\r\n                        const params = {\r\n                            name,\r\n                            scriptSource,\r\n                            scriptId,\r\n                            scriptVersionId,\r\n                            scriptLanguage,\r\n                            content,\r\n                            scriptParam,\r\n                            secureParam,\r\n                            timeout,\r\n                            account,\r\n                            targetServers,\r\n                        };\r\n                        // 重做时需要带上taskInstanceId，主要处理敏感参数\r\n                        // 标记是重做任务\r\n                        if (this.taskInstanceId) {\r\n                            params.taskInstanceId = this.taskInstanceId;\r\n                            params.isRedoTask = true;\r\n                        }\r\n                        \r\n                        return TaskExecuteService.executeScript(params)\r\n                            .then((data) => {\r\n                                window.changeAlert = false;\r\n                                this.$router.push({\r\n                                    name: 'historyStep',\r\n                                    params: {\r\n                                        taskInstanceId: data.taskInstanceId,\r\n                                    },\r\n                                    query: {\r\n                                        stepInstanceId: data.stepInstanceId,\r\n                                        from: 'fastExecuteScript',\r\n                                    },\r\n                                });\r\n                                this.pushLocalStorage({\r\n                                    id: Date.now(),\r\n                                    name,\r\n                                    taskInstanceId: data.taskInstanceId,\r\n                                    stepInstanceId: data.stepInstanceId,\r\n                                    formData: this.formData,\r\n                                });\r\n                            });\r\n                    })\r\n                    .catch(() => {\r\n                        this.isSubmiting = false;\r\n                    });\r\n            },\r\n            /**\r\n             * @desc 取消、重置操作数据\r\n             */\r\n            handleCancel () {\r\n                this.$refs.execScriptForm.clearError();\r\n                this.formData = getDefaultData();\r\n                this.reset += 1;\r\n            },\r\n        },\r\n    };\r\n</script>\r\n<style lang='postcss'>\r\n    @import \"@/css/mixins/media\";\r\n\r\n    html[lang=\"en-US\"] {\r\n        .recent-result {\r\n            margin-top: 6px;\r\n            transform: rotate(90deg);\r\n        }\r\n    }\r\n\r\n    .exec-script-page {\r\n        .fast-execution-script-form {\r\n            margin-bottom: 10px;\r\n\r\n            .bk-select {\r\n                background: #fff;\r\n            }\r\n\r\n            .form-item-content {\r\n                width: 500px;\r\n\r\n                @media (--small-viewports) {\r\n                    width: 500px;\r\n                }\r\n\r\n                @media (--medium-viewports) {\r\n                    width: 560px;\r\n                }\r\n\r\n                @media (--large-viewports) {\r\n                    width: 620px;\r\n                }\r\n\r\n                @media (--huge-viewports) {\r\n                    width: 680px;\r\n                }\r\n            }\r\n        }\r\n\r\n        .execution-history {\r\n            position: fixed;\r\n            top: 127px;\r\n            right: 0;\r\n            z-index: 99;\r\n            font-size: 12px;\r\n            line-height: 30px;\r\n            color: #c4c6cc;\r\n            background: #63656e;\r\n            border-bottom-left-radius: 2px;\r\n            transform: translateX(100%);\r\n            transition: all 0.35s;\r\n            user-select: none;\r\n\r\n            &.active {\r\n                transform: translateX(0);\r\n\r\n                .toggle-flag {\r\n                    transform: rotateZ(180deg);\r\n                }\r\n            }\r\n\r\n            .toggle-btn {\r\n                position: absolute;\r\n                top: 0;\r\n                left: -22px;\r\n                display: flex;\r\n                width: 22px;\r\n                height: 88px;\r\n                line-height: 13px;\r\n                color: #dcdee5;\r\n                text-align: center;\r\n                cursor: pointer;\r\n                background: #63656e;\r\n                border-right: 1px solid #757783;\r\n                border-bottom-left-radius: 8px;\r\n                border-top-left-radius: 8px;\r\n                flex-direction: column;\r\n                justify-content: center;\r\n\r\n                .toggle-flag {\r\n                    margin-bottom: 5px;\r\n                    color: #979ba5;\r\n                    transition: all 0.2s;\r\n                }\r\n            }\r\n\r\n            .history-content {\r\n                display: flex;\r\n                min-height: 90px;\r\n                padding: 12px 0;\r\n                flex-direction: column;\r\n                justify-content: center;\r\n            }\r\n\r\n            .item {\r\n                padding-right: 16px;\r\n                padding-left: 16px;\r\n                cursor: pointer;\r\n                transition: all 0.15s;\r\n\r\n                &:hover {\r\n                    color: #fff;\r\n                    background: #4f515a;\r\n                }\r\n            }\r\n        }\r\n    }\r\n</style>\r\n","var render = function () {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n  return _c(\n    \"div\",\n    {\n      directives: [\n        {\n          name: \"bkloading\",\n          rawName: \"v-bkloading\",\n          value: { isLoading: _vm.isLoading },\n          expression: \"{ isLoading }\",\n        },\n      ],\n      staticClass: \"exec-script-page\",\n    },\n    [\n      _c(\n        \"smart-action\",\n        {\n          attrs: { \"offset-target\": \"bk-form-content\" },\n          scopedSlots: _vm._u([\n            {\n              key: \"action\",\n              fn: function () {\n                return [\n                  _c(\n                    \"div\",\n                    { staticStyle: { display: \"flex\" } },\n                    [\n                      _c(\n                        \"bk-button\",\n                        {\n                          directives: [\n                            {\n                              name: \"test\",\n                              rawName: \"v-test\",\n                              value: {\n                                type: \"button\",\n                                value: \"fastExecuteScriptSubmit\",\n                              },\n                              expression:\n                                \"{ type: 'button', value: 'fastExecuteScriptSubmit' }\",\n                            },\n                          ],\n                          staticClass: \"w120 mr10\",\n                          attrs: { loading: _vm.isSubmiting, theme: \"primary\" },\n                          on: { click: _vm.handleSubmit },\n                        },\n                        [\n                          _vm._v(\n                            \"\\n                    \" +\n                              _vm._s(\"执行\") +\n                              \"\\n                \"\n                          ),\n                        ]\n                      ),\n                      _vm._v(\" \"),\n                      _c(\n                        \"bk-button\",\n                        {\n                          directives: [\n                            {\n                              name: \"test\",\n                              rawName: \"v-test\",\n                              value: {\n                                type: \"button\",\n                                value: \"fastExecuteScriptCancel\",\n                              },\n                              expression:\n                                \"{ type: 'button', value: 'fastExecuteScriptCancel' }\",\n                            },\n                          ],\n                          on: { click: _vm.handleCancel },\n                        },\n                        [\n                          _vm._v(\n                            \"\\n                    \" +\n                              _vm._s(\"重置\") +\n                              \"\\n                \"\n                          ),\n                        ]\n                      ),\n                    ],\n                    1\n                  ),\n                ]\n              },\n              proxy: true,\n            },\n          ]),\n        },\n        [\n          _c(\n            \"jb-form\",\n            {\n              directives: [\n                {\n                  name: \"test\",\n                  rawName: \"v-test\",\n                  value: { type: \"form\", value: \"executeScript\" },\n                  expression: \"{ type: 'form', value: 'executeScript' }\",\n                },\n              ],\n              ref: \"execScriptForm\",\n              staticClass: \"fast-execution-script-form\",\n              attrs: { model: _vm.formData },\n            },\n            [\n              _c(\"item-factory\", {\n                attrs: {\n                  name: \"scriptName\",\n                  field: \"name\",\n                  label: \"脚本名称\",\n                  placeholder:\n                    \"取一个便于记忆的任务名，方便后续在历史记录中快速定位...\",\n                  \"form-data\": _vm.formData,\n                },\n                on: { \"on-change\": _vm.handleChange },\n              }),\n              _vm._v(\" \"),\n              _c(\"item-factory\", {\n                attrs: {\n                  name: \"scriptSourceOfExecution\",\n                  \"script-source-field\": \"scriptSource\",\n                  \"content-field\": \"content\",\n                  \"language-field\": \"scriptLanguage\",\n                  \"script-id-field\": \"scriptId\",\n                  \"script-version-id-field\": \"scriptVersionId\",\n                  \"form-data\": _vm.formData,\n                },\n                on: { \"on-reset\": _vm.handleReset },\n              }),\n              _vm._v(\" \"),\n              _c(\"item-factory\", {\n                key: _vm.reset,\n                attrs: {\n                  name: \"scriptContent\",\n                  \"script-source-field\": \"scriptSource\",\n                  \"content-field\": \"content\",\n                  \"language-field\": \"scriptLanguage\",\n                  \"form-data\": _vm.formData,\n                },\n                on: { \"on-change\": _vm.handleChange },\n              }),\n              _vm._v(\" \"),\n              _c(\"item-factory\", {\n                attrs: {\n                  name: \"scriptParam\",\n                  \"param-field\": \"scriptParam\",\n                  \"secure-field\": \"secureParam\",\n                  \"form-data\": _vm.formData,\n                },\n                on: { \"on-change\": _vm.handleChange },\n              }),\n              _vm._v(\" \"),\n              _c(\"item-factory\", {\n                attrs: {\n                  name: \"scriptTimeout\",\n                  field: \"timeout\",\n                  \"form-data\": _vm.formData,\n                },\n                on: { \"on-change\": _vm.handleChange },\n              }),\n              _vm._v(\" \"),\n              _c(\"item-factory\", {\n                attrs: {\n                  name: \"scriptAccount\",\n                  field: \"account\",\n                  \"script-language-field\": \"scriptLanguage\",\n                  \"form-data\": _vm.formData,\n                },\n                on: { \"on-change\": _vm.handleChange },\n              }),\n              _vm._v(\" \"),\n              _c(\"item-factory\", {\n                attrs: {\n                  name: \"executeTargetOfExecution\",\n                  field: \"targetServers\",\n                  \"form-data\": _vm.formData,\n                },\n                on: { \"on-change\": _vm.handleChange },\n              }),\n            ],\n            1\n          ),\n        ],\n        1\n      ),\n      _vm._v(\" \"),\n      _vm.historyList.length > 0\n        ? _c(\n            \"div\",\n            {\n              staticClass: \"execution-history\",\n              class: { active: _vm.isShowHistory },\n            },\n            [\n              _c(\n                \"div\",\n                {\n                  staticClass: \"toggle-btn\",\n                  on: { click: _vm.handleShowHistory },\n                },\n                [\n                  _c(\"Icon\", {\n                    staticClass: \"toggle-flag\",\n                    attrs: { type: \"angle-double-left\" },\n                  }),\n                  _vm._v(\" \"),\n                  _c(\"div\", { staticClass: \"recent-result\" }, [\n                    _vm._v(_vm._s(\"最近结果\")),\n                  ]),\n                ],\n                1\n              ),\n              _vm._v(\" \"),\n              _c(\n                \"div\",\n                { staticClass: \"history-content\" },\n                _vm._l(_vm.historyList, function (item) {\n                  return _c(\n                    \"div\",\n                    {\n                      key: item.id,\n                      staticClass: \"item\",\n                      on: {\n                        click: function ($event) {\n                          return _vm.handleGoHistoryDetail(item)\n                        },\n                      },\n                    },\n                    [\n                      _vm._v(\n                        \"\\n                \" +\n                          _vm._s(item.name) +\n                          \"\\n            \"\n                      ),\n                    ]\n                  )\n                }),\n                0\n              ),\n            ]\n          )\n        : _vm._e(),\n    ],\n    1\n  )\n}\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns }","import mod from \"-!../../../../node_modules/_babel-loader@8.2.5@babel-loader/lib/index.js??clonedRuleSet-1[0].rules[0].use[0]!../../../../node_modules/_vue-loader@15.9.8@vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../node_modules/_babel-loader@8.2.5@babel-loader/lib/index.js??clonedRuleSet-1[0].rules[0].use[0]!../../../../node_modules/_vue-loader@15.9.8@vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./index.vue?vue&type=template&id=069c8c3c&\"\nimport script from \"./index.vue?vue&type=script&lang=js&\"\nexport * from \"./index.vue?vue&type=script&lang=js&\"\nimport style0 from \"./index.vue?vue&type=style&index=0&lang=postcss&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../node_modules/_vue-loader@15.9.8@vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\n/* hot reload */\nif (module.hot) {\n  var api = require(\"D:\\\\Desktop\\\\bk-job-frontend\\\\node_modules\\\\_vue-hot-reload-api@2.3.4@vue-hot-reload-api\\\\dist\\\\index.js\")\n  api.install(require('vue'))\n  if (api.compatible) {\n    module.hot.accept()\n    if (!api.isRecorded('069c8c3c')) {\n      api.createRecord('069c8c3c', component.options)\n    } else {\n      api.reload('069c8c3c', component.options)\n    }\n    module.hot.accept(\"./index.vue?vue&type=template&id=069c8c3c&\", function () {\n      api.rerender('069c8c3c', {\n        render: render,\n        staticRenderFns: staticRenderFns\n      })\n    })\n  }\n}\ncomponent.options.__file = \"src/views/fast-execution/exec-script/index.vue\"\nexport default component.exports","// style-loader: Adds some css to the DOM by adding a <style> tag\n\n// load the styles\nvar content = require(\"!!../../../../node_modules/_mini-css-extract-plugin@2.6.0@mini-css-extract-plugin/dist/loader.js??clonedRuleSet-3[0].rules[0].use[1]!../../../../node_modules/_css-loader@6.7.1@css-loader/dist/cjs.js??clonedRuleSet-3[0].rules[0].use[2]!../../../../node_modules/_vue-loader@15.9.8@vue-loader/lib/loaders/stylePostLoader.js!../../../../node_modules/_postcss-loader@6.2.1@postcss-loader/dist/cjs.js!../../../../node_modules/_vue-loader@15.9.8@vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=style&index=0&lang=postcss&\");\nif(content.__esModule) content = content.default;\nif(typeof content === 'string') content = [[module.id, content, '']];\nif(content.locals) module.exports = content.locals;\n// add the styles to the DOM\nvar add = require(\"!../../../../node_modules/_vue-style-loader@4.1.3@vue-style-loader/lib/addStylesClient.js\").default\nvar update = add(\"3b8eb3c4\", content, false, {});\n// Hot Module Replacement\nif(module.hot) {\n // When the styles change, update the <style> tags\n if(!content.locals) {\n   module.hot.accept(\"!!../../../../node_modules/_mini-css-extract-plugin@2.6.0@mini-css-extract-plugin/dist/loader.js??clonedRuleSet-3[0].rules[0].use[1]!../../../../node_modules/_css-loader@6.7.1@css-loader/dist/cjs.js??clonedRuleSet-3[0].rules[0].use[2]!../../../../node_modules/_vue-loader@15.9.8@vue-loader/lib/loaders/stylePostLoader.js!../../../../node_modules/_postcss-loader@6.2.1@postcss-loader/dist/cjs.js!../../../../node_modules/_vue-loader@15.9.8@vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=style&index=0&lang=postcss&\", function() {\n     var newContent = require(\"!!../../../../node_modules/_mini-css-extract-plugin@2.6.0@mini-css-extract-plugin/dist/loader.js??clonedRuleSet-3[0].rules[0].use[1]!../../../../node_modules/_css-loader@6.7.1@css-loader/dist/cjs.js??clonedRuleSet-3[0].rules[0].use[2]!../../../../node_modules/_vue-loader@15.9.8@vue-loader/lib/loaders/stylePostLoader.js!../../../../node_modules/_postcss-loader@6.2.1@postcss-loader/dist/cjs.js!../../../../node_modules/_vue-loader@15.9.8@vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=style&index=0&lang=postcss&\");\n     if(newContent.__esModule) newContent = newContent.default;\n     if(typeof newContent === 'string') newContent = [[module.id, newContent, '']];\n     update(newContent);\n   });\n }\n // When the module is disposed, remove the <style> tags\n module.hot.dispose(function() { update(); });\n}"],"names":["isScriptContentLoading","name","scriptSource","scriptLanguage","scriptId","scriptVersionId","content","scriptParam","secureParam","timeout","account","targetServers","components","ItemFactory","data","reset","isLoading","formData","historyList","isSubmiting","isShowHistory","window","debugScriptCache","methods","id","then","ignoreError","executeTarget","finally","historyRecord","pushLocalStorage","execScriptHistory","handleGoHistoryDetail","params","taskInstanceId","query","stepInstanceId","from","handleChange","handleReset","payload","catch","render","_vm","this","_h","$createElement","_c","_self","directives","rawName","value","expression","staticClass","attrs","scopedSlots","_u","key","fn","staticStyle","display","type","loading","theme","on","click","handleSubmit","_v","_s","handleCancel","proxy","ref","model","field","label","placeholder","length","class","active","handleShowHistory","_l","item","$event","_e","_withStripped","component","options","__file","__esModule","default","module","locals","exports","add"],"sourceRoot":""}