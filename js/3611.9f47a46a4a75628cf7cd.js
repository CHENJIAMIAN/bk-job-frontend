(self.webpackChunkjob=self.webpackChunkjob||[]).push([[3611],{48746:function(e,t,a){"use strict";var r=a(22696);Object.defineProperty(t,"X",{value:!0}),t.Z=void 0;var s=r(a(45673)),n=a(41980),l={components:{AceEditor:s.default},props:{data:{type:Object,require:!0}},data:()=>({lang:"",scriptContent:""}),watch:{data:{handler(e){this.scriptContent=e.scriptContent,this.lang=(0,n.formatScriptTypeValue)(e.scriptLanguage)},immediate:!0}}};t.Z=l},59156:function(e,t,a){"use strict";a(35927),a(45974),a(9042),a(43364);var r=a(22696);Object.defineProperty(t,"X",{value:!0}),t.Z=void 0;var s=r(a(33610));a(71959),a(87033),a(70969),a(7170);var n=r(a(15399)),l=a(41980),o=a(46790),c=r(a(46117)),i=r(a(48373)),d=r(a(8240)),u=r(a(27452)),p=r(a(15695)),f=r(a(2645)),h=r(a(80712)),m=r(a(99232));function b(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function v(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?b(Object(a),!0).forEach((function(t){(0,s.default)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):b(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var g="detect_records_list_columns",y={name:"detectRecordsList",components:{RenderList:u.default,JbSideslider:p.default,JbSearchSelect:f.default,ListActionLayout:h.default,RenderScriptContent:m.default},data:()=>({searchParams:{},defaultDateTime:["",""],selectedTableColumn:[],tableSize:"small",scriptData:{},isShowScriptContent:!1}),computed:{isSkeletonLoading(){return this.$refs.list.isLoading},allRenderColumnMap(){return this.selectedTableColumn.reduce((function(e,t){return e[t.id]=!0,e}),{})}},created(){this.parseDefaultDateTime(),this.fetchDetectRecordsList=d.default.recordList,this.searchSelect=[{name:n.default.t("detectRecords.拦截ID"),id:"id",default:!0},{name:n.default.t("detectRecords.表达式.label"),id:"ruleExpression"},{name:n.default.t("detectRecords.业务.label"),id:"appId",remoteMethod:function(){return i.default.fetchWholeAppList().then((function(e){return e.data}))}},{name:n.default.t("detectRecords.执行人.label"),id:"operator",remoteMethod:c.default.fetchUsersOfSearch,inputInclude:!0},{name:n.default.t("detectRecords.执行方式.label"),id:"startupMode",children:[{name:n.default.t("detectRecords.页面执行"),id:1},{name:n.default.t("detectRecords.定时执行"),id:3},{name:n.default.t("detectRecords.API调用"),id:2}]},{name:n.default.t("detectRecords.调用方.label"),id:"client"},{name:n.default.t("detectRecords.动作.label"),id:"action",children:[{name:n.default.t("detectRecords.扫描"),id:1},{name:n.default.t("detectRecords.拦截"),id:2}]}],this.shortcuts=[{text:n.default.t("detectRecords.近1小时"),value(){var e=new Date,t=new Date;return t.setTime(t.getTime()-36e5),[t,e]}},{text:n.default.t("detectRecords.近12小时"),value(){var e=new Date,t=new Date;return t.setTime(t.getTime()-432e5),[t,e]}},{text:n.default.t("detectRecords.近1天"),value(){var e=new Date,t=new Date;return t.setTime(t.getTime()-864e5),[t,e]}},{text:n.default.t("detectRecords.近7天"),value(){var e=new Date,t=new Date;return t.setTime(t.getTime()-6048e5),[t,e]}}],this.tableColumn=[{id:"id",label:"ID",disabled:!0},{id:"ruleExpression",label:n.default.t("detectRecords.表达式.colHead")},{id:"appId",label:n.default.t("detectRecords.业务.colHead")},{id:"operator",label:n.default.t("detectRecords.执行人.colHead")},{id:"statusDesc",label:n.default.t("detectRecords.执行时间")},{id:"startupMode",label:n.default.t("detectRecords.执行方式.colHead")},{id:"client",label:n.default.t("detectRecords.调用方.colHead")},{id:"action",label:n.default.t("detectRecords.动作.colHead")},{id:"scriptLanguage",label:n.default.t("detectRecords.脚本语言.colHead")}];var e=o.listColumnsCache.getItem(g);e?(this.selectedTableColumn=Object.freeze(e.columns),this.tableSize=e.size):this.selectedTableColumn=Object.freeze([{id:"id"},{id:"ruleExpression"},{id:"appId"},{id:"operator"},{id:"statusDesc"},{id:"startupMode"},{id:"client"},{id:"action"},{id:"scriptLanguage"}])},methods:{fetchData(){var e=v({},this.searchParams);this.$refs.list.$emit("onFetch",e)},setToNowText(e){this.$refs.datePicker.shortcut={text:"".concat(e[0]," ").concat(n.default.t("detectRecords.至今"))}},parseDefaultDateTime(){var e=this,t=["",""],a={startTime:"",endTime:""},r=(new Date).getTime();Object.prototype.hasOwnProperty.call(this.$route.query,"startTime")?t[0]=this.$route.query.startTime:t[0]=(0,l.prettyDateTimeFormat)(r-864e5),a.startTime=t[0],Object.prototype.hasOwnProperty.call(this.$route.query,"endTime")?(t[1]=this.$route.query.endTime,a.endTime=this.$route.query.endTime):(t[1]=(0,l.prettyDateTimeFormat)(r),a.endTime=""),this.defaultDateTime=t,this.searchParams=a,a.endTime||setTimeout((function(){e.setToNowText(e.defaultDateTime)}))},renderPatternHeader(e,t){var a=[{title:this.$t("detectRecords.【扫描】"),content:this.$t("detectRecords.命中规则的脚本执行任务仅会做记录，不会拦截")},{title:this.$t("detectRecords.【拦截】"),content:this.$t("detectRecords.命中规则的脚本执行任务会被记录，并中止运行")}];return e("div",{class:"pattern-head"},[e("span",[t.column.label," "]),e("bk-popover",{attrs:{placement:"right-start",width:"290"}},[e("Icon",{attrs:{type:"info"},style:"color: #C4C6CC"}),e("div",{slot:"content"},[e("div",{class:"detect-records-tips-content"},[a.map((function(t){return e("div",{class:"item"},[e("p",[t.title]),e("p",[t.content])])}))])])])])},handleSearch(e){var t=this.searchParams,a=t.startTime,r=t.endTime;this.searchParams=v(v({},e),{},{startTime:a,endTime:r}),this.fetchData()},handleDateChange(e){this.searchParams.startTime=e[0],this.searchParams.endTime=e[1],this.fetchData()},handleSettingChange(e){var t=e.fields,a=e.size;this.selectedTableColumn=Object.freeze(t),this.tableSize=a,o.listColumnsCache.setItem(g,{columns:t,size:a})},handleShowScriptContent(e){this.isShowScriptContent=!0,this.scriptData=Object.freeze(e)}}};t.Z=y},49312:function(e,t,a){"use strict";var r=a(22696);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a(70969);var s=r(a(33610)),n=r(a(15399)),l=a(41980);class o{constructor(e){this.action=e.action,this.appId=e.appId,this.scopeType=e.scopeType,this.scopeId=e.scopeId,this.appName=e.appName,this.checkResultItems=e.checkResultItems,this.client=e.client,this.createTime=e.createTime,this.id=e.id,this.operator=e.operator,this.ruleExpression=e.ruleExpression,this.ruleId=e.ruleId,this.scriptContent=e.scriptContent,this.scriptLanguage=e.scriptLanguage,this.startupMode=e.startupMode}get getSctiptTypeHtml(){return o.scriptTypeMap[this.scriptLanguage]}get getActionHtml(){var e="display: inline-block; padding: 0 5px; line-height: 16px; font-size: 12px;";return 1===this.action?e+="background: #f0f1f5; color: #979ba5":e+="background: #ffebeb; color: #ea3636",'<span style="'.concat(e,'">').concat(o.actionMap[this.action],"<span>")}get getCreatTimes(){return(0,l.prettyDateTimeFormat)(this.createTime)}get getStartupModeHtml(){return o.startupModeMap[this.startupMode]}}t.default=o,(0,s.default)(o,"scriptTypeMap",{1:"Shell",2:"Bat",3:"Perl",4:"Python",5:"Powershell",6:"Sql"}),(0,s.default)(o,"actionMap",{1:"".concat(n.default.t("detectRecords.扫描")),2:"".concat(n.default.t("detectRecords.拦截"))}),(0,s.default)(o,"startupModeMap",{1:"Web",2:"API",3:"Cron"})},8240:function(e,t,a){"use strict";var r=a(22696);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a(7170);var s=r(a(63473)),n=r(a(49312)),l={recordList:(e,t)=>s.default.getDangerousRecordList(e,t).then((function(e){var t=e.data;return t.data?(t.data=t.data.map((function(e){return Object.freeze(new n.default(e))})),t):[]}))};t.default=l},63473:function(e,t,a){"use strict";var r=a(22696);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s=r(a(24875)),n=r(a(79121));class l extends n.default{constructor(){super(),this.module="/job-execute/web/dangerous-record"}getDangerousRecordList(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return s.default.get("".concat(this.module,"/list"),{params:e,payload:t})}}var o=new l;t.default=o},30104:function(){},99232:function(e,t,a){"use strict";a.r(t),a.d(t,{__esModule:function(){return s.X},default:function(){return o}});var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"render-script-content"},[a("ace-editor",{attrs:{value:e.scriptContent,lang:e.lang,options:[e.lang],"custom-enable":!1,readonly:""}})],1)};r._withStripped=!0;var s=a(48746),n=s.Z,l=(0,a(35471).Z)(n,r,[],!1,null,null,null);l.options.__file="src/views/detect-records/list/components/render-script-content.vue";var o=l.exports},93611:function(e,t,a){"use strict";a.r(t),a.d(t,{__esModule:function(){return s.X},default:function(){return o}});var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"detect-records-list-page"},[a("list-action-layout",{scopedSlots:e._u([{key:"right",fn:function(){return[a("bk-date-picker",{ref:"datePicker",attrs:{value:e.defaultDateTime,placeholder:e.$t("detectRecords.选择日期"),shortcuts:e.shortcuts,type:"datetimerange","shortcut-close":!0,"use-shortcut-text":!0,clearable:!1,"up-to-now":""},on:{change:e.handleDateChange}})]},proxy:!0}])},[a("jb-search-select",{ref:"search",staticStyle:{width:"480px"},attrs:{data:e.searchSelect,placeholder:e.$t("detectRecords.搜索拦截ID，表达式，业务，执行人，执行方式，调用方，动作…")},on:{"on-change":e.handleSearch}})],1),e._v(" "),a("render-list",{directives:[{name:"test",rawName:"v-test",value:{type:"list",value:"detectRecord"},expression:"{ type: 'list', value: 'detectRecord' }"}],ref:"list",attrs:{size:e.tableSize,"data-source":e.fetchDetectRecordsList,"search-control":function(){return e.$refs.search}}},[e.allRenderColumnMap.id?a("bk-table-column",{key:"id",attrs:{label:"ID",prop:"id",width:"80",align:"left"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v("\n                "+e._s(a.id)+"\n            ")]}}],null,!1,2377966962)}):e._e(),e._v(" "),e.allRenderColumnMap.ruleExpression?a("bk-table-column",{key:"ruleExpression",attrs:{label:e.$t("detectRecords.表达式.colHead"),prop:"ruleExpression",align:"left","show-overflow-tooltip":""}}):e._e(),e._v(" "),e.allRenderColumnMap.appId?a("bk-table-column",{key:"appName",attrs:{label:e.$t("detectRecords.业务.colHead"),prop:"appName",width:"200",align:"left"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("span",[e._v("["+e._s(r.appId)+"] "+e._s(r.appName))])]}}],null,!1,3811058794)}):e._e(),e._v(" "),e.allRenderColumnMap.operator?a("bk-table-column",{key:"operator",attrs:{label:e.$t("detectRecords.执行人.colHead"),prop:"operator",width:"140",align:"left"}}):e._e(),e._v(" "),e.allRenderColumnMap.statusDesc?a("bk-table-column",{key:"createTime",attrs:{label:e.$t("detectRecords.执行时间"),prop:"createTime",width:"200",align:"left"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v("\n                "+e._s(a.getCreatTimes)+"\n            ")]}}],null,!1,1419859470)}):e._e(),e._v(" "),e.allRenderColumnMap.startupMode?a("bk-table-column",{key:"startupMode",attrs:{label:e.$t("detectRecords.执行方式.colHead"),prop:"startupMode",width:"140",align:"left"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v("\n                "+e._s(a.getStartupModeHtml)+"\n            ")]}}],null,!1,2606843314)}):e._e(),e._v(" "),e.allRenderColumnMap.client?a("bk-table-column",{key:"client",attrs:{label:e.$t("detectRecords.调用方.colHead"),prop:"client",width:"150",align:"left"}}):e._e(),e._v(" "),e.allRenderColumnMap.action?a("bk-table-column",{key:"mode",attrs:{label:e.$t("detectRecords.动作.colHead"),"render-header":e.renderPatternHeader,prop:"mode",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("span",{domProps:{innerHTML:e._s(r.getActionHtml)}})]}}],null,!1,543757652)}):e._e(),e._v(" "),e.allRenderColumnMap.scriptLanguage?a("bk-table-column",{key:"scriptLanguage",attrs:{label:e.$t("detectRecords.脚本语言.colHead"),prop:"scriptLanguage",width:"150",align:"left"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v("\n                "+e._s(a.getSctiptTypeHtml)+"\n            ")]}}],null,!1,346443397)}):e._e(),e._v(" "),a("bk-table-column",{key:"action",attrs:{label:e.$t("detectRecords.操作"),fixed:"right",align:"left",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("bk-button",{directives:[{name:"test",rawName:"v-test",value:{type:"button",value:"viewDetectScript"},expression:"{ type: 'button', value: 'viewDetectScript' }"}],attrs:{text:""},on:{click:function(t){return e.handleShowScriptContent(r)}}},[e._v("\n                    "+e._s(e.$t("detectRecords.查看脚本"))+"\n                ")])]}}])}),e._v(" "),a("bk-table-column",{attrs:{type:"setting"}},[a("bk-table-setting-content",{attrs:{fields:e.tableColumn,selected:e.selectedTableColumn,size:e.tableSize},on:{"setting-change":e.handleSettingChange}})],1)],1),e._v(" "),a("jb-sideslider",{attrs:{"is-show":e.isShowScriptContent,title:e.$t("detectRecords.脚本内容"),"show-footer":!1,width:900},on:{"update:isShow":function(t){e.isShowScriptContent=t},"update:is-show":function(t){e.isShowScriptContent=t}}},[a("render-script-content",{attrs:{data:e.scriptData}})],1)],1)};r._withStripped=!0;var s=a(59156),n=s.Z,l=(a(36946),(0,a(35471).Z)(n,r,[],!1,null,null,null));l.options.__file="src/views/detect-records/list/index.vue";var o=l.exports},36946:function(e,t,a){var r=a(30104);r.__esModule&&(r=r.default),"string"==typeof r&&(r=[[e.id,r,""]]),r.locals&&(e.exports=r.locals);(0,a(13570).Z)("04e465a8",r,!1,{})}}]);