(self.webpackChunkjob=self.webpackChunkjob||[]).push([[149],{21086:function(e,t,i){"use strict";var n=i(70534);Object.defineProperty(t,"X",{value:!0}),t.Z=void 0,i(85376),i(98495),i(41336),i(91981),i(63898);var a=n(i(2348)),s=i(7216),r=n(i(11715)),o=i(11986),l=n(i(15107)),d=n(i(34583)),c={Shell:"sh",Bat:"batchfile",Perl:"perl",Python:"python",Powershell:"powershell",SQL:"sql"},u={name:"",components:{ResizeableBox:d.default},props:{parentWidth:{type:Number,default:window.innerWidth},scriptContent:{type:String,default:""},scriptLanguage:{type:String,required:!0}},data:()=>({isLoading:!1,needRefresh:!1}),computed:{mode(){return"ace/mode/".concat(c[this.scriptLanguage])}},watch:{scriptContent:{handler(){this.hasRendered?this.needRefresh=!0:this.fetchRenderScript()},immediate:!0},scriptLanguage(){var e=this;setTimeout((function(){e.editor.getSession().setMode(e.mode)}))}},created(){this.hasRendered=!1,this.editorId="scriptTemplatePrevice".concat((0,a.default)(1,1e3),"_").concat(Date.now())},mounted(){this.initEditor()},methods:{initEditor(){var e=l.default.edit(this.editorId);e.getSession().setMode(this.mode),e.setOptions({fontSize:13,enableBasicAutocompletion:!0,enableLiveAutocompletion:!0,enableSnippets:!0,wrapBehavioursEnabled:!0,autoScrollEditorIntoView:!0,copyWithEmptySelection:!0,useElasticTabstops:!0,printMarginColumn:!0,printMargin:80,scrollPastEnd:.2}),e.setTheme("ace/theme/monokai"),e.setShowPrintMargin(!1),e.$blockScrolling=1/0,e.setReadOnly(!0),e.scrollToLine(1/0),e.setValue(""),e.clearSelection(),this.editor=e,this.$once("hook:beforeDestroy",(function(){e.destroy(),e.container.remove()}))},fetchRenderScript(){var e=this;this.isLoading=!0,r.default.fetchRenderScript({scriptContent:this.scriptContent,scriptLanguage:(0,o.formatScriptTypeValue)(this.scriptLanguage)}).then((function(t){e.editor.setValue(s.Base64.decode(t.scriptContent)),e.editor.clearSelection()})).finally((function(){e.isLoading=!1,e.hasRendered=!0,e.needRefresh=!1}))},handleRefresh(){this.fetchRenderScript()}}};t.Z=u},61629:function(e,t,i){"use strict";var n=i(70534);Object.defineProperty(t,"X",{value:!0}),t.Z=void 0,i(41336),i(91981),i(63898);var a=n(i(11715)),s=i(11986),r={components:{ResizeableBox:n(i(34583)).default},inheritAttrs:!1,data:()=>({isLoading:!1,variableList:[{},{},{}]}),created(){this.fetchVariableList()},methods:{fetchVariableList(){var e=this;this.isLoading=!0,a.default.fetchVaribaleList().then((function(t){e.variableList=Object.freeze(t)})).finally((function(){e.isLoading=!1}))},handleCopyScriptVariable(e){(0,s.execCopy)(e,"复制成功".concat(" ",e))}}};t.Z=r},99319:function(e,t,i){"use strict";var n=i(70534);Object.defineProperty(t,"X",{value:!0}),t.Z=void 0,i(85376);var a=n(i(2771)),s={props:{parentWidth:{type:Number,default:window.innerWidth},width:{type:Number,default:400}},data(){return{styles:{width:"".concat(this.width,"px")}}},created(){this.moveStartWidth=this.width,this.isResizeable=!1,this.handleMousemove=(0,a.default)(this.eventMousemove,30)},mounted(){var e=this;document.body.addEventListener("mousemove",this.handleMousemove),document.body.addEventListener("mouseup",this.handleMouseup),this.$once("hook:beforeDestroy",(function(){document.body.removeEventListener("mousemove",e.handleMousemove),document.body.removeEventListener("mouseup",e.handleMouseup)}))},methods:{handleMousedown(e){this.isResizeable=!0,this.screenX=e.screenX,this.moveStartWidth=this.$refs.handle.getBoundingClientRect().width,document.body.style.userSelect="none"},handleMouseup(){this.isResizeable=!1,document.body.style.userSelect=""},eventMousemove(e){if(this.isResizeable){var t=Math.max(.8*this.parentWidth,this.parentWidth-200),i=Math.min(.1*this.parentWidth,200),n=e.screenX,a=this.screenX-n+this.moveStartWidth;a>t||a<i||(this.styles={width:"".concat(a,"px")},this.$emit("on-resize"))}}}};t.Z=s},44397:function(e,t,i){"use strict";i(79951),i(28709),i(45680);var n=i(70534);Object.defineProperty(t,"X",{value:!0}),t.Z=void 0,i(33303),i(41336),i(91981),i(63898),i(59241);var a=n(i(65778)),s=n(i(11715)),r=i(11986),o=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var i=c(t);if(i&&i.has(e))return i.get(e);var n={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if("default"!==s&&Object.prototype.hasOwnProperty.call(e,s)){var r=a?Object.getOwnPropertyDescriptor(e,s):null;r&&(r.get||r.set)?Object.defineProperty(n,s,r):n[s]=e[s]}n.default=e,i&&i.set(e,n);return n}(i(78876)),l=n(i(84749)),d=n(i(52457));function c(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,i=new WeakMap;return(c=function(e){return e?i:t})(e)}var u={name:"",components:{AceEditor:o.default,RenderVariable:l.default,PreviewTemplate:d.default},data:()=>({isLoading:!1,isSubmiting:!1,editorHeight:0,editorWidth:0,isShowVariable:!1,scriptLanguage:"Shell",scriptContent:"",sidePanelComponentName:""}),computed:{renderSideComponent(){return{previewTemplate:d.default,renderVariable:l.default}[this.sidePanelComponentName]}},created(){this.templateMap=Object.assign({},o.builtInScript),this.fetchOriginalTemplate()},mounted(){var e=this;this.calcEditorSize(),window.addEventListener("resize",this.calcEditorSize),this.$once("hook:beforeDestroy",(function(){window.removeEventListener("resize",e.calcEditorSize)}))},methods:{fetchOriginalTemplate(){var e=this;this.isLoading=!0,s.default.fetchOriginalTemplate().then((function(t){t.forEach((function(t){e.templateMap[(0,r.formatScriptTypeValue)(t.scriptLanguage)]=t.scriptContent})),(0,a.default)(e.templateMap,e.scriptLanguage)&&e.$refs.editor.setValue(e.templateMap[e.scriptLanguage])})).finally((function(){e.isLoading=!1}))},calcEditorSize(){var e=(0,r.getOffset)(this.$refs.container).top,t=window.innerHeight;this.editorHeight=t-e-72,this.editorWidth=this.$refs.container.getBoundingClientRect().width},beforeLangChange(){return window.changeAlert=this.scriptContent!==this.templateMap[this.scriptLanguage],(0,r.leaveConfirm)()},handleLangChange(e){var t=this;this.scriptLanguage=e,setTimeout((function(){(0,a.default)(t.templateMap,t.scriptLanguage)&&t.$refs.editor.setValue(t.templateMap[t.scriptLanguage])}))},handleContentChange(e){this.scriptContent=e},handleSidePanelShow(e){this.sidePanelComponentName===e?this.sidePanelComponentName="":this.sidePanelComponentName=e},handleSidePanelHide(){this.sidePanelComponentName=""},handleSidePanelResize(){this.$refs.editor.resize()},handleSave(){var e=this;this.isSubmiting=!0,s.default.updateOriginalTemplate({scriptLanguage:(0,r.formatScriptTypeValue)(this.scriptLanguage),scriptContent:this.scriptContent}).then((function(){window.changeAlert=!1,e.templateMap[e.scriptLanguage]=e.scriptLanguage,e.messageSuccess("保存成功")})).finally((function(){e.isSubmiting=!1}))},handleEditReset(){this.$refs.editor.setValue(this.templateMap[this.scriptLanguage]),this.messageSuccess("重置成功")},handleUseDefault(){this.$refs.editor.resetValue(),this.messageSuccess("还原默认成功")}}};t.Z=u},16022:function(){},67060:function(){},73719:function(){},4077:function(){},52457:function(e,t,i){"use strict";i.r(t),i.d(t,{__esModule:function(){return a.X},default:function(){return o}});var n=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("resizeable-box",{attrs:{"parent-width":e.parentWidth,width:e.parentWidth/2}},[i("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:e.isLoading},expression:"{ isLoading }"}],staticClass:"script-template-preview-template"},[i("div",{staticClass:"preview-result"},[i("span",[e._v(e._s("渲染结果"))]),e._v(" "),e.needRefresh?i("div",{staticClass:"refresh-flag",on:{click:e.handleRefresh}},[i("span",{staticClass:"dot"},[i("Icon",{attrs:{type:"refresh-2"}})],1),e._v(" "),i("span",{staticStyle:{color:"#d74242"}},[e._v(e._s("有更新"))])]):e._e()]),e._v(" "),i("div",{staticClass:"preview-content",attrs:{id:e.editorId}})])])};n._withStripped=!0;var a=i(21086),s=a.Z,r=(i(13081),(0,i(51900).Z)(s,n,[],!1,null,null,null));r.options.__file="src/views/script-template/index/components/preview-template.vue";var o=r.exports},84749:function(e,t,i){"use strict";i.r(t),i.d(t,{__esModule:function(){return a.X},default:function(){return o}});var n=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("resizeable-box",[i("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:e.isLoading},expression:"{ isLoading }"}],staticClass:"script-template-render-variable"},[i("scroll-faker",{attrs:{theme:"dark"}},[i("div",{staticClass:"title"},[e._v(e._s("变量列表"))]),e._v(" "),i("table",{staticClass:"script-variable-list"},[i("thead",[i("tr",[i("td",[e._v(e._s("变量名称"))]),e._v(" "),i("td",[e._v(e._s("含义"))]),e._v(" "),i("td",[e._v(e._s("示例"))])])]),e._v(" "),e._l(e.variableList,(function(t){return i("tbody",{key:t.name},[i("tr",[i("td",[i("div",{staticClass:"variable-name",on:{click:function(i){return e.handleCopyScriptVariable("{{"+t.name+"}}")}}},[e._v("\n                                "+e._s(t.name)+"\n                            ")])]),e._v(" "),i("td",[e._v(e._s(t.description))]),e._v(" "),i("td",[e._v(e._s(t.demo))])])])}))],2)])],1)])};n._withStripped=!0;var a=i(61629),s=a.Z,r=(i(82066),(0,i(51900).Z)(s,n,[],!1,null,null,null));r.options.__file="src/views/script-template/index/components/render-variable.vue";var o=r.exports},34583:function(e,t,i){"use strict";i.r(t),i.d(t,{__esModule:function(){return a.X},default:function(){return o}});var n=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{ref:"handle",staticClass:"resizeable-box",style:e.styles},[e._t("default"),e._v(" "),i("div",{staticClass:"mouse-flag",on:{mousedown:e.handleMousedown}},[i("Icon",{attrs:{type:"many-dot"}})],1)],2)};n._withStripped=!0;var a=i(99319),s=a.Z,r=(i(90606),(0,i(51900).Z)(s,n,[],!1,null,null,null));r.options.__file="src/views/script-template/index/components/resizeable-box.vue";var o=r.exports},60149:function(e,t,i){"use strict";i.r(t),i.d(t,{__esModule:function(){return a.X},default:function(){return o}});var n=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:e.isLoading},expression:"{ isLoading }"}],ref:"container",staticClass:"script-template-page"},[i("ace-editor",{ref:"editor",staticClass:"script-template-editor",attrs:{lang:e.scriptLanguage,height:e.editorHeight,"custom-enable":!1,"before-lang-change":e.beforeLangChange},on:{change:e.handleContentChange,"on-mode-change":e.handleLangChange}},[i("template",{slot:"action"},[i("Icon",{directives:[{name:"bk-tooltips",rawName:"v-bk-tooltips",value:"内置变量",expression:"'内置变量'"}],attrs:{type:"variable"},on:{click:function(t){return e.handleSidePanelShow("renderVariable")}}})],1),e._v(" "),e.sidePanelComponentName?i("div",{staticClass:"script-editor-right-panel",attrs:{slot:"side"},slot:"side"},[i(e.renderSideComponent,{tag:"component",attrs:{"parent-width":e.editorWidth,"script-language":e.scriptLanguage,"script-content":e.scriptContent},on:{"on-resize":e.handleSidePanelResize}}),e._v(" "),i("div",{staticClass:"panel-close",on:{click:e.handleSidePanelHide}},[i("Icon",{attrs:{type:"close"}})],1)],1):e._e()],2),e._v(" "),i("div",{staticClass:"action-box"},[i("bk-button",{staticClass:"mr10",staticStyle:{width:"86px"},attrs:{theme:"primary",loading:e.isSubmiting},on:{click:e.handleSave}},[e._v("\n            "+e._s("保存")+"\n        ")]),e._v(" "),i("div",{staticClass:"action-btn mr10",on:{click:e.handleEditReset}},[e._v(e._s("重置"))]),e._v(" "),i("div",{staticClass:"action-btn",on:{click:e.handleUseDefault}},[e._v(e._s("还原默认"))]),e._v(" "),i("div",{staticClass:"action-btn",class:{active:"previewTemplate"===e.sidePanelComponentName},staticStyle:{"margin-left":"60px"},on:{click:function(t){return e.handleSidePanelShow("previewTemplate")}}},[e._v("\n            "+e._s("渲染预览")+"\n        ")])],1)],1)};n._withStripped=!0;var a=i(44397),s=a.Z,r=(i(61550),(0,i(51900).Z)(s,n,[],!1,null,null,null));r.options.__file="src/views/script-template/index/index.vue";var o=r.exports},13081:function(e,t,i){var n=i(16022);n.__esModule&&(n=n.default),"string"==typeof n&&(n=[[e.id,n,""]]),n.locals&&(e.exports=n.locals);(0,i(18086).Z)("05c1234d",n,!1,{})},82066:function(e,t,i){var n=i(67060);n.__esModule&&(n=n.default),"string"==typeof n&&(n=[[e.id,n,""]]),n.locals&&(e.exports=n.locals);(0,i(18086).Z)("282b6c06",n,!1,{})},90606:function(e,t,i){var n=i(73719);n.__esModule&&(n=n.default),"string"==typeof n&&(n=[[e.id,n,""]]),n.locals&&(e.exports=n.locals);(0,i(18086).Z)("d172f426",n,!1,{})},61550:function(e,t,i){var n=i(4077);n.__esModule&&(n=n.default),"string"==typeof n&&(n=[[e.id,n,""]]),n.locals&&(e.exports=n.locals);(0,i(18086).Z)("f956f372",n,!1,{})}}]);