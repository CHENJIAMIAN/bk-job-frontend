(self.webpackChunkjob=self.webpackChunkjob||[]).push([[3849],{65991:function(e,t,i){"use strict";var n=i(22696);Object.defineProperty(t,"X",{value:!0}),t.Z=void 0,i(57024),i(70969),i(87033),i(35948),i(94522);var a=n(i(18306)),s=i(1064),r=n(i(81865)),o=i(41980),l=n(i(77789)),c=n(i(62049)),d={Shell:"sh",Bat:"batchfile",Perl:"perl",Python:"python",Powershell:"powershell",SQL:"sql"},p={name:"",components:{ResizeableBox:c.default},props:{parentWidth:{type:Number,default:window.innerWidth},scriptContent:{type:String,default:""},scriptLanguage:{type:String,required:!0}},data:()=>({isLoading:!1,needRefresh:!1}),computed:{mode(){return"ace/mode/".concat(d[this.scriptLanguage])}},watch:{scriptContent:{handler(){this.hasRendered?this.needRefresh=!0:this.fetchRenderScript()},immediate:!0},scriptLanguage(){var e=this;setTimeout((function(){e.editor.getSession().setMode(e.mode)}))}},created(){this.hasRendered=!1,this.editorId="scriptTemplatePrevice".concat((0,a.default)(1,1e3),"_").concat(Date.now())},mounted(){this.initEditor()},methods:{initEditor(){var e=l.default.edit(this.editorId);e.getSession().setMode(this.mode),e.setOptions({fontSize:13,enableBasicAutocompletion:!0,enableLiveAutocompletion:!0,enableSnippets:!0,wrapBehavioursEnabled:!0,autoScrollEditorIntoView:!0,copyWithEmptySelection:!0,useElasticTabstops:!0,printMarginColumn:!0,printMargin:80,scrollPastEnd:.2}),e.setTheme("ace/theme/monokai"),e.setShowPrintMargin(!1),e.$blockScrolling=1/0,e.setReadOnly(!0),e.scrollToLine(1/0),e.setValue(""),e.clearSelection(),this.editor=e,this.$once("hook:beforeDestroy",(function(){e.destroy(),e.container.remove()}))},fetchRenderScript(){var e=this;this.isLoading=!0,r.default.fetchRenderScript({scriptContent:this.scriptContent,scriptLanguage:(0,o.formatScriptTypeValue)(this.scriptLanguage)}).then((function(t){e.editor.setValue(s.Base64.decode(t.scriptContent)),e.editor.clearSelection()})).finally((function(){e.isLoading=!1,e.hasRendered=!0,e.needRefresh=!1}))},handleRefresh(){this.fetchRenderScript()}}};t.Z=p},93570:function(e,t,i){"use strict";var n=i(22696);Object.defineProperty(t,"X",{value:!0}),t.Z=void 0,i(87033),i(35948),i(94522),i(70969);var a=n(i(15399)),s=n(i(81865)),r=i(41980),o={components:{ResizeableBox:n(i(62049)).default},inheritAttrs:!1,data:()=>({isLoading:!1,variableList:[{},{},{}]}),created(){this.fetchVariableList()},methods:{fetchVariableList(){var e=this;this.isLoading=!0,s.default.fetchVaribaleList().then((function(t){e.variableList=Object.freeze(t)})).finally((function(){e.isLoading=!1}))},handleCopyScriptVariable(e){(0,r.execCopy)(e,"".concat(a.default.t("scriptTemplate.复制成功")," ").concat(e))}}};t.Z=o},15029:function(e,t,i){"use strict";var n=i(22696);Object.defineProperty(t,"X",{value:!0}),t.Z=void 0,i(57024);var a=n(i(45812)),s={props:{parentWidth:{type:Number,default:window.innerWidth},width:{type:Number,default:400}},data(){return{styles:{width:"".concat(this.width,"px")}}},created(){this.moveStartWidth=this.width,this.isResizeable=!1,this.handleMousemove=(0,a.default)(this.eventMousemove,30)},mounted(){var e=this;document.body.addEventListener("mousemove",this.handleMousemove),document.body.addEventListener("mouseup",this.handleMouseup),this.$once("hook:beforeDestroy",(function(){document.body.removeEventListener("mousemove",e.handleMousemove),document.body.removeEventListener("mouseup",e.handleMouseup)}))},methods:{handleMousedown(e){this.isResizeable=!0,this.screenX=e.screenX,this.moveStartWidth=this.$refs.handle.getBoundingClientRect().width,document.body.style.userSelect="none"},handleMouseup(){this.isResizeable=!1,document.body.style.userSelect=""},eventMousemove(e){if(this.isResizeable){var t=Math.max(.8*this.parentWidth,this.parentWidth-200),i=Math.min(.1*this.parentWidth,200),n=e.screenX,a=this.screenX-n+this.moveStartWidth;a>t||a<i||(this.styles={width:"".concat(a,"px")},this.$emit("on-resize"))}}}};t.Z=s},82467:function(e,t,i){"use strict";i(23232),i(58596),i(80433);var n=i(22696);Object.defineProperty(t,"X",{value:!0}),t.Z=void 0,i(92974),i(87033),i(35948),i(94522),i(9042);var a=n(i(35058)),s=n(i(15399)),r=n(i(81865)),o=i(41980),l=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var i=p(t);if(i&&i.has(e))return i.get(e);var n={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if("default"!==s&&Object.prototype.hasOwnProperty.call(e,s)){var r=a?Object.getOwnPropertyDescriptor(e,s):null;r&&(r.get||r.set)?Object.defineProperty(n,s,r):n[s]=e[s]}n.default=e,i&&i.set(e,n);return n}(i(45673)),c=n(i(22686)),d=n(i(66848));function p(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,i=new WeakMap;return(p=function(e){return e?i:t})(e)}var u={name:"",components:{AceEditor:l.default,RenderVariable:c.default,PreviewTemplate:d.default},data:()=>({isLoading:!1,isSubmiting:!1,editorHeight:0,editorWidth:0,isShowVariable:!1,scriptLanguage:"Shell",scriptContent:"",sidePanelComponentName:""}),computed:{renderSideComponent(){return{previewTemplate:d.default,renderVariable:c.default}[this.sidePanelComponentName]}},created(){this.templateMap=Object.assign({},l.builtInScript),this.fetchOriginalTemplate()},mounted(){var e=this;this.calcEditorSize(),window.addEventListener("resize",this.calcEditorSize),this.$once("hook:beforeDestroy",(function(){window.removeEventListener("resize",e.calcEditorSize)}))},methods:{fetchOriginalTemplate(){var e=this;this.isLoading=!0,r.default.fetchOriginalTemplate().then((function(t){t.forEach((function(t){e.templateMap[(0,o.formatScriptTypeValue)(t.scriptLanguage)]=t.scriptContent})),(0,a.default)(e.templateMap,e.scriptLanguage)&&e.$refs.editor.setValue(e.templateMap[e.scriptLanguage])})).finally((function(){e.isLoading=!1}))},calcEditorSize(){var e=(0,o.getOffset)(this.$refs.container).top,t=window.innerHeight;this.editorHeight=t-e-72,this.editorWidth=this.$refs.container.getBoundingClientRect().width},beforeLangChange(){return window.changeAlert=this.scriptContent!==this.templateMap[this.scriptLanguage],(0,o.leaveConfirm)()},handleLangChange(e){var t=this;this.scriptLanguage=e,setTimeout((function(){(0,a.default)(t.templateMap,t.scriptLanguage)&&t.$refs.editor.setValue(t.templateMap[t.scriptLanguage])}))},handleContentChange(e){this.scriptContent=e},handleSidePanelShow(e){this.sidePanelComponentName===e?this.sidePanelComponentName="":this.sidePanelComponentName=e},handleSidePanelHide(){this.sidePanelComponentName=""},handleSidePanelResize(){this.$refs.editor.resize()},handleSave(){var e=this;this.isSubmiting=!0,r.default.updateOriginalTemplate({scriptLanguage:(0,o.formatScriptTypeValue)(this.scriptLanguage),scriptContent:this.scriptContent}).then((function(){window.changeAlert=!1,e.templateMap[e.scriptLanguage]=e.scriptLanguage,e.messageSuccess(s.default.t("scriptTemplate.保存成功"))})).finally((function(){e.isSubmiting=!1}))},handleEditReset(){this.$refs.editor.setValue(this.templateMap[this.scriptLanguage]),this.messageSuccess(s.default.t("scriptTemplate.重置成功"))},handleUseDefault(){this.$refs.editor.resetValue(),this.messageSuccess(s.default.t("scriptTemplate.还原默认成功"))}}};t.Z=u},77576:function(){},16185:function(){},59079:function(){},55748:function(){},66848:function(e,t,i){"use strict";i.r(t),i.d(t,{__esModule:function(){return a.X},default:function(){return o}});var n=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("resizeable-box",{attrs:{"parent-width":e.parentWidth,width:e.parentWidth/2}},[i("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:e.isLoading},expression:"{ isLoading }"}],staticClass:"script-template-preview-template"},[i("div",{staticClass:"preview-result"},[i("span",[e._v(e._s(e.$t("scriptTemplate.渲染结果")))]),e._v(" "),e.needRefresh?i("div",{staticClass:"refresh-flag",on:{click:e.handleRefresh}},[i("span",{staticClass:"dot"},[i("Icon",{attrs:{type:"refresh-2"}})],1),e._v(" "),i("span",{staticStyle:{color:"#d74242"}},[e._v(e._s(e.$t("scriptTemplate.有更新")))])]):e._e()]),e._v(" "),i("div",{staticClass:"preview-content",attrs:{id:e.editorId}})])])};n._withStripped=!0;var a=i(65991),s=a.Z,r=(i(69916),(0,i(35471).Z)(s,n,[],!1,null,null,null));r.options.__file="src/views/script-template/index/components/preview-template.vue";var o=r.exports},22686:function(e,t,i){"use strict";i.r(t),i.d(t,{__esModule:function(){return a.X},default:function(){return o}});var n=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("resizeable-box",[i("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:e.isLoading},expression:"{ isLoading }"}],staticClass:"script-template-render-variable"},[i("scroll-faker",{attrs:{theme:"dark"}},[i("div",{staticClass:"title"},[e._v(e._s(e.$t("scriptTemplate.变量列表")))]),e._v(" "),i("table",{staticClass:"script-variable-list"},[i("thead",[i("tr",[i("td",[e._v(e._s(e.$t("scriptTemplate.变量名称")))]),e._v(" "),i("td",[e._v(e._s(e.$t("scriptTemplate.含义")))]),e._v(" "),i("td",[e._v(e._s(e.$t("scriptTemplate.示例")))])])]),e._v(" "),e._l(e.variableList,(function(t){return i("tbody",{key:t.name},[i("tr",[i("td",[i("div",{staticClass:"variable-name",on:{click:function(i){return e.handleCopyScriptVariable("{{"+t.name+"}}")}}},[e._v("\n                                "+e._s(t.name)+"\n                            ")])]),e._v(" "),i("td",[e._v(e._s(t.description))]),e._v(" "),i("td",[e._v(e._s(t.demo))])])])}))],2)])],1)])};n._withStripped=!0;var a=i(93570),s=a.Z,r=(i(93714),(0,i(35471).Z)(s,n,[],!1,null,null,null));r.options.__file="src/views/script-template/index/components/render-variable.vue";var o=r.exports},62049:function(e,t,i){"use strict";i.r(t),i.d(t,{__esModule:function(){return a.X},default:function(){return o}});var n=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{ref:"handle",staticClass:"resizeable-box",style:e.styles},[e._t("default"),e._v(" "),i("div",{staticClass:"mouse-flag",on:{mousedown:e.handleMousedown}},[i("Icon",{attrs:{type:"many-dot"}})],1)],2)};n._withStripped=!0;var a=i(15029),s=a.Z,r=(i(87954),(0,i(35471).Z)(s,n,[],!1,null,null,null));r.options.__file="src/views/script-template/index/components/resizeable-box.vue";var o=r.exports},3849:function(e,t,i){"use strict";i.r(t),i.d(t,{__esModule:function(){return a.X},default:function(){return o}});var n=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:e.isLoading},expression:"{ isLoading }"}],ref:"container",staticClass:"script-template-page"},[i("ace-editor",{ref:"editor",staticClass:"script-template-editor",attrs:{lang:e.scriptLanguage,height:e.editorHeight,"custom-enable":!1,"before-lang-change":e.beforeLangChange},on:{change:e.handleContentChange,"on-mode-change":e.handleLangChange}},[i("template",{slot:"action"},[i("Icon",{directives:[{name:"bk-tooltips",rawName:"v-bk-tooltips",value:e.$t("scriptTemplate.内置变量"),expression:"$t('scriptTemplate.内置变量')"}],attrs:{type:"variable"},on:{click:function(t){return e.handleSidePanelShow("renderVariable")}}})],1),e._v(" "),e.sidePanelComponentName?i("div",{staticClass:"script-editor-right-panel",attrs:{slot:"side"},slot:"side"},[i(e.renderSideComponent,{tag:"component",attrs:{"parent-width":e.editorWidth,"script-language":e.scriptLanguage,"script-content":e.scriptContent},on:{"on-resize":e.handleSidePanelResize}}),e._v(" "),i("div",{staticClass:"panel-close",on:{click:e.handleSidePanelHide}},[i("Icon",{attrs:{type:"close"}})],1)],1):e._e()],2),e._v(" "),i("div",{staticClass:"action-box"},[i("bk-button",{staticClass:"mr10",staticStyle:{width:"86px"},attrs:{theme:"primary",loading:e.isSubmiting},on:{click:e.handleSave}},[e._v("\n            "+e._s(e.$t("scriptTemplate.保存"))+"\n        ")]),e._v(" "),i("div",{staticClass:"action-btn mr10",on:{click:e.handleEditReset}},[e._v(e._s(e.$t("scriptTemplate.重置")))]),e._v(" "),i("div",{staticClass:"action-btn",on:{click:e.handleUseDefault}},[e._v(e._s(e.$t("scriptTemplate.还原默认")))]),e._v(" "),i("div",{staticClass:"action-btn",class:{active:"previewTemplate"===e.sidePanelComponentName},staticStyle:{"margin-left":"60px"},on:{click:function(t){return e.handleSidePanelShow("previewTemplate")}}},[e._v("\n            "+e._s(e.$t("scriptTemplate.渲染预览"))+"\n        ")])],1)],1)};n._withStripped=!0;var a=i(82467),s=a.Z,r=(i(49581),(0,i(35471).Z)(s,n,[],!1,null,null,null));r.options.__file="src/views/script-template/index/index.vue";var o=r.exports},69916:function(e,t,i){var n=i(77576);n.__esModule&&(n=n.default),"string"==typeof n&&(n=[[e.id,n,""]]),n.locals&&(e.exports=n.locals);(0,i(13570).Z)("6657ff42",n,!1,{})},93714:function(e,t,i){var n=i(16185);n.__esModule&&(n=n.default),"string"==typeof n&&(n=[[e.id,n,""]]),n.locals&&(e.exports=n.locals);(0,i(13570).Z)("35019f32",n,!1,{})},87954:function(e,t,i){var n=i(59079);n.__esModule&&(n=n.default),"string"==typeof n&&(n=[[e.id,n,""]]),n.locals&&(e.exports=n.locals);(0,i(13570).Z)("75a8b73c",n,!1,{})},49581:function(e,t,i){var n=i(55748);n.__esModule&&(n=n.default),"string"==typeof n&&(n=[[e.id,n,""]]),n.locals&&(e.exports=n.locals);(0,i(13570).Z)("e7244a94",n,!1,{})}}]);