(self.webpackChunkjob=self.webpackChunkjob||[]).push([[8460],{49595:function(e,t,a){"use strict";a(35927),a(45974),a(9042),a(43364);var s=a(22696);Object.defineProperty(t,"X",{value:!0}),t.Z=void 0;var i=s(a(33610));a(71959),a(87033),a(63762),a(35948),a(94522);var r=s(a(67713)),n=s(a(46117)),l=a(41980),o=a(46790),c=a(61681),u=s(a(80712)),d=s(a(27452)),m=s(a(2645));function h(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,s)}return a}function p(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?h(Object(a),!0).forEach((function(t){(0,i.default)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):h(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var f="execute_history_list_columns",b={name:"",components:{ListActionLayout:u.default,RenderList:d.default,JbSearchSelect:m.default},data:()=>({showOperation:!1,searchParams:{startTime:"",endTime:""},defaultDateTime:["",""],selectedTableColumn:[],tableSize:"small",redoRequestMap:{}}),computed:{isSkeletonLoading(){return this.$refs.list.isLoading},searchInfoEnable(){return!!this.searchParams.taskInstanceId},allRenderColumnMap(){return this.selectedTableColumn.reduce((function(e,t){return e[t.id]=!0,e}),{})}},created(){this.parseDefaultDateTime(),this.fetchExecutionHistoryList=r.default.fetchExecutionHistoryList,this.searchSelect=[{name:"ID",id:"taskInstanceId",description:"将覆盖其它条件",validate:(e,t)=>!!e.every((function(e){return/^(\d*)$/.test(e.name)}))||"ID只支持数字"},{name:"任务名称",id:"taskName",default:!0},{name:"目标 IP",id:"ip",validate:(e,t)=>!!e.every((function(e){return c.IPRule.validator(e.name)}))||c.IPRule.message},{name:"执行耗时",id:"totalTimeType",children:[{name:"≤ 60s",id:"LESS_THAN_ONE_MINUTE"},{name:"＞60s and ≤ 600s",id:"ONE_MINUTE_TO_TEN_MINUTES"},{name:"＞ 600s",id:"MORE_THAN_TEN_MINUTES"}]},{name:"执行方式",id:"startupModes",children:[{name:"页面执行",id:1},{name:"定时执行",id:3},{name:"API调用",id:2}]},{name:"任务类型",id:"taskType",children:[{name:"作业执行",id:0},{name:"脚本执行",id:1},{name:"文件分发",id:2}]},{name:"任务状态",id:"status",children:[{name:"等待执行",id:1},{name:"正在执行",id:2},{name:"执行成功",id:3},{name:"执行失败",id:4},{name:"等待确认",id:7},{name:"强制终止中",id:10},{name:"强制终止成功",id:11},{name:"确认终止",id:13},{name:"被丢弃",id:14}]},{name:"执行人",id:"operator",remoteMethod:n.default.fetchUsersOfSearch,inputInclude:!0}],this.shortcuts=[{text:"近1小时",value(){var e=new Date,t=new Date;return t.setTime(t.getTime()-36e5),[t,e]}},{text:"近12小时",value(){var e=new Date,t=new Date;return t.setTime(t.getTime()-432e5),[t,e]}},{text:"近1天",value(){var e=new Date,t=new Date;return t.setTime(t.getTime()-864e5),[t,e]}},{text:"近7天",value(){var e=new Date,t=new Date;return t.setTime(t.getTime()-6048e5),[t,e]}}],this.tableColumn=[{id:"id",label:"任务 ID",disabled:!0},{id:"name",label:"任务名称",disabled:!0},{id:"startupModeDesc",label:"执行方式",disabled:!0},{id:"typeDesc",label:"任务类型"},{id:"statusDesc",label:"任务状态",disabled:!0},{id:"operator",label:"执行人"},{id:"createTime",label:"开始时间"},{id:"totalTimeText",label:"耗时时长"}];var e=o.listColumnsCache.getItem(f);e?(this.selectedTableColumn=Object.freeze(e.columns),this.tableSize=e.size):this.selectedTableColumn=Object.freeze([{id:"id"},{id:"name"},{id:"startupModeDesc"},{id:"typeDesc"},{id:"statusDesc"},{id:"operator"},{id:"createTime"},{id:"totalTimeText"}])},methods:{fetchData(){this.$refs.list.$emit("onFetch",this.searchParams)},redoTask(e){var t=this;r.default.redoTask({taskInstanceId:e,taskVariables:[]}).then((function(e){var a=e.taskInstanceId;t.$bkMessage({theme:"success",message:"执行成功"}),t.$router.push({name:"historyTask",params:{id:a}})}))},parseDefaultDateTime(){var e=this,t=["",""],a={startTime:"",endTime:""},s=(new Date).getTime();Object.prototype.hasOwnProperty.call(this.$route.query,"startTime")?t[0]=this.$route.query.startTime:t[0]=(0,l.prettyDateTimeFormat)(s-864e5),a.startTime=t[0],Object.prototype.hasOwnProperty.call(this.$route.query,"endTime")?(t[1]=this.$route.query.endTime,a.endTime=this.$route.query.endTime):(t[1]=(0,l.prettyDateTimeFormat)(s),a.endTime=""),this.defaultDateTime=t,this.searchParams=a,a.endTime||setTimeout((function(){e.setToNowText(e.defaultDateTime)}))},handleSettingChange(e){var t=e.fields,a=e.size;this.selectedTableColumn=Object.freeze(t),this.tableSize=a,o.listColumnsCache.setItem(f,{columns:t,size:a})},handleSearch(e){var t=this.searchParams,a=t.startTime,s=t.endTime;this.searchParams=p(p({},e),{},{startTime:a,endTime:s}),this.fetchData()},handleDateChange(e,t){"upToNow"===t&&this.setToNowText(e),this.searchParams.startTime=e[0],this.searchParams.endTime="upToNow"===t?"":e[1],this.fetchData()},setToNowText(e){this.$refs.datePicker.shortcut={text:"".concat(e[0]," ","至今")}},handleGoDetail(e){e.isTask?this.$router.push({name:"historyStep",params:{taskInstanceId:1},query:{from:"historyList"}}):this.$router.push({name:"historyTask",params:{id:1}})},handleGoRetry(e){var t=this;if(!e.isTask){this.redoRequestMap=p(p({},this.redoRequestMap),{},{[e.id]:!0});if([1].length>0)return this.redoRequestMap[e.id]=!1,void this.$router.push({name:"redoTask",params:{taskInstanceId:e.id}});this.$bkInfo({title:"确认执行？",subTitle:"该方案未设置全局变量，点击确认将直接执行。",confirmFn:function(){r.default.redoTask({taskInstanceId:e.id,taskVariables:[]}).then((function(e){var a=e.taskInstanceId;t.$bkMessage({theme:"success",message:"执行成功"}),t.$router.push({name:"historyTask",params:{id:a}})})).finally((function(){t.redoRequestMap[e.id]=!1}))}})}e.isScript?this.$router.push({name:"fastExecuteScript",params:{taskInstanceId:e.id},query:{from:"executiveHistory"}}):e.isFile&&this.$router.push({name:"fastPushFile",params:{taskInstanceId:e.id},query:{from:"executiveHistory"}})}}};t.Z=b},99793:function(){},68460:function(e,t,a){"use strict";a.r(t),a.d(t,{__esModule:function(){return i.X},default:function(){return l}});var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"executive-history-page"},[a("list-action-layout",{scopedSlots:e._u([{key:"right",fn:function(){return[a("bk-date-picker",{ref:"datePicker",attrs:{value:e.defaultDateTime,placeholder:"选择日期",shortcuts:e.shortcuts,type:"datetimerange","shortcut-close":!0,"use-shortcut-text":!0,clearable:!1,"up-to-now":""},on:{change:e.handleDateChange}})]},proxy:!0}])},[a("jb-search-select",{ref:"search",staticStyle:{width:"600px"},attrs:{data:e.searchSelect,placeholder:"搜索任务ID，任务名称，执行方式，任务类型，任务状态，执行人..."},on:{"on-change":e.handleSearch}})],1),e._v(" "),a("render-list",{directives:[{name:"test",rawName:"v-test",value:{type:"list",value:"execHistory"},expression:"{ type: 'list', value: 'execHistory' }"}],ref:"list",staticClass:"executive-history-table",attrs:{size:e.tableSize,"data-source":e.fetchExecutionHistoryList,"search-control":function(){return e.$refs.search}}},[e.allRenderColumnMap.id?a("bk-table-column",{key:"id",attrs:{label:"ID",prop:"id",width:"130",align:"left"},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.row;return[a("auth-button",{attrs:{permission:s.canView,auth:"task_instance/view","resource-id":s.id,text:""},on:{click:function(t){return e.handleGoDetail(s)}}},[e._v("\n                    "+e._s(s.id)+"\n                ")])]}}],null,!1,1163985655)}):e._e(),e._v(" "),e.allRenderColumnMap.name?a("bk-table-column",{key:"name",attrs:{label:"任务名称",prop:"name","min-width":"200",align:"left","show-overflow-tooltip":""}}):e._e(),e._v(" "),e.allRenderColumnMap.startupModeDesc?a("bk-table-column",{key:"startupModeDesc",attrs:{label:"执行方式",prop:"startupModeDesc",width:"120",align:"left"}}):e._e(),e._v(" "),e.allRenderColumnMap.typeDesc?a("bk-table-column",{key:"typeDesc",attrs:{label:"任务类型",prop:"typeDesc",width:"140",align:"left"}}):e._e(),e._v(" "),e.allRenderColumnMap.statusDesc?a("bk-table-column",{key:"statusDesc",attrs:{label:"任务状态",prop:"statusDesc",width:"140",align:"left"},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.row;return[a("Icon",{class:{"rotate-loading":s.isDoing},staticStyle:{"font-size":"16px",color:"#3a84ff","vertical-align":"middle"},attrs:{svg:"",type:s.statusIconType}}),e._v(" "),a("span",{staticStyle:{"vertical-align":"middle"}},[e._v(e._s(s.statusDesc))])]}}],null,!1,2868236769)}):e._e(),e._v(" "),e.allRenderColumnMap.operator?a("bk-table-column",{key:"operator",attrs:{label:"执行人",prop:"operator",width:"140",align:"left"}}):e._e(),e._v(" "),e.allRenderColumnMap.createTime?a("bk-table-column",{key:"createTime",attrs:{label:"开始时间",prop:"createTime",width:"180",align:"left"}}):e._e(),e._v(" "),e.allRenderColumnMap.totalTimeText?a("bk-table-column",{key:"totalTimeText",attrs:{label:"耗时时长",prop:"totalTimeText",width:"130",align:"right"}}):e._e(),e._v(" "),a("bk-table-column",{key:"action",attrs:{label:"操作",width:"150",fixed:"right",align:"left"},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.row;return[a("auth-button",{attrs:{permission:s.canView,auth:"task_instance/view","resource-id":s.id,text:""},on:{click:function(t){return e.handleGoDetail(s)}}},[e._v("\n                    "+e._s("查看详情")+"\n                ")]),e._v(" "),e.redoRequestMap[s.id]?a("span",{staticClass:"task-redo-loading ml10",attrs:{"data-text":"去重做"}},[a("Icon",{staticClass:"rotate-loading",attrs:{svg:"",type:"sync-pending"}})],1):a("auth-button",{attrs:{permission:s.canExecute,auth:"task_instance/redo","resource-id":s.id,text:""},on:{click:function(t){return e.handleGoRetry(s)}}},[e._v("\n                    "+e._s("去重做")+"\n                ")])]}}])}),e._v(" "),a("bk-table-column",{attrs:{type:"setting"}},[a("bk-table-setting-content",{attrs:{fields:e.tableColumn,selected:e.selectedTableColumn,size:e.tableSize},on:{"setting-change":e.handleSettingChange}})],1)],1)],1)};s._withStripped=!0;var i=a(49595),r=i.Z,n=(a(82743),(0,a(35471).Z)(r,s,[],!1,null,null,null));n.options.__file="src/views/executive-history/list/index.vue";var l=n.exports},82743:function(e,t,a){var s=a(99793);s.__esModule&&(s=s.default),"string"==typeof s&&(s=[[e.id,s,""]]),s.locals&&(e.exports=s.locals);(0,a(13570).Z)("45374406",s,!1,{})}}]);