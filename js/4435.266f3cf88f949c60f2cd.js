(self.webpackChunkjob=self.webpackChunkjob||[]).push([[4435],{21229:function(t,e,a){"use strict";a(35927),a(45974),a(9042),a(43364);var r=a(22696);Object.defineProperty(e,"X",{value:!0}),e.Z=void 0,a(87033),a(35948),a(94522),a(85604);var s=r(a(33610)),i=r(a(57525)),n=r(a(93435)),c=r(a(67713)),o=r(a(72075)),u=r(a(39986)),p=r(a(20703)),d=a(41980),f=a(46790);function l(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,r)}return a}function m(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?l(Object(a),!0).forEach((function(e){(0,s.default)(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):l(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}var h=function(){return{isScriptContentLoading:!1,name:(0,d.genDefaultName)("快速执行脚本"),scriptSource:o.default.scriptStep.TYPE_SOURCE_LOCAL,scriptLanguage:1,scriptId:"",scriptVersionId:"",content:"",scriptParam:"",secureParam:0,timeout:7200,account:"",targetServers:new u.default({})}},g={name:"",components:{ItemFactory:p.default},data:()=>({reset:0,isLoading:!1,formData:h(),historyList:[{},{},{}],isSubmiting:!1,isShowHistory:!1}),created(){this.parseUrlParams()},mounted(){window.IPInputScope="SCRIPT_EXECUTE",this.$once("hook:beforeDestroy",(function(){window.IPInputScope=""}))},beforeDestroy(){f.debugScriptCache.clearItem()},methods:{fetchData(){var t=this;this.$request(c.default.fetchTaskInstance({id:this.taskInstanceId}),(function(){t.isLoading=!0})).then((function(e){var a=e.stepInfo.scriptStepInfo,r=a.account,s=a.content,i=a.ignoreError,n=a.scriptId,c=a.scriptLanguage,o=a.scriptParam,u=a.scriptSource,p=a.scriptVersionId,d=a.secureParam,f=a.timeout,l=a.executeTarget;t.formData=m(m({},t.formData),{},{name:e.stepInfo.name,account:r,content:s,ignoreError:i,scriptId:n,scriptLanguage:c,scriptParam:o,scriptSource:u,scriptVersionId:p,secureParam:d,timeout:f,targetServers:l})})).finally((function(){t.isLoading=!1}))},parseUrlParams(){var t=this;if("debugScript"!==this.$route.query.model){this.taskInstanceId=parseInt(this.$route.params.taskInstanceId,10),this.scriptVersionId=parseInt(this.$route.params.scriptVersionId,10);var e=this.$route.query.from;if(this.timeTravel(),"historyStep"===e){var a=null;if(a=this.taskInstanceId?(0,n.default)(this.historyList,(function(e){return e.taskInstanceId===t.taskInstanceId})):(0,i.default)(this.historyList))return void(this.formData=a.formData)}this.taskInstanceId>0?this.fetchData():this.scriptVersionId>0&&(this.formData.scriptVersionId=this.scriptVersionId,this.formData.scriptSource=o.default.scriptStep.TYPE_SOURCE_PUBLIC)}else{var r=f.debugScriptCache.getItem();r&&(this.formData.content=r)}},timeTravel(){this.historyList=Object.freeze(f.execScriptHistory.getItem())},pushLocalStorage(t){var e=f.execScriptHistory.getItem();e.unshift(t),f.execScriptHistory.setItem(e)},handleShowHistory(){this.isShowHistory=!this.isShowHistory},handleGoHistoryDetail(t){this.$router.push({name:"historyStep",params:{taskInstanceId:t.taskInstanceId},query:{stepInstanceId:t.stepInstanceId,from:"fastExecuteScript"}})},handleChange(t,e){this.formData[t]=e},handleReset(t){this.formData=m(m({},this.formData),t)},handleSubmit(){var t=this;this.isSubmiting=!0,this.$refs.execScriptForm.validate().then((function(){if(!t.$store.state.scriptCheckError){var e=t.formData,a=e.name,r=e.scriptSource,s=e.scriptId,i=e.scriptVersionId,n=e.scriptLanguage,o=e.content,u=e.scriptParam,p=e.secureParam,f=e.timeout,l=e.account,m=e.targetServers,h={name:a,scriptSource:r,scriptId:s,scriptVersionId:i,scriptLanguage:n,content:o,scriptParam:u,secureParam:p,timeout:f,account:l,targetServers:m};return t.taskInstanceId&&(h.taskInstanceId=t.taskInstanceId,h.isRedoTask=!0),c.default.executeScript(h).then((function(e){window.changeAlert=!1,t.$router.push({name:"historyStep",params:{taskInstanceId:e.taskInstanceId},query:{stepInstanceId:e.stepInstanceId,from:"fastExecuteScript"}}),t.pushLocalStorage({id:Date.now(),name:a,taskInstanceId:e.taskInstanceId,stepInstanceId:e.stepInstanceId,formData:t.formData})}))}(0,d.scriptErrorAlert)()})).catch((function(){t.isSubmiting=!1}))},handleCancel(){this.$refs.execScriptForm.clearError(),this.formData=h(),this.reset+=1}}};e.Z=g},76483:function(){},94435:function(t,e,a){"use strict";a.r(e),a.d(e,{__esModule:function(){return s.X},default:function(){return c}});var r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:t.isLoading},expression:"{ isLoading }"}],staticClass:"exec-script-page"},[a("smart-action",{attrs:{"offset-target":"bk-form-content"},scopedSlots:t._u([{key:"action",fn:function(){return[a("div",{staticStyle:{display:"flex"}},[a("bk-button",{directives:[{name:"test",rawName:"v-test",value:{type:"button",value:"fastExecuteScriptSubmit"},expression:"{ type: 'button', value: 'fastExecuteScriptSubmit' }"}],staticClass:"w120 mr10",attrs:{loading:t.isSubmiting,theme:"primary"},on:{click:t.handleSubmit}},[t._v("\n                    "+t._s("执行")+"\n                ")]),t._v(" "),a("bk-button",{directives:[{name:"test",rawName:"v-test",value:{type:"button",value:"fastExecuteScriptCancel"},expression:"{ type: 'button', value: 'fastExecuteScriptCancel' }"}],on:{click:t.handleCancel}},[t._v("\n                    "+t._s("重置")+"\n                ")])],1)]},proxy:!0}])},[a("jb-form",{directives:[{name:"test",rawName:"v-test",value:{type:"form",value:"executeScript"},expression:"{ type: 'form', value: 'executeScript' }"}],ref:"execScriptForm",staticClass:"fast-execution-script-form",attrs:{model:t.formData}},[a("item-factory",{attrs:{name:"scriptName",field:"name",label:"脚本名称",placeholder:"取一个便于记忆的任务名，方便后续在历史记录中快速定位...","form-data":t.formData},on:{"on-change":t.handleChange}}),t._v(" "),a("item-factory",{attrs:{name:"scriptSourceOfExecution","script-source-field":"scriptSource","content-field":"content","language-field":"scriptLanguage","script-id-field":"scriptId","script-version-id-field":"scriptVersionId","form-data":t.formData},on:{"on-reset":t.handleReset}}),t._v(" "),a("item-factory",{key:t.reset,attrs:{name:"scriptContent","script-source-field":"scriptSource","content-field":"content","language-field":"scriptLanguage","form-data":t.formData},on:{"on-change":t.handleChange}}),t._v(" "),a("item-factory",{attrs:{name:"scriptParam","param-field":"scriptParam","secure-field":"secureParam","form-data":t.formData},on:{"on-change":t.handleChange}}),t._v(" "),a("item-factory",{attrs:{name:"scriptTimeout",field:"timeout","form-data":t.formData},on:{"on-change":t.handleChange}}),t._v(" "),a("item-factory",{attrs:{name:"scriptAccount",field:"account","script-language-field":"scriptLanguage","form-data":t.formData},on:{"on-change":t.handleChange}}),t._v(" "),a("item-factory",{attrs:{name:"executeTargetOfExecution",field:"targetServers","form-data":t.formData},on:{"on-change":t.handleChange}})],1)],1),t._v(" "),t.historyList.length>0?a("div",{staticClass:"execution-history",class:{active:t.isShowHistory}},[a("div",{staticClass:"toggle-btn",on:{click:t.handleShowHistory}},[a("Icon",{staticClass:"toggle-flag",attrs:{type:"angle-double-left"}}),t._v(" "),a("div",{staticClass:"recent-result"},[t._v(t._s("最近结果"))])],1),t._v(" "),a("div",{staticClass:"history-content"},t._l(t.historyList,(function(e){return a("div",{key:e.id,staticClass:"item",on:{click:function(a){return t.handleGoHistoryDetail(e)}}},[t._v("\n                "+t._s(e.name)+"\n            ")])})),0)]):t._e()],1)};r._withStripped=!0;var s=a(21229),i=s.Z,n=(a(69546),(0,a(35471).Z)(i,r,[],!1,null,null,null));n.options.__file="src/views/fast-execution/exec-script/index.vue";var c=n.exports},69546:function(t,e,a){var r=a(76483);r.__esModule&&(r=r.default),"string"==typeof r&&(r=[[t.id,r,""]]),r.locals&&(t.exports=r.locals);(0,a(13570).Z)("3b8eb3c4",r,!1,{})}}]);