{"version":3,"file":"js/6004.13e828dd07f40637c46e.js","mappings":"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","sources":["webpack://job/src/views/fast-execution/distro-file/index.vue","webpack://job/./src/views/fast-execution/distro-file/index.vue?03aa","webpack://job/./src/views/fast-execution/distro-file/index.vue?de73","webpack://job/./src/views/fast-execution/distro-file/index.vue?dffd","webpack://job/./src/views/fast-execution/distro-file/index.vue?ee85"],"sourcesContent":["\r\n\r\n<template>\r\n    <div class=\"distro-file-page\" v-bkloading=\"{ isLoading }\">\r\n        <smart-action offset-target=\"bk-form-content\">\r\n            <jb-form\r\n                class=\"push-file-form\"\r\n                ref=\"pushFileForm\"\r\n                v-test=\"{ type: 'form', value: 'pushFile' }\"\r\n                :model=\"formData\">\r\n                <card-layout :title=\"$t('execution.基本信息')\" class=\"block\">\r\n                    <item-factory\r\n                        name=\"stepName\"\r\n                        field=\"name\"\r\n                        :label=\"$t('execution.任务名称')\"\r\n                        :placeholder=\"$t('execution.取一个便于记忆的任务名，方便后续在历史记录中快速定位...')\"\r\n                        :form-data=\"formData\"\r\n                        @on-change=\"handleChange\" />\r\n                    <item-factory\r\n                        name=\"timeout\"\r\n                        field=\"timeout\"\r\n                        :form-data=\"formData\"\r\n                        @on-change=\"handleChange\" />\r\n                    <item-factory\r\n                        name=\"speedLimit\"\r\n                        field=\"uploadSpeedLimit\"\r\n                        :label=\"$t('execution.上传限速')\"\r\n                        :form-data=\"formData\"\r\n                        @on-change=\"handleChange\" />\r\n                    <item-factory\r\n                        name=\"speedLimit\"\r\n                        field=\"downloadSpeedLimit\"\r\n                        :label=\"$t('execution.下载限速')\"\r\n                        :form-data=\"formData\"\r\n                        @on-change=\"handleChange\" />\r\n                </card-layout>\r\n                <card-layout :title=\"$t('execution.文件来源')\" class=\"block\">\r\n                    <item-factory\r\n                        name=\"sourceFileOfExecution\"\r\n                        field=\"fileSourceList\"\r\n                        :form-data=\"formData\"\r\n                        @on-change=\"handleChange\" />\r\n                </card-layout>\r\n                <card-layout :title=\"$t('execution.传输目标')\" class=\"block\" style=\"margin-bottom: 0;\">\r\n                    <item-factory\r\n                        ref=\"targetPath\"\r\n                        name=\"targetPath\"\r\n                        field=\"path\"\r\n                        :tips-placement=\"targetPathTipsPlacement\"\r\n                        :form-data=\"formData\"\r\n                        @on-change=\"handleChange\" />\r\n                    <item-factory\r\n                        name=\"transferMode\"\r\n                        field=\"transferMode\"\r\n                        :form-data=\"formData\"\r\n                        @on-change=\"handleChange\" />\r\n                    <item-factory\r\n                        name=\"executeAccount\"\r\n                        field=\"account\"\r\n                        :form-data=\"formData\"\r\n                        @on-change=\"handleChange\" />\r\n                    <item-factory\r\n                        name=\"targetServerOfExecution\"\r\n                        field=\"server\"\r\n                        :form-data=\"formData\"\r\n                        @on-change=\"handleChange\" />\r\n                </card-layout>\r\n            </jb-form>\r\n            <template #action>\r\n                <bk-button\r\n                    class=\"w120 mr10\"\r\n                    theme=\"primary\"\r\n                    :loading=\"isSubmiting\"\r\n                    @click=\"handleSubmit\"\r\n                    v-test=\"{ type: 'button', value: 'fastPushFileSubmit' }\">\r\n                    {{ $t('execution.执行') }}\r\n                </bk-button>\r\n                <bk-button\r\n                    @click=\"handleCancel\"\r\n                    v-test=\"{ type: 'button', value: 'fastPushFileReset' }\">\r\n                    {{ $t('execution.重置') }}\r\n                </bk-button>\r\n            </template>\r\n        </smart-action>\r\n        <div v-if=\"historyList.length > 0\" class=\"execution-history\" :class=\"{ active: isShowHistory }\">\r\n            <div class=\"toggle-btn\" @click=\"handleShowHistory\">\r\n                <Icon class=\"toggle-flag\" type=\"angle-double-left\" />\r\n                <div class=\"recent-result\">{{ $t('execution.最近结果') }}</div>\r\n            </div>\r\n            <div class=\"history-content\">\r\n                <div\r\n                    v-for=\"item in historyList\"\r\n                    class=\"item\"\r\n                    :key=\"item.id\"\r\n                    @click=\"handleGoHistoryDetail(item)\">\r\n                    {{ item.name }}\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</template>\r\n<script>\r\n    import _ from 'lodash';\r\n    import {\r\n        mapState,\r\n    } from 'vuex';\r\n    import I18n from '@/i18n';\r\n    import TaskExecuteService from '@service/task-execute';\r\n    import TaskStepModel from '@model/task/task-step';\r\n    import TaskHostNodeModel from '@model/task-host-node';\r\n    import JbForm from '@components/jb-form';\r\n    import CardLayout from '@components/task-step/file/card-layout';\r\n    import ItemFactory from '@components/task-step/file/item-factory';\r\n    import {\r\n        genDefaultName,\r\n        compareHost,\r\n        detectionSourceFileDupLocation,\r\n    } from '@utils/assist';\r\n    import {\r\n        pushFileHistory,\r\n    } from '@utils/cache-helper';\r\n\r\n    const getDefaultData = () => ({\r\n        // 快速执行name\r\n        name: genDefaultName(I18n.t('execution.快速执行分发文件')),\r\n        // 源文件列表\r\n        fileSourceList: [{},{},{}],\r\n        // 超时\r\n        timeout: 7200,\r\n        // 上传文件限速\r\n        uploadSpeedLimit: 0,\r\n        // 传输模式： 1 - 严谨模式； 2 - 强制模式；3 - 安全模式\r\n        transferMode: 2,\r\n        // 下载文件限速\r\n        downloadSpeedLimit: 0,\r\n        // 执行账号\r\n        account: '',\r\n        // 目标路径\r\n        path: '',\r\n        // 目标服务器\r\n        server: new TaskHostNodeModel({}),\r\n    });\r\n\r\n    export default {\r\n        name: '',\r\n        components: {\r\n            JbForm,\r\n            CardLayout,\r\n            ItemFactory,\r\n        },\r\n        data () {\r\n            return {\r\n                isLoading: false,\r\n                formData: getDefaultData(),\r\n                isSubmiting: false,\r\n                historyList: [{},{},{}],\r\n                isShowHistory: false,\r\n                targetPathTipsPlacement: '',\r\n            };\r\n        },\r\n        computed: {\r\n            ...mapState('distroFile', {\r\n                isEditNewSourceFile: state => state.isEditNewSourceFile,\r\n            }),\r\n        },\r\n        created () {\r\n            this.init();\r\n            this.calcTargetPathTipsPlacement();\r\n        },\r\n        mounted () {\r\n            window.addEventListener('resize', this.calcTargetPathTipsPlacement);\r\n            this.$once('hook:beforeDestroy', () => {\r\n                window.removeEventListener('resize', this.calcTargetPathTipsPlacement);\r\n            });\r\n            window.IPInputScope = 'FILE_DISTRIBUTION';\r\n            this.$once('hook:beforeDestroy', () => {\r\n                window.IPInputScope = '';\r\n            });\r\n        },\r\n        methods: {\r\n            /**\r\n             * @desc 执行历史重做\r\n             *\r\n             * 通过任务taskInstanceId获取任务的详情\r\n             */\r\n            fetchData () {\r\n                this.$request(TaskExecuteService.fetchTaskInstance({\r\n                    id: this.taskInstanceId,\r\n                }), () => {\r\n                    this.isLoading = true;\r\n                }).then((data) => {\r\n                    const { stepInfo } = data;\r\n                    const {\r\n                        downloadSpeedLimit,\r\n                        fileDestination,\r\n                        fileSourceList,\r\n                        timeout,\r\n                        transferMode,\r\n                        uploadSpeedLimit,\r\n                    } = stepInfo.fileStepInfo;\r\n                    const {\r\n                        account,\r\n                        path,\r\n                        server,\r\n                    } = fileDestination;\r\n                    this.formData = {\r\n                        ...this.formData,\r\n                        name: stepInfo.name,\r\n                        uploadSpeedLimit,\r\n                        downloadSpeedLimit,\r\n                        account,\r\n                        path,\r\n                        server,\r\n                        timeout,\r\n                        fileSourceList,\r\n                        transferMode,\r\n                    };\r\n                })\r\n                    .finally(() => {\r\n                        this.isLoading = false;\r\n                    });\r\n            },\r\n            /**\r\n             * @desc 初始化逻辑\r\n             *\r\n             * 1，读取执行历史缓存\r\n             * 2，解析url\r\n             *     -- 路由回退重做\r\n             *     -- 执行历史指定任务重做\r\n             */\r\n            init () {\r\n                this.taskInstanceId = parseInt(this.$route.params.taskInstanceId, 10);\r\n                this.timeTravel();\r\n\r\n                const { from } = this.$route.query;\r\n                // 步骤执行详情历史编辑——从历史缓存数据中查找对应数据的formData\r\n                if (from === 'historyStep') {\r\n                    let historyRecord = null;\r\n                    if (this.taskInstanceId) {\r\n                        // 有指定taskInstanceId\r\n                        historyRecord = _.find(this.historyList, _ => _.taskInstanceId === this.taskInstanceId);\r\n                    } else {\r\n                        // 没有指定taskInstanceId，默认取第一个\r\n                        historyRecord = _.head(this.historyList);\r\n                    }\r\n                    // 历史缓存中有数据使用缓存数据\r\n                    if (historyRecord) {\r\n                        this.formData = historyRecord.formData;\r\n                        return;\r\n                    }\r\n                }\r\n                // 执行历史——通过taskInstanceId重做\r\n                if (this.taskInstanceId > 0) {\r\n                    this.fetchData();\r\n                }\r\n            },\r\n            calcTargetPathTipsPlacement: _.throttle(function () {\r\n                this.targetPathTipsPlacement = window.innerWidth > 1650 ? 'right-start' : 'top';\r\n            }, 60),\r\n            /**\r\n             * @desc 回溯执行历史\r\n             *\r\n             */\r\n            timeTravel () {\r\n                this.historyList = Object.freeze(pushFileHistory.getItem());\r\n            },\r\n            /**\r\n             * @desc 执行记录缓存\r\n             * @param {Array} history 执行历史记录\r\n             *\r\n             */\r\n            pushLocalStorage (history) {\r\n                const historyList = pushFileHistory.getItem();\r\n                historyList.unshift(history);\r\n                pushFileHistory.setItem(historyList);\r\n            },\r\n            /**\r\n             * @desc 展开执行历史列表\r\n             *\r\n             */\r\n            handleShowHistory () {\r\n                this.isShowHistory = !this.isShowHistory;\r\n            },\r\n            /**\r\n             * @desc 查看执行历史记录任务详情\r\n             *\r\n             */\r\n            handleGoHistoryDetail (payload) {\r\n                this.$router.push({\r\n                    name: 'historyStep',\r\n                    params: {\r\n                        taskInstanceId: payload.taskInstanceId,\r\n                    },\r\n                    query: {\r\n                        stepInstanceId: payload.stepInstanceId,\r\n                        from: 'fastPushFile',\r\n                    },\r\n                });\r\n            },\r\n            /**\r\n             * @desc 表单值更新\r\n             * @param {String} field 字段名\r\n             * @param {Any} value  字段最新值\r\n             *\r\n             */\r\n            handleChange (field, value) {\r\n                this.formData[field] = value;\r\n            },\r\n            /**\r\n             * @desc 执行\r\n             */\r\n            handleSubmit () {\r\n                this.isSubmiting = true;\r\n                this.$refs.pushFileForm.validate()\r\n                    // 检测没有保存的源文件\r\n                    .then(() => new Promise((resolve, reject) => {\r\n                        if (!this.isEditNewSourceFile) {\r\n                            return resolve();\r\n                        }\r\n                        this.$bkInfo({\r\n                            title: I18n.t('execution.您有未保存的源文件'),\r\n                            type: 'warning',\r\n                            okText: I18n.t('execution.继续执行'),\r\n                            cancelText: I18n.t('execution.去保存'),\r\n                            confirmFn: () => {\r\n                                setTimeout(() => {\r\n                                    resolve();\r\n                                }, 300);\r\n                            },\r\n                            cancelFn: () => {\r\n                                setTimeout(() => {\r\n                                    reject(new Error('save'));\r\n                                }, 300);\r\n                            },\r\n                        });\r\n                    }))\r\n                    // 检测服务器源文件的主机和执行目标服务器主机相同\r\n                    .then(() => new Promise((resolve, reject) => {\r\n                        let sameHost = false;\r\n                        // eslint-disable-next-line no-plusplus\r\n                        for (let i = 0; i < this.formData.fileSourceList.length; i++) {\r\n                            const currentFileSource = this.formData.fileSourceList[i];\r\n                            // 服务器源文件\r\n                            if (currentFileSource.fileType === TaskStepModel.fileStep.TYPE_SERVER) {\r\n                                if (compareHost(this.formData.server, currentFileSource.host)) {\r\n                                    sameHost = true;\r\n                                    break;\r\n                                }\r\n                            }\r\n                        }\r\n                        if (sameHost) {\r\n                            this.$bkInfo({\r\n                                title: I18n.t('execution.源和目标服务器相同'),\r\n                                subTitle: I18n.t('execution.检测到文件传输源和目标服务器是同一批，若是单台建议使用本地 cp 方式效率会更高，请问你是否确定参数无误？'),\r\n                                width: 500,\r\n                                okText: I18n.t('execution.好的，我调整一下'),\r\n                                cancelText: I18n.t('execution.是的，确定无误'),\r\n                                confirmFn: () => {\r\n                                    reject(new Error('execute'));\r\n                                },\r\n                                cancelFn: () => {\r\n                                    resolve();\r\n                                },\r\n                            });\r\n                        } else {\r\n                            resolve();\r\n                        }\r\n                    }))\r\n                    // 检测源文件的同名文件和目录\r\n                    .then(() => new Promise((resolve, reject) => {\r\n                        if (detectionSourceFileDupLocation(this.formData.fileSourceList)) {\r\n                            // 有重名目录和文件\r\n                            this.$bkInfo({\r\n                                title: I18n.t('execution.源文件可能出现同名'),\r\n                                subTitle: I18n.t('execution.多文件源传输场景下容易出现同名文件覆盖的问题，你可以在目标路径中使用 [源服务器IP] 的变量来尽可能规避风险。'),\r\n                                okText: I18n.t('execution.好的，我调整一下'),\r\n                                cancelText: I18n.t('execution.已知悉，确定执行'),\r\n                                closeIcon: false,\r\n                                width: 500,\r\n                                confirmFn: () => {\r\n                                    // 聚焦到目标路径输入框\r\n                                    this.$refs.targetPath.$el.scrollIntoView();\r\n                                    this.$refs.targetPath.$el.querySelector('.bk-form-input').focus();\r\n                                    reject(new Error('transferMode change'));\r\n                                },\r\n                                cancelFn: () => {\r\n                                    resolve();\r\n                                },\r\n                            });\r\n                        } else {\r\n                            resolve();\r\n                        }\r\n                    }))\r\n                    .then(() => {\r\n                        const {\r\n                            name,\r\n                            timeout,\r\n                            uploadSpeedLimit,\r\n                            downloadSpeedLimit,\r\n                            transferMode,\r\n                            fileSourceList,\r\n                            account,\r\n                            path,\r\n                            server,\r\n                        } = this.formData;\r\n                        \r\n                        return TaskExecuteService.pushFile({\r\n                            name,\r\n                            uploadSpeedLimit: parseInt(uploadSpeedLimit, 10),\r\n                            downloadSpeedLimit: parseInt(downloadSpeedLimit, 10),\r\n                            timeout: parseInt(timeout, 10),\r\n                            fileSourceList,\r\n                            transferMode,\r\n                            fileDestination: {\r\n                                account,\r\n                                path,\r\n                                server,\r\n                            },\r\n                        }).then((data) => {\r\n                            window.changeAlert = false;\r\n                            this.$router.push({\r\n                                name: 'historyStep',\r\n                                params: {\r\n                                    taskInstanceId: data.taskInstanceId,\r\n                                },\r\n                                query: {\r\n                                    stepInstanceId: data.stepInstanceId,\r\n                                    from: 'fastPushFile',\r\n                                },\r\n                            });\r\n                            this.pushLocalStorage({\r\n                                id: Date.now(),\r\n                                name,\r\n                                taskInstanceId: data.taskInstanceId,\r\n                                stepInstanceId: data.stepInstanceId,\r\n                                formData: this.formData,\r\n                            });\r\n                        });\r\n                    })\r\n                    .catch(() => {\r\n                        this.isSubmiting = false;\r\n                    });\r\n            },\r\n            /**\r\n             * @desc 重置\r\n             */\r\n            handleCancel () {\r\n                this.$refs.pushFileForm.clearError();\r\n                this.formData = getDefaultData();\r\n            },\r\n        },\r\n    };\r\n</script>\r\n<style lang='postcss'>\r\n    @import \"@/css/mixins/media\";\r\n\r\n    html[lang=\"en-US\"] {\r\n        .recent-result {\r\n            margin-top: 6px;\r\n            transform: rotate(90deg);\r\n        }\r\n    }\r\n\r\n    .distro-file-page {\r\n        .push-file-form {\r\n            margin-bottom: 24px;\r\n\r\n            .card-box {\r\n                margin-bottom: 6px;\r\n            }\r\n\r\n            .form-item-content {\r\n                width: 500px;\r\n\r\n                @media (--small-viewports) {\r\n                    width: 500px;\r\n                }\r\n\r\n                @media (--medium-viewports) {\r\n                    width: 560px;\r\n                }\r\n\r\n                @media (--large-viewports) {\r\n                    width: 620px;\r\n                }\r\n\r\n                @media (--huge-viewports) {\r\n                    width: 680px;\r\n                }\r\n            }\r\n        }\r\n\r\n        .execution-history {\r\n            position: fixed;\r\n            top: 127px;\r\n            right: 0;\r\n            z-index: 99;\r\n            font-size: 12px;\r\n            line-height: 30px;\r\n            color: #c4c6cc;\r\n            background: #63656e;\r\n            border-bottom-left-radius: 2px;\r\n            transform: translateX(100%);\r\n            transition: all 0.35s;\r\n            user-select: none;\r\n\r\n            &.active {\r\n                transform: translateX(0);\r\n\r\n                .toggle-flag {\r\n                    transform: rotateZ(180deg);\r\n                }\r\n            }\r\n\r\n            .toggle-btn {\r\n                position: absolute;\r\n                top: 0;\r\n                left: -22px;\r\n                display: flex;\r\n                width: 22px;\r\n                height: 88px;\r\n                line-height: 13px;\r\n                color: #dcdee5;\r\n                text-align: center;\r\n                cursor: pointer;\r\n                background: #63656e;\r\n                border-right: 1px solid #757783;\r\n                border-bottom-left-radius: 8px;\r\n                border-top-left-radius: 8px;\r\n                flex-direction: column;\r\n                justify-content: center;\r\n\r\n                .toggle-flag {\r\n                    margin-bottom: 5px;\r\n                    color: #979ba5;\r\n                    transition: all 0.2s;\r\n                }\r\n            }\r\n\r\n            .history-content {\r\n                display: flex;\r\n                min-height: 90px;\r\n                padding: 12px 0;\r\n                flex-direction: column;\r\n                justify-content: center;\r\n            }\r\n\r\n            .item {\r\n                padding-right: 16px;\r\n                padding-left: 16px;\r\n                cursor: pointer;\r\n                transition: all 0.15s;\r\n\r\n                &:hover {\r\n                    color: #fff;\r\n                    background: #4f515a;\r\n                }\r\n            }\r\n        }\r\n    }\r\n</style>\r\n","var render = function () {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n  return _c(\n    \"div\",\n    {\n      directives: [\n        {\n          name: \"bkloading\",\n          rawName: \"v-bkloading\",\n          value: { isLoading: _vm.isLoading },\n          expression: \"{ isLoading }\",\n        },\n      ],\n      staticClass: \"distro-file-page\",\n    },\n    [\n      _c(\n        \"smart-action\",\n        {\n          attrs: { \"offset-target\": \"bk-form-content\" },\n          scopedSlots: _vm._u([\n            {\n              key: \"action\",\n              fn: function () {\n                return [\n                  _c(\n                    \"bk-button\",\n                    {\n                      directives: [\n                        {\n                          name: \"test\",\n                          rawName: \"v-test\",\n                          value: {\n                            type: \"button\",\n                            value: \"fastPushFileSubmit\",\n                          },\n                          expression:\n                            \"{ type: 'button', value: 'fastPushFileSubmit' }\",\n                        },\n                      ],\n                      staticClass: \"w120 mr10\",\n                      attrs: { theme: \"primary\", loading: _vm.isSubmiting },\n                      on: { click: _vm.handleSubmit },\n                    },\n                    [\n                      _vm._v(\n                        \"\\n                \" +\n                          _vm._s(_vm.$t(\"execution.执行\")) +\n                          \"\\n            \"\n                      ),\n                    ]\n                  ),\n                  _vm._v(\" \"),\n                  _c(\n                    \"bk-button\",\n                    {\n                      directives: [\n                        {\n                          name: \"test\",\n                          rawName: \"v-test\",\n                          value: { type: \"button\", value: \"fastPushFileReset\" },\n                          expression:\n                            \"{ type: 'button', value: 'fastPushFileReset' }\",\n                        },\n                      ],\n                      on: { click: _vm.handleCancel },\n                    },\n                    [\n                      _vm._v(\n                        \"\\n                \" +\n                          _vm._s(_vm.$t(\"execution.重置\")) +\n                          \"\\n            \"\n                      ),\n                    ]\n                  ),\n                ]\n              },\n              proxy: true,\n            },\n          ]),\n        },\n        [\n          _c(\n            \"jb-form\",\n            {\n              directives: [\n                {\n                  name: \"test\",\n                  rawName: \"v-test\",\n                  value: { type: \"form\", value: \"pushFile\" },\n                  expression: \"{ type: 'form', value: 'pushFile' }\",\n                },\n              ],\n              ref: \"pushFileForm\",\n              staticClass: \"push-file-form\",\n              attrs: { model: _vm.formData },\n            },\n            [\n              _c(\n                \"card-layout\",\n                {\n                  staticClass: \"block\",\n                  attrs: { title: _vm.$t(\"execution.基本信息\") },\n                },\n                [\n                  _c(\"item-factory\", {\n                    attrs: {\n                      name: \"stepName\",\n                      field: \"name\",\n                      label: _vm.$t(\"execution.任务名称\"),\n                      placeholder: _vm.$t(\n                        \"execution.取一个便于记忆的任务名，方便后续在历史记录中快速定位...\"\n                      ),\n                      \"form-data\": _vm.formData,\n                    },\n                    on: { \"on-change\": _vm.handleChange },\n                  }),\n                  _vm._v(\" \"),\n                  _c(\"item-factory\", {\n                    attrs: {\n                      name: \"timeout\",\n                      field: \"timeout\",\n                      \"form-data\": _vm.formData,\n                    },\n                    on: { \"on-change\": _vm.handleChange },\n                  }),\n                  _vm._v(\" \"),\n                  _c(\"item-factory\", {\n                    attrs: {\n                      name: \"speedLimit\",\n                      field: \"uploadSpeedLimit\",\n                      label: _vm.$t(\"execution.上传限速\"),\n                      \"form-data\": _vm.formData,\n                    },\n                    on: { \"on-change\": _vm.handleChange },\n                  }),\n                  _vm._v(\" \"),\n                  _c(\"item-factory\", {\n                    attrs: {\n                      name: \"speedLimit\",\n                      field: \"downloadSpeedLimit\",\n                      label: _vm.$t(\"execution.下载限速\"),\n                      \"form-data\": _vm.formData,\n                    },\n                    on: { \"on-change\": _vm.handleChange },\n                  }),\n                ],\n                1\n              ),\n              _vm._v(\" \"),\n              _c(\n                \"card-layout\",\n                {\n                  staticClass: \"block\",\n                  attrs: { title: _vm.$t(\"execution.文件来源\") },\n                },\n                [\n                  _c(\"item-factory\", {\n                    attrs: {\n                      name: \"sourceFileOfExecution\",\n                      field: \"fileSourceList\",\n                      \"form-data\": _vm.formData,\n                    },\n                    on: { \"on-change\": _vm.handleChange },\n                  }),\n                ],\n                1\n              ),\n              _vm._v(\" \"),\n              _c(\n                \"card-layout\",\n                {\n                  staticClass: \"block\",\n                  staticStyle: { \"margin-bottom\": \"0\" },\n                  attrs: { title: _vm.$t(\"execution.传输目标\") },\n                },\n                [\n                  _c(\"item-factory\", {\n                    ref: \"targetPath\",\n                    attrs: {\n                      name: \"targetPath\",\n                      field: \"path\",\n                      \"tips-placement\": _vm.targetPathTipsPlacement,\n                      \"form-data\": _vm.formData,\n                    },\n                    on: { \"on-change\": _vm.handleChange },\n                  }),\n                  _vm._v(\" \"),\n                  _c(\"item-factory\", {\n                    attrs: {\n                      name: \"transferMode\",\n                      field: \"transferMode\",\n                      \"form-data\": _vm.formData,\n                    },\n                    on: { \"on-change\": _vm.handleChange },\n                  }),\n                  _vm._v(\" \"),\n                  _c(\"item-factory\", {\n                    attrs: {\n                      name: \"executeAccount\",\n                      field: \"account\",\n                      \"form-data\": _vm.formData,\n                    },\n                    on: { \"on-change\": _vm.handleChange },\n                  }),\n                  _vm._v(\" \"),\n                  _c(\"item-factory\", {\n                    attrs: {\n                      name: \"targetServerOfExecution\",\n                      field: \"server\",\n                      \"form-data\": _vm.formData,\n                    },\n                    on: { \"on-change\": _vm.handleChange },\n                  }),\n                ],\n                1\n              ),\n            ],\n            1\n          ),\n        ],\n        1\n      ),\n      _vm._v(\" \"),\n      _vm.historyList.length > 0\n        ? _c(\n            \"div\",\n            {\n              staticClass: \"execution-history\",\n              class: { active: _vm.isShowHistory },\n            },\n            [\n              _c(\n                \"div\",\n                {\n                  staticClass: \"toggle-btn\",\n                  on: { click: _vm.handleShowHistory },\n                },\n                [\n                  _c(\"Icon\", {\n                    staticClass: \"toggle-flag\",\n                    attrs: { type: \"angle-double-left\" },\n                  }),\n                  _vm._v(\" \"),\n                  _c(\"div\", { staticClass: \"recent-result\" }, [\n                    _vm._v(_vm._s(_vm.$t(\"execution.最近结果\"))),\n                  ]),\n                ],\n                1\n              ),\n              _vm._v(\" \"),\n              _c(\n                \"div\",\n                { staticClass: \"history-content\" },\n                _vm._l(_vm.historyList, function (item) {\n                  return _c(\n                    \"div\",\n                    {\n                      key: item.id,\n                      staticClass: \"item\",\n                      on: {\n                        click: function ($event) {\n                          return _vm.handleGoHistoryDetail(item)\n                        },\n                      },\n                    },\n                    [\n                      _vm._v(\n                        \"\\n                \" +\n                          _vm._s(item.name) +\n                          \"\\n            \"\n                      ),\n                    ]\n                  )\n                }),\n                0\n              ),\n            ]\n          )\n        : _vm._e(),\n    ],\n    1\n  )\n}\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns }","import mod from \"-!../../../../node_modules/_babel-loader@8.2.5@babel-loader/lib/index.js??clonedRuleSet-1[0].rules[0].use[0]!../../../../node_modules/_vue-loader@15.9.8@vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../node_modules/_babel-loader@8.2.5@babel-loader/lib/index.js??clonedRuleSet-1[0].rules[0].use[0]!../../../../node_modules/_vue-loader@15.9.8@vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./index.vue?vue&type=template&id=eda052ca&\"\nimport script from \"./index.vue?vue&type=script&lang=js&\"\nexport * from \"./index.vue?vue&type=script&lang=js&\"\nimport style0 from \"./index.vue?vue&type=style&index=0&lang=postcss&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../node_modules/_vue-loader@15.9.8@vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\n/* hot reload */\nif (module.hot) {\n  var api = require(\"D:\\\\Desktop\\\\bk-job-frontend\\\\node_modules\\\\_vue-hot-reload-api@2.3.4@vue-hot-reload-api\\\\dist\\\\index.js\")\n  api.install(require('vue'))\n  if (api.compatible) {\n    module.hot.accept()\n    if (!api.isRecorded('eda052ca')) {\n      api.createRecord('eda052ca', component.options)\n    } else {\n      api.reload('eda052ca', component.options)\n    }\n    module.hot.accept(\"./index.vue?vue&type=template&id=eda052ca&\", function () {\n      api.rerender('eda052ca', {\n        render: render,\n        staticRenderFns: staticRenderFns\n      })\n    })\n  }\n}\ncomponent.options.__file = \"src/views/fast-execution/distro-file/index.vue\"\nexport default component.exports","// style-loader: Adds some css to the DOM by adding a <style> tag\n\n// load the styles\nvar content = require(\"!!../../../../node_modules/_mini-css-extract-plugin@2.6.0@mini-css-extract-plugin/dist/loader.js??clonedRuleSet-3[0].rules[0].use[1]!../../../../node_modules/_css-loader@6.7.1@css-loader/dist/cjs.js??clonedRuleSet-3[0].rules[0].use[2]!../../../../node_modules/_vue-loader@15.9.8@vue-loader/lib/loaders/stylePostLoader.js!../../../../node_modules/_postcss-loader@6.2.1@postcss-loader/dist/cjs.js!../../../../node_modules/_vue-loader@15.9.8@vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=style&index=0&lang=postcss&\");\nif(content.__esModule) content = content.default;\nif(typeof content === 'string') content = [[module.id, content, '']];\nif(content.locals) module.exports = content.locals;\n// add the styles to the DOM\nvar add = require(\"!../../../../node_modules/_vue-style-loader@4.1.3@vue-style-loader/lib/addStylesClient.js\").default\nvar update = add(\"64cbf07d\", content, false, {});\n// Hot Module Replacement\nif(module.hot) {\n // When the styles change, update the <style> tags\n if(!content.locals) {\n   module.hot.accept(\"!!../../../../node_modules/_mini-css-extract-plugin@2.6.0@mini-css-extract-plugin/dist/loader.js??clonedRuleSet-3[0].rules[0].use[1]!../../../../node_modules/_css-loader@6.7.1@css-loader/dist/cjs.js??clonedRuleSet-3[0].rules[0].use[2]!../../../../node_modules/_vue-loader@15.9.8@vue-loader/lib/loaders/stylePostLoader.js!../../../../node_modules/_postcss-loader@6.2.1@postcss-loader/dist/cjs.js!../../../../node_modules/_vue-loader@15.9.8@vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=style&index=0&lang=postcss&\", function() {\n     var newContent = require(\"!!../../../../node_modules/_mini-css-extract-plugin@2.6.0@mini-css-extract-plugin/dist/loader.js??clonedRuleSet-3[0].rules[0].use[1]!../../../../node_modules/_css-loader@6.7.1@css-loader/dist/cjs.js??clonedRuleSet-3[0].rules[0].use[2]!../../../../node_modules/_vue-loader@15.9.8@vue-loader/lib/loaders/stylePostLoader.js!../../../../node_modules/_postcss-loader@6.2.1@postcss-loader/dist/cjs.js!../../../../node_modules/_vue-loader@15.9.8@vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=style&index=0&lang=postcss&\");\n     if(newContent.__esModule) newContent = newContent.default;\n     if(typeof newContent === 'string') newContent = [[module.id, newContent, '']];\n     update(newContent);\n   });\n }\n // When the module is disposed, remove the <style> tags\n module.hot.dispose(function() { update(); });\n}"],"names":["name","fileSourceList","timeout","uploadSpeedLimit","transferMode","downloadSpeedLimit","account","path","server","components","JbForm","CardLayout","ItemFactory","data","isLoading","formData","isSubmiting","historyList","isShowHistory","targetPathTipsPlacement","computed","isEditNewSourceFile","window","methods","id","then","stepInfo","fileDestination","finally","historyRecord","calcTargetPathTipsPlacement","pushLocalStorage","pushFileHistory","handleGoHistoryDetail","params","taskInstanceId","query","stepInstanceId","from","handleChange","title","type","okText","cancelText","confirmFn","setTimeout","cancelFn","reject","sameHost","subTitle","width","closeIcon","catch","render","_vm","this","_h","$createElement","_c","_self","directives","rawName","value","expression","staticClass","attrs","scopedSlots","_u","key","fn","theme","loading","on","click","handleSubmit","_v","_s","$t","handleCancel","proxy","ref","model","field","label","placeholder","staticStyle","length","class","active","handleShowHistory","_l","item","$event","_e","_withStripped","component","options","__file","content","__esModule","default","module","locals","exports","add"],"sourceRoot":""}