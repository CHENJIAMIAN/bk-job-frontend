(self.webpackChunkjob=self.webpackChunkjob||[]).push([[5501],{76312:function(e,t){"use strict";Object.defineProperty(t,"X",{value:!0}),t.Z=void 0;var n={inject:["collapse"],data:()=>({iconType:"arrow-full-right"}),mounted(){var e=this,t=this.$watch((function(){return e.$refs.collapseItem.isActive}),(function(t){e.iconType=t?"arrow-full-down":"arrow-full-right"}),{immediate:!0});this.$once("hook:beforeDestroy",(function(){t()}))}};t.Z=n},57894:function(e,t,n){"use strict";Object.defineProperty(t,"X",{value:!0}),t.Z=void 0,n(7170),n(87033),n(9042),n(61026),n(60259);var a={name:"",props:{channelList:{type:Array,default:function(){return[]}},value:{type:Array,default:function(){return[]}}},data:()=>({localValue:[]}),computed:{allCheckStatus(){var e=this;if(this.localValue.length<1)return{checked:!1,indeterminate:!1};var t=this.channelList.map((function(e){return e.code})),n=!0,a=!1;return t.forEach((function(t){e.localValue.includes(t)||(n=!1)})),a=!n,t.length<1&&(n=!1,a=!1),{checked:n,indeterminate:a}}},watch:{value:{handler(e){this.localValue=e},immediate:!0}},methods:{handleCheckToggle(){if(this.allCheckStatus.checked)this.handleChange([]);else{var e=this.channelList.map((function(e){return e.code}));this.handleChange(e)}},handleChange(e){this.localValue=e,this.$emit("on-change",this.localValue)}}};t.Z=a},88192:function(e,t,n){"use strict";var a=n(22696);Object.defineProperty(t,"X",{value:!0}),t.Z=void 0,n(71959),n(87033);var i=a(n(38502)),r=a(n(6922)),s=a(n(87880)),o={components:{JbUserSelector:r.default,RenderNotifyWay:s.default},props:{type:{type:String,require:!0},data:{type:Object,default:function(){return{}}},templateData:{type:Object,default:function(){return{}}}},data(){return{localValue:(0,i.default)(this.data)}},methods:{reset(){this.localValue=(0,i.default)(this.data)},getValue(){var e=this.localValue,t=e.resourceTypeList,n=e.extraObserverList,a=e.roleList,i=e.resourceStatusChannelMap;return{triggerType:this.type,resourceTypeList:t,roleList:a,extraObserverList:n,resourceStatusChannelList:Object.keys(i).reduce((function(e,t){return e.push({executeStatus:t,channelList:i[t]}),e}),[])}},handleResourceTypeChange(e){this.localValue.resourceTypeList=e},handleUserChange(e,t){e.length>0&&t.push("JOB_EXTRA_OBSERVER"),this.localValue.extraObserverList=e,this.localValue.roleList=t},handleNotifyWayChange(e,t){this.localValue.resourceStatusChannelMap[e]=t}}};t.Z=o},17435:function(e,t,n){"use strict";var a=n(22696);Object.defineProperty(t,"X",{value:!0}),t.Z=void 0,n(87033),n(35948),n(94522),n(23232),n(80433),n(7170),n(71959),n(9042);var i=a(n(15399)),r=a(n(46117)),s=a(n(10031)),o=a(n(18773)),l={components:{NotifyCollapseItem:s.default,TriggerSetting:o.default},data:()=>({isLoading:!0,isSubmiting:!1,activeResult:[],templateData:{},formData:{}}),computed:{isSkeletonLoading(){return this.isLoading}},created(){var e=this;this.isLoading=!0,Promise.all([this.fetchPageTemplate(),this.fetchPoliciesList()]).finally((function(){e.isLoading=!1}))},methods:{fetchPageTemplate(){var e={},t=e.triggerTypeList,n=void 0===t?[{},{},{}]:t,a=e.availableNotifyChannelList,i=void 0===a?[{},{},{}]:a,r=e.executeStatusList,s=void 0===r?[{},{},{}]:r,o=e.resourceTypeList,l=void 0===o?[{},{},{}]:o,c=e.roleList,u=void 0===c?[{},{},{}]:c;this.triggerTypeList=Object.freeze(n),this.templateData=Object.freeze({availableNotifyChannelList:i,executeStatusList:s,resourceTypeList:l,roleList:u}),this.activeResult=n.map((function(e){return e.code}))},fetchPoliciesList(){var e=[].reduce((function(e,t){var n=t.extraObserverList,a=void 0===n?[]:n,i=t.resourceStatusChannelMap,r=void 0===i?[]:i,s=t.resourceTypeList,o=void 0===s?[]:s,l=t.roleList,c=void 0===l?[]:l,u=t.triggerType;return e[void 0===u?[]:u]={extraObserverList:a,resourceStatusChannelMap:r,resourceTypeList:o,roleList:c},e}),{});this.formData=Object.freeze(e)},handleSave(){var e=this;this.isSubmiting=!0;var t=this.$refs.setting.map((function(e){return e.getValue()}));r.default.defaultPoliciesUpdate({triggerPoliciesList:t}).then((function(){return e.messageSuccess(i.default.t("notify.保存成功")),e.fetchPoliciesList()})).finally((function(){e.isSubmiting=!1}))},handleCancel(){this.$refs.setting.forEach((function(e){return e.reset()}))}}};t.Z=l},76927:function(){},13884:function(){},55741:function(){},94405:function(){},10031:function(e,t,n){"use strict";n.r(t),n.d(t,{__esModule:function(){return i.X},default:function(){return o}});var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"notify-collapse-item"},[n("bk-collapse-item",e._g(e._b({ref:"collapseItem",attrs:{"hide-arrow":""},scopedSlots:e._u([{key:"default",fn:function(){return[n("Icon",{staticStyle:{color:"#979ba5"},attrs:{type:e.iconType}}),e._v(" "),n("span",{staticStyle:{display:"none"}},[e._v(e._s(e.iconType))]),e._v(" "),e._t("default")]},proxy:!0},{key:"content",fn:function(){return[e._t("content")]},proxy:!0}],null,!0)},"bk-collapse-item",e.$attrs,!1),e.$listeners))],1)};a._withStripped=!0;var i=n(76312),r=i.Z,s=(n(45523),(0,n(35471).Z)(r,a,[],!1,null,null,null));s.options.__file="src/views/notify-manage/index/components/notify-collapse-item.vue";var o=s.exports},87880:function(e,t,n){"use strict";n.r(t),n.d(t,{__esModule:function(){return i.X},default:function(){return o}});var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"render-notify-way-check"},[n("bk-checkbox",e._b({staticClass:"check-all",nativeOn:{click:function(t){return e.handleCheckToggle.apply(null,arguments)}}},"bk-checkbox",e.allCheckStatus,!1),[e._v("\n        "+e._s(e.$t("notify.全选"))+"\n    ")]),e._v(" "),n("bk-checkbox-group",{staticClass:"check-item",attrs:{value:e.localValue},on:{change:e.handleChange}},e._l(e.channelList,(function(t){return n("bk-checkbox",{key:t.code,attrs:{value:t.code}},[e._v("\n            "+e._s(t.name)+"\n        ")])})),1)],1)};a._withStripped=!0;var i=n(57894),r=i.Z,s=(n(27449),(0,n(35471).Z)(r,a,[],!1,null,"6aecfc2e",null));s.options.__file="src/views/notify-manage/index/components/trigger-setting/components/render-notify-way.vue";var o=s.exports},18773:function(e,t,n){"use strict";n.r(t),n.d(t,{__esModule:function(){return i.X},default:function(){return o}});var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("jb-form",{staticClass:"notify-trigger-setting"},[n("jb-form-item",{attrs:{label:e.$t("notify.操作类型")}},[n("bk-checkbox-group",{staticClass:"input",attrs:{value:e.localValue.resourceTypeList},on:{change:e.handleResourceTypeChange}},e._l([{},{},{}],(function(t){return n("bk-checkbox",{key:t.code,attrs:{value:t.code}},[e._v("\n                "+e._s(t.name)+"\n            ")])})),1)],1),e._v(" "),n("jb-form-item",{attrs:{label:e.$t("notify.通知对象")}},[n("jb-user-selector",{staticClass:"input",attrs:{placeholder:e.$t("notify.请输入"),user:e.localValue.extraObserverList,role:e.localValue.roleList,"filter-list":["JOB_EXTRA_OBSERVER"]},on:{"on-change":e.handleUserChange}})],1),e._v(" "),n("jb-form-item",{attrs:{label:e.$t("notify.通知方式")}},[n("table",{staticClass:"notify-way-table input"},[n("thead",[n("th",{staticStyle:{width:"95px"}},[e._v(e._s(e.$t("notify.状态")))]),e._v(" "),n("th",[e._v(e._s(e.$t("notify.通知方式")))])]),e._v(" "),n("tbody",e._l([{},{},{}],(function(t,a){return n("tr",{key:a},[n("td",[e._v(e._s(t.name))]),e._v(" "),n("td",[n("render-notify-way",{attrs:{"channel-list":e.templateData.availableNotifyChannelList,value:[]},on:{"on-change":function(n){return e.handleNotifyWayChange(t.code,n)}}})],1)])})),0)])])],1)};a._withStripped=!0;var i=n(88192),r=i.Z,s=(n(33624),(0,n(35471).Z)(r,a,[],!1,null,null,null));s.options.__file="src/views/notify-manage/index/components/trigger-setting/index.vue";var o=s.exports},15501:function(e,t,n){"use strict";n.r(t),n.d(t,{__esModule:function(){return i.X},default:function(){return o}});var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("smart-action",{attrs:{"offset-target":"bk-form-content"},scopedSlots:e._u([{key:"action",fn:function(){return[n("div",{staticClass:"action-wrapper"},[n("bk-button",{staticClass:"w120 mr10",attrs:{theme:"primary",loading:e.isSubmiting},on:{click:e.handleSave}},[e._v("\n                "+e._s(e.$t("notify.保存"))+"\n            ")]),e._v(" "),n("bk-button",{on:{click:e.handleCancel}},[e._v("\n                "+e._s(e.$t("notify.重置"))+"\n            ")])],1)]},proxy:!0}])},[n("div",{staticClass:"notify-message-page"},[e.isLoading?e._e():n("bk-collapse",{attrs:{value:"1"}},e._l(e.triggerTypeList,(function(t){return n("notify-collapse-item",{key:t.code,attrs:{name:t.code,active:"1"}},[e._v("\n                trigger-title\n                "),n("span",{staticClass:"trigger-title"},[e._v(e._s(t.name))]),e._v(" "),n("trigger-setting",{ref:"setting",refInFor:!0,attrs:{slot:"content",type:t.code,data:e.formData[t.code],"template-data":e.templateData},slot:"content"})],1)})),1)],1)])};a._withStripped=!0;var i=n(17435),r=i.Z,s=(n(91825),(0,n(35471).Z)(r,a,[],!1,null,"9894fef6",null));s.options.__file="src/views/notify-manage/index/index.vue";var o=s.exports},45523:function(e,t,n){var a=n(76927);a.__esModule&&(a=a.default),"string"==typeof a&&(a=[[e.id,a,""]]),a.locals&&(e.exports=a.locals);(0,n(13570).Z)("562a0daf",a,!1,{})},27449:function(e,t,n){var a=n(13884);a.__esModule&&(a=a.default),"string"==typeof a&&(a=[[e.id,a,""]]),a.locals&&(e.exports=a.locals);(0,n(13570).Z)("e5ed03a8",a,!1,{})},33624:function(e,t,n){var a=n(55741);a.__esModule&&(a=a.default),"string"==typeof a&&(a=[[e.id,a,""]]),a.locals&&(e.exports=a.locals);(0,n(13570).Z)("50a8c738",a,!1,{})},91825:function(e,t,n){var a=n(94405);a.__esModule&&(a=a.default),"string"==typeof a&&(a=[[e.id,a,""]]),a.locals&&(e.exports=a.locals);(0,n(13570).Z)("6eb42313",a,!1,{})}}]);