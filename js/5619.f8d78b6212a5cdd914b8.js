(self.webpackChunkjob=self.webpackChunkjob||[]).push([[5619],{94772:function(t,e,i){"use strict";var n=i(70534);Object.defineProperty(e,"X",{value:!0}),e.Z=void 0,i(85376);var a=n(i(7285)),s={name:"",props:{value:{type:Number,require:!0}},data:()=>({isEditing:!1}),computed:{text(){var t=this;return(0,a.default)(this.actionList,(function(e){return e.id===t.value})).name},textClass(){return{1:"normal",2:"hight"}[this.value]}},created(){this.actionList=[{id:1,name:"扫描"},{id:2,name:"拦截"}]},methods:{handleEdit(){var t=this;this.isEditing=!0,this.$nextTick((function(){t.$refs.select.$el.querySelector(".bk-select-name").click()}))},handleSelectToggle(t){t||(this.isEditing=!1)},handleChange(t){this.$emit("on-change",t)}}};e.Z=s},39981:function(t,e,i){"use strict";i(13118),i(59241),i(20767);var n=i(70534);Object.defineProperty(e,"X",{value:!0}),e.Z=void 0;var a=n(i(68203));i(87147),i(63876),i(41336),i(91981),i(63898);var s=n(i(67237)),r=n(i(88214));function o(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,n)}return i}var l={data:()=>({isEdit:!1,isSubmiting:!1,formData:{expression:"",description:"",scriptTypeList:1,action:1},scriptTypeList:[{},{},{}]}),created(){this.fetchScriptType()},methods:{fetchScriptType(){var t=this;r.default.scriptTypeList().then((function(e){t.scriptTypeList=e}))},handleToggle(){this.isEdit=!0},handleCancel(){this.isEdit=!1,this.formData={expression:"",description:"",scriptTypeList:1,action:1}},handleSubmit(){var t=this;this.isSubmiting||(this.formData.expression&&this.formData.description?(this.isSubmiting=!0,s.default.update(function(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?o(Object(i),!0).forEach((function(e){(0,a.default)(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):o(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}({id:-1},this.formData)).then((function(){t.messageSuccess("新增成功"),t.$emit("on-change"),t.handleCancel()})).finally((function(){t.isSubmiting=!1}))):this.messageError("请填写完整的语法检测表达式和说明"))}}};e.Z=l},95053:function(t,e,i){"use strict";i(87147),i(13118),i(59241),i(20767);var n=i(70534);Object.defineProperty(e,"X",{value:!0}),e.Z=void 0;var a=n(i(68203));i(41336),i(91981),i(63898),i(33303),i(77702);var s=n(i(67237)),r=n(i(88214)),o=n(i(71693)),l=n(i(41867)),c=n(i(35549)),u=n(i(22958)),d=n(i(23882));function p(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,n)}return i}function v(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?p(Object(i),!0).forEach((function(e){(0,a.default)(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):p(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}var f={name:"",components:{JbEditInput:o.default,JbEditSelect:l.default,JbPopoverConfirm:c.default,TableActionRow:u.default,EditAction:d.default},data:()=>({isLoading:!0,list:[{},{},{}],scriptTypeList:[{},{},{}]}),computed:{isSkeletonLoading(){return this.isLoading}},created(){this.editRule={},this.fetchData(),this.fetchScriptType(),this.formRules={expression:[{required:!0,message:"语法检测表达式不能为空"}],description:[{required:!0,message:"规则说明不能为空"}],scriptTypeList:[{validator:function(t){return t.length>0},message:"脚本类型不能为空"}]}},methods:{fetchData(){var t=this;this.isLoading=!0,s.default.fetchList({},{permission:"page"}).then((function(e){t.list=e})).finally((function(){t.isLoading=!1}))},fetchScriptType(){var t=this;r.default.scriptTypeList().then((function(e){t.scriptTypeList=e}))},handleScriptTypeUpdate(t,e){this.editRule=v(v({},t),{},{scriptTypeList:e})},handleSubmitScriptTypeChange(t){var e=this;!t&&this.editRule.scriptTypeList&&this.editRule.scriptTypeList.length>0&&s.default.update(v({},this.editRule)).then((function(){e.messageSuccess("编辑成功")}))},handleUpdate(t,e){var i=this;return console.log("from handleUpdate = ",t,e),s.default.update(v(v({},t),e)).then((function(){i.messageSuccess("编辑成功"),Object.assign(t,e)}))},handleAdd(){this.fetchData()},handleMove(t,e){var i=this;this.isLoading=!0,s.default.updateSort({id:this.list[t].id,dir:e}).then((function(){var n=i.list[t],a=i.list[t+e];i.list.splice(t,1,a),i.list.splice(t+e,1,n),i.messageSuccess(e<0?"上移成功":"下移成功")})).finally((function(){i.isLoading=!1}))},handleDelete(t){var e=this;return s.default.remove({id:t}).then((function(){e.messageSuccess("删除成功"),e.fetchData()}))}}};e.Z=f},67237:function(t,e,i){"use strict";var n=i(70534);Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a=n(i(19084)),s={fetchList(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return a.default.getData(t,e).then((function(t){return t.data}))},update:t=>a.default.update(t).then((function(t){return t.data})),remove:t=>a.default.removeById(t).then((function(t){return t.data})),updateSort:t=>a.default.move(t).then((function(t){return t.data}))};e.default=s},19084:function(t,e,i){"use strict";var n=i(70534);Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,i(98495);var a=n(i(37346));var s=new class{constructor(){this.module="/job-manage/web/dangerousRule"}getData(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return a.default.get("".concat(this.module,"/list"),{params:t,payload:e})}update(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return a.default.post("".concat(this.module),{params:t})}removeById(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return a.default.delete("".concat(this.module,"/").concat(t.id))}move(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return a.default.put("".concat(this.module,"/move"),{params:t})}};e.default=s},2553:function(){},64281:function(){},23882:function(t,e,i){"use strict";i.r(e),i.d(e,{__esModule:function(){return a.X},default:function(){return o}});var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"dangerous-rule-edit-mode"},[i("bk-select",{ref:"select",attrs:{value:t.value,clearable:!1},on:{toggle:t.handleSelectToggle,change:t.handleChange}},t._l(t.actionList,(function(t){return i("bk-option",{key:t.id,attrs:{name:t.name,id:t.id}})})),1),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:!t.isEditing,expression:"!isEditing"}],staticClass:"value-box",on:{click:function(e){return e.stopPropagation(),t.handleEdit.apply(null,arguments)}}},[i("div",{staticClass:"action-text",class:t.textClass},[t._v("\n            "+t._s(t.text)+"\n        ")]),t._v(" "),i("i",{staticClass:"bk-icon icon-angle-down value-box-arrow"})])],1)};n._withStripped=!0;var a=i(94772),s=a.Z,r=(i(44706),(0,i(51900).Z)(s,n,[],!1,null,null,null));r.options.__file="src/views/dangerous-rule-manage/index/components/edit-action.vue";var o=r.exports},22958:function(t,e,i){"use strict";i.r(e),i.d(e,{__esModule:function(){return a.X},default:function(){return o}});var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("tbody",[t.isEdit?i("tr",[i("td",[i("bk-input",{staticClass:"input",model:{value:t.formData.expression,callback:function(e){t.$set(t.formData,"expression",e)},expression:"formData.expression"}})],1),t._v(" "),i("td",[i("bk-input",{staticClass:"input",model:{value:t.formData.description,callback:function(e){t.$set(t.formData,"description",e)},expression:"formData.description"}})],1),t._v(" "),i("td",[i("bk-select",{attrs:{clearable:!1,multiple:"","show-select-all":""},model:{value:t.formData.scriptTypeList,callback:function(e){t.$set(t.formData,"scriptTypeList",e)},expression:"formData.scriptTypeList"}},t._l(t.scriptTypeList,(function(t){return i("bk-option",{key:t.id,attrs:{name:t.name,id:t.id}})})),1)],1),t._v(" "),i("td",[i("bk-select",{attrs:{clearable:!1},model:{value:t.formData.action,callback:function(e){t.$set(t.formData,"action",e)},expression:"formData.action"}},[i("bk-option",{attrs:{name:"扫描",id:1}}),t._v(" "),i("bk-option",{attrs:{name:"拦截",id:2}})],1)],1),t._v(" "),i("td",[i("bk-button",{attrs:{text:""},on:{click:t.handleSubmit}},[t._v("\n                "+t._s("保存")+"\n            ")]),t._v(" "),i("bk-button",{attrs:{text:""},on:{click:t.handleCancel}},[t._v("\n                "+t._s("取消")+"\n            ")])],1)]):i("tr",[i("td",{attrs:{colspan:"5"}},[i("bk-button",{attrs:{text:""},on:{click:t.handleToggle}},[i("Icon",{attrs:{type:"plus"}}),t._v("\n                "+t._s("新增检测规则")+"\n            ")],1)],1)])])};n._withStripped=!0;var a=i(39981),s=a.Z,r=(0,i(51900).Z)(s,n,[],!1,null,null,null);r.options.__file="src/views/dangerous-rule-manage/index/components/table-action-row.vue";var o=r.exports},59652:function(t,e,i){"use strict";i.r(e),i.d(e,{__esModule:function(){return a.X},default:function(){return o}});var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"dangerous-rule-manage-page"},[i("table",{directives:[{name:"test",rawName:"v-test",value:{type:"list",value:"dangerousRule"},expression:"{ type: 'list', value: 'dangerousRule' }"}],staticClass:"rule-table"},[i("thead",[i("tr",[i("th",{staticStyle:{width:"200px"}},[t._v(t._s("语法检测表达式"))]),t._v(" "),i("th",[t._v(t._s("规则说明"))]),t._v(" "),i("th",{staticStyle:{width:"300px"}},[t._v(t._s("脚本类型"))]),t._v(" "),i("th",{staticStyle:{width:"300px"}},[i("span",[t._v(t._s("动作"))]),t._v(" "),i("bk-popover",{attrs:{placement:"right"}},[i("Icon",{staticClass:"action-tips",attrs:{type:"info"}}),t._v(" "),i("div",{attrs:{slot:"content"},slot:"content"},[i("div",[t._v(t._s("【扫描】"))]),t._v(" "),i("div",[t._v(t._s("命中规则的脚本执行任务仅会做记录，不会拦截"))]),t._v(" "),i("div",{staticStyle:{"margin-top":"8px"}},[t._v(t._s("【拦截】"))]),t._v(" "),i("div",[t._v(t._s("命中规则的脚本执行任务会被记录，并中止运行"))])])],1)],1),t._v(" "),i("th",{staticStyle:{width:"180px"}},[t._v("\n                    "+t._s("操作")+"\n                    "),i("Icon",{directives:[{name:"bk-tooltips",rawName:"v-bk-tooltips",value:{theme:"dark",content:"规则的顺位越高，表示执行优先度越高"},expression:"{\n                            theme: 'dark',\n                            content: '规则的顺位越高，表示执行优先度越高',\n                        }"}],staticClass:"action-tips",attrs:{type:"info"}})],1)])]),t._v(" "),i("table-action-row",{on:{"on-change":t.handleAdd}}),t._v(" "),t._l(t.list,(function(e,n){return i("tbody",{key:e.id},[i("tr",[i("td",[i("jb-edit-input",{attrs:{field:"expression",mode:"block",rules:t.formRules.expression,value:e.expression,"remote-hander":function(i){return t.handleUpdate(e,i)}}})],1),t._v(" "),i("td",[i("jb-edit-input",{attrs:{field:"description",mode:"block",rules:t.formRules.description,value:e.description,"remote-hander":function(i){return t.handleUpdate(e,i)}}})],1),t._v(" "),i("td",[i("jb-edit-select",{attrs:{field:"scriptTypeList",mode:"block",rules:t.formRules.scriptTypeList,multiple:"","show-select-all":"",value:e.scriptTypeList,list:t.scriptTypeList,"remote-hander":function(i){return t.handleUpdate(e,i)}}})],1),t._v(" "),i("td",[i("edit-action",{attrs:{value:e.action},on:{"on-change":function(i){return t.handleUpdate(e,{action:i})}}})],1),t._v(" "),i("td",[i("div",{staticClass:"action-box"},[i("bk-switcher",{directives:[{name:"test",rawName:"v-test",value:{type:"button",value:"toggleRuleStatus"},expression:"{ type: 'button', value: 'toggleRuleStatus' }"}],staticClass:"mr10",attrs:{value:e.status,"true-value":1,"false-value":0,theme:"primary",size:"small"},on:{update:function(i){return t.handleUpdate(e,{status:i})}}}),t._v(" "),i("bk-button",{directives:[{name:"bk-tooltips",rawName:"v-bk-tooltips.top",value:"上移",expression:"'上移'",modifiers:{top:!0}},{name:"test",rawName:"v-test",value:{type:"button",value:"upMoveRule"},expression:"{ type: 'button', value: 'upMoveRule' }"}],staticClass:"arrow-btn mr10",attrs:{text:""},on:{click:function(e){return t.handleMove(n,-1)}}},[i("Icon",{attrs:{type:"increase-line"}})],1),t._v(" "),i("bk-button",{directives:[{name:"bk-tooltips",rawName:"v-bk-tooltips.top",value:"下移",expression:"'下移'",modifiers:{top:!0}},{name:"test",rawName:"v-test",value:{type:"button",value:"downMoveRule"},expression:"{ type: 'button', value: 'downMoveRule' }"}],staticClass:"arrow-btn mr10",attrs:{text:""},on:{click:function(e){return t.handleMove(n,1)}}},[i("Icon",{attrs:{type:"decrease-line"}})],1),t._v(" "),i("jb-popover-confirm",{attrs:{title:"确定删除该规则？",content:"脚本编辑器中匹配该规则将不会再收到提醒","confirm-handler":function(){return t.handleDelete(e.id)}}},[i("bk-button",{directives:[{name:"test",rawName:"v-test",value:{type:"button",value:"deleteRule"},expression:"{ type: 'button', value: 'deleteRule' }"}],attrs:{text:""}},[t._v("\n                                "+t._s("删除")+"\n                            ")])],1)],1)])])])}))],2)])};n._withStripped=!0;var a=i(95053),s=a.Z,r=(i(98993),(0,i(51900).Z)(s,n,[],!1,null,null,null));r.options.__file="src/views/dangerous-rule-manage/index/index.vue";var o=r.exports},44706:function(t,e,i){var n=i(2553);n.__esModule&&(n=n.default),"string"==typeof n&&(n=[[t.id,n,""]]),n.locals&&(t.exports=n.locals);(0,i(18086).Z)("8f4be4dc",n,!1,{})},98993:function(t,e,i){var n=i(64281);n.__esModule&&(n=n.default),"string"==typeof n&&(n=[[t.id,n,""]]),n.locals&&(t.exports=n.locals);(0,i(18086).Z)("51bd219e",n,!1,{})}}]);