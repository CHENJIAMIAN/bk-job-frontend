(self.webpackChunkjob=self.webpackChunkjob||[]).push([[238],{82287:function(t,e,i){"use strict";i(35927),i(45974),i(9042),i(43364);var s=i(22696);Object.defineProperty(e,"X",{value:!0}),e.Z=void 0,i(71959),i(87033),i(35948),i(94522),i(23232),i(80433);var r=s(i(33610)),n=s(i(77094)),a=s(i(45812)),o=s(i(15399)),l=s(i(44068)),c=s(i(12e3)),d=s(i(86234)),u=s(i(45673)),p=i(41980),h=i(46790),f=i(61681),v=s(i(2317));function m(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,s)}return i}function b(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?m(Object(i),!0).forEach((function(e){(0,r.default)(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):m(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}var y=function(){return{id:"",typeName:"Shell",version:(0,p.genDefaultScriptVersion)(),versionDesc:"",type:1,content:""}},g={name:"",components:{JbInput:d.default,AceEditor:u.default,Layout:v.default},inheritAttrs:!1,props:{scriptInfo:{type:Object,required:!0},scriptVersionList:{type:Array,default:function(){return[]}}},data:()=>({isLoading:!0,isSubmiting:!1,formData:y(),contentHeight:0}),computed:{versionMap(){return this.scriptVersionList.reduce((function(t,e){return e.scriptVersionId<1||(t[e.version]=!0),t}),{})}},watch:{scriptInfo:{handler(t){if(t.id){var e=t.content,i=t.id,s=t.name,r=t.versionDesc,n=t.type,a=t.typeName;this.formData=b(b({},y()),{},{id:i,name:s,versionDesc:r,type:n,typeName:a,content:e})}},immediate:!0}},created(){var t=this;this.publicScript=(0,p.checkPublicScript)(this.$route),this.scriptManageServiceHandler=this.publicScript?c.default:l.default,this.rules={version:[{required:!0,message:o.default.t("script.版本号必填"),trigger:"blur"},{validator:f.scriptVersionRule.validator,message:f.scriptVersionRule.message,trigger:"blur"},{validator:function(e){return!t.versionMap[e]},message:o.default.t("script.版本号已存在，请重新输入"),trigger:"blur"}],content:[{required:!0,message:o.default.t("script.脚本内容不能为空"),trigger:"change"},{validator:function(e){return l.default.getScriptValidation({content:e,scriptType:t.formData.type}).then((function(e){return t.$store.commit("setScriptCheckError",e.some((function(t){return t.isDangerous}))),!0}))},message:o.default.t("script.脚本内容检测失败"),trigger:"blur"}]}},mounted(){this.calcContentHeight();var t=(0,a.default)(this.calcContentHeight,60);window.addEventListener("resize",t),this.$once("hook:beforeDestroy",(function(){window.removeEventListener("resize",t)}))},methods:{calcContentHeight(){var t=(0,p.getOffset)(this.$refs.content).top;this.contentHeight=window.innerHeight-t-66},handleUploadScript(){this.$refs.aceEditor.handleUploadScript()},handleShowHistory(){this.$refs.aceEditor.handleShowHistory()},handleFullScreen(){this.$refs.aceEditor.handleFullScreen()},handleVersionChange:(0,n.default)((function(t){this.formData.version=t;var e=this.scriptInfo.scriptVersionId;this.$emit("on-create-change",e,{version:t})}),100),handleTypeChange(t){this.formData.type=(0,p.formatScriptTypeValue)(t)},handleSubmit(){var t=this;this.formData.content?(this.isSubmiting=!0,Promise.all([this.$refs.form.validate(),l.default.getScriptValidation({content:this.formData.content,scriptType:this.formData.type}).then((function(e){return t.$store.commit("setScriptCheckError",e.some((function(t){return t.isDangerous}))),!0}))]).then((function(){t.$store.state.scriptCheckError?(0,p.scriptErrorAlert)():t.scriptManageServiceHandler.scriptUpdate(b({},t.formData)).then((function(e){t.$emit("on-create",{scriptVersionId:e.scriptVersionId}),window.changeAlert=!1,t.messageSuccess(o.default.t("script.操作成功"))}))})).finally((function(){t.isSubmiting=!1}))):this.messageError(o.default.t("script.脚本内容不能为空"))},handleDebugScript(){h.debugScriptCache.setItem(this.formData.content);var t=this.$router.resolve({name:"fastExecuteScript",query:{model:"debugScript"}}).href;window.open(t)},handleCancel(){var t=this;(0,p.leaveConfirm)().then((function(){t.$emit("on-create-cancel")}))}}};e.Z=g},87161:function(t,e,i){"use strict";i(35927),i(45974),i(9042),i(43364);var s=i(22696);Object.defineProperty(e,"X",{value:!0}),e.Z=void 0,i(87033),i(35948),i(94522),i(23232),i(80433);var r=s(i(33610)),n=s(i(45812)),a=s(i(15399)),o=s(i(44068)),l=s(i(12e3)),c=s(i(45673)),d=i(41980),u=i(46790),p=s(i(2317));function h(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,s)}return i}function f(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?h(Object(i),!0).forEach((function(e){(0,r.default)(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):h(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}var v={name:"",components:{AceEditor:c.default,Layout:p.default},inheritAttrs:!1,props:{scriptInfo:{type:Object,required:!0}},data:()=>({isSubmiting:!1,contentHeight:0,formData:{}}),watch:{scriptInfo:{handler(t){if(t.id){var e=t.id,i=t.name,s=t.scriptVersionId,r=t.version,n=t.versionDesc,a=t.type,o=t.typeName,l=t.content;this.formData=f(f({},{id:"",name:"",scriptVersionId:"",typeName:"Shell",version:"",versionDesc:"",type:1,content:""}),{},{id:e,name:i,scriptVersionId:s,version:r,versionDesc:n,type:a,typeName:o,content:l})}},immediate:!0}},created(){var t=this;this.publicScript=(0,d.checkPublicScript)(this.$route),this.serviceHandler=this.publicScript?l.default:o.default,this.rules={content:[{required:!0,message:a.default.t("script.脚本内容不能为空"),trigger:"change"},{validator:function(e){return o.default.getScriptValidation({content:e,scriptType:t.formData.type}).then((function(e){return t.$store.commit("setScriptCheckError",e.some((function(t){return t.isDangerous}))),!0}))},message:a.default.t("script.脚本内容检测失败"),trigger:"blur"}]},window.addEventListener("resize",this.init),this.$once("hook:beforeDestroy",(function(){window.removeEventListener("resize",t.init)}))},mounted(){this.calcContentHeight();var t=(0,n.default)(this.calcContentHeight,60);window.addEventListener("resize",t),this.$once("hook:beforeDestroy",(function(){window.removeEventListener("resize",t)}))},methods:{calcContentHeight(){var t=(0,d.getOffset)(this.$refs.content).top;this.contentHeight=window.innerHeight-t-26},handleUploadScript(){this.$refs.aceEditor.handleUploadScript()},handleShowHistory(){this.$refs.aceEditor.handleShowHistory()},handleFullScreen(){this.$refs.aceEditor.handleFullScreen()},handleSubmit(){var t=this;this.formData.content?(this.isSubmiting=!0,Promise.all([this.$refs.form.validate(),o.default.getScriptValidation({content:this.formData.content,scriptType:this.formData.type}).then((function(e){return t.$store.commit("setScriptCheckError",e.some((function(t){return t.isDangerous}))),!0}))]).then((function(){t.$store.state.scriptCheckError?(0,d.scriptErrorAlert)():t.serviceHandler.scriptUpdate(f(f({},t.formData),{},{scriptVersionId:t.scriptInfo.scriptVersionId})).then((function(){window.changeAlert=!1,t.$emit("on-edit",{scriptVersionId:t.scriptInfo.scriptVersionId}),t.messageSuccess(a.default.t("script.操作成功"))}))})).finally((function(){t.isSubmiting=!1}))):this.messageError(a.default.t("script.脚本内容不能为空"))},handleDebugScript(){u.debugScriptCache.setItem(this.formData.content);var t=this.$router.resolve({name:"fastExecuteScript",query:{model:"debugScript"}}).href;window.open(t)},handleCancel(){var t=this;(0,d.leaveConfirm)().then((function(){t.$emit("on-edit-cancel",{scriptVersionId:t.scriptInfo.scriptVersionId})}))}}};e.Z=v},57634:function(t,e,i){"use strict";var s=i(22696);Object.defineProperty(e,"X",{value:!0}),e.Z=void 0,i(57024),i(30254),i(87033),i(9042);var r=s(i(93435)),n=i(1064),a={props:{data:{type:Array,required:!0},title:{type:String,default:""},oldVersionId:{type:Number,required:!0},newVersionId:{type:Number,required:!0}},data(){return{oldVersion:this.oldVersionId,newVersion:this.newVersionId,zIndex:"auto",del:0,ins:0,change:0}},computed:{language(){return this.data.length<1?"":this.data[0].typeName.toLocaleLowerCase()},oldContent(){var t=this,e=(0,r.default)(this.data,(function(e){return e.scriptVersionId===t.oldVersion}));return e?n.Base64.decode(e.content):""},newContent(){var t=this,e=(0,r.default)(this.data,(function(e){return e.scriptVersionId===t.newVersion}));return e?n.Base64.decode(e.content):""}},watch:{oldContent(){this.statisticsDiff()},newContent(){this.statisticsDiff()}},created(){this.scrollTopMemo=0,this.insElements=[],this.insIndex=0,this.delElements=[],this.delIndex=0,this.changeElements=[],this.changeIndex=0},mounted(){var t=this;this.zIndex=window.__bk_zIndex_manager.nextZIndex(),document.body.append(this.$el),window.addEventListener("keydown",this.handleEsc),this.resetBodyStyle(),this.statisticsDiff(),this.$once("hook:beforeDestroy",(function(){window.removeEventListener("keydown",t.handleEsc);try{document.body.removeChild(t.$el)}catch(t){}}))},methods:{statisticsDiff(){var t=this;this.$nextTick((function(){var e=t.$refs.diff.$el.querySelectorAll(".d2h-file-side-diff")[1],i=Array.from(e.querySelectorAll("td.d2h-code-side-linenumber.d2h-ins"));i.pop(),t.insElements=[],t.ins=0,t.insIndex=0,t.changeElements=[],t.change=0,t.changeIndex=0,i.forEach((function(e){e.classList.contains("d2h-change")?(t.changeElements.push(e),t.change+=1):(t.insElements.push(e),t.ins+=1)}));var s=e.querySelectorAll("td.d2h-code-side-linenumber.d2h-code-side-emptyplaceholder");t.delElements=s,t.del=s.length,t.delIndex=0,t.lineElements=e.querySelectorAll("td.d2h-code-side-linenumber")}))},lineViewReset(){this.lineElements.forEach((function(t){t.classList.remove("active")}))},handleViewDel(){if(this.lineViewReset(),!(this.del<1)){var t=this.delElements[this.delIndex];t.scrollIntoView(),t.classList.add("active"),this.changeIndex=0,this.insIndex=0,this.delIndex+=1,this.delIndex>=this.del&&(this.delIndex=0)}},handleViewChange(){if(this.lineViewReset(),!(this.change<1)){var t=this.changeElements[this.changeIndex];t.scrollIntoView(),t.classList.add("active"),this.insIndex=0,this.delIndex=0,this.changeIndex+=1,this.changeIndex>=this.change&&(this.changeIndex=0)}},handleViewIns(){if(this.lineViewReset(),!(this.ins<1)){var t=this.insElements[this.insIndex];t.scrollIntoView(),t.classList.add("active"),this.delIndex=0,this.changeIndex=0,this.insIndex+=1,this.insIndex>=this.ins&&(this.insIndex=0)}},handleEsc(t){t&&"Escape"===t.code&&this.handleClose()},handleClose(){this.$emit("on-change",{[this.oldVersion]:!0,[this.newVersion]:!0}),this.$emit("close")},resetBodyStyle(){this.scrollTopMemo=document.scrollingElement.scrollTop,document.scrollingElement.style.overflow="hidden"},recoveryBodyStyle(){document.scrollingElement.style.overflow="initial",document.scrollingElement.scrollTop=this.scrollTopMemo}}};e.Z=a},39902:function(t,e,i){"use strict";Object.defineProperty(e,"X",{value:!0}),e.Z=void 0;var s=i(41980),r={name:"",props:{flod:{type:Boolean,default:!1}},data:()=>({isShowRight:!1,isOpen:!1,layoutWidth:"auto",layoutOffsetTop:0}),computed:{styles(){return this.flod?{width:"360px"}:{width:this.layoutWidth}},rightStyles(){return{height:"calc(100vh -  ".concat(this.layoutOffsetTop+20,"px)")}}},watch:{flod:{handler(t){var e=this;t?setTimeout((function(){e.isShowRight=t}),110):this.isShowRight=!1},immediate:!0}},mounted(){var t=this;this.init(),window.addEventListener("resize",this.init),this.$once("hook:beforeDestroy",(function(){window.removeEventListener("resize",t.init)}))},methods:{init(){var t=this.$refs.layout.getBoundingClientRect().width;this.layoutWidth="".concat(t,"px");var e=(0,s.getOffset)(this.$refs.layout).top;this.layoutOffsetTop=e},handleToggle(){this.isOpen=!this.isOpen},handleClose(){var t=this;(0,s.leaveConfirm)().then((function(){t.isOpen=!1,t.$emit("on-flod"),t.$emit("update:flod",!1)}))}}};e.Z=r},76824:function(t,e,i){"use strict";var s=i(22696);Object.defineProperty(e,"X",{value:!0}),e.Z=void 0;var r=s(i(93435)),n=s(i(15399)),a={name:"",props:{versionList:{type:Array,require:!0}},data:()=>({renderList:[],formData:{scriptVersionId:""}}),watch:{versionList:{handler(t){this.renderList=Object.freeze(t),this.formData.scriptVersionId=""},immediate:!0}},created(){this.rules={scriptVersionId:[{required:!0,message:n.default.t("script.脚本版本必填"),trigger:"blur"}]}},methods:{submit(){var t=this;return this.$refs.form.validate().then((function(){var e=(0,r.default)(t.renderList,(function(e){return e.scriptVersionId===t.formData.scriptVersionId}));t.$emit("on-create",e)}))},reset(){this.formData.scriptVersionId="",this.$refs.form.clearError()}}};e.Z=a},63665:function(t,e,i){"use strict";i(35927),i(45974),i(43364);var s=i(22696);Object.defineProperty(e,"X",{value:!0}),e.Z=void 0;var r=s(i(33610));i(87033),i(35948),i(94522),i(9042);var n=s(i(44068)),a=s(i(12e3)),o=i(41980),l=s(i(36894)),c=s(i(53823)),d=s(i(28877));function u(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,s)}return i}function p(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?u(Object(i),!0).forEach((function(e){(0,r.default)(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):u(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}var h={name:"",components:{JbEditInput:l.default,JbEditTag:c.default,JbEditTextarea:d.default},data:()=>({isLoading:!0,data:{}}),created(){this.publicScript=(0,o.checkPublicScript)(this.$route),this.serviceHandler=this.publicScript?a.default:n.default,this.scriptId=this.$route.params.id,this.fetchScriptBasic()},methods:{fetchScriptBasic(){var t=this;this.isLoading=!0,this.serviceHandler.fetchBasicInfo({id:this.scriptId}).then((function(e){t.data=Object.freeze(e),t.calcLableWidth()})).finally((function(){t.isLoading=!1}))},calcLableWidth(){this.$refs.wraper.querySelectorAll(".detail-column").forEach((function(t){var e=t.querySelectorAll(".item-label"),i=0;e.forEach((function(t){var e=t.getBoundingClientRect().width;i=Math.max(i,e)})),e.forEach((function(t){t.style.width="".concat(i+2,"px")}))}))},handleUpdateScript(t,e){return this.serviceHandler.scriptUpdateMeta(p(p({id:this.scriptId},e),{},{updateField:t}))}}};e.Z=h},65386:function(t,e,i){"use strict";i(35927),i(43364);var s=i(22696);Object.defineProperty(e,"X",{value:!0}),e.Z=void 0,i(23232),i(80433),i(85604),i(71959),i(87033),i(35948),i(94522),i(9042),i(56259),i(63762),i(95179),i(45974),i(47140),i(92974);var r=s(i(33610)),n=s(i(93435)),a=s(i(5068)),o=s(i(15399)),l=s(i(44068)),c=s(i(12e3)),d=s(i(46117)),u=s(i(68830)),p=s(i(2645)),h=s(i(80712)),f=s(i(93962)),v=i(41980),m=i(46790),b=s(i(78621)),y=s(i(98336)),g=s(i(65540)),w=s(i(45874)),_=s(i(16410)),C=s(i(23044)),S=s(i(66966)),I=s(i(49824));function k(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,s)}return i}function V(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?k(Object(i),!0).forEach((function(e){(0,r.default)(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):k(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}var D="script_version_list_columns",$={name:"ScriptVersion",components:{ListActionLayout:h.default,JbPopoverConfirm:f.default,JbSearchSelect:p.default,ScriptRelatedInfo:b.default,Diff:S.default,Layout:_.default,DetailScript:y.default,Edit:g.default,CopyCreate:w.default,ScriptBasic:C.default,NewVersion:I.default},data:()=>({isLoading:!1,isListFlod:!1,isShowNewVersion:!1,showDiff:!1,data:[],dataAppendList:[],scriptDetailInfo:{},tableHeight:"",selectedTableColumn:[],selectVersionId:"",choosedMap:{},showRelated:!1,relatedScriptInfo:[],displayCom:"",tableSize:"small"}),computed:{isSkeletonLoading(){return this.isLoading},curCom(){return this.displayCom?{detail:y.default,edit:g.default,copyCreate:w.default}[this.displayCom]:"div"},renderList(){return[...this.dataAppendList,...this.data]},isCopyCreateDisabled(){return!!(0,n.default)(this.dataMemo,(function(t){return t.isDraft}))},selectVersion(){var t=this,e=(0,n.default)(this.renderList,(function(e){return e.scriptVersionId===t.selectVersionId}));return e||{}},disableDiff(){return Object.keys(this.choosedMap).length<2},diffInfo(){var t=Object.keys(this.choosedMap);return{oldVersionId:parseInt(t[0],10)||"",newVersionId:parseInt(t[1],10)||""}},currentVersionName(){return this.dataMemo.length<1?"":this.dataMemo[0].name},allColumnMap(){return this.isListFlod?{version:!0,statusDesc:!0}:this.selectedTableColumn.reduce((function(t,e){return t[e.id]=!0,t}),{})}},watch:{displayCom(t){"copyCreate"!==t&&(this.dataAppendList=[])}},created(){this.lastSelectScriptVersionId="",this.dataMemo=[],this.publicScript=(0,v.checkPublicScript)(this.$route),this.serviceHandler=this.publicScript?c.default:l.default,this.scriptId=this.$route.params.id,this.fetchData(!0),this.searchSelect=[{name:o.default.t("script.版本号.colHead"),id:"version",default:!0},{name:o.default.t("script.更新人.colHead"),id:"lastModifyUser",remoteMethod:d.default.fetchUsersOfSearch,inputInclude:!0}],this.tableColumn=[{id:"scriptVersionId",label:o.default.t("script.版本 ID")},{id:"version",label:o.default.t("script.版本号.colHead"),disabled:!0},{id:"relatedTaskNum",label:o.default.t("script.被引用.colHead"),disabled:!0},{id:"lastModifyUser",label:o.default.t("script.更新人.colHead")},{id:"lastModifyTime",label:o.default.t("script.更新时间")},{id:"statusDesc",label:o.default.t("script.状态"),disabled:!0}];var t=m.listColumnsCache.getItem(D);t?(this.selectedTableColumn=Object.freeze(t.columns),this.tableSize=t.size):this.selectedTableColumn=Object.freeze([{id:"version"},{id:"relatedTaskNum"},{id:"lastModifyUser"},{id:"lastModifyTime"},{id:"statusDesc"}])},mounted(){var t=this;this.calcTableHeight(),window.addEventListener("resize",this.calcTableHeight),this.$once("hook:beforeDestroy",(function(){window.removeEventListener("resize",t.calcTableHeight)}))},methods:{fetchData(t){var e=this;return this.isLoading=!0,this.serviceHandler.scriptVersionList({id:this.scriptId},{permission:"page"}).then((function(i){e.dataMemo=Object.freeze([...i]),e.data=Object.freeze(i),t&&e.parseUrl()})).finally((function(){e.isLoading=!1}))},parseUrl(){var t=parseInt(this.$route.query.scriptVersionId,10);t&&this.handleShowDetail({scriptVersionId:t})},calcTableHeight(){var t=(0,v.getOffset)(this.$refs.list).top,e=window.innerHeight;this.tableHeight=e-t-20},rowClassName(t){return t.row.scriptVersionId===this.selectVersionId?"active":""},handlNewVersion(){var t=this;this.isCopyCreateDisabled?(this.newVersionPopperInstance||(this.newVersionPopperInstance=(0,a.default)(this.$refs.newVersion.$el,{arrow:!0,width:192,placement:"bottom-start",trigger:"manual",theme:"light",interactive:!0,animation:"slide-toggle",content:document.querySelector("#newVersionDisableActions"),boundary:"window",distance:20,zIndex:window.__bk_zIndex_manager.nextZIndex()}),this.$once("hook:beforeDestroy",(function(){t.newVersionPopperInstance.hide(),t.newVersionPopperInstance.destroy()}))),this.newVersionPopperInstance.show()):this.isShowNewVersion=!0},handleEditDraftVersion(){var t=(0,n.default)(this.dataMemo,(function(t){return t.isDraft}));this.handleEdit(t),this.newVersionPopperInstance.hide()},handleNewVersionClose(){this.newVersionPopperInstance&&this.newVersionPopperInstance.hide(),this.isShowNewVersion=!1},handleSearch(t){var e=this.dataMemo;Object.keys(t).forEach((function(i){var s=new RegExp((0,v.encodeRegexp)(t[i]));e=e.filter((function(t){return s.test(t[i])}))})),this.data=Object.freeze(e),this.handleLayoutFlod()},handleSortChange(t){if(t.prop){var e=t.prop;[...this.data].sort((function(i,s){return"descending"===t.order?i[e]-s[e]:s[e]-i[e]}))}},handleSettingChange(t){var e=t.fields,i=t.size;this.selectedTableColumn=Object.freeze(e),this.tableSize=i,m.listColumnsCache.setItem(D,{columns:e,size:i})},handleLayoutFlod(){this.displayCom="",this.isListFlod=!1,-1===this.selectVersionId&&this.handleCreateCancel(),this.selectVersionId=""},handleSelectionChange(t,e){e?this.choosedMap[t.scriptVersionId]=!0:delete this.choosedMap[t.scriptVersionId],this.choosedMap=V({},this.choosedMap)},handleShowDetail(t){var e=this;(0,v.leaveConfirm)().then((function(){e.selectVersionId=t.scriptVersionId,e.isListFlod=!0,e.displayCom="detail"}))},handleRowSelect(t){this.isListFlod&&this.handleShowDetail(t)},handleOffline(t,e){var i=this;return this.serviceHandler.scriptVersionOffline({id:t,versionId:e}).then((function(){i.messageSuccess(o.default.t("script.操作成功")),i.fetchData()}))},handleOnline(t,e){var i=this;return this.serviceHandler.scriptVersionOnline({id:t,versionId:e}).then((function(){i.messageSuccess(o.default.t("script.操作成功")),i.fetchData()}))},handleRemove(t){var e=this;return this.serviceHandler.scriptVersionRemove({versionId:t}).then((function(){e.messageSuccess(o.default.t("script.删除成功")),e.fetchData()}))},handleGoExce(t){this.$router.push({name:"fastExecuteScript",params:{taskInstanceId:0,scriptVersionId:t.scriptVersionId},query:{from:"scriptDetail"}})},handleSync(t){var e=this.publicScript?"scriptPublicSync":"scriptSync";this.$router.push({name:e,params:{scriptId:t.id,scriptVersionId:t.scriptVersionId}})},handleEdit(t){this.selectVersionId=t.scriptVersionId,this.displayCom="edit",this.isListFlod=!0,this.isShowNewVersion=!1},handleShowRelated(t){this.showRelated=!0,this.relatedScriptInfo=t},handlShowDiff(){this.showDiff=!0},handleDiffVersionChange(t){this.choosedMap=t},handleDiffClose(){this.showDiff=!1},handleScriptChangeSubmit(){this.fetchData()},handleDeleteSubmit(){this.handleLayoutFlod(),this.fetchData()},handleToggleCopyCreate(t){var e=t.scriptVersionId;this.selectVersionId=e;var i=(0,n.default)(this.dataMemo,(function(t){return t.scriptVersionId===e})),s=new u.default(V(V({},i),{},{scriptVersionId:-1,status:-1,version:(0,v.genDefaultScriptVersion)()}));this.isListFlod=!0,this.lastSelectScriptVersionId=this.selectVersionId,this.selectVersionId=-1,this.displayCom="copyCreate",this.dataAppendList=Object.freeze([s])},handleToggleEdit(){this.displayCom="edit"},handleCreateCancel(){this.displayCom="detail",this.selectVersionId=this.lastSelectScriptVersionId},handleCreateSubmit(t){var e=this,i=t.scriptVersionId;this.fetchData().then((function(){setTimeout((function(){e.displayCom="detail",e.selectVersionId=i}))}))},handleCreateValueChange(t,e){var i=[...this.dataAppendList],s=(0,n.default)(i,(function(e){return e.scriptVersionId===t}));s&&(Object.assign(s,e),this.dataAppendList=Object.freeze(i))},handleEditSubmit(){this.displayCom="detail",this.fetchData()},handleEditCancel(){this.displayCom="detail"},isRowSelectable(t){return!!this.disableDiff||this.choosedMap[t.scriptVersionId]},isRowChecked(t){return this.choosedMap[t.scriptVersionId]},renderHeader:(t,e)=>t("span",[t("span",[e.column.label]),t("bk-popover",[t("icon",{attrs:{type:"circle-italics-info"},style:"margin-left: 8px; font-size: 12px;"}),t("div",{slot:"content"},[t("div",[o.default.t("script.显示被作业引用的次数")]),t("div",[o.default.t("script.显示被执行方案引用的次数")])])])]),routerBack(){this.publicScript?this.$router.push({name:"publicScriptList"}):this.$router.push({name:"scriptList"})}}};e.Z=$},24620:function(){},8972:function(){},72269:function(){},18759:function(){},43125:function(){},45874:function(t,e,i){"use strict";i.r(e),i.d(e,{__esModule:function(){return r.X},default:function(){return o}});var s=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("layout",{staticClass:"script-manage-copy-create-box",scopedSlots:t._u([{key:"footer",fn:function(){return[i("bk-button",{directives:[{name:"test",rawName:"v-test",value:{type:"button",value:"copyCreateScriptSubmit"},expression:"{ type: 'button', value: 'copyCreateScriptSubmit' }"}],staticClass:"w120 mr10",attrs:{loading:t.isSubmiting,theme:"primary"},on:{click:t.handleSubmit}},[t._v("\n            "+t._s(t.$t("script.提交"))+"\n        ")]),t._v(" "),i("bk-button",{directives:[{name:"test",rawName:"v-test",value:{type:"button",value:"debugScript"},expression:"{ type: 'button', value: 'debugScript' }"}],staticClass:"mr10",on:{click:t.handleDebugScript}},[t._v("\n            "+t._s(t.$t("script.调试"))+"\n        ")]),t._v(" "),i("bk-button",{directives:[{name:"test",rawName:"v-test",value:{type:"button",value:"copyCreateScriptCancel"},expression:"{ type: 'button', value: 'copyCreateScriptCancel' }"}],on:{click:t.handleCancel}},[t._v("\n            "+t._s(t.$t("script.取消"))+"\n        ")])]},proxy:!0}])},[i("div",{attrs:{slot:"title"},slot:"title"},[t._v(t._s(t.$t("script.新建脚本")))]),t._v(" "),i("template",{slot:"sub-header"},[i("Icon",{directives:[{name:"bk-tooltips",rawName:"v-bk-tooltips",value:t.$t("上传脚本"),expression:"$t('上传脚本')"},{name:"test",rawName:"v-test",value:{type:"button",value:"uploadScript"},expression:"{ type: 'button', value: 'uploadScript' }"}],attrs:{type:"upload"},on:{click:t.handleUploadScript}}),t._v(" "),i("Icon",{directives:[{name:"bk-tooltips",rawName:"v-bk-tooltips",value:t.$t("历史缓存"),expression:"$t('历史缓存')"},{name:"test",rawName:"v-test",value:{type:"button",value:"scriptEditHistory"},expression:"{ type: 'button', value: 'scriptEditHistory' }"}],attrs:{type:"history"},on:{click:function(e){return e.stopPropagation(),t.handleShowHistory.apply(null,arguments)}}}),t._v(" "),i("Icon",{directives:[{name:"bk-tooltips",rawName:"v-bk-tooltips",value:t.$t("全屏"),expression:"$t('全屏')"},{name:"test",rawName:"v-test",value:{type:"button",value:"scriptEditFullscreen"},expression:"{ type: 'button', value: 'scriptEditFullscreen' }"}],attrs:{type:"full-screen"},on:{click:t.handleFullScreen}})],1),t._v(" "),i("div",{attrs:{slot:"left"},slot:"left"},[i("jb-form",{directives:[{name:"test",rawName:"v-test",value:{type:"form",value:"copyCreateScript"},expression:"{ type: 'form', value: 'copyCreateScript' }"}],ref:"form",attrs:{model:t.formData,"form-type":"vertical",rules:t.rules}},[i("jb-form-item",{attrs:{label:t.$t("script.版本号.label"),required:"",property:"version"}},[i("div",{staticClass:"script-version"},[i("jb-input",{attrs:{value:t.formData.version,placeholder:t.$t("script.输入版本号"),maxlength:30,property:"version"},on:{change:t.handleVersionChange}}),t._v(" "),i("Icon",{staticClass:"new-flag",attrs:{type:"new-dark",svg:""}})],1)]),t._v(" "),i("jb-form-item",{attrs:{label:t.$t("script.版本日志")}},[i("bk-input",{attrs:{type:"textarea",maxlength:100,rows:5},model:{value:t.formData.versionDesc,callback:function(e){t.$set(t.formData,"versionDesc",e)},expression:"formData.versionDesc"}})],1)],1)],1),t._v(" "),i("div",{ref:"content"},[t.contentHeight>0?i("ace-editor",{ref:"aceEditor",attrs:{lang:t.formData.typeName,height:t.contentHeight,options:t.formData.typeName},on:{"on-mode-change":t.handleTypeChange},model:{value:t.formData.content,callback:function(e){t.$set(t.formData,"content",e)},expression:"formData.content"}}):t._e()],1)],2)};s._withStripped=!0;var r=i(82287),n=r.Z,a=(i(30790),(0,i(35471).Z)(n,s,[],!1,null,null,null));a.options.__file="src/views/script-manage/common/copy-create.vue";var o=a.exports},65540:function(t,e,i){"use strict";i.r(e),i.d(e,{__esModule:function(){return r.X},default:function(){return o}});var s=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("layout",{scopedSlots:t._u([{key:"footer",fn:function(){return[i("bk-button",{directives:[{name:"test",rawName:"v-test",value:{type:"button",value:"editScriptSubmit"},expression:"{ type: 'button', value: 'editScriptSubmit' }"}],staticClass:"w120 mr10",attrs:{theme:"primary",loading:t.isSubmiting},on:{click:t.handleSubmit}},[t._v("\n            "+t._s(t.$t("script.提交"))+"\n        ")]),t._v(" "),i("bk-button",{directives:[{name:"test",rawName:"v-test",value:{type:"button",value:"debugScript"},expression:"{ type: 'button', value: 'debugScript' }"}],staticClass:"mr10",on:{click:t.handleDebugScript}},[t._v("\n            "+t._s(t.$t("script.调试"))+"\n        ")]),t._v(" "),i("bk-button",{directives:[{name:"test",rawName:"v-test",value:{type:"button",value:"editScriptCancel"},expression:"{ type: 'button', value: 'editScriptCancel' }"}],on:{click:t.handleCancel}},[t._v("\n            "+t._s(t.$t("script.取消"))+"\n        ")])]},proxy:!0}])},[i("div",{attrs:{slot:"title"},slot:"title"},[t._v(t._s(t.$t("script.编辑脚本")))]),t._v(" "),i("template",{slot:"sub-header"},[i("Icon",{directives:[{name:"bk-tooltips",rawName:"v-bk-tooltips",value:t.$t("上传脚本"),expression:"$t('上传脚本')"},{name:"test",rawName:"v-test",value:{type:"button",value:"uploadScript"},expression:"{ type: 'button', value: 'uploadScript' }"}],attrs:{type:"upload"},on:{click:t.handleUploadScript}}),t._v(" "),i("Icon",{directives:[{name:"bk-tooltips",rawName:"v-bk-tooltips",value:t.$t("历史缓存"),expression:"$t('历史缓存')"},{name:"test",rawName:"v-test",value:{type:"button",value:"scriptEditHistory"},expression:"{ type: 'button', value: 'scriptEditHistory' }"}],attrs:{type:"history"},on:{click:function(e){return e.stopPropagation(),t.handleShowHistory.apply(null,arguments)}}}),t._v(" "),i("Icon",{directives:[{name:"bk-tooltips",rawName:"v-bk-tooltips",value:t.$t("全屏"),expression:"$t('全屏')"},{name:"test",rawName:"v-test",value:{type:"button",value:"scriptEditFullscreen"},expression:"{ type: 'button', value: 'scriptEditFullscreen' }"}],attrs:{type:"full-screen"},on:{click:t.handleFullScreen}})],1),t._v(" "),i("div",{attrs:{slot:"left"},slot:"left"},[i("jb-form",{directives:[{name:"test",rawName:"v-test",value:{type:"form",value:"editScript"},expression:"{ type: 'form', value: 'editScript' }"}],ref:"form",staticClass:"edit-script-form",attrs:{model:t.formData,rules:t.rules,"form-type":"vertical"}},[i("jb-form-item",{attrs:{label:t.$t("script.版本号.label"),required:""}},[i("bk-input",{attrs:{value:t.formData.version,readonly:""}})],1),t._v(" "),i("jb-form-item",{attrs:{label:t.$t("script.版本日志")}},[i("bk-input",{attrs:{type:"textarea",rows:5,maxlength:100},model:{value:t.formData.versionDesc,callback:function(e){t.$set(t.formData,"versionDesc",e)},expression:"formData.versionDesc"}})],1)],1)],1),t._v(" "),i("div",{ref:"content"},[i("ace-editor",{ref:"aceEditor",attrs:{lang:t.formData.typeName,height:t.contentHeight,readonly:!t.scriptInfo.isDraft,options:t.formData.typeName},model:{value:t.formData.content,callback:function(e){t.$set(t.formData,"content",e)},expression:"formData.content"}})],1)],2)};s._withStripped=!0;var r=i(87161),n=r.Z,a=(0,i(35471).Z)(n,s,[],!1,null,null,null);a.options.__file="src/views/script-manage/common/edit.vue";var o=a.exports},66966:function(t,e,i){"use strict";i.r(e),i.d(e,{__esModule:function(){return r.X},default:function(){return o}});var s=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"jb-diff-layout",style:{"z-index":t.zIndex}},[i("div",{staticClass:"header"},[i("div",{staticClass:"title"},[t._v(t._s(t.title))]),t._v(" "),i("div",{staticClass:"diff-info"},[i("div",{staticClass:"diff-del",on:{click:t.handleViewDel}},[i("span",{staticClass:"before"}),t._v(" "),i("span",{staticClass:"after"}),t._v(" "),i("span",[t._v(t._s(t.$t("删除"))+"（"+t._s(t.del)+"）")])]),t._v(" "),i("div",{staticClass:"diff-change",on:{click:t.handleViewChange}},[i("span",{staticClass:"before"}),t._v(" "),i("span",{staticClass:"after"}),t._v(" "),i("span",[t._v(t._s(t.$t("变换"))+"（"+t._s(t.change)+"）")])]),t._v(" "),i("div",{staticClass:"diff-ins",on:{click:t.handleViewIns}},[i("span",{staticClass:"before"}),t._v(" "),i("span",{staticClass:"after"}),t._v(" "),i("span",[t._v(t._s(t.$t("新增.diff"))+"（"+t._s(t.ins)+"）")])])])]),t._v(" "),i("div",{staticClass:"version-select-layout"},[i("div",{staticClass:"version-left"},[i("bk-select",{staticClass:"version-selector",attrs:{clearable:!1},model:{value:t.oldVersion,callback:function(e){t.oldVersion=e},expression:"oldVersion"}},t._l(t.data,(function(e){return i("bk-option",{key:e.scriptVersionId,attrs:{id:e.scriptVersionId,name:e.version,disabled:e.scriptVersionId===t.oldVersionId}})})),1)],1),t._v(" "),i("div",{staticClass:"version-right"},[i("bk-select",{staticClass:"version-selector",attrs:{clearable:!1},model:{value:t.newVersion,callback:function(e){t.newVersion=e},expression:"newVersion"}},t._l(t.data,(function(e){return i("bk-option",{key:e.scriptVersionId,attrs:{id:e.scriptVersionId,name:e.version,disabled:e.scriptVersionId===t.newVersionId}})})),1)],1)]),t._v(" "),i("scroll-faker",{staticClass:"content-wraper"},[i("jb-diff",{ref:"diff",staticClass:"diff-details",attrs:{format:"side-by-side",theme:"dark",language:t.language,context:1/0,"old-content":t.oldContent,"new-content":t.newContent}})],1),t._v(" "),i("i",{staticClass:"bk-icon icon-close",on:{click:t.handleClose}})],1)};s._withStripped=!0;var r=i(57634),n=r.Z,a=(i(77402),(0,i(35471).Z)(n,s,[],!1,null,null,null));a.options.__file="src/views/script-manage/version/components/diff.vue";var o=a.exports},16410:function(t,e,i){"use strict";i.r(e),i.d(e,{__esModule:function(){return r.X},default:function(){return o}});var s=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{ref:"layout",staticClass:"script-version-page-layout",class:{"is-flod":t.flod,toggled:t.isOpen}},[i("div",{staticClass:"layout-left"},[i("div",{staticClass:"left-wraper",style:t.styles},[t._t("default")],2),t._v(" "),t.isShowRight?i("div",{staticClass:"toggle-button",on:{click:t.handleToggle}},[i("Icon",{staticClass:"toggle-arrow",attrs:{type:"down-small"}})],1):t._e()]),t._v(" "),t.flod?i("div",{staticClass:"layout-right",style:t.rightStyles},[i("div",{staticClass:"right-wraper",class:{active:t.isShowRight}},[t.isShowRight?t._t("flod"):t._e()],2),t._v(" "),i("div",{staticClass:"close-btn",on:{click:t.handleClose}},[i("Icon",{attrs:{type:"close-big"}})],1)]):t._e()])};s._withStripped=!0;var r=i(39902),n=r.Z,a=(i(53413),(0,i(35471).Z)(n,s,[],!1,null,null,null));a.options.__file="src/views/script-manage/version/components/layout.vue";var o=a.exports},49824:function(t,e,i){"use strict";i.r(e),i.d(e,{__esModule:function(){return r.X},default:function(){return o}});var s=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"script-manage-new-version"},[i("jb-form",{ref:"form",attrs:{"form-type":"vertical",model:t.formData,rules:t.rules}},[i("jb-form-item",{staticStyle:{"margin-bottom":"0"},attrs:{label:t.$t("script.选择载入版本"),required:"",property:"scriptVersionId"}},[i("bk-select",{model:{value:t.formData.scriptVersionId,callback:function(e){t.$set(t.formData,"scriptVersionId",e)},expression:"formData.scriptVersionId"}},t._l(t.renderList,(function(e){return i("bk-option",{key:e.scriptVersionId,attrs:{id:e.scriptVersionId,name:e.version}},[i("span",[t._v(t._s(e.version))]),t._v(" "),i("span",{domProps:{innerHTML:t._s(e.statusHtml)}})])})),1)],1)],1)],1)};s._withStripped=!0;var r=i(76824),n=r.Z,a=(0,i(35471).Z)(n,s,[],!1,null,null,null);a.options.__file="src/views/script-manage/version/components/new-version.vue";var o=a.exports},23044:function(t,e,i){"use strict";i.r(e),i.d(e,{__esModule:function(){return r.X},default:function(){return o}});var s=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:t.isLoading},expression:"{ isLoading }"}],ref:"wraper",staticClass:"script-version-basic-box"},[t.data.id?[i("div",{staticClass:"script-type-flag"},[i("img",{attrs:{src:"/static/images/script/"+t.data.typeName+".svg"}})]),t._v(" "),i("div",{staticClass:"detail-column",staticStyle:{width:"270px"}},[i("div",{staticClass:"detail-col"},[i("div",{staticClass:"item-label"},[t._v(t._s(t.$t("script.脚本名：")))]),t._v(" "),i("div",{staticClass:"item-value"},[i("auth-component",{attrs:{auth:"script/edit","resource-id":t.data.id}},[i("jb-edit-input",{staticStyle:{width:"100%"},attrs:{field:"scriptName",value:t.data.name,"remote-hander":function(e){return t.handleUpdateScript("scriptName",e)}}}),t._v(" "),i("div",{attrs:{slot:"forbid"},slot:"forbid"},[t._v(t._s(t.data.name))])],1)],1)]),t._v(" "),i("div",{staticClass:"detail-col"},[i("div",{staticClass:"item-label"},[t._v(t._s(t.$t("script.更新人：")))]),t._v(" "),i("div",{staticClass:"item-value"},[i("div",{directives:[{name:"bk-overflow-tips",rawName:"v-bk-overflow-tips"}],staticClass:"text-box"},[t._v(t._s(t.data.lastModifyUser))])])]),t._v(" "),i("div",{staticClass:"detail-col"},[i("div",{staticClass:"item-label"},[t._v(t._s(t.$t("script.创建人：")))]),t._v(" "),i("div",{staticClass:"item-value"},[i("div",{directives:[{name:"bk-overflow-tips",rawName:"v-bk-overflow-tips"}],staticClass:"text-box"},[t._v(t._s(t.data.creator))])])])]),t._v(" "),i("div",{staticClass:"detail-column",staticStyle:{width:"282px"}},[i("div",{staticClass:"detail-col"},[i("div",{staticClass:"item-label"},[t._v(t._s(t.$t("script.脚本语言：")))]),t._v(" "),i("div",{staticClass:"item-value"},[i("div",{staticClass:"text-box"},[t._v(t._s(t.data.typeName))])])]),t._v(" "),i("div",{staticClass:"detail-col"},[i("div",{staticClass:"item-label"},[t._v(t._s(t.$t("script.更新时间：")))]),t._v(" "),i("div",{staticClass:"item-value"},[i("div",{directives:[{name:"bk-overflow-tips",rawName:"v-bk-overflow-tips"}],staticClass:"text-box"},[t._v(t._s(t.data.lastModifyTime))])])]),t._v(" "),i("div",{staticClass:"detail-col"},[i("div",{staticClass:"item-label"},[t._v(t._s(t.$t("script.创建时间：")))]),t._v(" "),i("div",{directives:[{name:"bk-overflow-tips",rawName:"v-bk-overflow-tips"}],staticClass:"item-value"},[i("div",{staticClass:"text-box"},[t._v(t._s(t.data.createTime))])])])]),t._v(" "),i("div",{staticClass:"detail-column last"},[i("div",{staticClass:"detail-col"},[i("div",{staticClass:"item-label"},[t._v(t._s(t.$t("script.场景标签：")))]),t._v(" "),i("div",{staticClass:"item-value"},[i("auth-component",{attrs:{auth:"script/edit","resource-id":t.data.id}},[i("jb-edit-tag",{staticClass:"input",attrs:{field:"scriptTags",rows:1,value:t.data.tags,"remote-hander":function(e){return t.handleUpdateScript("scriptTags",e)}}}),t._v(" "),i("div",{attrs:{slot:"forbid"},slot:"forbid"},[t._v(t._s(t.data.tagText))])],1)],1)]),t._v(" "),i("div",{staticClass:"detail-col"},[i("div",{staticClass:"item-label"},[t._v(t._s(t.$t("script.脚本描述：")))]),t._v(" "),i("div",{staticClass:"item-value"},[i("jb-edit-textarea",{attrs:{field:"scriptDesc","single-row-render":"",placeholder:t.$t("script.在此处标注该脚本的备注和使用说明"),maxlength:500,rows:1,value:t.data.description,"remote-hander":function(e){return t.handleUpdateScript("scriptDesc",e)}}})],1)])])]:t._e()],2)};s._withStripped=!0;var r=i(63665),n=r.Z,a=(i(37395),(0,i(35471).Z)(n,s,[],!1,null,null,null));a.options.__file="src/views/script-manage/version/components/script-basic.vue";var o=a.exports},50238:function(t,e,i){"use strict";i.r(e),i.d(e,{__esModule:function(){return r.X},default:function(){return o}});var s=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"script-manage-version-page"},[i("script-basic"),t._v(" "),i("div",{staticClass:"version-list-wraper"},[i("list-action-layout",{scopedSlots:t._u([{key:"right",fn:function(){return[i("jb-search-select",{staticStyle:{width:"420px"},attrs:{data:t.searchSelect,placeholder:t.$t("script.直接输入 版本号 或 更新人 进行全局模糊搜索"),"show-condition":!1},on:{"on-change":t.handleSearch}})]},proxy:!0}])},[i("bk-button",{ref:"newVersion",on:{click:t.handlNewVersion}},[t._v("\n                "+t._s(t.$t("script.新建版本"))+"\n            ")]),t._v(" "),i("bk-button",{attrs:{disabled:t.disableDiff},on:{click:t.handlShowDiff}},[t._v("\n                "+t._s(t.$t("script.版本对比"))+"\n            ")])],1),t._v(" "),i("div",{ref:"list"},[i("layout",{attrs:{flod:t.isListFlod},on:{"on-flod":t.handleLayoutFlod}},[t.tableHeight?i("bk-table",{staticClass:"script-version-list",attrs:{data:t.renderList,"outer-border":!1,"max-height":t.tableHeight,size:t.tableSize,"row-class-name":t.rowClassName},on:{"row-click":t.handleRowSelect,"sort-change":t.handleSortChange}},[i("bk-table-column",{key:"selection",attrs:{width:"47",align:"center",resizable:!1},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.row;return[i("bk-checkbox",{attrs:{disabled:!t.isRowSelectable(s),checked:t.isRowChecked(s)},on:{change:function(e){return t.handleSelectionChange(s,e)}}})]}}],null,!1,1429060344)}),t._v(" "),t.allColumnMap.scriptVersionId?i("bk-table-column",{key:"scriptVersionId",attrs:{label:t.$t("script.版本 ID"),prop:"scriptVersionId",align:"left",width:"100"}}):t._e(),t._v(" "),t.allColumnMap.version?i("bk-table-column",{key:"version",attrs:{label:t.$t("script.版本号.colHead"),prop:"version",align:"left","show-overflow-tooltip":"",sortable:!0},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.row;return[i("a",{on:{click:function(e){return t.handleShowDetail(s)}}},[t._v(t._s(s.version||"--"))])]}}],null,!1,1975994852)}):t._e(),t._v(" "),t.allColumnMap.relatedTaskNum?i("bk-table-column",{key:"relatedTaskNum",attrs:{label:t.$t("script.被引用.colHead"),prop:"relatedTaskNum","render-header":t.renderHeader,align:"right",width:"150"},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.row;return[i("bk-button",{directives:[{name:"bk-tooltips",rawName:"v-bk-tooltips.allowHtml",value:"\n                                <div>"+t.$t("script.作业模板引用")+": "+s.relatedTaskTemplateNum+"</div>\n                                <div>"+t.$t("script.执行方案引用")+": "+s.relatedTaskPlanNum+"</div>",expression:"`\n                                <div>${$t('script.作业模板引用')}: ${row.relatedTaskTemplateNum}</div>\n                                <div>${$t('script.执行方案引用')}: ${row.relatedTaskPlanNum}</div>`",modifiers:{allowHtml:!0}}],staticClass:"mr20",attrs:{text:""},on:{click:function(e){return t.handleShowRelated(s)}}},[i("span",[t._v("\n                                    "+t._s(s.relatedTaskTemplateNum)+"\n                                ")]),t._v(" "),i("span",[t._v(" / ")]),t._v(" "),i("span",[t._v("\n                                    "+t._s(s.relatedTaskPlanNum)+"\n                                ")])])]}}],null,!1,152096840)}):t._e(),t._v(" "),t.allColumnMap.lastModifyUser?i("bk-table-column",{key:"lastModifyUser",attrs:{label:t.$t("script.更新人.colHead"),prop:"lastModifyUser",align:"left",width:"160"}}):t._e(),t._v(" "),t.allColumnMap.lastModifyTime?i("bk-table-column",{key:"lastModifyTime",attrs:{label:t.$t("script.更新时间"),prop:"lastModifyTime",align:"left",width:"200",sortable:!0}}):t._e(),t._v(" "),t.allColumnMap.statusDesc?i("bk-table-column",{key:"statusDesc",attrs:{label:t.$t("script.状态"),prop:"statusDesc",align:"left",width:"120",sortable:!0},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.row;return[i("span",{domProps:{innerHTML:t._s(s.statusHtml)}}),t._v(" "),i("Icon",{directives:[{name:"show",rawName:"v-show",value:s.scriptVersionId===t.selectVersionId,expression:"row.scriptVersionId === selectVersionId"}],staticClass:"select-flag",attrs:{type:"arrow-full-right"}})]}}],null,!1,2485370968)}):t._e(),t._v(" "),t.isListFlod?t._e():i("bk-table-column",{key:"action",attrs:{label:t.$t("script.操作"),prop:"action",align:"left",width:"200"},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.row;return i("div",{on:{click:function(t){t.stopPropagation()}}},[s.isOnline?t._e():i("jb-popover-confirm",{staticClass:"mr10",attrs:{title:t.$t("script.确定上线该版本？"),content:t.$t("script.上线后，之前的线上版本将被置为「已下线」状态，但不影响作业使用"),disabled:s.isDisabledOnline,"confirm-handler":function(){return t.handleOnline(s.id,s.scriptVersionId)}}},[i("auth-button",{attrs:{permission:s.canManage,"resource-id":s.id,auth:"script/edit",disabled:s.isDisabledOnline,text:""}},[t._v("\n                                    "+t._s(t.$t("script.上线"))+"\n                                ")])],1),t._v(" "),s.isOnline?i("jb-popover-confirm",{staticClass:"mr10",attrs:{title:t.$t("script.确定禁用该版本？"),content:t.$t("script.一旦禁用成功，线上引用该版本的作业脚本步骤都会执行失败，请务必谨慎操作！"),"confirm-handler":function(){return t.handleOffline(s.id,s.scriptVersionId)}}},[i("auth-button",{attrs:{permission:s.canManage,"resource-id":s.id,auth:"script/edit",text:""}},[t._v("\n                                    "+t._s(t.$t("script.禁用"))+"\n                                ")])],1):t._e(),t._v(" "),s.isDraft?i("auth-button",{staticClass:"mr10",attrs:{permission:s.canManage,"resource-id":s.id,auth:"script/edit",text:""},on:{click:function(e){return t.handleEdit(s)}}},[t._v("\n                                "+t._s(t.$t("script.编辑"))+"\n                            ")]):t._e(),t._v(" "),s.isDraft?t._e():i("span",{staticClass:"mr10",attrs:{"tippy-tips":t.isCopyCreateDisabled?t.$t("script.已有[未上线]版本"):""}},[i("auth-button",{attrs:{permission:s.canClone,"resource-id":s.id,auth:"script/clone",disabled:t.isCopyCreateDisabled,text:""},on:{click:function(e){return t.handleToggleCopyCreate(s)}}},[t._v("\n                                    "+t._s(t.$t("script.复制并新建"))+"\n                                ")])],1),t._v(" "),s.isOnline?i("auth-button",{attrs:{text:"",permission:s.canManage,auth:"script/execute","resource-id":s.id,disabled:s.isExecuteDisable},on:{click:function(e){return t.handleGoExce(s)}}},[t._v("\n                                "+t._s(t.$t("script.去执行"))+"\n                            ")]):t._e(),t._v(" "),i("span",{attrs:{"tippy-tips":s.syncEnabled?"":t.$t("script.所有关联作业模板已是当前版本")}},[s.isOnline?i("auth-button",{staticClass:"ml10",attrs:{permission:s.canManage,"resource-id":s.id,auth:"script/edit",disabled:!s.syncEnabled,text:""},on:{click:function(e){return t.handleSync(s)}}},[t._v("\n                                    "+t._s(t.$t("script.同步"))+"\n                                ")]):t._e()],1),t._v(" "),s.isVersionEnableRemove?i("jb-popover-confirm",{attrs:{title:t.$t("script.确定删除该版本？"),content:t.$t("script.删除后不可恢复，请谨慎操作！"),"confirm-handler":function(){return t.handleRemove(s.scriptVersionId)}}},[i("auth-button",{attrs:{permission:s.canManage,"resource-id":s.id,auth:"script/delete",text:""}},[t._v("\n                                    "+t._s(t.$t("script.删除"))+"\n                                ")])],1):t._e()],1)}}],null,!1,2314070831)}),t._v(" "),i("bk-table-column",{attrs:{type:"setting"}},[i("bk-table-setting-content",{attrs:{fields:t.tableColumn,selected:t.selectedTableColumn,size:t.tableSize},on:{"setting-change":t.handleSettingChange}})],1)],1):t._e(),t._v(" "),i("template",{slot:"flod"},[i(t.curCom,{tag:"component",attrs:{"script-version-list":t.data,"script-info":t.selectVersion},on:{"on-edit-change":t.handleScriptChangeSubmit,"on-go-copy-create":t.handleToggleCopyCreate,"on-go-edit":t.handleToggleEdit,"on-delete":t.handleDeleteSubmit,"on-create-change":t.handleCreateValueChange,"on-create":t.handleCreateSubmit,"on-create-cancel":t.handleCreateCancel,"on-edit":t.handleEditSubmit,"on-edit-cancel":t.handleEditCancel}})],1)],2)],1)],1),t._v(" "),i("div",{staticStyle:{display:"none"}},[i("div",{staticStyle:{padding:"16px 12px"},attrs:{id:"newVersionDisableActions"}},[i("div",{staticStyle:{"margin-bottom":"17px","font-size":"14px","line-height":"22px",color:"#313238"}},[t._v("\n                "+t._s(t.$t("script.已有[未上线]版本"))+"\n            ")]),t._v(" "),i("div",[i("bk-button",{staticStyle:{"margin-right":"8px"},attrs:{theme:"primary",size:"small"},on:{click:t.handleEditDraftVersion}},[t._v("\n                    "+t._s(t.$t("script.前往编辑"))+"\n                ")]),t._v(" "),i("bk-button",{attrs:{size:"small"},on:{click:t.handleNewVersionClose}},[t._v("\n                    "+t._s(t.$t("script.取消"))+"\n                ")])],1)])]),t._v(" "),t.currentVersionName?i("element-teleport",[i("span",[t._v(" - "+t._s(t.currentVersionName))])]):t._e(),t._v(" "),t.showDiff?i("Diff",{attrs:{title:t.$t("script.版本对比"),data:t.dataMemo,"old-version-id":t.diffInfo.oldVersionId,"new-version-id":t.diffInfo.newVersionId},on:{"on-change":t.handleDiffVersionChange,close:t.handleDiffClose}}):t._e(),t._v(" "),i("jb-sideslider",{attrs:{"is-show":t.showRelated,"show-footer":!1,"quick-close":"",title:t.$t("script.被引用.label"),width:695},on:{"update:isShow":function(e){t.showRelated=e},"update:is-show":function(e){t.showRelated=e}}},[i("script-related-info",{attrs:{info:t.relatedScriptInfo,mode:"scriptVersionList"}})],1),t._v(" "),i("jb-dialog",{attrs:{"header-position":"left",title:t.$t("script.新建版本"),"ok-text":t.$t("script.确定"),"mask-close":!1,width:480},model:{value:t.isShowNewVersion,callback:function(e){t.isShowNewVersion=e},expression:"isShowNewVersion"}},[i("new-version",{attrs:{"version-list":t.data},on:{"on-close":t.handleNewVersionClose,"on-create":t.handleToggleCopyCreate}})],1)],1)};s._withStripped=!0;var r=i(65386),n=r.Z,a=(i(65008),(0,i(35471).Z)(n,s,[],!1,null,null,null));a.options.__file="src/views/script-manage/version/index.vue";var o=a.exports},30790:function(t,e,i){var s=i(24620);s.__esModule&&(s=s.default),"string"==typeof s&&(s=[[t.id,s,""]]),s.locals&&(t.exports=s.locals);(0,i(13570).Z)("1e28ab96",s,!1,{})},77402:function(t,e,i){var s=i(8972);s.__esModule&&(s=s.default),"string"==typeof s&&(s=[[t.id,s,""]]),s.locals&&(t.exports=s.locals);(0,i(13570).Z)("0b614b9a",s,!1,{})},53413:function(t,e,i){var s=i(72269);s.__esModule&&(s=s.default),"string"==typeof s&&(s=[[t.id,s,""]]),s.locals&&(t.exports=s.locals);(0,i(13570).Z)("387a3d93",s,!1,{})},37395:function(t,e,i){var s=i(18759);s.__esModule&&(s=s.default),"string"==typeof s&&(s=[[t.id,s,""]]),s.locals&&(t.exports=s.locals);(0,i(13570).Z)("681ae15a",s,!1,{})},65008:function(t,e,i){var s=i(43125);s.__esModule&&(s=s.default),"string"==typeof s&&(s=[[t.id,s,""]]),s.locals&&(t.exports=s.locals);(0,i(13570).Z)("b5f9c6b2",s,!1,{})}}]);