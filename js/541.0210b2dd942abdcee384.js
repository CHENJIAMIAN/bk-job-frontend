(self.webpackChunkjob=self.webpackChunkjob||[]).push([[541],{26987:function(t,e,r){"use strict";var a=r(22696);Object.defineProperty(e,"X",{value:!0}),e.Z=void 0,r(87033),r(35948),r(94522);var i=a(r(15399)),s=a(r(44068)),n=a(r(12e3)),o=r(41980),c=r(61681),l=a(r(86234)),p=a(r(45673)),u=a(r(15578)),m={name:"",components:{AceEditor:p.default,JbTagSelect:u.default,JbInput:l.default},data:()=>({isContentLoading:!1,isSbumiting:!1,scriptType:"Shell",contentHeight:480,formData:{name:"",tags:[],description:"",version:"",type:1,content:""}}),created(){var t=this;this.publicScript=(0,o.checkPublicScript)(this.$route),this.serviceHandler=this.publicScript?n.default:s.default,this.rules={name:[{required:!0,message:i.default.t("script.脚本名称必填"),trigger:"blur"},{validator:c.scriptNameRule.validator,message:c.scriptNameRule.message,trigger:"blur"}],version:[{required:!0,message:i.default.t("script.脚本版本必填"),trigger:"blur"},{validator:c.scriptVersionRule.validator,message:c.scriptVersionRule.message,trigger:"blur"}],desc:[{max:200,message:i.default.t("script.最多仅可 200个字符"),trigger:"blur"}],content:[{required:!0,message:i.default.t("script.脚本内容不能为空"),trigger:"change"},{validator:function(e){return s.default.getScriptValidation({content:e,scriptType:t.formData.type}).then((function(e){return t.$store.commit("setScriptCheckError",e.some((function(t){return t.isDangerous}))),!0}))},message:i.default.t("script.脚本内容检测失败"),trigger:"blur"}]}},mounted(){this.init()},methods:{init(){var t=(0,o.getOffset)(this.$refs.content).top,e=window.innerHeight-t+20;this.contentHeight=e>480?e:480},handleTypeChange(t){this.scriptType=t,this.formData.type=(0,o.formatScriptTypeValue)(t)},handleSubmit(){var t=this;this.isSbumiting=!0,this.$refs.form.validate().then((function(){if(!t.$store.state.scriptCheckError)return t.serviceHandler.scriptUpdate(t.formData).then((function(e){window.changeAlert=!1,t.messageSuccess(i.default.t("script.操作成功"),(function(){t.$router.push({name:t.publicScript?"publicScriptVersion":"scriptVersion",params:{id:e.id},query:{scriptVersionId:e.scriptVersionId}})}))}));(0,o.scriptErrorAlert)()})).finally((function(){t.isSbumiting=!1}))},handleCancel(){this.routerBack()},routerBack(){this.publicScript?this.$router.push({name:"publicScriptList"}):this.$router.push({name:"scriptList"})}}};e.Z=m},84460:function(){},541:function(t,e,r){"use strict";r.r(e),r.d(e,{__esModule:function(){return i.X},default:function(){return o}});var a=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("smart-action",{staticClass:"create-script-page",attrs:{"offset-target":"bk-form-content"},scopedSlots:t._u([{key:"action",fn:function(){return[r("bk-button",{staticClass:"w120 mr10",attrs:{loading:t.isSbumiting,theme:"primary"},on:{click:t.handleSubmit}},[t._v("\n            "+t._s(t.$t("script.提交"))+"\n        ")]),t._v(" "),r("bk-button",{attrs:{theme:"default"},on:{click:t.handleCancel}},[t._v("\n            "+t._s(t.$t("script.取消"))+"\n        ")])]},proxy:!0}])},[r("jb-form",{directives:[{name:"test",rawName:"v-test",value:{type:"form",value:"create_script"},expression:"{ type: 'form', value: 'create_script' }"}],ref:"form",attrs:{model:t.formData,rules:t.rules}},[r("jb-form-item",{attrs:{label:t.$t("script.脚本名称.label"),required:"",property:"name"}},[r("div",{staticClass:"script-name input"},[r("jb-input",{attrs:{placeholder:t.$t("script.推荐按照该脚本逻辑提供的使用场景来取名..."),maxlength:60},model:{value:t.formData.name,callback:function(e){t.$set(t.formData,"name",e)},expression:"formData.name"}})],1)]),t._v(" "),r("jb-form-item",{attrs:{label:t.$t("script.场景标签.label"),property:"tags"}},[r("jb-tag-select",{staticClass:"input",attrs:{placeholder:t.$t("script.标签对资源的分类管理有很大帮助")},model:{value:t.formData.tags,callback:function(e){t.$set(t.formData,"tags",e)},expression:"formData.tags"}})],1),t._v(" "),r("jb-form-item",{attrs:{label:t.$t("script.描述")}},[r("bk-input",{staticClass:"input",attrs:{placeholder:t.$t("script.在此处标注该脚本的备注和使用说明"),type:"textarea",maxlength:200},model:{value:t.formData.description,callback:function(e){t.$set(t.formData,"description",e)},expression:"formData.description"}})],1),t._v(" "),r("jb-form-item",{attrs:{label:t.$t("script.版本号.label"),required:"",property:"version"}},[r("jb-input",{staticClass:"input",attrs:{placeholder:t.$t("script.输入版本号"),maxlength:30},model:{value:t.formData.version,callback:function(e){t.$set(t.formData,"version",e)},expression:"formData.version"}})],1),t._v(" "),r("jb-form-item",{attrs:{label:t.$t("script.脚本内容"),required:"",property:"content"}},[r("div",{ref:"content"},[r("ace-editor",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:t.isContentLoading,opacity:.2},expression:"{ isLoading: isContentLoading, opacity: .2 }"}],attrs:{lang:t.scriptType,height:t.contentHeight},on:{"on-mode-change":t.handleTypeChange},model:{value:t.formData.content,callback:function(e){t.$set(t.formData,"content",e)},expression:"formData.content"}})],1)])],1)],1)};a._withStripped=!0;var i=r(26987),s=i.Z,n=(r(55887),(0,r(35471).Z)(s,a,[],!1,null,"fd7c36fe",null));n.options.__file="src/views/script-manage/create/index.vue";var o=n.exports},55887:function(t,e,r){var a=r(84460);a.__esModule&&(a=a.default),"string"==typeof a&&(a=[[t.id,a,""]]),a.locals&&(t.exports=a.locals);(0,r(13570).Z)("4cf2bf20",a,!1,{})}}]);