(self.webpackChunkjob=self.webpackChunkjob||[]).push([[5700],{17136:function(t,e,a){"use strict";a(87147),a(13118),a(20767);var n=a(70534);Object.defineProperty(e,"X",{value:!0}),e.Z=void 0,a(41336),a(91981),a(63898),a(70616),a(59241),a(79951),a(45680),a(14309);var i=n(a(68203)),s=n(a(25190)),r=n(a(66662)),o=n(a(75907)),l=n(a(28033)),c=n(a(14590)),d=n(a(89888));function u(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,n)}return a}var f={name:"",components:{PermissionSection:o.default,GlobalVariableLayout:l.default,GlobalVariable:c.default,Empty:d.default},props:{data:{type:Object,default:function(){return{}}},variableList:{type:Array,required:!0}},data:()=>({isLoading:!1,isEmpty:!1,isEditing:!1,isSubmiting:!1,info:{name:"",enable:!0,hasConfirm:!1,variableValue:[]}}),computed:{readonly(){return!this.data.enable||!this.isEditing&&this.info.hasConfirm}},created(){this.data.id&&(this.info=function(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?u(Object(a),!0).forEach((function(e){(0,i.default)(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):u(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}({},this.data),this.isEditing=!this.info.hasConfirm,this.info.hasConfirm||(this.info.variableValue=Object.freeze((0,s.default)(this.variableList)),this.fetchData()))},methods:{fetchData(){var t=this;this.isLoading=!0,r.default.getDetail({id:this.data.id},{permission:"catch"}).then((function(e){var a=e.name,n=e.variableValue;t.info.name=a,t.variableList.length<1&&(t.isEmpty=!0,t.$emit("on-change",[]));var i=n.reduce((function(t,e){return t[e.id]=e,t}),{});t.info.variableValue.forEach((function(t){if(i[t.id]){var e=i[t.id],a=e.value,n=e.targetValue;t.defaultValue=a,t.defaultTargetValue=n}}))})).finally((function(){t.isLoading=!1}))},handleToggleEdit(){this.isEditing=!0,this.$emit("on-update-confirm",!1)},handleSubmit(){var t=this;Promise.all(this.$refs.variable.map((function(t){return t.validate()}))).then((function(e){window.changeAlert=!1,t.isEditing=!1,t.info.hasConfirm=!0,t.info.variableValue=Object.freeze(e),t.messageSuccess("定时任务确认成功"),t.$emit("on-change",Object.freeze(e))}))},handleReset(){this.$refs.variable.forEach((function(t){return t.reset()}))}}};e.Z=f},80037:function(t,e,a){"use strict";a(87147),a(13118),a(59241),a(20767);var n=a(70534);Object.defineProperty(e,"X",{value:!0}),e.Z=void 0;var i=n(a(68203));a(85376),a(3511),a(41336),a(91981),a(63898),a(14309),a(70616);var s=n(a(66662)),r=n(a(80336)),o=n(a(71506));function l(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,n)}return a}function c(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?l(Object(a),!0).forEach((function(e){(0,i.default)(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):l(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}var d={name:"",components:{ScrollFaker:r.default,CronDetail:o.default},props:{templateInfo:{type:Object,required:!0},planId:{type:Number,required:!0},cronJobList:{type:Array,default:function(){return[]}}},data:()=>({isLoading:!0,isEmpty:!1,timeTaskList:[{},{},{}],currentTaskId:0}),computed:{detailInfo(){var t=this;return this.timeTaskList.find((function(e){return e.id===t.currentTaskId}))||{}}},created(){this.templateId=this.templateInfo.id,this.templateVariableList=this.templateInfo.variables,this.fetchTimeTaskList()},methods:{fetchTimeTaskList(){var t=this;if(this.cronJobList.length>0)return this.timeTaskList=this.cronJobList,void(this.currentTaskId=this.cronJobList[0].id);this.isLoading=!0,s.default.fetchTaskOfPlan({id:this.planId}).then((function(e){e.length<1?t.isEmpty=!0:(t.timeTaskList=e.map((function(t){return{id:(e=t).id,name:e.name,enable:e.enable,hasConfirm:!1,variableValue:[]};var e})),e.length>0&&(t.currentTaskId=e[0].id))})).finally((function(){t.isLoading=!1}))},trigger(){var t=this.timeTaskList.reduce((function(t,e){return t.push(c(c({},e),{},{variableValue:e.enable?e.variableValue:[]})),t}),[]);this.$emit("on-change",t)},handleTabChange(t){this.currentTaskId=t},handleEnableChange(t,e){var a=this.timeTaskList.find((function(e){return e.id===t}));a.enable=e,a.hasConfirm=!1,this.trigger()},handleVariableChange(t){var e=this,a=this.timeTaskList.find((function(t){return t.id===e.currentTaskId}));a.variableValue=Object.freeze(t),a.hasConfirm=!0,this.trigger()},handleUpdateConfirm(t){var e=this;this.timeTaskList.find((function(t){return t.id===e.currentTaskId})).hasConfirm=t,this.trigger()}}};e.Z=d},42459:function(t,e,a){"use strict";var n=a(70534);Object.defineProperty(e,"X",{value:!0}),e.Z=void 0,a(85376),a(41336),a(91981),a(63898);var i=n(a(74650)),s={name:"",components:{ConfirmCron:n(a(85151)).default},props:{isShow:{type:Boolean,default:!1},templateId:{type:Number,required:!0},planId:{type:Number,required:!0},cronJobInfoList:{type:Array,default:function(){return[]}}},data:()=>({isShowDialog:!1,isLoading:!0,templateInfo:{}}),watch:{templateId(t){t<0||this.fetchData()}},methods:{fetchData(){var t=this;this.isLoading=!0,i.default.taskDetail({id:this.templateId}).then((function(e){t.templateInfo=Object.freeze(e)})).finally((function(){t.isLoading=!1}))},handleClose(){this.$emit("on-close")},handleConfirmCron(t){this.$emit("on-change",t)}}};e.Z=s},98260:function(t,e,a){"use strict";a(87147),a(13118),a(20767);var n=a(70534);Object.defineProperty(e,"X",{value:!0}),e.Z=void 0,a(41336),a(59241),a(91981),a(63898),a(79951),a(45680),a(70616);var i=n(a(17434)),s=n(a(68203)),r=n(a(7285)),o=n(a(25190)),l=n(a(74650)),c=n(a(51391)),d=n(a(66662)),u=n(a(21913)),f=n(a(27898)),h=a(11986),p=n(a(66355));function m(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,n)}return a}function b(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?m(Object(a),!0).forEach((function(e){(0,s.default)(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):m(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}var v=function(t,e){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){},n=0,i=function i(){(n+=1)>=t.length?a():e(t[n],i)};e(t[n],i)},_={name:"",components:{ListActionLayout:f.default,ConfirmCron:p.default},data:()=>({isLoading:!0,data:[{},{},{}],tableHeight:"",isCronJobLoading:!1,isConfirmLoading:!1,isComfirmAllFinished:!1,isSyncLoading:!1,isShowConfirmCron:!1,isFinished:!1,syncValueMemoMap:{},selectPlanInfo:{templateId:-1,planId:-1,cronJobInfoList:[{},{},{}]}}),computed:{isSkeletonLoading(){return this.isLoading},planConfirmInfo(){var t=0,e=0;return this.data.forEach((function(a){a.isConfirmed?t+=1:e+=1})),{confirmed:t,unconfirmed:e}},syncSubmitInvalid(){for(var t=0;t<this.data.length;t++){if(this.data[t].needUpdate)return!1}return!0}},created(){var t=this.$route.query.planIds,e=void 0===t?"":t;this.planIds=e,this.lastOnePlanTemplateId="",this.fetchData()},mounted(){this.calcTableHeight()},methods:{fetchData(){var t=this;this.isLoading=!0,c.default.fetchBatchPlan({planIds:this.planIds}).then((function(e){var a=[],n={};e.forEach((function(e){var i=new u.default(e);a.push(i),t.lastOnePlanTemplateId=e.templateId,i.cronJobCount>0&&(i.status=u.default.STATUS_CRON_JOB_LOADING,n[i.id]=i)})),t.data=a;var i=Object.keys(n);i.length>0&&(t.isCronJobLoading=!0,d.default.fetchTaskOfPlanBatch({planIds:i.join(",")}).then((function(t){for(var e in t){t[e].some((function(t){return t.enable}))?n[e].status=u.default.STATUS_DEFAULT:n[e].status=u.default.STATUS_CONFIRMED}})).finally((function(){t.isCronJobLoading=!1}))),t.data.length>0&&(window.changeAlert=!0)})).finally((function(){t.isLoading=!1}))},calcTableHeight(){var t=(0,h.getOffset)(this.$refs.list).top,e=window.innerHeight;this.tableHeight=e-t-77},calcRowClass(t){var e="template-plan-sync-record";return t.row.canEdit||(e="".concat(e," sync-permission")),e},handleConfirmAll(){var t=this;window.changeAlert=!0,this.isConfirmLoading=!0;var e=b({},this.syncValueMemoMap);this.data.forEach((function(t){e[t.id]||(t.status=u.default.STATUS_CONFIRM_QUEUE)}));var a=0;v(this.data,(function(t,n){var s=t,r={planId:s.id,templateId:s.templateId,templateVersion:s.templateVersion,cronJobInfoList:[{},{},{}]};if(s.canView&&s.canEdit)if(s.isConfirmed)n();else{if(s.isPassConfirm)return e[s.id]=r,void n();s.status=u.default.STATUS_CONFIRM_PENDGING,Promise.all([l.default.taskDetail({id:s.templateId}),d.default.fetchTaskOfPlan({id:s.id})]).then((function(t){for(var n=(0,i.default)(t,2),l=n[0],c=n[1],d=l.variables,f=!1,h=!1,p=[],m=0;m<c.length;m++){var b=c[m],v={id:b.id,name:b.name,enable:b.enable,hasConfirm:!1,variableValue:[]};if(b.canManage)if(b.enable){for(var _=b.variableValue.reduce((function(t,e){return t[e.id]=e,t}),{}),g=[],C=0;C<d.length;C++){var y=(0,o.default)(d[C]);if(_[y.id]){var S=_[y.id],T=S.value,I=S.targetValue;y.defaultValue=T,y.defaultTargetValue=I}y.isRequired&&y.isEmpty&&(f=!0);var L=y.id,O=y.name,k=y.type,E=y.defaultValue,A=y.defaultTargetValue;g.push({id:L,name:O,type:k,defaultValue:E,defaultTargetValue:A,value:E,targetValue:A})}v.hasConfirm=!f,v.variableValue=g,p.push(v)}else p.push(v);else h=!0,p.push(v)}e[s.id]||(r.cronJobInfoList=p,e[s.id]=r),s.cronJobInfoList=p,f?(s.status=u.default.STATUS_CONFIRM_FAILED,s.error="定时任务中必填变量未赋值",a+=1):h?(s.status=u.default.STATUS_CONFIRM_FAILED,s.error="没有定时任务管理权限，请手动确认",a+=1):s.status=u.default.STATUS_CONFIRMED})).catch((function(){s.status=u.default.STATUS_CONFIRM_FAILED,s.error="自动确认定时任务失败，请手动确认",a+=1})).finally((function(){n()}))}else n()}),(function(){t.isConfirmLoading=!1,t.syncValueMemoMap=Object.freeze(e),t.isComfirmAllFinished=!0,a>0&&t.messageError("".concat(a," ","项执行方案的确认出现问题，请逐个确认"))}))},handleGoDiff(t){var e=this.$router.resolve({name:"syncPlan",params:{id:t.id,templateId:t.templateId},query:{mode:"view"}});window.open(e.href)},handleConfirmCron(t){var e=[];this.syncValueMemoMap[t.id]&&(e=this.syncValueMemoMap[t.id].cronJobInfoList),this.isShowConfirmCron=!0,this.selectPlanInfo={templateId:t.templateId,planId:t.id,cronJobInfoList:e}},hanndleSelectPlanConfirmClose(){this.isShowConfirmCron=!1,this.selectPlanInfo={templateId:-1,planId:-1,cronJobInfoList:[{},{},{}]}},handleSelectPlanConfirmChange(t){var e=this;window.changeAlert=!0;var a=b({},this.syncValueMemoMap);a[this.selectPlanInfo.planId]={templateId:this.selectPlanInfo.templateId,id:this.selectPlanInfo.planId,cronJobInfoList:t},this.syncValueMemoMap=Object.freeze(a);var n=(0,r.default)(this.data,(function(t){return t.id===e.selectPlanInfo.planId}));t.every((function(t){return t.hasConfirm||!t.enable}))&&(n.status=u.default.STATUS_CONFIRMED),n.cronJobInfoList=t,this.data=[...this.data]},handleSubmitSync(){var t=this;this.isSyncLoading=!0,this.data.forEach((function(t){t.needUpdate&&(t.status=u.default.STATUS_SYNC_QUEUE)}));v(this.data,(function(e,a){var n=e;if(!n.needUpdate)return n.status=u.default.STATUS_SYNCED,void a();n.status=u.default.STATUS_SYNC_PENDING,c.default.planSyncInfo({planId:n.id,templateId:n.templateId,templateVersion:n.templateVersion}).then((function(){return t.syncValueMemoMap[n.id]&&t.syncValueMemoMap[n.id].cronJobInfoList.length>0?d.default.updatePlanTask({cronJobInfoList:t.syncValueMemoMap[n.id].cronJobInfoList}):Promise.resolve()})).then((function(){n.status=u.default.STATUS_SYNCED})).catch((function(){n.status=u.default.STATUS_SYNC_FAILED})).finally((function(){a()}))}),(function(){t.isSyncLoading=!1,t.isFinished=!0,window.changeAlert=!1}))},handleSyncRetry(t){var e=this;t.status=u.default.STATUS_SYNC_PENDING,c.default.planSyncInfo({planId:t.id,templateId:t.templateId,templateVersion:t.templateVersion}).then((function(){return d.default.updatePlanTask({cronJobInfoList:e.syncValueMemoMap[t.id].cronJobList})})).then((function(){t.status=u.default.STATUS_SYNCED})).catch((function(){t.error="同步请求失败，请重试",t.status=u.default.STATUS_SYNC_FAILED}))},handleCancle(){var t=this;(0,h.leaveConfirm)().then((function(){t.routerBack()}))},handleFinish(){window.changeAlert=!1,this.routerBack()},routerBack(){var t=this.$route.query.from;"viewPlan"===t?this.$router.push({name:"viewPlan",params:{templateId:this.lastOnePlanTemplateId}}):"planList"===t?this.$router.push({name:"planList"}):"templateDetail"===t?this.$router.push({name:"templateDetail",params:{id:this.lastOnePlanTemplateId}}):"templateEdit"===t?this.$router.push({name:"viewPlan",params:{templateId:this.lastOnePlanTemplateId}}):this.$router.push({name:"planList"})}}};e.Z=_},21913:function(t,e,a){"use strict";var n=a(70534);Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,a(94354),a(25910),a(98495),a(41336),a(59241);var i=n(a(68203)),s=5;class r{constructor(t){this.id=t.id,this.name=t.name,this.createTime=t.createTime,this.creator=t.creator,this.cronJobCount=t.cronJobCount||0,this.hasCronJob=t.hasCronJob||!1,this.lastModifyTime=t.lastModifyTime,this.lastModifyUser=t.lastModifyUser,this.needUpdate=t.needUpdate,this.stepList=t.stepList||[],this.templateId=t.templateId,this.templateName=t.templateName,this.templateVersion=t.templateVersion,this.variableList=Object.freeze(t.variableList||[]),this.version=t.version,this.canDelete=t.canDelete,this.canEdit=t.canEdit,this.canView=t.canView,this._cronJonList=[],this._error="",this._status=r.STATUS_DEFAULT,(this.cronJobCount<1||!this.needUpdate)&&(this._status=r.STATUS_CONFIRMED),this.canEdit||(this._status=r.STATUS_PERMISSION)}get cronJobInfoList(){return this._cronJonList}set cronJobInfoList(t){this._cronJonList=t}get error(){return this._error}set error(t){this._error=t}get status(){return r.STATUS_TEXT_MAP[this._status]}set status(t){this.canEdit&&this.needUpdate&&([r.STATUS_CONFIRM_FAILED,r.STATUS_SYNC_FAILED].includes(t)||(this._error=""),[s].includes(this._status)&&[r.STATUS_CONFIRM_QUEUE,r.STATUS_CONFIRM_PENDGING,r.STATUS_CONFIRM_FAILED].includes(t)||(this._status=t))}get statusHtml(){var t="";return[r.STATUS_CONFIRM_FAILED,r.STATUS_SYNC_FAILED].includes(this._status)&&this._error&&(t='tippy-tips="'.concat(this._error,'"')),"<span ".concat(t,">").concat(r.STATUS_TEXT_MAP[this._status],"</span>")}get statusIcon(){return r.STATUS_ICON_MAP[this._status]}get isCronJobLoading(){return this._status===r.STATUS_CRON_JOB_LOADING}get isPassConfirm(){return this.cronJobCount<1||!this.needUpdate}get isSyncDisabled(){return!this.needUpdate}get isConfirmed(){return![r.STATUS_DEFAULT,r.STATUS_CONFIRM_QUEUE,r.STATUS_CONFIRM_PENDGING,r.STATUS_CONFIRM_FAILED].includes(this._status)}get isRetryEnable(){return this._status===r.STATUS_SYNC_FAILED}get disableDiffTips(){return this.needUpdate?"":"方案已是最新版，无差异"}get disableConfirmTips(){return this.needUpdate?this.cronJobCount<1?"无关联定时任务，系统自动确认":"":"该方案已同步，无需处理"}get confirmProcessText(){if(this.isConfirmed)return"".concat(this.cronJobCount,"/").concat(this.cronJobCount);var t=0;return this._cronJonList.forEach((function(e){!e.hasConfirm&&e.enable||(t+=1)})),"".concat(t,"/").concat(this.cronJobCount)}}e.default=r,(0,i.default)(r,"STATUS_CRON_JOB_LOADING",-1),(0,i.default)(r,"STATUS_DEFAULT",0),(0,i.default)(r,"STATUS_CONFIRM_QUEUE",2),(0,i.default)(r,"STATUS_CONFIRM_PENDGING",3),(0,i.default)(r,"STATUS_CONFIRM_FAILED",4),(0,i.default)(r,"STATUS_CONFIRMED",s),(0,i.default)(r,"STATUS_SYNC_QUEUE",6),(0,i.default)(r,"STATUS_SYNC_PENDING",7),(0,i.default)(r,"STATUS_SYNC_FAILED",8),(0,i.default)(r,"STATUS_SYNCED",9),(0,i.default)(r,"STATUS_PERMISSION",10),(0,i.default)(r,"STATUS_TEXT_MAP",{[-1]:"",0:"未就绪",2:"等待确认中",3:"确认中",4:"未就绪，确认失败",[s]:"已就绪",6:"等待同步中",7:"同步中",8:"同步失败",9:"同步成功",10:"无同步权限"}),(0,i.default)(r,"STATUS_ICON_MAP",{[-1]:"sync-pending",0:"sync-default",2:"sync-default",3:"sync-pending",4:"sync-failed",[s]:"sync-success",6:"sync-default",7:"sync-pending",8:"sync-failed",9:"sync-success",10:"sync-default"})},31557:function(){},64332:function(){},8955:function(){},46092:function(){},71506:function(t,e,a){"use strict";a.r(e),a.d(e,{__esModule:function(){return i.X},default:function(){return o}});var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("permission-section",[a("smart-action",{attrs:{"offset-target":"variable-value"},scopedSlots:t._u([t.isLoading||t.isEmpty?null:{key:"action",fn:function(){return[t.isEditing?a("bk-button",{staticClass:"mr10",attrs:{theme:"primary"},on:{click:t.handleSubmit}},[t._v("\n                "+t._s("确认")+"\n            ")]):t._e(),t._v(" "),t.isEditing?a("bk-button",{staticClass:"mr10",on:{click:t.handleReset}},[t._v("\n                "+t._s("重置")+"\n            ")]):a("bk-button",{staticClass:"mr10",attrs:{theme:"primary"},on:{click:t.handleToggleEdit}},[t._v("\n                "+t._s("编辑")+"\n            ")])]},proxy:!0}],null,!0)},[a("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:t.isLoading},expression:"{ isLoading }"}],staticClass:"cron-job-detail",class:{"is-loading":t.isLoading}},[a("bk-alert",{attrs:{title:"同步执行方案需要重新确认定时任务的全局变量，不使用的定时任务可以直接停用。"}}),t._v(" "),a("div",{staticClass:"title"},[a("span",[t._v("「"+t._s(t.info.name)+"」"+t._s("的全局变量"))]),t._v(" "),t.data.enable?t.data.hasConfirm?a("span",{staticClass:"confirm"},[t._v(t._s("已确认"))]):a("span",{staticClass:"waiting"},[t._v(t._s("待确认"))]):a("span",{staticClass:"disable"},[t._v(t._s("已停用"))])]),t._v(" "),a("div",[t.isLoading?t._e():a("global-variable-layout",t._l(t.info.variableValue,(function(e){return a("global-variable",{key:e.id,ref:"variable",refInFor:!0,attrs:{type:e.type,readonly:t.readonly,data:e}})})),1),t._v(" "),t.isEmpty?a("empty",[a("p",[t._v(t._s("无关联的全局变量"))]),t._v(" "),a("p",{staticStyle:{"margin-top":"8px"}},[t._v(t._s("已直接确认"))])]):t._e()],1)],1)])],1)};n._withStripped=!0;var i=a(17136),s=i.Z,r=(a(31502),(0,a(51900).Z)(s,n,[],!1,null,"0d5ec9cc",null));r.options.__file="src/views/task-manage/common/plan/confirm-cron/cron-detail.vue";var o=r.exports},85151:function(t,e,a){"use strict";a.r(e),a.d(e,{__esModule:function(){return i.X},default:function(){return o}});var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"plan-manage-confirm-cron",attrs:{empty:t.isEmpty,loading:t.isLoading}},[a("div",{staticClass:"layout-left"},[a("scroll-faker",t._l(t.timeTaskList,(function(e){return a("div",{key:e.id,staticClass:"cron-job-tab",class:{active:e.id===t.currentTaskId}},[a("auth-component",{attrs:{permission:e.canManage,auth:"cron/view","resource-id":e.id}},[a("div",{staticClass:"tab-container",on:{click:function(a){return t.handleTabChange(e.id)}}},[a("span",{staticClass:"job-name"},[t._v(t._s(e.name))]),t._v(" "),e.hasConfirm?a("Icon",{staticClass:"job-check",attrs:{type:"check"}}):t._e(),t._v(" "),a("div",{on:{click:function(t){t.stopPropagation()}}},[a("bk-switcher",{staticClass:"job-switch",attrs:{value:e.enable,size:"small",theme:"primary"},on:{change:function(a){return t.handleEnableChange(e.id,a)}}})],1)],1),t._v(" "),a("div",{staticClass:"tab-container",attrs:{slot:"forbid"},slot:"forbid"},[a("span",{staticClass:"job-name"},[t._v(t._s(e.name))]),t._v(" "),e.hasConfirm?a("Icon",{staticClass:"job-check",attrs:{type:"check"}}):t._e(),t._v(" "),a("div",{on:{click:function(t){t.stopPropagation()}}},[a("bk-switcher",{staticClass:"job-switch",attrs:{value:e.enable,size:"small",disabled:"",theme:"primary"},on:{change:function(a){return t.handleEnableChange(e.id,a)}}})],1)],1)])],1)})),0)],1),t._v(" "),a("div",{staticClass:"layout-right"},[a("scroll-faker",[a("cron-detail",{key:t.detailInfo.id,attrs:{data:t.detailInfo,"variable-list":t.templateVariableList},on:{"on-change":t.handleVariableChange,"on-update-confirm":t.handleUpdateConfirm}})],1)],1)])};n._withStripped=!0;var i=a(80037),s=i.Z,r=(a(5425),(0,a(51900).Z)(s,n,[],!1,null,null,null));r.options.__file="src/views/task-manage/common/plan/confirm-cron/index.vue";var o=r.exports},66355:function(t,e,a){"use strict";a.r(e),a.d(e,{__esModule:function(){return i.X},default:function(){return o}});var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("jb-dialog",{staticClass:"plan-confirm-cron-dialog",attrs:{value:t.isShow,fullscreen:""},on:{cancel:t.handleClose}},[a("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:t.isLoading},expression:"{ isLoading }"}],staticClass:"confirm-cron-wraper",on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"esc",27,e.key,["Esc","Escape"])?null:t.handleClose.apply(null,arguments)}}},[t.isLoading?t._e():a("confirm-cron",{attrs:{"template-info":t.templateInfo,"plan-id":t.planId,"cron-job-list":t.cronJobInfoList},on:{"on-change":t.handleConfirmCron}})],1)])};n._withStripped=!0;var i=a(42459),s=i.Z,r=(a(4417),(0,a(51900).Z)(s,n,[],!1,null,null,null));r.options.__file="src/views/task-manage/sync-plan-batch/components/confirm-cron.vue";var o=r.exports},75700:function(t,e,a){"use strict";a.r(e),a.d(e,{__esModule:function(){return i.X},default:function(){return o}});var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"sync-plan-batch-page"},[a("list-action-layout",{scopedSlots:t._u([{key:"right",fn:function(){return[a("bk-button",{attrs:{theme:"primary",loading:t.isConfirmLoading||t.isCronJobLoading},on:{click:t.handleConfirmAll}},[t._v("\n                "+t._s("全部确认")+"\n            ")])]},proxy:!0}])}),t._v(" "),a("div",{staticClass:"render-list-header"},[a("div",{staticClass:"list-name"},[a("span",[t._v(t._s("同步执行方案"))]),t._v(" "),a("span",{staticClass:"total"},[t._v("（"+t._s("共")+" "+t._s(t.data.length)+" "+t._s("个")+"）")])]),t._v(" "),a("div",{staticClass:"item-status"},[t.isCronJobLoading?[a("Icon",{staticClass:"plan-cron-job-loading",attrs:{type:"sync-pending",svg:""}})]:[a("span",{staticClass:"confirmed"},[t._v(t._s(t.planConfirmInfo.confirmed))]),t._v(t._s("个已就绪")+" ，\n                "),a("span",{staticClass:"unconfirmed"},[t._v(t._s(t.planConfirmInfo.unconfirmed))]),t._v(t._s("个未就绪")+"\n            ")]],2)]),t._v(" "),a("div",{ref:"list"},[t.tableHeight?a("bk-table",{staticClass:"sync-plan-list",attrs:{data:t.data,"max-height":t.tableHeight,"row-class-name":t.calcRowClass,selectable:""}},[a("bk-table-column",{key:"name",attrs:{label:"执行方案",prop:"name",align:"left"},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row;return[a("auth-router-link",{attrs:{permission:n.canView,auth:"job_plan/view","resource-id":n.id,target:"_blank",to:{name:"viewPlan",params:{templateid:4},query:{viewPlanId:4}}}},[t._v("\n                        "+t._s(n.name)+"\n                        "),a("Icon",{staticClass:"open-link-flag",attrs:{type:"edit"}})],1)]}}],null,!1,2468989349)}),t._v(" "),a("bk-table-column",{key:"templateName",attrs:{label:"所属作业模板",prop:"templateName",align:"left"},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row;return[a("router-link",{attrs:{target:"_blank",to:{name:"templateDetail",params:{id:4}}}},[t._v("\n                        "+t._s(n.templateName)+"\n                        "),a("Icon",{staticClass:"open-link-flag",attrs:{type:"edit"}})],1)]}}],null,!1,2309935885)}),t._v(" "),a("bk-table-column",{key:"statusText2",attrs:{label:"状态",prop:"statusText","class-name":"status-column",align:"left"},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row;return[a("div",{staticClass:"confirm-status-box"},[a("Icon",{staticClass:"status-flag",class:n.statusIcon,attrs:{type:n.statusIcon,svg:""}}),t._v(" "),a("span",{domProps:{innerHTML:t._s(n.statusHtml)}}),t._v(" "),n.isRetryEnable?a("bk-button",{staticClass:"ml10",attrs:{text:""},on:{click:function(e){return t.handleSyncRetry(n)}}},[t._v("\n                            "+t._s("重试")+"\n                        ")]):t._e()],1)]}}],null,!1,2115953018)}),t._v(" "),a("bk-table-column",{key:"action",attrs:{resizable:!1,label:"操作",width:"280",align:"left"},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row;return[a("span",{staticClass:"mr10",attrs:{"tippy-tips":n.disableDiffTips}},[a("bk-button",{attrs:{text:""},on:{click:function(e){return t.handleGoDiff(n)}}},[t._v("\n                            "+t._s("查看差异")+"\n                        ")])],1),t._v(" "),n.isCronJobLoading?[a("Icon",{staticClass:"plan-cron-job-loading",attrs:{type:"sync-pending",svg:""}})]:[a("span",{staticClass:"mr10",attrs:{"tippy-tips":n.disableConfirmTips}},[a("bk-button",{attrs:{text:"",loading:n.isCronJobLoading},on:{click:function(e){return t.handleConfirmCron(n)}}},[t._v("\n                                "+t._s("确认定时任务")+"\n                            ")])],1),t._v(" "),a("div",{staticClass:"confirm-status",class:{confirmed:n.isConfirmed}},[t._v("\n                            "+t._s(n.confirmProcessText)+"\n                        ")])]]}}],null,!1,521973342)})],1):t._e()],1),t._v(" "),a("div",{staticClass:"sync-plan-action"},[t.isFinished?a("bk-button",{staticClass:"w120",attrs:{theme:"primary"},on:{click:t.handleFinish}},[t._v("\n            "+t._s("完成")+"\n        ")]):[a("bk-button",{staticClass:"mr10",on:{click:t.handleCancle}},[t._v("\n                "+t._s("取消")+"\n            ")]),t._v(" "),a("span",{attrs:{"tippy-tips":t.syncSubmitInvalid?"所有方案均已同步至最新版":""}},[a("bk-button",{staticClass:"w120",attrs:{theme:"primary",loading:t.isSyncLoading||t.isCronJobLoading},on:{click:t.handleSubmitSync}},[t._v("\n                    "+t._s("立即同步")+"\n                ")])],1)]],2),t._v(" "),a("confirm-cron",t._b({attrs:{"is-show":t.isShowConfirmCron},on:{"on-change":t.handleSelectPlanConfirmChange,"on-close":t.hanndleSelectPlanConfirmClose}},"confirm-cron",t.selectPlanInfo,!1))],1)};n._withStripped=!0;var i=a(98260),s=i.Z,r=(a(44340),(0,a(51900).Z)(s,n,[],!1,null,null,null));r.options.__file="src/views/task-manage/sync-plan-batch/index.vue";var o=r.exports},31502:function(t,e,a){var n=a(31557);n.__esModule&&(n=n.default),"string"==typeof n&&(n=[[t.id,n,""]]),n.locals&&(t.exports=n.locals);(0,a(18086).Z)("6859bd28",n,!1,{})},5425:function(t,e,a){var n=a(64332);n.__esModule&&(n=n.default),"string"==typeof n&&(n=[[t.id,n,""]]),n.locals&&(t.exports=n.locals);(0,a(18086).Z)("81a9ad66",n,!1,{})},4417:function(t,e,a){var n=a(8955);n.__esModule&&(n=n.default),"string"==typeof n&&(n=[[t.id,n,""]]),n.locals&&(t.exports=n.locals);(0,a(18086).Z)("019b00f4",n,!1,{})},44340:function(t,e,a){var n=a(46092);n.__esModule&&(n=n.default),"string"==typeof n&&(n=[[t.id,n,""]]),n.locals&&(t.exports=n.locals);(0,a(18086).Z)("748ea22e",n,!1,{})}}]);