(self.webpackChunkjob=self.webpackChunkjob||[]).push([[3065],{20798:function(e,t){"use strict";Object.defineProperty(t,"X",{value:!0}),t.Z=void 0;var a={inject:["collapse"],data:()=>({iconType:"arrow-full-right"}),mounted(){var e=this,t=this.$watch((function(){return e.$refs.collapseItem.isActive}),(function(t){e.iconType=t?"arrow-full-down":"arrow-full-right"}),{immediate:!0});this.$once("hook:beforeDestroy",(function(){t()}))}};t.Z=a},78237:function(e,t,a){"use strict";Object.defineProperty(t,"X",{value:!0}),t.Z=void 0,a(14309),a(41336),a(59241),a(94354),a(25910);var n={name:"",props:{channelList:{type:Array,default:function(){return[]}},value:{type:Array,default:function(){return[]}}},data:()=>({localValue:[]}),computed:{allCheckStatus(){var e=this;if(this.localValue.length<1)return{checked:!1,indeterminate:!1};var t=this.channelList.map((function(e){return e.code})),a=!0,n=!1;return t.forEach((function(t){e.localValue.includes(t)||(a=!1)})),n=!a,t.length<1&&(a=!1,n=!1),{checked:a,indeterminate:n}}},watch:{value:{handler(e){this.localValue=e},immediate:!0}},methods:{handleCheckToggle(){if(this.allCheckStatus.checked)this.handleChange([]);else{var e=this.channelList.map((function(e){return e.code}));this.handleChange(e)}},handleChange(e){this.localValue=e,this.$emit("on-change",this.localValue)}}};t.Z=n},61050:function(e,t,a){"use strict";var n=a(70534);Object.defineProperty(t,"X",{value:!0}),t.Z=void 0,a(70616),a(41336);var i=n(a(25190)),r=n(a(7861)),s=n(a(22924)),l={components:{JbUserSelector:r.default,RenderNotifyWay:s.default},props:{type:{type:String,require:!0},data:{type:Object,default:function(){return{}}},templateData:{type:Object,default:function(){return{}}}},data(){return{localValue:(0,i.default)(this.data)}},methods:{reset(){this.localValue=(0,i.default)(this.data)},getValue(){var e=this.localValue,t=e.resourceTypeList,a=e.extraObserverList,n=e.roleList,i=e.resourceStatusChannelMap;return{triggerType:this.type,resourceTypeList:t,roleList:n,extraObserverList:a,resourceStatusChannelList:Object.keys(i).reduce((function(e,t){return e.push({executeStatus:t,channelList:i[t]}),e}),[])}},handleResourceTypeChange(e){this.localValue.resourceTypeList=e},handleUserChange(e,t){e.length>0&&t.push("JOB_EXTRA_OBSERVER"),this.localValue.extraObserverList=e,this.localValue.roleList=t},handleNotifyWayChange(e,t){this.localValue.resourceStatusChannelMap[e]=t}}};t.Z=l},70576:function(e,t,a){"use strict";var n=a(70534);Object.defineProperty(t,"X",{value:!0}),t.Z=void 0,a(41336),a(91981),a(63898),a(79951),a(45680),a(14309),a(70616),a(59241);var i=n(a(31752)),r=n(a(23181)),s=n(a(53056)),l={components:{NotifyCollapseItem:r.default,TriggerSetting:s.default},data:()=>({isLoading:!0,isSubmiting:!1,activeResult:[],templateData:{},formData:{}}),computed:{isSkeletonLoading(){return this.isLoading}},created(){var e=this;this.isLoading=!0,Promise.all([this.fetchPageTemplate(),this.fetchPoliciesList()]).finally((function(){e.isLoading=!1}))},methods:{fetchPageTemplate(){var e={},t=e.triggerTypeList,a=void 0===t?[{},{},{}]:t,n=e.availableNotifyChannelList,i=void 0===n?[{},{},{}]:n,r=e.executeStatusList,s=void 0===r?[{},{},{}]:r,l=e.resourceTypeList,o=void 0===l?[{},{},{}]:l,c=e.roleList,u=void 0===c?[{},{},{}]:c;this.triggerTypeList=Object.freeze(a),this.templateData=Object.freeze({availableNotifyChannelList:i,executeStatusList:s,resourceTypeList:o,roleList:u}),this.activeResult=a.map((function(e){return e.code}))},fetchPoliciesList(){var e=[].reduce((function(e,t){var a=t.extraObserverList,n=void 0===a?[]:a,i=t.resourceStatusChannelMap,r=void 0===i?[]:i,s=t.resourceTypeList,l=void 0===s?[]:s,o=t.roleList,c=void 0===o?[]:o,u=t.triggerType;return e[void 0===u?[]:u]={extraObserverList:n,resourceStatusChannelMap:r,resourceTypeList:l,roleList:c},e}),{});this.formData=Object.freeze(e)},handleSave(){var e=this;this.isSubmiting=!0;var t=this.$refs.setting.map((function(e){return e.getValue()}));i.default.defaultPoliciesUpdate({triggerPoliciesList:t}).then((function(){return e.messageSuccess("保存成功"),e.fetchPoliciesList()})).finally((function(){e.isSubmiting=!1}))},handleCancel(){this.$refs.setting.forEach((function(e){return e.reset()}))}}};t.Z=l},59845:function(){},86810:function(){},61366:function(){},98627:function(){},23181:function(e,t,a){"use strict";a.r(t),a.d(t,{__esModule:function(){return i.X},default:function(){return l}});var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"notify-collapse-item"},[a("bk-collapse-item",e._g(e._b({ref:"collapseItem",attrs:{"hide-arrow":""},scopedSlots:e._u([{key:"default",fn:function(){return[a("Icon",{staticStyle:{color:"#979ba5"},attrs:{type:e.iconType}}),e._v(" "),a("span",{staticStyle:{display:"none"}},[e._v(e._s(e.iconType))]),e._v(" "),e._t("default")]},proxy:!0},{key:"content",fn:function(){return[e._t("content")]},proxy:!0}],null,!0)},"bk-collapse-item",e.$attrs,!1),e.$listeners))],1)};n._withStripped=!0;var i=a(20798),r=i.Z,s=(a(62633),(0,a(51900).Z)(r,n,[],!1,null,null,null));s.options.__file="src/views/notify-manage/index/components/notify-collapse-item.vue";var l=s.exports},22924:function(e,t,a){"use strict";a.r(t),a.d(t,{__esModule:function(){return i.X},default:function(){return l}});var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"render-notify-way-check"},[a("bk-checkbox",e._b({staticClass:"check-all",nativeOn:{click:function(t){return e.handleCheckToggle.apply(null,arguments)}}},"bk-checkbox",e.allCheckStatus,!1),[e._v("\n        "+e._s("全选")+"\n    ")]),e._v(" "),a("bk-checkbox-group",{staticClass:"check-item",attrs:{value:e.localValue},on:{change:e.handleChange}},e._l(e.channelList,(function(t){return a("bk-checkbox",{key:t.code,attrs:{value:t.code}},[e._v("\n            "+e._s(t.name)+"\n        ")])})),1)],1)};n._withStripped=!0;var i=a(78237),r=i.Z,s=(a(1900),(0,a(51900).Z)(r,n,[],!1,null,"6aecfc2e",null));s.options.__file="src/views/notify-manage/index/components/trigger-setting/components/render-notify-way.vue";var l=s.exports},53056:function(e,t,a){"use strict";a.r(t),a.d(t,{__esModule:function(){return i.X},default:function(){return l}});var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("jb-form",{staticClass:"notify-trigger-setting"},[a("jb-form-item",{attrs:{label:"操作类型"}},[a("bk-checkbox-group",{staticClass:"input",attrs:{value:e.localValue.resourceTypeList},on:{change:e.handleResourceTypeChange}},e._l([{},{},{}],(function(t){return a("bk-checkbox",{key:t.code,attrs:{value:t.code}},[e._v("\n                "+e._s(t.name)+"\n            ")])})),1)],1),e._v(" "),a("jb-form-item",{attrs:{label:"通知对象"}},[a("jb-user-selector",{staticClass:"input",attrs:{placeholder:"请输入",user:e.localValue.extraObserverList,role:e.localValue.roleList,"filter-list":["JOB_EXTRA_OBSERVER"]},on:{"on-change":e.handleUserChange}})],1),e._v(" "),a("jb-form-item",{attrs:{label:"通知方式"}},[a("table",{staticClass:"notify-way-table input"},[a("thead",[a("th",{staticStyle:{width:"95px"}},[e._v(e._s("状态"))]),e._v(" "),a("th",[e._v(e._s("通知方式"))])]),e._v(" "),a("tbody",e._l([{},{},{}],(function(t,n){return a("tr",{key:n},[a("td",[e._v(e._s(t.name))]),e._v(" "),a("td",[a("render-notify-way",{attrs:{"channel-list":e.templateData.availableNotifyChannelList,value:[]},on:{"on-change":function(a){return e.handleNotifyWayChange(t.code,a)}}})],1)])})),0)])])],1)};n._withStripped=!0;var i=a(61050),r=i.Z,s=(a(63996),(0,a(51900).Z)(r,n,[],!1,null,null,null));s.options.__file="src/views/notify-manage/index/components/trigger-setting/index.vue";var l=s.exports},93065:function(e,t,a){"use strict";a.r(t),a.d(t,{__esModule:function(){return i.X},default:function(){return l}});var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("smart-action",{attrs:{"offset-target":"bk-form-content"},scopedSlots:e._u([{key:"action",fn:function(){return[a("div",{staticClass:"action-wrapper"},[a("bk-button",{staticClass:"w120 mr10",attrs:{theme:"primary",loading:e.isSubmiting},on:{click:e.handleSave}},[e._v("\n                "+e._s("保存")+"\n            ")]),e._v(" "),a("bk-button",{on:{click:e.handleCancel}},[e._v("\n                "+e._s("重置")+"\n            ")])],1)]},proxy:!0}])},[a("div",{staticClass:"notify-message-page"},[e.isLoading?e._e():a("bk-collapse",{attrs:{value:"1"}},e._l(e.triggerTypeList,(function(t){return a("notify-collapse-item",{key:t.code,attrs:{name:t.code,active:"1"}},[e._v("\n                trigger-title\n                "),a("span",{staticClass:"trigger-title"},[e._v(e._s(t.name))]),e._v(" "),a("trigger-setting",{ref:"setting",refInFor:!0,attrs:{slot:"content",type:t.code,data:e.formData[t.code],"template-data":e.templateData},slot:"content"})],1)})),1)],1)])};n._withStripped=!0;var i=a(70576),r=i.Z,s=(a(34941),(0,a(51900).Z)(r,n,[],!1,null,"9894fef6",null));s.options.__file="src/views/notify-manage/index/index.vue";var l=s.exports},62633:function(e,t,a){var n=a(59845);n.__esModule&&(n=n.default),"string"==typeof n&&(n=[[e.id,n,""]]),n.locals&&(e.exports=n.locals);(0,a(18086).Z)("ade6850c",n,!1,{})},1900:function(e,t,a){var n=a(86810);n.__esModule&&(n=n.default),"string"==typeof n&&(n=[[e.id,n,""]]),n.locals&&(e.exports=n.locals);(0,a(18086).Z)("9697f17e",n,!1,{})},63996:function(e,t,a){var n=a(61366);n.__esModule&&(n=n.default),"string"==typeof n&&(n=[[e.id,n,""]]),n.locals&&(e.exports=n.locals);(0,a(18086).Z)("ab68981a",n,!1,{})},34941:function(e,t,a){var n=a(98627);n.__esModule&&(n=n.default),"string"==typeof n&&(n=[[e.id,n,""]]),n.locals&&(e.exports=n.locals);(0,a(18086).Z)("86df4838",n,!1,{})}}]);