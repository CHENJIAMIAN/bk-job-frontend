(self.webpackChunkjob=self.webpackChunkjob||[]).push([[8489],{5485:function(t,e,n){"use strict";var i=n(22696);Object.defineProperty(e,"X",{value:!0}),e.Z=void 0,n(87033),n(71959),n(57024),n(35948),n(9042),n(7170),n(94522),n(23232),n(80433);var a=i(n(86627)),r=i(n(15399)),s={name:"JbEditSelect",props:{mode:{type:String,default:""},field:{type:String,required:!0},value:{type:[String,Number,Array],default:""},list:{type:Array,require:!0},width:{type:String,default:"auto"},remoteHander:{type:Function,default:function(){return Promise.resolve()}},rules:{type:Array,default:function(){return[]}}},data(){return{localValue:this.value,error:"",isEditing:!1,isSubmiting:!1}},computed:{renderText(){var t={};Array.isArray(this.localValue)?this.localValue.forEach((function(e){t[e]=!0})):t[this.localValue]=!0;var e=(0,a.default)(this.list,(function(e){var n=e.id;return t[n]}));return e.length<1?"--":e.map((function(t){return t.name})).join(",")},styles(){return{width:this.width}},isBlock(){return"block"===this.mode},refreshKey(){return"editSelect_".concat(Array.isArray(this.value)?this.value.join("_"):this.value)}},watch:{value(t){this.localValue=t}},mounted(){var t=this;this.isValidatoring=!1,document.body.addEventListener("click",this.handleHideEdit),this.$once("hook:beforeDestroy",(function(){document.body.removeEventListener("click",t.handleHideEdit)}))},methods:{doValidator(){var t=this,e=this.rules.map((function(e){return function(t,e){return new Promise((function(n,i){if(t.required&&!e&&i(t.message),t.validator&&"function"==typeof t.validator){var a=t.validator(e);if(!a.then)return a?n():i(t.message);a.then((function(e){return e?n():i(t.message)})).catch((function(){i(t.message)}))}else n()}))}(e,t.localValue)}));return this.isValidatoring=!0,Promise.all(e).finally((function(){t.isValidatoring=!1}))},triggerChange(){var t=this;this.doValidator().then((function(){t.isEditing=!1,function(t,e){if(t===e)return!0;if(Object.prototype.toString.call(t)!==Object.prototype.toString.call(e))return!1;if(Array.isArray(t)){if(t.length!==e.length)return!1;for(var n=t.reduce((function(t,e){return t[e]=!0,t}),[]),i=0;i<e.length;i++)if(!n[e[i]])return!1;return!0}return!1}(t.localValue,t.value)||(t.isSubmiting=!0,t.remoteHander({[t.field]:t.localValue}).then((function(){t.$emit("on-change",{[t.field]:t.localValue}),t.messageSuccess(r.default.t("编辑成功"))})).catch((function(){t.localValue=t.value})).finally((function(){t.isSubmiting=!1})))})).catch((function(e){t.error=e}))},handleBlockShowEdit(){this.isBlock&&this.handleShowEdit()},handleShowEdit(){var t=this;document.body.click(),this.isEditing=!0,this.$nextTick((function(){t.$refs.select.$el.querySelector(".bk-select-name").click()}))},handleHideEdit(t){if(!this.isValidatoring&&!this.error){if(t.path&&t.path.length>0)for(var e=0;e<t.path.length;e++){var n=t.path[e];if("jb-edit-select"===n.className||"tippy-content"===n.className)return}this.isEditing=!1}},handleSelectChange(t){this.localValue=t},handleSelectToggle(t){t||this.triggerChange()}}};e.Z=s},6911:function(t,e,n){"use strict";var i=n(22696);Object.defineProperty(e,"X",{value:!0}),e.Z=void 0,n(57024);var a=i(n(93435)),r=i(n(15399)),s={name:"",props:{value:{type:Number,require:!0}},data:()=>({isEditing:!1}),computed:{text(){var t=this;return(0,a.default)(this.actionList,(function(e){return e.id===t.value})).name},textClass(){return{1:"normal",2:"hight"}[this.value]}},created(){this.actionList=[{id:1,name:r.default.t("dangerousRule.扫描")},{id:2,name:r.default.t("dangerousRule.拦截")}]},methods:{handleEdit(){var t=this;this.isEditing=!0,this.$nextTick((function(){t.$refs.select.$el.querySelector(".bk-select-name").click()}))},handleSelectToggle(t){t||(this.isEditing=!1)},handleChange(t){this.$emit("on-change",t)}}};e.Z=s},21933:function(t,e,n){"use strict";n(45974),n(9042),n(43364);var i=n(22696);Object.defineProperty(e,"X",{value:!0}),e.Z=void 0;var a=i(n(33610));n(35927),n(6919),n(87033),n(35948),n(94522);var r=i(n(15399)),s=i(n(17782)),o=i(n(12e3));function l(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}var u={data:()=>({isEdit:!1,isSubmiting:!1,formData:{expression:"",description:"",scriptTypeList:1,action:1},scriptTypeList:[{},{},{}]}),created(){this.fetchScriptType()},methods:{fetchScriptType(){var t=this;o.default.scriptTypeList().then((function(e){t.scriptTypeList=e}))},handleToggle(){this.isEdit=!0},handleCancel(){this.isEdit=!1,this.formData={expression:"",description:"",scriptTypeList:1,action:1}},handleSubmit(){var t=this;this.isSubmiting||(this.formData.expression&&this.formData.description?(this.isSubmiting=!0,s.default.update(function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?l(Object(n),!0).forEach((function(e){(0,a.default)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}({id:-1},this.formData)).then((function(){t.messageSuccess(r.default.t("dangerousRule.新增成功")),t.$emit("on-change"),t.handleCancel()})).finally((function(){t.isSubmiting=!1}))):this.messageError(r.default.t("dangerousRule.请填写完整的语法检测表达式和说明")))}}};e.Z=u},19385:function(t,e,n){"use strict";n(35927),n(45974),n(9042),n(43364);var i=n(22696);Object.defineProperty(e,"X",{value:!0}),e.Z=void 0;var a=i(n(33610));n(87033),n(35948),n(94522),n(92974),n(77036);var r=i(n(15399)),s=i(n(17782)),o=i(n(12e3)),l=i(n(36894)),u=i(n(10839)),c=i(n(93962)),d=i(n(99146)),p=i(n(33549));function f(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function v(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?f(Object(n),!0).forEach((function(e){(0,a.default)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):f(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var h={name:"",components:{JbEditInput:l.default,JbEditSelect:u.default,JbPopoverConfirm:c.default,TableActionRow:d.default,EditAction:p.default},data:()=>({isLoading:!0,list:[{},{},{}],scriptTypeList:[{},{},{}]}),computed:{isSkeletonLoading(){return this.isLoading}},created(){this.editRule={},this.fetchData(),this.fetchScriptType(),this.formRules={expression:[{required:!0,message:r.default.t("dangerousRule.语法检测表达式不能为空")}],description:[{required:!0,message:r.default.t("dangerousRule.规则说明不能为空")}],scriptTypeList:[{validator:function(t){return t.length>0},message:r.default.t("dangerousRule.脚本类型不能为空")}]}},methods:{fetchData(){var t=this;this.isLoading=!0,s.default.fetchList({},{permission:"page"}).then((function(e){t.list=e})).finally((function(){t.isLoading=!1}))},fetchScriptType(){var t=this;o.default.scriptTypeList().then((function(e){t.scriptTypeList=e}))},handleScriptTypeUpdate(t,e){this.editRule=v(v({},t),{},{scriptTypeList:e})},handleSubmitScriptTypeChange(t){var e=this;!t&&this.editRule.scriptTypeList&&this.editRule.scriptTypeList.length>0&&s.default.update(v({},this.editRule)).then((function(){e.messageSuccess(r.default.t("dangerousRule.编辑成功"))}))},handleUpdate(t,e){var n=this;return console.log("from handleUpdate = ",t,e),s.default.update(v(v({},t),e)).then((function(){n.messageSuccess(r.default.t("dangerousRule.编辑成功")),Object.assign(t,e)}))},handleAdd(){this.fetchData()},handleMove(t,e){var n=this;this.isLoading=!0,s.default.updateSort({id:this.list[t].id,dir:e}).then((function(){var i=n.list[t],a=n.list[t+e];n.list.splice(t,1,a),n.list.splice(t+e,1,i),n.messageSuccess(e<0?r.default.t("dangerousRule.上移成功"):r.default.t("dangerousRule.下移成功"))})).finally((function(){n.isLoading=!1}))},handleDelete(t){var e=this;return s.default.remove({id:t}).then((function(){e.messageSuccess(r.default.t("dangerousRule.删除成功")),e.fetchData()}))}}};e.Z=h},17782:function(t,e,n){"use strict";var i=n(22696);Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a=i(n(96771)),r={fetchList(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return a.default.getData(t,e).then((function(t){return t.data}))},update:t=>a.default.update(t).then((function(t){return t.data})),remove:t=>a.default.removeById(t).then((function(t){return t.data})),updateSort:t=>a.default.move(t).then((function(t){return t.data}))};e.default=r},96771:function(t,e,n){"use strict";var i=n(22696);Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,n(70969);var a=i(n(24875));var r=new class{constructor(){this.module="/job-manage/web/dangerousRule"}getData(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return a.default.get("".concat(this.module,"/list"),{params:t,payload:e})}update(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return a.default.post("".concat(this.module),{params:t})}removeById(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return a.default.delete("".concat(this.module,"/").concat(t.id))}move(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return a.default.put("".concat(this.module,"/move"),{params:t})}};e.default=r},78234:function(){},74246:function(){},57693:function(){},10839:function(t,e,n){"use strict";n.r(e),n.d(e,{__esModule:function(){return a.X},default:function(){return o}});var i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{key:t.refreshKey,staticClass:"jb-edit-select",class:t.mode},[t.isEditing?[n("div",{staticClass:"edit-value-box",class:{"edit-error":!!t.error},on:{click:function(t){t.stopPropagation()}}},[n("bk-select",t._b({ref:"select",attrs:{value:t.value,clearable:!1},on:{change:t.handleSelectChange,toggle:t.handleSelectToggle}},"bk-select",t.$attrs,!1),t._l(t.list,(function(t){return n("bk-option",{key:t.id,attrs:{id:t.id,name:t.name}})})),1),t._v(" "),t.error?n("div",{directives:[{name:"bk-tooltips",rawName:"v-bk-tooltips.top",value:t.error,expression:"error",modifiers:{top:!0}}],staticClass:"input-edit-info"},[n("Icon",{attrs:{type:"info"}})],1):t._e()],1)]:[n("div",{staticClass:"render-value-box",on:{click:function(e){return e.stopPropagation(),t.handleBlockShowEdit.apply(null,arguments)}}},[n("div",{directives:[{name:"bk-overflow-tips",rawName:"v-bk-overflow-tips"}],staticClass:"value-text"},[t._t("default",(function(){return[n("span",[t._v(t._s(t.renderText))])]}),{value:t.renderText})],2),t._v(" "),n("i",{staticClass:"bk-icon icon-angle-down value-arrow"}),t._v(" "),n("div",{staticClass:"edit-action-box"},[t.isBlock||t.isSubmiting?t._e():n("Icon",{staticClass:"edit-action",attrs:{type:"edit-2"},on:{click:function(e){return e.target!==e.currentTarget?null:(e.stopPropagation(),t.handleShowEdit.apply(null,arguments))}}}),t._v(" "),t.isSubmiting?n("Icon",{staticClass:"edit-loading",attrs:{type:"loading-circle"}}):t._e()],1)])]],2)};i._withStripped=!0;var a=n(5485),r=a.Z,s=(n(46023),(0,n(35471).Z)(r,i,[],!1,null,null,null));s.options.__file="src/components/jb-edit/select.vue";var o=s.exports},33549:function(t,e,n){"use strict";n.r(e),n.d(e,{__esModule:function(){return a.X},default:function(){return o}});var i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"dangerous-rule-edit-mode"},[n("bk-select",{ref:"select",attrs:{value:t.value,clearable:!1},on:{toggle:t.handleSelectToggle,change:t.handleChange}},t._l(t.actionList,(function(t){return n("bk-option",{key:t.id,attrs:{name:t.name,id:t.id}})})),1),t._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:!t.isEditing,expression:"!isEditing"}],staticClass:"value-box",on:{click:function(e){return e.stopPropagation(),t.handleEdit.apply(null,arguments)}}},[n("div",{staticClass:"action-text",class:t.textClass},[t._v("\n            "+t._s(t.text)+"\n        ")]),t._v(" "),n("i",{staticClass:"bk-icon icon-angle-down value-box-arrow"})])],1)};i._withStripped=!0;var a=n(6911),r=a.Z,s=(n(34774),(0,n(35471).Z)(r,i,[],!1,null,null,null));s.options.__file="src/views/dangerous-rule-manage/index/components/edit-action.vue";var o=s.exports},99146:function(t,e,n){"use strict";n.r(e),n.d(e,{__esModule:function(){return a.X},default:function(){return o}});var i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("tbody",[t.isEdit?n("tr",[n("td",[n("bk-input",{staticClass:"input",model:{value:t.formData.expression,callback:function(e){t.$set(t.formData,"expression",e)},expression:"formData.expression"}})],1),t._v(" "),n("td",[n("bk-input",{staticClass:"input",model:{value:t.formData.description,callback:function(e){t.$set(t.formData,"description",e)},expression:"formData.description"}})],1),t._v(" "),n("td",[n("bk-select",{attrs:{clearable:!1,multiple:"","show-select-all":""},model:{value:t.formData.scriptTypeList,callback:function(e){t.$set(t.formData,"scriptTypeList",e)},expression:"formData.scriptTypeList"}},t._l(t.scriptTypeList,(function(t){return n("bk-option",{key:t.id,attrs:{name:t.name,id:t.id}})})),1)],1),t._v(" "),n("td",[n("bk-select",{attrs:{clearable:!1},model:{value:t.formData.action,callback:function(e){t.$set(t.formData,"action",e)},expression:"formData.action"}},[n("bk-option",{attrs:{name:t.$t("dangerousRule.扫描"),id:1}}),t._v(" "),n("bk-option",{attrs:{name:t.$t("dangerousRule.拦截"),id:2}})],1)],1),t._v(" "),n("td",[n("bk-button",{attrs:{text:""},on:{click:t.handleSubmit}},[t._v("\n                "+t._s(t.$t("dangerousRule.保存"))+"\n            ")]),t._v(" "),n("bk-button",{attrs:{text:""},on:{click:t.handleCancel}},[t._v("\n                "+t._s(t.$t("dangerousRule.取消"))+"\n            ")])],1)]):n("tr",[n("td",{attrs:{colspan:"5"}},[n("bk-button",{attrs:{text:""},on:{click:t.handleToggle}},[n("Icon",{attrs:{type:"plus"}}),t._v("\n                "+t._s(t.$t("dangerousRule.新增检测规则"))+"\n            ")],1)],1)])])};i._withStripped=!0;var a=n(21933),r=a.Z,s=(0,n(35471).Z)(r,i,[],!1,null,null,null);s.options.__file="src/views/dangerous-rule-manage/index/components/table-action-row.vue";var o=s.exports},68489:function(t,e,n){"use strict";n.r(e),n.d(e,{__esModule:function(){return a.X},default:function(){return o}});var i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"dangerous-rule-manage-page"},[n("table",{directives:[{name:"test",rawName:"v-test",value:{type:"list",value:"dangerousRule"},expression:"{ type: 'list', value: 'dangerousRule' }"}],staticClass:"rule-table"},[n("thead",[n("tr",[n("th",{staticStyle:{width:"200px"}},[t._v(t._s(t.$t("dangerousRule.语法检测表达式")))]),t._v(" "),n("th",[t._v(t._s(t.$t("dangerousRule.规则说明")))]),t._v(" "),n("th",{staticStyle:{width:"300px"}},[t._v(t._s(t.$t("dangerousRule.脚本类型")))]),t._v(" "),n("th",{staticStyle:{width:"300px"}},[n("span",[t._v(t._s(t.$t("dangerousRule.动作")))]),t._v(" "),n("bk-popover",{attrs:{placement:"right"}},[n("Icon",{staticClass:"action-tips",attrs:{type:"info"}}),t._v(" "),n("div",{attrs:{slot:"content"},slot:"content"},[n("div",[t._v(t._s(t.$t("dangerousRule.【扫描】")))]),t._v(" "),n("div",[t._v(t._s(t.$t("dangerousRule.命中规则的脚本执行任务仅会做记录，不会拦截")))]),t._v(" "),n("div",{staticStyle:{"margin-top":"8px"}},[t._v(t._s(t.$t("dangerousRule.【拦截】")))]),t._v(" "),n("div",[t._v(t._s(t.$t("dangerousRule.命中规则的脚本执行任务会被记录，并中止运行")))])])],1)],1),t._v(" "),n("th",{staticStyle:{width:"180px"}},[t._v("\n                    "+t._s(t.$t("dangerousRule.操作"))+"\n                    "),n("Icon",{directives:[{name:"bk-tooltips",rawName:"v-bk-tooltips",value:{theme:"dark",content:t.$t("dangerousRule.规则的顺位越高，表示执行优先度越高")},expression:"{\n                            theme: 'dark',\n                            content: $t('dangerousRule.规则的顺位越高，表示执行优先度越高'),\n                        }"}],staticClass:"action-tips",attrs:{type:"info"}})],1)])]),t._v(" "),n("table-action-row",{on:{"on-change":t.handleAdd}}),t._v(" "),t._l(t.list,(function(e,i){return n("tbody",{key:e.id},[n("tr",[n("td",[n("jb-edit-input",{attrs:{field:"expression",mode:"block",rules:t.formRules.expression,value:e.expression,"remote-hander":function(n){return t.handleUpdate(e,n)}}})],1),t._v(" "),n("td",[n("jb-edit-input",{attrs:{field:"description",mode:"block",rules:t.formRules.description,value:e.description,"remote-hander":function(n){return t.handleUpdate(e,n)}}})],1),t._v(" "),n("td",[n("jb-edit-select",{attrs:{field:"scriptTypeList",mode:"block",rules:t.formRules.scriptTypeList,multiple:"","show-select-all":"",value:e.scriptTypeList,list:t.scriptTypeList,"remote-hander":function(n){return t.handleUpdate(e,n)}}})],1),t._v(" "),n("td",[n("edit-action",{attrs:{value:e.action},on:{"on-change":function(n){return t.handleUpdate(e,{action:n})}}})],1),t._v(" "),n("td",[n("div",{staticClass:"action-box"},[n("bk-switcher",{directives:[{name:"test",rawName:"v-test",value:{type:"button",value:"toggleRuleStatus"},expression:"{ type: 'button', value: 'toggleRuleStatus' }"}],staticClass:"mr10",attrs:{value:e.status,"true-value":1,"false-value":0,theme:"primary",size:"small"},on:{update:function(n){return t.handleUpdate(e,{status:n})}}}),t._v(" "),n("bk-button",{directives:[{name:"bk-tooltips",rawName:"v-bk-tooltips.top",value:t.$t("dangerousRule.上移"),expression:"$t('dangerousRule.上移')",modifiers:{top:!0}},{name:"test",rawName:"v-test",value:{type:"button",value:"upMoveRule"},expression:"{ type: 'button', value: 'upMoveRule' }"}],staticClass:"arrow-btn mr10",attrs:{text:""},on:{click:function(e){return t.handleMove(i,-1)}}},[n("Icon",{attrs:{type:"increase-line"}})],1),t._v(" "),n("bk-button",{directives:[{name:"bk-tooltips",rawName:"v-bk-tooltips.top",value:t.$t("dangerousRule.下移"),expression:"$t('dangerousRule.下移')",modifiers:{top:!0}},{name:"test",rawName:"v-test",value:{type:"button",value:"downMoveRule"},expression:"{ type: 'button', value: 'downMoveRule' }"}],staticClass:"arrow-btn mr10",attrs:{text:""},on:{click:function(e){return t.handleMove(i,1)}}},[n("Icon",{attrs:{type:"decrease-line"}})],1),t._v(" "),n("jb-popover-confirm",{attrs:{title:t.$t("dangerousRule.确定删除该规则？"),content:t.$t("dangerousRule.脚本编辑器中匹配该规则将不会再收到提醒"),"confirm-handler":function(){return t.handleDelete(e.id)}}},[n("bk-button",{directives:[{name:"test",rawName:"v-test",value:{type:"button",value:"deleteRule"},expression:"{ type: 'button', value: 'deleteRule' }"}],attrs:{text:""}},[t._v("\n                                "+t._s(t.$t("dangerousRule.删除"))+"\n                            ")])],1)],1)])])])}))],2)])};i._withStripped=!0;var a=n(19385),r=a.Z,s=(n(84491),(0,n(35471).Z)(r,i,[],!1,null,null,null));s.options.__file="src/views/dangerous-rule-manage/index/index.vue";var o=s.exports},46023:function(t,e,n){var i=n(78234);i.__esModule&&(i=i.default),"string"==typeof i&&(i=[[t.id,i,""]]),i.locals&&(t.exports=i.locals);(0,n(13570).Z)("10f8a2fa",i,!1,{})},34774:function(t,e,n){var i=n(74246);i.__esModule&&(i=i.default),"string"==typeof i&&(i=[[t.id,i,""]]),i.locals&&(t.exports=i.locals);(0,n(13570).Z)("3381a7f2",i,!1,{})},84491:function(t,e,n){var i=n(57693);i.__esModule&&(i=i.default),"string"==typeof i&&(i=[[t.id,i,""]]),i.locals&&(t.exports=i.locals);(0,n(13570).Z)("4149b266",i,!1,{})}}]);