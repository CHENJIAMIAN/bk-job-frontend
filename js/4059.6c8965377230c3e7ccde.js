(self.webpackChunkjob=self.webpackChunkjob||[]).push([[4059],{63074:function(t,e,i){"use strict";var s=i(22696);Object.defineProperty(e,"X",{value:!0}),e.Z=void 0,i(57024),i(87033),i(35948),i(94522);var n=s(i(44068)),a=s(i(12e3)),r=i(41980),o={name:"",components:{ScriptDetail:s(i(98336)).default},props:{isShow:{type:Boolean,default:!1},scriptVersionId:{type:Number,required:!0}},data:()=>({isLoading:!1,scriptInfo:{}}),watch:{isShow(t){t&&this.scriptVersionId>0&&this.fetchScriptDetail()}},created(){this.publicScript=(0,r.checkPublicScript)(this.$route),this.serviceHandler=this.publicScript?a.default:n.default},methods:{fetchScriptDetail(){var t=this;this.isLoading=!0,this.serviceHandler.versionDetail({id:this.scriptVersionId}).then((function(e){t.scriptInfo=Object.freeze(e)})).finally((function(){t.isLoading=!1}))},handleCancel(){this.$emit("update:isShow",!1)}}};e.Z=o},35438:function(t,e,i){"use strict";var s=i(22696);Object.defineProperty(e,"X",{value:!0}),e.Z=void 0,i(87033),i(35948),i(94522),i(77036),i(7170),i(71959);var n=i(41980),a=s(i(44068)),r=s(i(12e3)),o=s(i(84484)),l={components:{ScriptDetail:s(i(82951)).default},data:()=>({data:[{},{},{}],isLoading:!1,isShowDetail:!1,selectScriptVersionId:0,lastVersionScriptInfo:{}}),computed:{isRetryAllDisable(){for(var t=0;t<this.data.length;t++)if(this.data[t].isSyncFailed)return!1;return!0}},created(){this.statusFilters=[{value:0,text:"未上线"},{value:1,text:"已上线"},{value:2,text:"已下线"},{value:3,text:"已禁用"}],this.publicScript=(0,n.checkPublicScript)(this.$route),this.serviceHandler=this.publicScript?r.default:a.default,this.scriptId=this.$route.params.scriptId,this.scriptVersionId=this.$route.params.scriptVersionId,this.stepList=JSON.parse(localStorage.getItem("SYNC_TEMPLATE_STEP_SCRIPT")),this.stepList.length<1?this.messageError("请先选择作业模板步骤"):(this.fetchData(),this.fetchLastScriptVersionDetail())},methods:{fetchData(){var t=this;this.isLoading=!0,this.serviceHandler.scriptVersionSync({scriptId:this.scriptId,scriptVersionId:this.scriptVersionId,steps:this.stepList}).then((function(e){t.data=e})).finally((function(){t.isLoading=!1}))},fetchLastScriptVersionDetail(){var t=this;this.serviceHandler.versionDetail({id:this.$route.params.scriptVersionId}).then((function(e){t.lastVersionScriptInfo=Object.freeze(e)}))},handleShowDetail(t){this.selectScriptVersionId=t,this.isShowDetail=!0},handleAllRetry(){this.fetchData()},handleRetry(t,e){var i=this;this.serviceHandler.scriptVersionSync({scriptId:this.scriptId,scriptVersionId:this.scriptVersionId,steps:[{templateid:4,stepid:4}]}).then((function(t){i.data.splice(e,1,t[0])}))},statusFilterMethod:(t,e)=>e.scriptStatus===t,handleFinish(){this.routerBack()},routerBack(){var t=this,e=this.$createElement;window.changeAlert=!this.isRetryAllDisable,this.isSyncPlanLoading=!1,(0,n.leaveConfirm)("部分作业模板同步失败，请留意").then((function(){t.$bkInfo({title:"是否需要进行执行方案同步？",closeIcon:!1,subHeader:e("div",[e("span",["点击"]),e("span",{style:"font-weight: bold"},[" ","“立即前往”"," "]),e("span",["将进入关联的执行方案同步确认页面，点击"]),e("span",{style:"font-weight: bold"},[" ","“暂时不用”"," "]),e("span",["结束本次操作并退出。"])]),okText:"立即前往",cancelText:"暂时不用",confirmFn:function(){return o.default.fetchBatchTaskPlan({templateIds:t.stepList.map((function(t){return t.templateId})).join(",")}).then((function(e){t.$router.push({name:"syncPlanBatch",query:{planIds:e.reduce((function(t,e){return e.needUpdate&&t.push(e.id),t}),[]).join(",")}})}))},cancelFn:function(){var e=t.publicScript?"publicScriptVersion":"scriptVersion";t.$router.push({name:e,params:{id:t.scriptId}})}})}))}}};e.Z=l},9312:function(){},45156:function(){},82951:function(t,e,i){"use strict";i.r(e),i.d(e,{__esModule:function(){return n.X},default:function(){return o}});var s=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("jb-sideslider",{attrs:{"is-show":t.isShow,"show-footer":!1,"quick-close":!0,width:900,title:"查看脚本"},on:{"update:isShow":t.handleCancel}},[t.isShow?i("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:t.isLoading},expression:"{ isLoading }"}]},[t.isLoading?t._e():i("script-detail",{attrs:{"script-info":t.scriptInfo,"offset-bottom":0}})],1):t._e()])};s._withStripped=!0;var n=i(63074),a=n.Z,r=(i(91790),(0,i(35471).Z)(a,s,[],!1,null,"06891118",null));r.options.__file="src/views/script-manage/sync-task/components/script-detail.vue";var o=r.exports},84059:function(t,e,i){"use strict";i.r(e),i.d(e,{__esModule:function(){return n.X},default:function(){return o}});var s=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:t.isLoading},expression:"{ isLoading }"}],staticClass:"script-manage-sync-task-page"},[i("div",{staticClass:"retry-btn"},[i("bk-button",{on:{click:t.handleAllRetry}},[t._v(t._s("全部重试"))])],1),t._v(" "),i("div",{staticClass:"table-top"},[t._v("\n        "+t._s("同步作业模板")+"\n        "),i("span",{staticClass:"version-sum"},[t._v("\n            （"+t._s("共")+" "+t._s(t.data.length)+" "+t._s("个")+"）\n        ")])]),t._v(" "),i("bk-table",{attrs:{data:t.data,"row-class-name":"sync-script-record"}},[i("bk-table-column",{attrs:{label:"作业模板名称",prop:"name",sortable:""},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.row;return[i("router-link",{attrs:{target:"_blank",to:{name:"templateDetail",params:{id:4}}}},[t._v("\n                    "+t._s(s.templateName)+"\n                    "),i("Icon",{staticClass:"template-link",attrs:{type:"edit"}})],1)]}}])}),t._v(" "),i("bk-table-column",{attrs:{label:"步骤名称",prop:"stepName"}}),t._v(" "),i("bk-table-column",{attrs:{label:"引用的版本号",prop:"version"},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.row;return[i("bk-button",{attrs:{text:""},on:{click:function(e){return t.handleShowDetail(s.scriptVersionId)}}},[t._v("\n                    "+t._s(s.scriptVersion)+"\n                ")])]}}])}),t._v(" "),i("bk-table-column",{attrs:{label:"引用版本状态",prop:"status",filters:t.statusFilters,"filter-method":t.statusFilterMethod,"filter-multiple":!0},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.row;return[i("span",{domProps:{innerHTML:t._s(s.statusHtml)}})]}}])}),t._v(" "),i("bk-table-column",{attrs:{label:"状态",width:"350",prop:"syncStatus"},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.row,n=e.$index;return[i("Icon",{staticClass:"mr10",attrs:{type:s.syncIcon,svg:""}}),t._v(" "),i("span",[t._v(t._s(s.syncStatusMsg))]),t._v(" "),s.isSyncFailed?i("bk-button",{staticStyle:{"margin-left":"15px"},attrs:{"tippy-tips":s.failMsg,text:""},on:{click:function(e){return t.handleRetry(s,n)}}},[t._v("\n                    "+t._s("重试")+"\n                ")]):t._e()]}}])})],1),t._v(" "),i("div",{staticClass:"footer-action"},[i("bk-button",{staticClass:"w120",attrs:{theme:"primary"},on:{click:t.handleFinish}},[t._v("\n            "+t._s("完成")+"\n        ")])],1),t._v(" "),i("script-detail",{attrs:{"is-show":t.isShowDetail,"script-version-id":t.selectScriptVersionId},on:{"update:isShow":function(e){t.isShowDetail=e},"update:is-show":function(e){t.isShowDetail=e}}}),t._v(" "),t.lastVersionScriptInfo.version?i("element-teleport",[i("span",[t._v(" - "+t._s("同步至"))]),t._v(" "),i("span",[t._v(t._s(t.lastVersionScriptInfo.version))])]):t._e()],1)};s._withStripped=!0;var n=i(35438),a=n.Z,r=(i(89002),(0,i(35471).Z)(a,s,[],!1,null,null,null));r.options.__file="src/views/script-manage/sync-task/index.vue";var o=r.exports},91790:function(t,e,i){var s=i(9312);s.__esModule&&(s=s.default),"string"==typeof s&&(s=[[t.id,s,""]]),s.locals&&(t.exports=s.locals);(0,i(13570).Z)("f3a71766",s,!1,{})},89002:function(t,e,i){var s=i(45156);s.__esModule&&(s=s.default),"string"==typeof s&&(s=[[t.id,s,""]]),s.locals&&(t.exports=s.locals);(0,i(13570).Z)("2391cd86",s,!1,{})}}]);