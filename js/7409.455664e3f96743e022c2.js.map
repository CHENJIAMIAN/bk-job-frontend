{"version":3,"file":"js/7409.455664e3f96743e022c2.js","mappings":"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","sources":["webpack://job/src/views/fast-execution/distro-file/index.vue","webpack://job/./src/views/fast-execution/distro-file/index.vue?a3e2","webpack://job/./src/views/fast-execution/distro-file/index.vue?f6da","webpack://job/./src/views/fast-execution/distro-file/index.vue?fa6d","webpack://job/./src/views/fast-execution/distro-file/index.vue?a8da"],"sourcesContent":["<template>\n    <div class=\"distro-file-page\" v-bkloading=\"{ isLoading }\">\n        <smart-action offset-target=\"bk-form-content\">\n            <jb-form\n                class=\"push-file-form\"\n                ref=\"pushFileForm\"\n                v-test=\"{ type: 'form', value: 'pushFile' }\"\n                :model=\"formData\">\n                <card-layout :title=\"'基本信息'\" class=\"block\">\n                    <item-factory\n                        name=\"stepName\"\n                        field=\"name\"\n                        :label=\"'任务名称'\"\n                        :placeholder=\"'取一个便于记忆的任务名，方便后续在历史记录中快速定位...'\"\n                        :form-data=\"formData\"\n                        @on-change=\"handleChange\" />\n                    <item-factory\n                        name=\"timeout\"\n                        field=\"timeout\"\n                        :form-data=\"formData\"\n                        @on-change=\"handleChange\" />\n                    <item-factory\n                        name=\"speedLimit\"\n                        field=\"uploadSpeedLimit\"\n                        :label=\"'上传限速'\"\n                        :form-data=\"formData\"\n                        @on-change=\"handleChange\" />\n                    <item-factory\n                        name=\"speedLimit\"\n                        field=\"downloadSpeedLimit\"\n                        :label=\"'下载限速'\"\n                        :form-data=\"formData\"\n                        @on-change=\"handleChange\" />\n                </card-layout>\n                <card-layout :title=\"'文件来源'\" class=\"block\">\n                    <item-factory\n                        name=\"sourceFileOfExecution\"\n                        field=\"fileSourceList\"\n                        :form-data=\"formData\"\n                        @on-change=\"handleChange\" />\n                </card-layout>\n                <card-layout :title=\"'传输目标'\" class=\"block\" style=\"margin-bottom: 0;\">\n                    <item-factory\n                        ref=\"targetPath\"\n                        name=\"targetPath\"\n                        field=\"path\"\n                        :tips-placement=\"targetPathTipsPlacement\"\n                        :form-data=\"formData\"\n                        @on-change=\"handleChange\" />\n                    <item-factory\n                        name=\"transferMode\"\n                        field=\"transferMode\"\n                        :form-data=\"formData\"\n                        @on-change=\"handleChange\" />\n                    <item-factory\n                        name=\"executeAccount\"\n                        field=\"account\"\n                        :form-data=\"formData\"\n                        @on-change=\"handleChange\" />\n                    <item-factory\n                        name=\"targetServerOfExecution\"\n                        field=\"server\"\n                        :form-data=\"formData\"\n                        @on-change=\"handleChange\" />\n                </card-layout>\n            </jb-form>\n            <template #action>\n                <bk-button\n                    class=\"w120 mr10\"\n                    theme=\"primary\"\n                    :loading=\"isSubmiting\"\n                    @click=\"handleSubmit\"\n                    v-test=\"{ type: 'button', value: 'fastPushFileSubmit' }\">\n                    {{ '执行' }}\n                </bk-button>\n                <bk-button\n                    @click=\"handleCancel\"\n                    v-test=\"{ type: 'button', value: 'fastPushFileReset' }\">\n                    {{ '重置' }}\n                </bk-button>\n            </template>\n        </smart-action>\n        <div v-if=\"historyList.length > 0\" class=\"execution-history\" :class=\"{ active: isShowHistory }\">\n            <div class=\"toggle-btn\" @click=\"handleShowHistory\">\n                <Icon class=\"toggle-flag\" type=\"angle-double-left\" />\n                <div class=\"recent-result\">{{ '最近结果' }}</div>\n            </div>\n            <div class=\"history-content\">\n                <div\n                    v-for=\"item in historyList\"\n                    class=\"item\"\n                    :key=\"item.id\"\n                    @click=\"handleGoHistoryDetail(item)\">\n                    {{ item.name }}\n                </div>\n            </div>\n        </div>\n    </div>\n</template>\n<script>\n    import _ from 'lodash';\n    import {\n        mapState,\n    } from 'vuex';\n       import TaskExecuteService from '@service/task-execute';\n    import TaskStepModel from '@model/task/task-step';\n    import TaskHostNodeModel from '@model/task-host-node';\n    import JbForm from '@components/jb-form';\n    import CardLayout from '@components/task-step/file/card-layout';\n    import ItemFactory from '@components/task-step/file/item-factory';\n    import {\n        genDefaultName,\n        compareHost,\n        detectionSourceFileDupLocation,\n    } from '@utils/assist';\n    import {\n        pushFileHistory,\n    } from '@utils/cache-helper';\n\n    const getDefaultData = () => ({\n        // 快速执行name\n        name: genDefaultName('快速执行分发文件'),\n        // 源文件列表\n        fileSourceList: [{},{},{}],\n        // 超时\n        timeout: 7200,\n        // 上传文件限速\n        uploadSpeedLimit: 0,\n        // 传输模式： 1 - 严谨模式； 2 - 强制模式；3 - 安全模式\n        transferMode: 2,\n        // 下载文件限速\n        downloadSpeedLimit: 0,\n        // 执行账号\n        account: '',\n        // 目标路径\n        path: '',\n        // 目标服务器\n        server: new TaskHostNodeModel({}),\n    });\n\n    export default {\n        name: '',\n        components: {\n            JbForm,\n            CardLayout,\n            ItemFactory,\n        },\n        data () {\n            return {\n                isLoading: false,\n                formData: getDefaultData(),\n                isSubmiting: false,\n                historyList: [{},{},{}],\n                isShowHistory: false,\n                targetPathTipsPlacement: '',\n            };\n        },\n        computed: {\n            ...mapState('distroFile', {\n                isEditNewSourceFile: state => state.isEditNewSourceFile,\n            }),\n        },\n        created () {\n            this.init();\n            this.calcTargetPathTipsPlacement();\n        },\n        mounted () {\n            window.addEventListener('resize', this.calcTargetPathTipsPlacement);\n            this.$once('hook:beforeDestroy', () => {\n                window.removeEventListener('resize', this.calcTargetPathTipsPlacement);\n            });\n            window.IPInputScope = 'FILE_DISTRIBUTION';\n            this.$once('hook:beforeDestroy', () => {\n                window.IPInputScope = '';\n            });\n        },\n        methods: {\n            /**\n             * @desc 执行历史重做\n             *\n             * 通过任务taskInstanceId获取任务的详情\n             */\n            fetchData () {\n                this.$request(TaskExecuteService.fetchTaskInstance({\n                    id: this.taskInstanceId,\n                }), () => {\n                    this.isLoading = true;\n                }).then((data) => {\n                    const { stepInfo } = data;\n                    const {\n                        downloadSpeedLimit,\n                        fileDestination,\n                        fileSourceList,\n                        timeout,\n                        transferMode,\n                        uploadSpeedLimit,\n                    } = stepInfo.fileStepInfo;\n                    const {\n                        account,\n                        path,\n                        server,\n                    } = fileDestination;\n                    this.formData = {\n                        ...this.formData,\n                        name: stepInfo.name,\n                        uploadSpeedLimit,\n                        downloadSpeedLimit,\n                        account,\n                        path,\n                        server,\n                        timeout,\n                        fileSourceList,\n                        transferMode,\n                    };\n                })\n                    .finally(() => {\n                        this.isLoading = false;\n                    });\n            },\n            /**\n             * @desc 初始化逻辑\n             *\n             * 1，读取执行历史缓存\n             * 2，解析url\n             *     -- 路由回退重做\n             *     -- 执行历史指定任务重做\n             */\n            init () {\n                this.taskInstanceId = parseInt(this.$route.params.taskInstanceId, 10);\n                this.timeTravel();\n\n                const { from } = this.$route.query;\n                // 步骤执行详情历史编辑——从历史缓存数据中查找对应数据的formData\n                if (from === 'historyStep') {\n                    let historyRecord = null;\n                    if (this.taskInstanceId) {\n                        // 有指定taskInstanceId\n                        historyRecord = _.find(this.historyList, _ => _.taskInstanceId === this.taskInstanceId);\n                    } else {\n                        // 没有指定taskInstanceId，默认取第一个\n                        historyRecord = _.head(this.historyList);\n                    }\n                    // 历史缓存中有数据使用缓存数据\n                    if (historyRecord) {\n                        this.formData = historyRecord.formData;\n                        return;\n                    }\n                }\n                // 执行历史——通过taskInstanceId重做\n                if (this.taskInstanceId > 0) {\n                    this.fetchData();\n                }\n            },\n            calcTargetPathTipsPlacement: _.throttle(function () {\n                this.targetPathTipsPlacement = window.innerWidth > 1650 ? 'right-start' : 'top';\n            }, 60),\n            /**\n             * @desc 回溯执行历史\n             *\n             */\n            timeTravel () {\n                this.historyList = Object.freeze(pushFileHistory.getItem());\n            },\n            /**\n             * @desc 执行记录缓存\n             * @param {Array} history 执行历史记录\n             *\n             */\n            pushLocalStorage (history) {\n                const historyList = pushFileHistory.getItem();\n                historyList.unshift(history);\n                pushFileHistory.setItem(historyList);\n            },\n            /**\n             * @desc 展开执行历史列表\n             *\n             */\n            handleShowHistory () {\n                this.isShowHistory = !this.isShowHistory;\n            },\n            /**\n             * @desc 查看执行历史记录任务详情\n             *\n             */\n            handleGoHistoryDetail (payload) {\n                this.$router.push({\n                    name: 'historyStep',\n                    params: {\n                        taskInstanceId: payload.taskInstanceId,\n                    },\n                    query: {\n                        stepInstanceId: payload.stepInstanceId,\n                        from: 'fastPushFile',\n                    },\n                });\n            },\n            /**\n             * @desc 表单值更新\n             * @param {String} field 字段名\n             * @param {Any} value  字段最新值\n             *\n             */\n            handleChange (field, value) {\n                this.formData[field] = value;\n            },\n            /**\n             * @desc 执行\n             */\n            handleSubmit () {\n                this.isSubmiting = true;\n                this.$refs.pushFileForm.validate()\n                    // 检测没有保存的源文件\n                    .then(() => new Promise((resolve, reject) => {\n                        if (!this.isEditNewSourceFile) {\n                            return resolve();\n                        }\n                        this.$bkInfo({\n                            title: '您有未保存的源文件',\n                            type: 'warning',\n                            okText: '继续执行',\n                            cancelText: '去保存',\n                            confirmFn: () => {\n                                setTimeout(() => {\n                                    resolve();\n                                }, 300);\n                            },\n                            cancelFn: () => {\n                                setTimeout(() => {\n                                    reject(new Error('save'));\n                                }, 300);\n                            },\n                        });\n                    }))\n                    // 检测服务器源文件的主机和执行目标服务器主机相同\n                    .then(() => new Promise((resolve, reject) => {\n                        let sameHost = false;\n                        // eslint-disable-next-line no-plusplus\n                        for (let i = 0; i < this.formData.fileSourceList.length; i++) {\n                            const currentFileSource = this.formData.fileSourceList[i];\n                            // 服务器源文件\n                            if (currentFileSource.fileType === TaskStepModel.fileStep.TYPE_SERVER) {\n                                if (compareHost(this.formData.server, currentFileSource.host)) {\n                                    sameHost = true;\n                                    break;\n                                }\n                            }\n                        }\n                        if (sameHost) {\n                            this.$bkInfo({\n                                title: '源和目标服务器相同',\n                                subTitle: '检测到文件传输源和目标服务器是同一批，若是单台建议使用本地 cp 方式效率会更高，请问你是否确定参数无误？',\n                                width: 500,\n                                okText: '好的，我调整一下',\n                                cancelText: '是的，确定无误',\n                                confirmFn: () => {\n                                    reject(new Error('execute'));\n                                },\n                                cancelFn: () => {\n                                    resolve();\n                                },\n                            });\n                        } else {\n                            resolve();\n                        }\n                    }))\n                    // 检测源文件的同名文件和目录\n                    .then(() => new Promise((resolve, reject) => {\n                        if (detectionSourceFileDupLocation(this.formData.fileSourceList)) {\n                            // 有重名目录和文件\n                            this.$bkInfo({\n                                title: '源文件可能出现同名',\n                                subTitle: '多文件源传输场景下容易出现同名文件覆盖的问题，你可以在目标路径中使用 [源服务器IP] 的变量来尽可能规避风险。',\n                                okText: '好的，我调整一下',\n                                cancelText: '已知悉，确定执行',\n                                closeIcon: false,\n                                width: 500,\n                                confirmFn: () => {\n                                    // 聚焦到目标路径输入框\n                                    this.$refs.targetPath.$el.scrollIntoView();\n                                    this.$refs.targetPath.$el.querySelector('.bk-form-input').focus();\n                                    reject(new Error('transferMode change'));\n                                },\n                                cancelFn: () => {\n                                    resolve();\n                                },\n                            });\n                        } else {\n                            resolve();\n                        }\n                    }))\n                    .then(() => {\n                        const {\n                            name,\n                            timeout,\n                            uploadSpeedLimit,\n                            downloadSpeedLimit,\n                            transferMode,\n                            fileSourceList,\n                            account,\n                            path,\n                            server,\n                        } = this.formData;\n                        \n                        return TaskExecuteService.pushFile({\n                            name,\n                            uploadSpeedLimit: parseInt(uploadSpeedLimit, 10),\n                            downloadSpeedLimit: parseInt(downloadSpeedLimit, 10),\n                            timeout: parseInt(timeout, 10),\n                            fileSourceList,\n                            transferMode,\n                            fileDestination: {\n                                account,\n                                path,\n                                server,\n                            },\n                        }).then((data) => {\n                            window.changeAlert = false;\n                            this.$router.push({\n                                name: 'historyStep',\n                                params: {\n                                    taskInstanceId: data.taskInstanceId,\n                                },\n                                query: {\n                                    stepInstanceId: data.stepInstanceId,\n                                    from: 'fastPushFile',\n                                },\n                            });\n                            this.pushLocalStorage({\n                                id: Date.now(),\n                                name,\n                                taskInstanceId: data.taskInstanceId,\n                                stepInstanceId: data.stepInstanceId,\n                                formData: this.formData,\n                            });\n                        });\n                    })\n                    .catch(() => {\n                        this.isSubmiting = false;\n                    });\n            },\n            /**\n             * @desc 重置\n             */\n            handleCancel () {\n                this.$refs.pushFileForm.clearError();\n                this.formData = getDefaultData();\n            },\n        },\n    };\n</script>\n<style lang='postcss'>\n    @import \"@/css/mixins/media\";\n\n    html[lang=\"en-US\"] {\n        .recent-result {\n            margin-top: 6px;\n            transform: rotate(90deg);\n        }\n    }\n\n    .distro-file-page {\n        .push-file-form {\n            margin-bottom: 24px;\n\n            .card-box {\n                margin-bottom: 6px;\n            }\n\n            .form-item-content {\n                width: 500px;\n\n                @media (--small-viewports) {\n                    width: 500px;\n                }\n\n                @media (--medium-viewports) {\n                    width: 560px;\n                }\n\n                @media (--large-viewports) {\n                    width: 620px;\n                }\n\n                @media (--huge-viewports) {\n                    width: 680px;\n                }\n            }\n        }\n\n        .execution-history {\n            position: fixed;\n            top: 127px;\n            right: 0;\n            z-index: 99;\n            font-size: 12px;\n            line-height: 30px;\n            color: #c4c6cc;\n            background: #63656e;\n            border-bottom-left-radius: 2px;\n            transform: translateX(100%);\n            transition: all 0.35s;\n            user-select: none;\n\n            &.active {\n                transform: translateX(0);\n\n                .toggle-flag {\n                    transform: rotateZ(180deg);\n                }\n            }\n\n            .toggle-btn {\n                position: absolute;\n                top: 0;\n                left: -22px;\n                display: flex;\n                width: 22px;\n                height: 88px;\n                line-height: 13px;\n                color: #dcdee5;\n                text-align: center;\n                cursor: pointer;\n                background: #63656e;\n                border-right: 1px solid #757783;\n                border-bottom-left-radius: 8px;\n                border-top-left-radius: 8px;\n                flex-direction: column;\n                justify-content: center;\n\n                .toggle-flag {\n                    margin-bottom: 5px;\n                    color: #979ba5;\n                    transition: all 0.2s;\n                }\n            }\n\n            .history-content {\n                display: flex;\n                min-height: 90px;\n                padding: 12px 0;\n                flex-direction: column;\n                justify-content: center;\n            }\n\n            .item {\n                padding-right: 16px;\n                padding-left: 16px;\n                cursor: pointer;\n                transition: all 0.15s;\n\n                &:hover {\n                    color: #fff;\n                    background: #4f515a;\n                }\n            }\n        }\n    }\n</style>\n","var render = function () {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n  return _c(\n    \"div\",\n    {\n      directives: [\n        {\n          name: \"bkloading\",\n          rawName: \"v-bkloading\",\n          value: { isLoading: _vm.isLoading },\n          expression: \"{ isLoading }\",\n        },\n      ],\n      staticClass: \"distro-file-page\",\n    },\n    [\n      _c(\n        \"smart-action\",\n        {\n          attrs: { \"offset-target\": \"bk-form-content\" },\n          scopedSlots: _vm._u([\n            {\n              key: \"action\",\n              fn: function () {\n                return [\n                  _c(\n                    \"bk-button\",\n                    {\n                      directives: [\n                        {\n                          name: \"test\",\n                          rawName: \"v-test\",\n                          value: {\n                            type: \"button\",\n                            value: \"fastPushFileSubmit\",\n                          },\n                          expression:\n                            \"{ type: 'button', value: 'fastPushFileSubmit' }\",\n                        },\n                      ],\n                      staticClass: \"w120 mr10\",\n                      attrs: { theme: \"primary\", loading: _vm.isSubmiting },\n                      on: { click: _vm.handleSubmit },\n                    },\n                    [\n                      _vm._v(\n                        \"\\n                \" + _vm._s(\"执行\") + \"\\n            \"\n                      ),\n                    ]\n                  ),\n                  _vm._v(\" \"),\n                  _c(\n                    \"bk-button\",\n                    {\n                      directives: [\n                        {\n                          name: \"test\",\n                          rawName: \"v-test\",\n                          value: { type: \"button\", value: \"fastPushFileReset\" },\n                          expression:\n                            \"{ type: 'button', value: 'fastPushFileReset' }\",\n                        },\n                      ],\n                      on: { click: _vm.handleCancel },\n                    },\n                    [\n                      _vm._v(\n                        \"\\n                \" + _vm._s(\"重置\") + \"\\n            \"\n                      ),\n                    ]\n                  ),\n                ]\n              },\n              proxy: true,\n            },\n          ]),\n        },\n        [\n          _c(\n            \"jb-form\",\n            {\n              directives: [\n                {\n                  name: \"test\",\n                  rawName: \"v-test\",\n                  value: { type: \"form\", value: \"pushFile\" },\n                  expression: \"{ type: 'form', value: 'pushFile' }\",\n                },\n              ],\n              ref: \"pushFileForm\",\n              staticClass: \"push-file-form\",\n              attrs: { model: _vm.formData },\n            },\n            [\n              _c(\n                \"card-layout\",\n                { staticClass: \"block\", attrs: { title: \"基本信息\" } },\n                [\n                  _c(\"item-factory\", {\n                    attrs: {\n                      name: \"stepName\",\n                      field: \"name\",\n                      label: \"任务名称\",\n                      placeholder:\n                        \"取一个便于记忆的任务名，方便后续在历史记录中快速定位...\",\n                      \"form-data\": _vm.formData,\n                    },\n                    on: { \"on-change\": _vm.handleChange },\n                  }),\n                  _vm._v(\" \"),\n                  _c(\"item-factory\", {\n                    attrs: {\n                      name: \"timeout\",\n                      field: \"timeout\",\n                      \"form-data\": _vm.formData,\n                    },\n                    on: { \"on-change\": _vm.handleChange },\n                  }),\n                  _vm._v(\" \"),\n                  _c(\"item-factory\", {\n                    attrs: {\n                      name: \"speedLimit\",\n                      field: \"uploadSpeedLimit\",\n                      label: \"上传限速\",\n                      \"form-data\": _vm.formData,\n                    },\n                    on: { \"on-change\": _vm.handleChange },\n                  }),\n                  _vm._v(\" \"),\n                  _c(\"item-factory\", {\n                    attrs: {\n                      name: \"speedLimit\",\n                      field: \"downloadSpeedLimit\",\n                      label: \"下载限速\",\n                      \"form-data\": _vm.formData,\n                    },\n                    on: { \"on-change\": _vm.handleChange },\n                  }),\n                ],\n                1\n              ),\n              _vm._v(\" \"),\n              _c(\n                \"card-layout\",\n                { staticClass: \"block\", attrs: { title: \"文件来源\" } },\n                [\n                  _c(\"item-factory\", {\n                    attrs: {\n                      name: \"sourceFileOfExecution\",\n                      field: \"fileSourceList\",\n                      \"form-data\": _vm.formData,\n                    },\n                    on: { \"on-change\": _vm.handleChange },\n                  }),\n                ],\n                1\n              ),\n              _vm._v(\" \"),\n              _c(\n                \"card-layout\",\n                {\n                  staticClass: \"block\",\n                  staticStyle: { \"margin-bottom\": \"0\" },\n                  attrs: { title: \"传输目标\" },\n                },\n                [\n                  _c(\"item-factory\", {\n                    ref: \"targetPath\",\n                    attrs: {\n                      name: \"targetPath\",\n                      field: \"path\",\n                      \"tips-placement\": _vm.targetPathTipsPlacement,\n                      \"form-data\": _vm.formData,\n                    },\n                    on: { \"on-change\": _vm.handleChange },\n                  }),\n                  _vm._v(\" \"),\n                  _c(\"item-factory\", {\n                    attrs: {\n                      name: \"transferMode\",\n                      field: \"transferMode\",\n                      \"form-data\": _vm.formData,\n                    },\n                    on: { \"on-change\": _vm.handleChange },\n                  }),\n                  _vm._v(\" \"),\n                  _c(\"item-factory\", {\n                    attrs: {\n                      name: \"executeAccount\",\n                      field: \"account\",\n                      \"form-data\": _vm.formData,\n                    },\n                    on: { \"on-change\": _vm.handleChange },\n                  }),\n                  _vm._v(\" \"),\n                  _c(\"item-factory\", {\n                    attrs: {\n                      name: \"targetServerOfExecution\",\n                      field: \"server\",\n                      \"form-data\": _vm.formData,\n                    },\n                    on: { \"on-change\": _vm.handleChange },\n                  }),\n                ],\n                1\n              ),\n            ],\n            1\n          ),\n        ],\n        1\n      ),\n      _vm._v(\" \"),\n      _vm.historyList.length > 0\n        ? _c(\n            \"div\",\n            {\n              staticClass: \"execution-history\",\n              class: { active: _vm.isShowHistory },\n            },\n            [\n              _c(\n                \"div\",\n                {\n                  staticClass: \"toggle-btn\",\n                  on: { click: _vm.handleShowHistory },\n                },\n                [\n                  _c(\"Icon\", {\n                    staticClass: \"toggle-flag\",\n                    attrs: { type: \"angle-double-left\" },\n                  }),\n                  _vm._v(\" \"),\n                  _c(\"div\", { staticClass: \"recent-result\" }, [\n                    _vm._v(_vm._s(\"最近结果\")),\n                  ]),\n                ],\n                1\n              ),\n              _vm._v(\" \"),\n              _c(\n                \"div\",\n                { staticClass: \"history-content\" },\n                _vm._l(_vm.historyList, function (item) {\n                  return _c(\n                    \"div\",\n                    {\n                      key: item.id,\n                      staticClass: \"item\",\n                      on: {\n                        click: function ($event) {\n                          return _vm.handleGoHistoryDetail(item)\n                        },\n                      },\n                    },\n                    [\n                      _vm._v(\n                        \"\\n                \" +\n                          _vm._s(item.name) +\n                          \"\\n            \"\n                      ),\n                    ]\n                  )\n                }),\n                0\n              ),\n            ]\n          )\n        : _vm._e(),\n    ],\n    1\n  )\n}\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns }","import mod from \"-!../../../../node_modules/babel-loader/lib/index.js??clonedRuleSet-1[0].rules[0].use[0]!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../node_modules/babel-loader/lib/index.js??clonedRuleSet-1[0].rules[0].use[0]!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./index.vue?vue&type=template&id=eda052ca&\"\nimport script from \"./index.vue?vue&type=script&lang=js&\"\nexport * from \"./index.vue?vue&type=script&lang=js&\"\nimport style0 from \"./index.vue?vue&type=style&index=0&lang=postcss&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\n/* hot reload */\nif (module.hot) {\n  var api = require(\"/home/runner/work/bk-job-frontend/bk-job-frontend/node_modules/vue-hot-reload-api/dist/index.js\")\n  api.install(require('vue'))\n  if (api.compatible) {\n    module.hot.accept()\n    if (!api.isRecorded('eda052ca')) {\n      api.createRecord('eda052ca', component.options)\n    } else {\n      api.reload('eda052ca', component.options)\n    }\n    module.hot.accept(\"./index.vue?vue&type=template&id=eda052ca&\", function () {\n      api.rerender('eda052ca', {\n        render: render,\n        staticRenderFns: staticRenderFns\n      })\n    })\n  }\n}\ncomponent.options.__file = \"src/views/fast-execution/distro-file/index.vue\"\nexport default component.exports","// style-loader: Adds some css to the DOM by adding a <style> tag\n\n// load the styles\nvar content = require(\"!!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??clonedRuleSet-3[0].rules[0].use[1]!../../../../node_modules/css-loader/dist/cjs.js??clonedRuleSet-3[0].rules[0].use[2]!../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../node_modules/postcss-loader/dist/cjs.js!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=style&index=0&lang=postcss&\");\nif(content.__esModule) content = content.default;\nif(typeof content === 'string') content = [[module.id, content, '']];\nif(content.locals) module.exports = content.locals;\n// add the styles to the DOM\nvar add = require(\"!../../../../node_modules/vue-style-loader/lib/addStylesClient.js\").default\nvar update = add(\"dc7250e8\", content, false, {});\n// Hot Module Replacement\nif(module.hot) {\n // When the styles change, update the <style> tags\n if(!content.locals) {\n   module.hot.accept(\"!!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??clonedRuleSet-3[0].rules[0].use[1]!../../../../node_modules/css-loader/dist/cjs.js??clonedRuleSet-3[0].rules[0].use[2]!../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../node_modules/postcss-loader/dist/cjs.js!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=style&index=0&lang=postcss&\", function() {\n     var newContent = require(\"!!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??clonedRuleSet-3[0].rules[0].use[1]!../../../../node_modules/css-loader/dist/cjs.js??clonedRuleSet-3[0].rules[0].use[2]!../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../node_modules/postcss-loader/dist/cjs.js!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=style&index=0&lang=postcss&\");\n     if(newContent.__esModule) newContent = newContent.default;\n     if(typeof newContent === 'string') newContent = [[module.id, newContent, '']];\n     update(newContent);\n   });\n }\n // When the module is disposed, remove the <style> tags\n module.hot.dispose(function() { update(); });\n}"],"names":["name","fileSourceList","timeout","uploadSpeedLimit","transferMode","downloadSpeedLimit","account","path","server","components","JbForm","CardLayout","ItemFactory","data","isLoading","formData","isSubmiting","historyList","isShowHistory","targetPathTipsPlacement","computed","isEditNewSourceFile","created","mounted","window","methods","fetchData","id","then","stepInfo","fileDestination","finally","init","historyRecord","calcTargetPathTipsPlacement","timeTravel","pushLocalStorage","pushFileHistory","handleShowHistory","handleGoHistoryDetail","params","taskInstanceId","query","stepInstanceId","from","handleChange","handleSubmit","title","type","okText","cancelText","confirmFn","setTimeout","resolve","cancelFn","reject","sameHost","subTitle","width","closeIcon","catch","handleCancel","render","_vm","this","_h","$createElement","_c","_self","directives","rawName","value","expression","staticClass","attrs","scopedSlots","_u","key","fn","theme","loading","on","click","_v","_s","proxy","ref","model","field","label","placeholder","staticStyle","length","class","active","_l","item","$event","_e","_withStripped","component","options","__file","content","__esModule","default","module","locals","exports","add"],"sourceRoot":""}