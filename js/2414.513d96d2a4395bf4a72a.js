(self.webpackChunkjob=self.webpackChunkjob||[]).push([[2414],{99280:function(t,e,a){"use strict";a(35927),a(45974),a(43364);var n=a(22696);Object.defineProperty(e,"X",{value:!0}),e.Z=void 0,a(87033),a(35948),a(94522),a(71959),a(9042),a(23232),a(80433),a(7170);var i=n(a(33610)),s=n(a(38502)),r=n(a(15399)),o=n(a(47124)),l=n(a(54606)),c=n(a(52189)),d=n(a(81920)),u=n(a(63715));function f(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,n)}return a}var p={name:"",components:{PermissionSection:l.default,GlobalVariableLayout:c.default,GlobalVariable:d.default,Empty:u.default},props:{data:{type:Object,default:function(){return{}}},variableList:{type:Array,required:!0}},data:()=>({isLoading:!1,isEmpty:!1,isEditing:!1,isSubmiting:!1,info:{name:"",enable:!0,hasConfirm:!1,variableValue:[]}}),computed:{readonly(){return!this.data.enable||!this.isEditing&&this.info.hasConfirm}},created(){this.data.id&&(this.info=function(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?f(Object(a),!0).forEach((function(e){(0,i.default)(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):f(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}({},this.data),this.isEditing=!this.info.hasConfirm,this.info.hasConfirm||(this.info.variableValue=Object.freeze((0,s.default)(this.variableList)),this.fetchData()))},methods:{fetchData(){var t=this;this.isLoading=!0,o.default.getDetail({id:this.data.id},{permission:"catch"}).then((function(e){var a=e.name,n=e.variableValue;t.info.name=a,t.variableList.length<1&&(t.isEmpty=!0,t.$emit("on-change",[]));var i=n.reduce((function(t,e){return t[e.id]=e,t}),{});t.info.variableValue.forEach((function(t){if(i[t.id]){var e=i[t.id],a=e.value,n=e.targetValue;t.defaultValue=a,t.defaultTargetValue=n}}))})).finally((function(){t.isLoading=!1}))},handleToggleEdit(){this.isEditing=!0,this.$emit("on-update-confirm",!1)},handleSubmit(){var t=this;Promise.all(this.$refs.variable.map((function(t){return t.validate()}))).then((function(e){window.changeAlert=!1,t.isEditing=!1,t.info.hasConfirm=!0,t.info.variableValue=Object.freeze(e),t.messageSuccess(r.default.t("template.定时任务确认成功")),t.$emit("on-change",Object.freeze(e))}))},handleReset(){this.$refs.variable.forEach((function(t){return t.reset()}))}}};e.Z=p},49186:function(t,e,a){"use strict";a(35927),a(45974),a(9042),a(43364);var n=a(22696);Object.defineProperty(e,"X",{value:!0}),e.Z=void 0;var i=n(a(33610));a(57024),a(5580),a(87033),a(35948),a(94522),a(7170),a(71959);var s=n(a(47124)),r=n(a(94498)),o=n(a(83174));function l(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,n)}return a}function c(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?l(Object(a),!0).forEach((function(e){(0,i.default)(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):l(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}var d={name:"",components:{ScrollFaker:r.default,CronDetail:o.default},props:{templateInfo:{type:Object,required:!0},planId:{type:Number,required:!0},cronJobList:{type:Array,default:function(){return[]}}},data:()=>({isLoading:!0,isEmpty:!1,timeTaskList:[],currentTaskId:0}),computed:{detailInfo(){var t=this;return this.timeTaskList.find((function(e){return e.id===t.currentTaskId}))||{}}},created(){this.templateId=this.templateInfo.id,this.templateVariableList=this.templateInfo.variables,this.fetchTimeTaskList()},methods:{fetchTimeTaskList(){var t=this;if(this.cronJobList.length>0)return this.timeTaskList=this.cronJobList,void(this.currentTaskId=this.cronJobList[0].id);this.isLoading=!0,s.default.fetchTaskOfPlan({id:this.planId}).then((function(e){e.length<1?t.isEmpty=!0:(t.timeTaskList=e.map((function(t){return{id:(e=t).id,name:e.name,enable:e.enable,hasConfirm:!1,variableValue:[]};var e})),e.length>0&&(t.currentTaskId=e[0].id))})).finally((function(){t.isLoading=!1}))},trigger(){var t=this.timeTaskList.reduce((function(t,e){return t.push(c(c({},e),{},{variableValue:e.enable?e.variableValue:[]})),t}),[]);this.$emit("on-change",t)},handleTabChange(t){this.currentTaskId=t},handleEnableChange(t,e){var a=this.timeTaskList.find((function(e){return e.id===t}));a.enable=e,a.hasConfirm=!1,this.trigger()},handleVariableChange(t){var e=this,a=this.timeTaskList.find((function(t){return t.id===e.currentTaskId}));a.variableValue=Object.freeze(t),a.hasConfirm=!0,this.trigger()},handleUpdateConfirm(t){var e=this;this.timeTaskList.find((function(t){return t.id===e.currentTaskId})).hasConfirm=t,this.trigger()}}};e.Z=d},74037:function(t,e,a){"use strict";var n=a(22696);Object.defineProperty(e,"X",{value:!0}),e.Z=void 0,a(57024),a(87033),a(35948),a(94522);var i=n(a(22910)),s={name:"",components:{ConfirmCron:n(a(32139)).default},props:{isShow:{type:Boolean,default:!1},templateId:{type:Number,required:!0},planId:{type:Number,required:!0},cronJobInfoList:{type:Array,default:function(){return[]}}},data:()=>({isShowDialog:!1,isLoading:!0,templateInfo:{}}),watch:{templateId(t){t<0||this.fetchData()}},methods:{fetchData(){var t=this;this.isLoading=!0,i.default.taskDetail({id:this.templateId}).then((function(e){t.templateInfo=Object.freeze(e)})).finally((function(){t.isLoading=!1}))},handleClose(){this.$emit("on-close")},handleConfirmCron(t){this.$emit("on-change",t)}}};e.Z=s},11607:function(t,e,a){"use strict";a(35927),a(45974),a(43364);var n=a(22696);Object.defineProperty(e,"X",{value:!0}),e.Z=void 0,a(87033),a(9042),a(35948),a(94522),a(23232),a(80433),a(71959),a(70969);var i=n(a(56318)),s=n(a(33610)),r=n(a(93435)),o=n(a(38502)),l=n(a(15399)),c=n(a(22910)),d=n(a(84484)),u=n(a(47124)),f=n(a(61635)),p=n(a(80712)),h=a(41980),m=n(a(96587));function b(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,n)}return a}function v(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?b(Object(a),!0).forEach((function(e){(0,s.default)(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):b(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}var _=function(t,e){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){},n=0,i=function i(){(n+=1)>=t.length?a():e(t[n],i)};e(t[n],i)},g={name:"",components:{ListActionLayout:p.default,ConfirmCron:m.default},data:()=>({isLoading:!0,data:[],tableHeight:"",isCronJobLoading:!1,isConfirmLoading:!1,isComfirmAllFinished:!1,isSyncLoading:!1,isShowConfirmCron:!1,isFinished:!1,syncValueMemoMap:{},selectPlanInfo:{templateId:-1,planId:-1,cronJobInfoList:[]}}),computed:{isSkeletonLoading(){return this.isLoading},planConfirmInfo(){var t=0,e=0;return this.data.forEach((function(a){a.isConfirmed?t+=1:e+=1})),{confirmed:t,unconfirmed:e}},syncSubmitInvalid(){for(var t=0;t<this.data.length;t++){if(this.data[t].needUpdate)return!1}return!0}},created(){var t=this.$route.query.planIds,e=void 0===t?"":t;this.planIds=e,this.lastOnePlanTemplateId="",this.fetchData()},mounted(){this.calcTableHeight()},methods:{fetchData(){var t=this;this.isLoading=!0,d.default.fetchBatchPlan({planIds:this.planIds}).then((function(e){var a=[],n={};e.forEach((function(e){var i=new f.default(e);a.push(i),t.lastOnePlanTemplateId=e.templateId,i.cronJobCount>0&&(i.status=f.default.STATUS_CRON_JOB_LOADING,n[i.id]=i)})),t.data=a;var i=Object.keys(n);i.length>0&&(t.isCronJobLoading=!0,u.default.fetchTaskOfPlanBatch({planIds:i.join(",")}).then((function(t){for(var e in t){t[e].some((function(t){return t.enable}))?n[e].status=f.default.STATUS_DEFAULT:n[e].status=f.default.STATUS_CONFIRMED}})).finally((function(){t.isCronJobLoading=!1}))),t.data.length>0&&(window.changeAlert=!0)})).finally((function(){t.isLoading=!1}))},calcTableHeight(){var t=(0,h.getOffset)(this.$refs.list).top,e=window.innerHeight;this.tableHeight=e-t-77},calcRowClass(t){var e="template-plan-sync-record";return t.row.canEdit||(e="".concat(e," sync-permission")),e},handleConfirmAll(){var t=this;window.changeAlert=!0,this.isConfirmLoading=!0;var e=v({},this.syncValueMemoMap);this.data.forEach((function(t){e[t.id]||(t.status=f.default.STATUS_CONFIRM_QUEUE)}));var a=0;_(this.data,(function(t,n){var s=t,r={planId:s.id,templateId:s.templateId,templateVersion:s.templateVersion,cronJobInfoList:[]};if(s.canView&&s.canEdit)if(s.isConfirmed)n();else{if(s.isPassConfirm)return e[s.id]=r,void n();s.status=f.default.STATUS_CONFIRM_PENDGING,Promise.all([c.default.taskDetail({id:s.templateId}),u.default.fetchTaskOfPlan({id:s.id})]).then((function(t){for(var n=(0,i.default)(t,2),c=n[0],d=n[1],u=c.variables,p=!1,h=!1,m=[],b=0;b<d.length;b++){var v=d[b],_={id:v.id,name:v.name,enable:v.enable,hasConfirm:!1,variableValue:[]};if(v.canManage)if(v.enable){for(var g=v.variableValue.reduce((function(t,e){return t[e.id]=e,t}),{}),C=[],y=0;y<u.length;y++){var S=(0,o.default)(u[y]);if(g[S.id]){var T=g[S.id],I=T.value,L=T.targetValue;S.defaultValue=I,S.defaultTargetValue=L}S.isRequired&&S.isEmpty&&(p=!0);var O=S.id,k=S.name,E=S.type,A=S.defaultValue,w=S.defaultTargetValue;C.push({id:O,name:k,type:E,defaultValue:A,defaultTargetValue:w,value:A,targetValue:w})}_.hasConfirm=!p,_.variableValue=C,m.push(_)}else m.push(_);else h=!0,m.push(_)}e[s.id]||(r.cronJobInfoList=m,e[s.id]=r),s.cronJobInfoList=m,p?(s.status=f.default.STATUS_CONFIRM_FAILED,s.error=l.default.t("template.定时任务中必填变量未赋值"),a+=1):h?(s.status=f.default.STATUS_CONFIRM_FAILED,s.error=l.default.t("template.没有定时任务管理权限，请手动确认"),a+=1):s.status=f.default.STATUS_CONFIRMED})).catch((function(){s.status=f.default.STATUS_CONFIRM_FAILED,s.error=l.default.t("template.自动确认定时任务失败，请手动确认"),a+=1})).finally((function(){n()}))}else n()}),(function(){t.isConfirmLoading=!1,t.syncValueMemoMap=Object.freeze(e),t.isComfirmAllFinished=!0,a>0&&t.messageError("".concat(a," ").concat(l.default.t("template.项执行方案的确认出现问题，请逐个确认")))}))},handleGoDiff(t){var e=this.$router.resolve({name:"syncPlan",params:{id:t.id,templateId:t.templateId},query:{mode:"view"}});window.open(e.href)},handleConfirmCron(t){var e=[];this.syncValueMemoMap[t.id]&&(e=this.syncValueMemoMap[t.id].cronJobInfoList),this.isShowConfirmCron=!0,this.selectPlanInfo={templateId:t.templateId,planId:t.id,cronJobInfoList:e}},hanndleSelectPlanConfirmClose(){this.isShowConfirmCron=!1,this.selectPlanInfo={templateId:-1,planId:-1,cronJobInfoList:[]}},handleSelectPlanConfirmChange(t){var e=this;window.changeAlert=!0;var a=v({},this.syncValueMemoMap);a[this.selectPlanInfo.planId]={templateId:this.selectPlanInfo.templateId,id:this.selectPlanInfo.planId,cronJobInfoList:t},this.syncValueMemoMap=Object.freeze(a);var n=(0,r.default)(this.data,(function(t){return t.id===e.selectPlanInfo.planId}));t.every((function(t){return t.hasConfirm||!t.enable}))&&(n.status=f.default.STATUS_CONFIRMED),n.cronJobInfoList=t,this.data=[...this.data]},handleSubmitSync(){var t=this;this.isSyncLoading=!0,this.data.forEach((function(t){t.needUpdate&&(t.status=f.default.STATUS_SYNC_QUEUE)}));_(this.data,(function(e,a){var n=e;if(!n.needUpdate)return n.status=f.default.STATUS_SYNCED,void a();n.status=f.default.STATUS_SYNC_PENDING,d.default.planSyncInfo({planId:n.id,templateId:n.templateId,templateVersion:n.templateVersion}).then((function(){return t.syncValueMemoMap[n.id]&&t.syncValueMemoMap[n.id].cronJobInfoList.length>0?u.default.updatePlanTask({cronJobInfoList:t.syncValueMemoMap[n.id].cronJobInfoList}):Promise.resolve()})).then((function(){n.status=f.default.STATUS_SYNCED})).catch((function(){n.status=f.default.STATUS_SYNC_FAILED})).finally((function(){a()}))}),(function(){t.isSyncLoading=!1,t.isFinished=!0,window.changeAlert=!1}))},handleSyncRetry(t){var e=this;t.status=f.default.STATUS_SYNC_PENDING,d.default.planSyncInfo({planId:t.id,templateId:t.templateId,templateVersion:t.templateVersion}).then((function(){return u.default.updatePlanTask({cronJobInfoList:e.syncValueMemoMap[t.id].cronJobList})})).then((function(){t.status=f.default.STATUS_SYNCED})).catch((function(){t.error=l.default.t("template.同步请求失败，请重试"),t.status=f.default.STATUS_SYNC_FAILED}))},handleCancle(){var t=this;(0,h.leaveConfirm)().then((function(){t.routerBack()}))},handleFinish(){window.changeAlert=!1,this.routerBack()},routerBack(){var t=this.$route.query.from;"viewPlan"===t?this.$router.push({name:"viewPlan",params:{templateId:this.lastOnePlanTemplateId}}):"planList"===t?this.$router.push({name:"planList"}):"templateDetail"===t?this.$router.push({name:"templateDetail",params:{id:this.lastOnePlanTemplateId}}):"templateEdit"===t?this.$router.push({name:"viewPlan",params:{templateId:this.lastOnePlanTemplateId}}):this.$router.push({name:"planList"})}}};e.Z=g},61635:function(t,e,a){"use strict";var n=a(22696);Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,a(61026),a(60259),a(70969),a(87033),a(9042);var i=n(a(33610)),s=n(a(15399)),r=5;class o{constructor(t){this.id=t.id,this.name=t.name,this.createTime=t.createTime,this.creator=t.creator,this.cronJobCount=t.cronJobCount||0,this.hasCronJob=t.hasCronJob||!1,this.lastModifyTime=t.lastModifyTime,this.lastModifyUser=t.lastModifyUser,this.needUpdate=t.needUpdate,this.stepList=t.stepList||[],this.templateId=t.templateId,this.templateName=t.templateName,this.templateVersion=t.templateVersion,this.variableList=Object.freeze(t.variableList||[]),this.version=t.version,this.canDelete=t.canDelete,this.canEdit=t.canEdit,this.canView=t.canView,this._cronJonList=[],this._error="",this._status=o.STATUS_DEFAULT,(this.cronJobCount<1||!this.needUpdate)&&(this._status=o.STATUS_CONFIRMED),this.canEdit||(this._status=o.STATUS_PERMISSION)}get cronJobInfoList(){return this._cronJonList}set cronJobInfoList(t){this._cronJonList=t}get error(){return this._error}set error(t){this._error=t}get status(){return o.STATUS_TEXT_MAP[this._status]}set status(t){this.canEdit&&this.needUpdate&&([o.STATUS_CONFIRM_FAILED,o.STATUS_SYNC_FAILED].includes(t)||(this._error=""),[r].includes(this._status)&&[o.STATUS_CONFIRM_QUEUE,o.STATUS_CONFIRM_PENDGING,o.STATUS_CONFIRM_FAILED].includes(t)||(this._status=t))}get statusHtml(){var t="";return[o.STATUS_CONFIRM_FAILED,o.STATUS_SYNC_FAILED].includes(this._status)&&this._error&&(t='tippy-tips="'.concat(this._error,'"')),"<span ".concat(t,">").concat(o.STATUS_TEXT_MAP[this._status],"</span>")}get statusIcon(){return o.STATUS_ICON_MAP[this._status]}get isCronJobLoading(){return this._status===o.STATUS_CRON_JOB_LOADING}get isPassConfirm(){return this.cronJobCount<1||!this.needUpdate}get isSyncDisabled(){return!this.needUpdate}get isConfirmed(){return![o.STATUS_DEFAULT,o.STATUS_CONFIRM_QUEUE,o.STATUS_CONFIRM_PENDGING,o.STATUS_CONFIRM_FAILED].includes(this._status)}get isRetryEnable(){return this._status===o.STATUS_SYNC_FAILED}get disableDiffTips(){return this.needUpdate?"":s.default.t("方案已是最新版，无差异")}get disableConfirmTips(){return this.needUpdate?this.cronJobCount<1?s.default.t("无关联定时任务，系统自动确认"):"":s.default.t("该方案已同步，无需处理")}get confirmProcessText(){if(this.isConfirmed)return"".concat(this.cronJobCount,"/").concat(this.cronJobCount);var t=0;return this._cronJonList.forEach((function(e){!e.hasConfirm&&e.enable||(t+=1)})),"".concat(t,"/").concat(this.cronJobCount)}}e.default=o,(0,i.default)(o,"STATUS_CRON_JOB_LOADING",-1),(0,i.default)(o,"STATUS_DEFAULT",0),(0,i.default)(o,"STATUS_CONFIRM_QUEUE",2),(0,i.default)(o,"STATUS_CONFIRM_PENDGING",3),(0,i.default)(o,"STATUS_CONFIRM_FAILED",4),(0,i.default)(o,"STATUS_CONFIRMED",r),(0,i.default)(o,"STATUS_SYNC_QUEUE",6),(0,i.default)(o,"STATUS_SYNC_PENDING",7),(0,i.default)(o,"STATUS_SYNC_FAILED",8),(0,i.default)(o,"STATUS_SYNCED",9),(0,i.default)(o,"STATUS_PERMISSION",10),(0,i.default)(o,"STATUS_TEXT_MAP",{[-1]:"",0:s.default.t("未就绪"),2:s.default.t("等待确认中"),3:s.default.t("确认中"),4:s.default.t("未就绪，确认失败"),[r]:s.default.t("已就绪"),6:s.default.t("等待同步中"),7:s.default.t("同步中"),8:s.default.t("同步失败"),9:s.default.t("同步成功"),10:s.default.t("无同步权限")}),(0,i.default)(o,"STATUS_ICON_MAP",{[-1]:"sync-pending",0:"sync-default",2:"sync-default",3:"sync-pending",4:"sync-failed",[r]:"sync-success",6:"sync-default",7:"sync-pending",8:"sync-failed",9:"sync-success",10:"sync-default"})},27772:function(){},43582:function(){},77272:function(){},3684:function(){},83174:function(t,e,a){"use strict";a.r(e),a.d(e,{__esModule:function(){return i.X},default:function(){return o}});var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("permission-section",[a("smart-action",{attrs:{"offset-target":"variable-value"},scopedSlots:t._u([t.isLoading||t.isEmpty?null:{key:"action",fn:function(){return[t.isEditing?a("bk-button",{staticClass:"mr10",attrs:{theme:"primary",disabled:!t.data.enable},on:{click:t.handleSubmit}},[t._v("\n                "+t._s(t.$t("template.确认"))+"\n            ")]):t._e(),t._v(" "),t.isEditing?a("bk-button",{staticClass:"mr10",attrs:{disabled:!t.data.enable},on:{click:t.handleReset}},[t._v("\n                "+t._s(t.$t("template.重置"))+"\n            ")]):a("bk-button",{staticClass:"mr10",attrs:{theme:"primary",disabled:!t.data.enable},on:{click:t.handleToggleEdit}},[t._v("\n                "+t._s(t.$t("template.编辑"))+"\n            ")])]},proxy:!0}],null,!0)},[a("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:t.isLoading},expression:"{ isLoading }"}],staticClass:"cron-job-detail",class:{"is-loading":t.isLoading}},[a("bk-alert",{attrs:{title:t.$t("template.同步执行方案需要重新确认定时任务的全局变量，不使用的定时任务可以直接停用。")}}),t._v(" "),a("div",{staticClass:"title"},[a("span",[t._v("「"+t._s(t.info.name)+"」"+t._s(t.$t("template.的全局变量")))]),t._v(" "),t.data.enable?t.data.hasConfirm?a("span",{staticClass:"confirm"},[t._v(t._s(t.$t("template.已确认")))]):a("span",{staticClass:"waiting"},[t._v(t._s(t.$t("template.待确认")))]):a("span",{staticClass:"disable"},[t._v(t._s(t.$t("template.已停用")))])]),t._v(" "),a("div",[t.isLoading?t._e():a("global-variable-layout",t._l(t.info.variableValue,(function(e){return a("global-variable",{key:e.id,ref:"variable",refInFor:!0,attrs:{type:e.type,readonly:t.readonly,data:e}})})),1),t._v(" "),t.isEmpty?a("empty",[a("p",[t._v(t._s(t.$t("template.无关联的全局变量")))]),t._v(" "),a("p",{staticStyle:{"margin-top":"8px"}},[t._v(t._s(t.$t("template.已直接确认")))])]):t._e()],1)],1)])],1)};n._withStripped=!0;var i=a(99280),s=i.Z,r=(a(71778),(0,a(35471).Z)(s,n,[],!1,null,"0d5ec9cc",null));r.options.__file="src/views/task-manage/common/plan/confirm-cron/cron-detail.vue";var o=r.exports},32139:function(t,e,a){"use strict";a.r(e),a.d(e,{__esModule:function(){return i.X},default:function(){return o}});var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"plan-manage-confirm-cron",attrs:{empty:t.isEmpty,loading:t.isLoading}},[a("div",{staticClass:"layout-left"},[a("scroll-faker",t._l(t.timeTaskList,(function(e){return a("div",{key:e.id,staticClass:"cron-job-tab",class:{active:e.id===t.currentTaskId}},[a("auth-component",{attrs:{permission:e.canManage,auth:"cron/view","resource-id":e.id}},[a("div",{staticClass:"tab-container",on:{click:function(a){return t.handleTabChange(e.id)}}},[a("span",{staticClass:"job-name"},[t._v(t._s(e.name))]),t._v(" "),e.hasConfirm?a("Icon",{staticClass:"job-check",attrs:{type:"check"}}):t._e(),t._v(" "),a("div",{on:{click:function(t){t.stopPropagation()}}},[a("bk-switcher",{staticClass:"job-switch",attrs:{value:e.enable,size:"small",theme:"primary"},on:{change:function(a){return t.handleEnableChange(e.id,a)}}})],1)],1),t._v(" "),a("div",{staticClass:"tab-container",attrs:{slot:"forbid"},slot:"forbid"},[a("span",{staticClass:"job-name"},[t._v(t._s(e.name))]),t._v(" "),e.hasConfirm?a("Icon",{staticClass:"job-check",attrs:{type:"check"}}):t._e(),t._v(" "),a("div",{on:{click:function(t){t.stopPropagation()}}},[a("bk-switcher",{staticClass:"job-switch",attrs:{value:e.enable,size:"small",disabled:"",theme:"primary"},on:{change:function(a){return t.handleEnableChange(e.id,a)}}})],1)],1)])],1)})),0)],1),t._v(" "),a("div",{staticClass:"layout-right"},[a("scroll-faker",[a("cron-detail",{key:t.detailInfo.id,attrs:{data:t.detailInfo,"variable-list":t.templateVariableList},on:{"on-change":t.handleVariableChange,"on-update-confirm":t.handleUpdateConfirm}})],1)],1)])};n._withStripped=!0;var i=a(49186),s=i.Z,r=(a(37189),(0,a(35471).Z)(s,n,[],!1,null,null,null));r.options.__file="src/views/task-manage/common/plan/confirm-cron/index.vue";var o=r.exports},96587:function(t,e,a){"use strict";a.r(e),a.d(e,{__esModule:function(){return i.X},default:function(){return o}});var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("jb-dialog",{staticClass:"plan-confirm-cron-dialog",attrs:{value:t.isShow,fullscreen:""},on:{cancel:t.handleClose}},[a("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:t.isLoading},expression:"{ isLoading }"}],staticClass:"confirm-cron-wraper",on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"esc",27,e.key,["Esc","Escape"])?null:t.handleClose.apply(null,arguments)}}},[t.isLoading?t._e():a("confirm-cron",{attrs:{"template-info":t.templateInfo,"plan-id":t.planId,"cron-job-list":t.cronJobInfoList},on:{"on-change":t.handleConfirmCron}})],1)])};n._withStripped=!0;var i=a(74037),s=i.Z,r=(a(14790),(0,a(35471).Z)(s,n,[],!1,null,null,null));r.options.__file="src/views/task-manage/sync-plan-batch/components/confirm-cron.vue";var o=r.exports},22414:function(t,e,a){"use strict";a.r(e),a.d(e,{__esModule:function(){return i.X},default:function(){return o}});var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"sync-plan-batch-page"},[a("list-action-layout",{scopedSlots:t._u([{key:"right",fn:function(){return[a("bk-button",{attrs:{theme:"primary",loading:t.isConfirmLoading||t.isCronJobLoading,disabled:t.planConfirmInfo.unconfirmed<1||t.isComfirmAllFinished},on:{click:t.handleConfirmAll}},[t._v("\n                "+t._s(t.$t("template.全部确认"))+"\n            ")])]},proxy:!0}])}),t._v(" "),a("div",{staticClass:"render-list-header"},[a("div",{staticClass:"list-name"},[a("span",[t._v(t._s(t.$t("template.同步执行方案")))]),t._v(" "),a("span",{staticClass:"total"},[t._v("（"+t._s(t.$t("template.共"))+" "+t._s(t.data.length)+" "+t._s(t.$t("template.个.total"))+"）")])]),t._v(" "),a("div",{staticClass:"item-status"},[t.isCronJobLoading?[a("Icon",{staticClass:"plan-cron-job-loading",attrs:{type:"sync-pending",svg:""}})]:[a("span",{staticClass:"confirmed"},[t._v(t._s(t.planConfirmInfo.confirmed))]),t._v(t._s(t.$t("template.个已就绪"))+" ，\n                "),a("span",{staticClass:"unconfirmed"},[t._v(t._s(t.planConfirmInfo.unconfirmed))]),t._v(t._s(t.$t("template.个未就绪"))+"\n            ")]],2)]),t._v(" "),a("div",{ref:"list"},[t.tableHeight?a("bk-table",{staticClass:"sync-plan-list",attrs:{data:t.data,"max-height":t.tableHeight,"row-class-name":t.calcRowClass,selectable:""}},[a("bk-table-column",{key:"name",attrs:{label:t.$t("template.执行方案.colHead"),prop:"name",align:"left"},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row;return[a("auth-router-link",{attrs:{permission:n.canView,auth:"job_plan/view","resource-id":n.id,target:"_blank",to:{name:"viewPlan",params:{templateId:n.templateId},query:{viewPlanId:n.id}}}},[t._v("\n                        "+t._s(n.name)+"\n                        "),a("Icon",{staticClass:"open-link-flag",attrs:{type:"edit"}})],1)]}}],null,!1,3272072453)}),t._v(" "),a("bk-table-column",{key:"templateName",attrs:{label:t.$t("template.所属作业模板"),prop:"templateName",align:"left"},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row;return[a("router-link",{attrs:{target:"_blank",to:{name:"templateDetail",params:{id:n.templateId}}}},[t._v("\n                        "+t._s(n.templateName)+"\n                        "),a("Icon",{staticClass:"open-link-flag",attrs:{type:"edit"}})],1)]}}],null,!1,739886681)}),t._v(" "),a("bk-table-column",{key:"statusText2",attrs:{label:t.$t("template.状态"),prop:"statusText","class-name":"status-column",align:"left"},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row;return[a("div",{staticClass:"confirm-status-box"},[a("Icon",{staticClass:"status-flag",class:n.statusIcon,attrs:{type:n.statusIcon,svg:""}}),t._v(" "),a("span",{domProps:{innerHTML:t._s(n.statusHtml)}}),t._v(" "),n.isRetryEnable?a("bk-button",{staticClass:"ml10",attrs:{text:""},on:{click:function(e){return t.handleSyncRetry(n)}}},[t._v("\n                            "+t._s(t.$t("template.重试"))+"\n                        ")]):t._e()],1)]}}],null,!1,4153748533)}),t._v(" "),a("bk-table-column",{key:"action",attrs:{resizable:!1,label:t.$t("template.操作"),width:"280",align:"left"},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row;return[a("span",{staticClass:"mr10",attrs:{"tippy-tips":n.disableDiffTips}},[a("bk-button",{attrs:{disabled:!!n.disableDiffTips,text:""},on:{click:function(e){return t.handleGoDiff(n)}}},[t._v("\n                            "+t._s(t.$t("template.查看差异"))+"\n                        ")])],1),t._v(" "),n.isCronJobLoading?[a("Icon",{staticClass:"plan-cron-job-loading",attrs:{type:"sync-pending",svg:""}})]:[a("span",{staticClass:"mr10",attrs:{"tippy-tips":n.disableConfirmTips}},[a("bk-button",{attrs:{text:"",loading:n.isCronJobLoading,disabled:!!n.disableConfirmTips},on:{click:function(e){return t.handleConfirmCron(n)}}},[t._v("\n                                "+t._s(t.$t("template.确认定时任务"))+"\n                            ")])],1),t._v(" "),a("div",{staticClass:"confirm-status",class:{confirmed:n.isConfirmed}},[t._v("\n                            "+t._s(n.confirmProcessText)+"\n                        ")])]]}}],null,!1,3252514561)})],1):t._e()],1),t._v(" "),a("div",{staticClass:"sync-plan-action"},[t.isFinished?a("bk-button",{staticClass:"w120",attrs:{theme:"primary"},on:{click:t.handleFinish}},[t._v("\n            "+t._s(t.$t("template.完成"))+"\n        ")]):[a("bk-button",{staticClass:"mr10",on:{click:t.handleCancle}},[t._v("\n                "+t._s(t.$t("template.取消"))+"\n            ")]),t._v(" "),a("span",{attrs:{"tippy-tips":t.syncSubmitInvalid?t.$t("template.所有方案均已同步至最新版"):""}},[a("bk-button",{staticClass:"w120",attrs:{theme:"primary",loading:t.isSyncLoading||t.isCronJobLoading,disabled:t.syncSubmitInvalid||t.planConfirmInfo.unconfirmed>0},on:{click:t.handleSubmitSync}},[t._v("\n                    "+t._s(t.$t("template.立即同步"))+"\n                ")])],1)]],2),t._v(" "),a("confirm-cron",t._b({attrs:{"is-show":t.isShowConfirmCron},on:{"on-change":t.handleSelectPlanConfirmChange,"on-close":t.hanndleSelectPlanConfirmClose}},"confirm-cron",t.selectPlanInfo,!1))],1)};n._withStripped=!0;var i=a(11607),s=i.Z,r=(a(39070),(0,a(35471).Z)(s,n,[],!1,null,null,null));r.options.__file="src/views/task-manage/sync-plan-batch/index.vue";var o=r.exports},71778:function(t,e,a){var n=a(27772);n.__esModule&&(n=n.default),"string"==typeof n&&(n=[[t.id,n,""]]),n.locals&&(t.exports=n.locals);(0,a(13570).Z)("50f00a59",n,!1,{})},37189:function(t,e,a){var n=a(43582);n.__esModule&&(n=n.default),"string"==typeof n&&(n=[[t.id,n,""]]),n.locals&&(t.exports=n.locals);(0,a(13570).Z)("63268a04",n,!1,{})},14790:function(t,e,a){var n=a(77272);n.__esModule&&(n=n.default),"string"==typeof n&&(n=[[t.id,n,""]]),n.locals&&(t.exports=n.locals);(0,a(13570).Z)("4ab25629",n,!1,{})},39070:function(t,e,a){var n=a(3684);n.__esModule&&(n=n.default),"string"==typeof n&&(n=[[t.id,n,""]]),n.locals&&(t.exports=n.locals);(0,a(13570).Z)("022ca75d",n,!1,{})}}]);