(self.webpackChunkjob=self.webpackChunkjob||[]).push([[9628],{48699:function(t,e,a){"use strict";a(13118),a(59241),a(20767);var s=a(70534);Object.defineProperty(e,"X",{value:!0}),e.Z=void 0,a(41336),a(91981),a(63898),a(87147),a(63876),a(94354),a(14309);var i=s(a(68203)),r=s(a(41844)),n=s(a(74650)),l=s(a(51391)),o=a(2938),d=s(a(89825)),u=s(a(70481)),p=s(a(11944)),c=s(a(71693)),m=s(a(62307)),f=s(a(8764)),h=s(a(35549)),v=s(a(18094)),b=s(a(96187));function k(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,s)}return a}function g(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?k(Object(a),!0).forEach((function(e){(0,i.default)(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):k(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}var _={name:"TemplateDetail",components:{DetailLayout:d.default,DetailItem:u.default,BackTop:p.default,RenderGlobalVar:v.default,RenderTaskStep:b.default,JbEditInput:c.default,JbEditTag:m.default,JbEditTextarea:f.default,JbPopoverConfirm:h.default},data:()=>({isLoading:!0,isPlanListLoading:!0,formData:{createTime:"",creator:"",description:"",favored:!1,id:0,lastModifyTime:"",lastModifyUser:"",name:"",needUpdate:!1,status:0,stepList:[{},{},{}],tags:[],variables:[]},planList:[{},{},{}],deleteLoading:!1}),computed:{isSkeletonLoading(){return this.isLoading},isNotNeedUpdate(){return!this.planList.some((function(t){return t.needUpdate}))},notNeedUpdateTips(){return this.planList.length<1?"该模板下面没有执行方案":this.planList.every((function(t){return!t.needUpdate}))?"该模板下面的所有执行方案已是最新版":""}},created(){this.taskId=this.$route.params.id,this.initShowScriptUpdateStep="scriptUpdate"===this.$route.query.mode,this.formDataLocal={},this.fetchData(),this.fetchPlanList(),this.rules={name:[{required:!0,message:"模板名称必填",trigger:"blur"},{validator:o.taskTemplateName.validator,message:o.taskTemplateName.message,trigger:"blur"},{validator:this.checkName,message:"模板名称已存在，请重新输入",trigger:"blur"}]}},methods:{fetchData(){var t=this,e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];n.default.taskDetail({id:this.taskId},{permission:"page"}).then((function(a){if(e){var s=a.name,i=a.description,n=a.tags;t.formData.name=s,t.formData.description=i,t.formData.tags=n,t.formDataLocal=a}else t.formData=a,t.formDataLocal=g({},a),t.initShowScriptUpdateStep&&setTimeout((function(){var e=a.stepList,s=(0,r.default)(e,(function(t){return t.isScriptDisabled||t.isScriptNeedUpdate}));s>-1&&t.$refs.step.clickStepByIndex(s)}))})).catch((function(e){[1,400].includes(e.code)&&setTimeout((function(){t.$router.push({name:"taskList"})}),3e3)})).finally((function(){t.isLoading=!1}))},fetchPlanList(){var t=this;this.isPlanListLoading=!0,l.default.fetchTaskPlan({id:this.taskId}).then((function(e){t.planList=Object.freeze(e)})).finally((function(){t.isPlanListLoading=!1}))},checkName(t){return n.default.taskCheckName({id:this.taskId,name:t})},handleUpdateTemplate(t){var e=this,a=this.formDataLocal,s=a.name,i=a.description,r=a.tags;return n.default.taskUpdateBasic(g({id:this.taskId,name:s,description:i,tags:r},t)).then((function(){e.fetchData(!0)}))},handleGoExec(){this.$router.push({name:"viewPlan",params:{templateId:this.taskId},query:{from:"templateDetail"}})},handleGoDebug(){this.$router.push({name:"debugPlan",params:{id:this.taskId},query:{from:"templateDetail"}})},handleGoSyncPlan(){this.$router.push({name:"syncPlanBatch",query:{planIds:this.planList.map((function(t){return t.id})).join(","),from:"templateDetail"}})},handleGoEdit(){this.$router.push({name:"templateEdit",params:{id:this.taskId},query:{from:"templateDetail"}})},handleDelete(){var t=this;return n.default.taskDelete({id:this.taskId}).then((function(){return t.routerBack(),!0}))},routerBack(){this.$router.push({name:"taskList"})}}};e.Z=_},37839:function(){},39628:function(t,e,a){"use strict";a.r(e),a.d(e,{__esModule:function(){return i.X},default:function(){return l}});var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("smart-action",{staticClass:"task-template-detail",attrs:{"offset-target":"detail-content"},scopedSlots:t._u([{key:"action",fn:function(){return[a("div",{staticClass:"action-box"},[a("bk-button",{directives:[{name:"test",rawName:"v-test",value:{type:"button",value:"planList"},expression:"{ type: 'button', value: 'planList' }"}],staticClass:"w120 mr10",attrs:{theme:"primary"},on:{click:t.handleGoExec}},[t._v("\n                "+t._s("选择方案")+"\n            ")]),t._v(" "),a("auth-button",{directives:[{name:"test",rawName:"v-test",value:{type:"button",value:"debugTemplate"},expression:"{ type: 'button', value: 'debugTemplate' }"}],staticClass:"mr10",attrs:{"resource-id":t.taskId,auth:"job_template/debug"},on:{click:t.handleGoDebug}},[t._v("\n                "+t._s("调试")+"\n            ")]),t._v(" "),a("auth-button",{directives:[{name:"test",rawName:"v-test",value:{type:"button",value:"editTemplate"},expression:"{ type: 'button', value: 'editTemplate' }"}],staticClass:"mr10",attrs:{"resource-id":t.taskId,auth:"job_template/edit"},on:{click:t.handleGoEdit}},[t._v("\n                "+t._s("编辑")+"\n            ")]),t._v(" "),a("span",{directives:[{name:"bk-tooltips",rawName:"v-bk-tooltips",value:t.notNeedUpdateTips,expression:"notNeedUpdateTips"}]},[a("bk-button",{directives:[{name:"test",rawName:"v-test",value:{type:"button",value:"syncPlan"},expression:"{ type: 'button', value: 'syncPlan' }"}],staticClass:"action-sync mr10",attrs:{loading:t.isPlanListLoading},on:{click:t.handleGoSyncPlan}},[t._v("\n                    "+t._s("同步方案")+"\n                    "),t.isNotNeedUpdate?t._e():a("div",{directives:[{name:"bk-tooltips",rawName:"v-bk-tooltips",value:"待同步",expression:"'待同步'"}],staticClass:"update-flag"},[a("Icon",{attrs:{type:"sync-8"}})],1)])],1),t._v(" "),a("jb-popover-confirm",{staticClass:"action-del",attrs:{title:"确定删除该作业模板？",content:"注意！模板下关联的所有执行方案也将被清除","confirm-handler":t.handleDelete}},[a("auth-button",{directives:[{name:"test",rawName:"v-test",value:{type:"button",value:"deleteTemplate"},expression:"{ type: 'button', value: 'deleteTemplate' }"}],staticClass:"delete-btn",attrs:{"resource-id":t.taskId,auth:"job_template/delete"}},[t._v("\n                    "+t._s("删除")+"\n                ")])],1)],1)]},proxy:!0}])},[a("detail-layout",{staticClass:"task-template-detail-layout",attrs:{mode:"see"}},[a("detail-item",{attrs:{label:"模板名称："}},[a("auth-component",{attrs:{auth:"job_template/edit","resource-id":t.taskId}},[a("jb-edit-input",{staticClass:"input",attrs:{field:"name",value:t.formData.name,rules:t.rules.name,"remote-hander":t.handleUpdateTemplate}}),t._v(" "),a("div",{attrs:{slot:"forbid"},slot:"forbid"},[t._v(t._s(t.formData.name))])],1)],1),t._v(" "),a("detail-item",{attrs:{label:"场景标签："}},[a("auth-component",{attrs:{auth:"job_template/edit","resource-id":t.taskId}},[a("jb-edit-tag",{staticClass:"input",attrs:{field:"tags",value:t.formData.tags,"remote-hander":t.handleUpdateTemplate}}),t._v(" "),a("div",{attrs:{slot:"forbid"},slot:"forbid"},[t._v(t._s(t.formData.tagText))])],1)],1),t._v(" "),a("detail-item",{attrs:{label:"模板描述："}},[a("auth-component",{attrs:{auth:"job_template/edit","resource-id":t.taskId}},[a("jb-edit-textarea",{staticClass:"input",attrs:{field:"description",placeholder:"填写该模板的功能介绍等详细描述...",maxlength:500,value:t.formData.description,"remote-hander":t.handleUpdateTemplate}}),t._v(" "),a("div",{attrs:{slot:"forbid"},slot:"forbid"},[t._v(t._s(t.formData.description||"--"))])],1)],1),t._v(" "),a("detail-item",{staticClass:"gloval-var-item",attrs:{label:"全局变量："}},[a("render-global-var",{attrs:{list:t.formData.variables}})],1),t._v(" "),a("detail-item",{staticClass:"task-step-item",attrs:{label:"作业步骤："}},[a("render-task-step",{ref:"step",attrs:{list:t.formData.stepList,variable:t.formData.variables}})],1)],1),t._v(" "),t._v(" "),t.formData.name?a("element-teleport",[a("div",{staticStyle:{"font-size":"12px",color:"#63656e"}},[t._v("（"+t._s(t.formData.name)+"）")])]):t._e(),t._v(" "),a("back-top")],1)};s._withStripped=!0;var i=a(48699),r=i.Z,n=(a(42070),(0,a(51900).Z)(r,s,[],!1,null,null,null));n.options.__file="src/views/task-manage/template-detail/index.vue";var l=n.exports},42070:function(t,e,a){var s=a(37839);s.__esModule&&(s=s.default),"string"==typeof s&&(s=[[t.id,s,""]]),s.locals&&(t.exports=s.locals);(0,a(18086).Z)("743cca2a",s,!1,{})}}]);