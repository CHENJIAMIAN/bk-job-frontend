(self.webpackChunkjob=self.webpackChunkjob||[]).push([[1701],{42181:function(e,t,a){"use strict";a(35927),a(45974),a(9042),a(43364);var i=a(22696);Object.defineProperty(t,"X",{value:!0}),t.Z=void 0;var r=i(a(56318)),n=i(a(33610));a(70969),a(7170),a(87033),a(35948),a(94522),a(23232),a(80433),a(63762),a(14370);var o=i(a(38752)),l=i(a(48373));function s(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,i)}return a}function c(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?s(Object(a),!0).forEach((function(t){(0,n.default)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):s(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var d={name:"",props:{data:{type:Object,default:function(){return{}}}},data:()=>({isLoading:!0,formData:{id:0,actionScopeIdList:[{},{},{}],scopeList:[{},{},{}],cloudAreaId:"",ipStr:"",remark:""},scopeLocalKeyList:[{},{},{}],appList:[{},{},{}],cloudAreaList:[{},{},{}],actionScope:[]}),watch:{data:{handler(e){if(e.id){var t=e.id,a=e.actionScopeList,i=e.cloudAreaId,r=e.appList,n=e.remark,o=e.ipList;this.formData=c(c({},this.formData),{},{id:t,actionScopeIdList:a.map((function(e){return e.id})),cloudAreaId:i,scopeList:r.map((function(e){return{type:e.scopeType,id:e.scopeId}})),remark:n,ipStr:o.join("\n")})}},immediate:!0}},created(){var e=this;Promise.all([this.fetchAppList(),this.fetchAllCloudArea(),this.fetchActionScope()]).finally((function(){e.isLoading=!1})),this.rules={ipStr:[{required:!0,message:"IP必填",trigger:"blur"}],remark:[{required:!0,message:"备注必填",trigger:"blur"}],actionScopeIdList:[{validator:function(e){return e.length>0},message:"生效范围必填",trigger:"blur"}]}},methods:{fetchAppList(){var e=this;return l.default.fetchAppList().then((function(t){if(e.appList=t.map((function(e){return c(c({},e),{},{localKey:(t=e,"#".concat(t.scopeType,"#").concat(t.scopeId))});var t})),e.formData.scopeList.length<1){var a=(0,r.default)(t,1)[0],i=a.scopeType,n=a.scopeId;e.formData.scopeList=[{type:i,id:n}]}e.scopeLocalKeyList=e.formData.scopeList.map((function(e){return"#".concat(e.type,"#").concat(e.id)}))}))},fetchAllCloudArea(){var e=this;return o.default.getAllCloudArea().then((function(t){e.cloudAreaList=t,""===e.formData.cloudAreaId&&(e.formData.cloudAreaId=e.cloudAreaList[0].id)}))},fetchActionScope(){var e=this;return o.default.getScope().then((function(t){e.actionScope=t}))},handleRangeChange(e){e.length>0&&this.$refs.whiteIpForm.clearError("actionScopeIdList")},submit(){var e=this;return this.$refs.whiteIpForm.validate().then((function(){var t=c({},e.formData);return t.id<1&&delete t.id,t.scopeList=e.scopeLocalKeyList.map((function(e){var t=e.match(/^#([^#]+)#(.+)$/),a=(0,r.default)(t,3);return{type:a[1],id:a[2]}})),o.default.whiteIpUpdate(t).then((function(){e.messageSuccess(e.formData.id?"编辑成功":"新建成功"),e.$emit("on-update")}))}))}}};t.Z=d},38010:function(e,t,a){"use strict";var i=a(22696);Object.defineProperty(t,"X",{value:!0}),t.Z=void 0,a(71959),a(87033);var r=i(a(48373)),n=i(a(38752)),o=i(a(46117)),l=a(46790),s=i(a(80712)),c=i(a(27452)),d=i(a(2645)),u=i(a(15695)),p=i(a(93962)),f=i(a(18454)),h="white_ip_list_columns",m={name:"",components:{ListActionLayout:s.default,RenderList:c.default,JbSearchSelect:d.default,JbSideslider:u.default,JbPopoverConfirm:p.default,Operation:f.default},data:()=>({searchParams:[],isShowCreateWhiteIp:!1,editInfo:{},selectedTableColumn:[],tableSize:"small"}),computed:{isSkeletonLoading(){return this.$refs.list.isLoading},allRenderColumnMap(){return this.selectedTableColumn.reduce((function(e,t){return e[t.id]=!0,e}),{})},operationSidesliderInfo(){return this.editInfo.id?{title:"编辑IP白名单",okText:"保存"}:{title:"新建IP白名单",okText:"提交"}}},created(){this.getWhiteList=n.default.whiteIpList,this.searchSelect=[{name:"IP",id:"ipStr",default:!0},{name:"目标业务",id:"appIdStr",remoteMethod:this.fetchAppList},{name:"创建人",id:"creator",remoteMethod:o.default.fetchUsersOfSearch,inputInclude:!0},{name:"更新人",id:"lastModifier",remoteMethod:o.default.fetchUsersOfSearch,inputInclude:!0}],this.tableColumn=[{id:"ip",label:"IP",disabled:!0},{id:"scopeText",label:"生效范围",disabled:!0},{id:"appText",label:"目标业务",disabled:!0},{id:"creator",label:"创建人"},{id:"createTime",label:"创建时间"},{id:"lastModifier",label:"更新人"},{id:"lastModifyTime",label:"更新时间"}];var e=l.listColumnsCache.getItem(h);e?(this.selectedTableColumn=Object.freeze(e.columns),this.tableSize=e.size):this.selectedTableColumn=Object.freeze([{id:"ip"},{id:"scopeText"},{id:"appText"},{id:"lastModifier"},{id:"lastModifyTime"}])},methods:{fetchData(){this.$refs.list.$emit("onFetch",this.searchParams)},fetchAppList:()=>r.default.fetchAppList(),fetchActionScope:()=>n.default.getScope(),handleSettingChange(e){var t=e.fields,a=e.size;this.selectedTableColumn=Object.freeze(t),this.tableSize=a,l.listColumnsCache.setItem(h,{columns:t,size:a})},handleCreate(){this.editInfo={},this.isShowCreateWhiteIp=!0},handleSearch(e){this.searchParams=e,this.fetchData()},handleEdit(e){this.isShowCreateWhiteIp=!0,this.editInfo=e},handleDelete(e){var t=this;return n.default.whiteDelete({id:e.id}).then((function(){return t.fetchData(),!0}))},handleWhiteIpUpdate(){this.fetchData()}}};t.Z=m},16875:function(e,t,a){"use strict";var i=a(22696);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a(7170);var r=i(a(7192));class n extends r.default{constructor(e){super(),this.actionScopeList=e.actionScopeList,this.appList=e.appList||[],this.cloudAreaId=e.cloudAreaId,this.createTime=e.createTime,this.creator=e.creator,this.id=e.id,this.ipList=e.ipList||[],this.lastModifier=e.lastModifier,this.lastModifyTime=e.lastModifyTime,this.remark=e.remark,this.canManage=e.canManage}get ip(){return this.ipList.length<2?this.ipList[0]:"共".concat(this.ipList.length,"个")}get scopeText(){return this.actionScopeList.map((function(e){return e.name})).join("，")}get appText(){return this.appList.map((function(e){return e.name})).join("，")}}t.default=n},38752:function(e,t,a){"use strict";a(35927),a(45974),a(87033),a(9042),a(43364);var i=a(22696);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=i(a(33610));a(7170);var n=i(a(86930)),o=i(a(16875));function l(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,i)}return a}function s(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?l(Object(a),!0).forEach((function(t){(0,r.default)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):l(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var c={whiteIpUpdate(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return n.default.update(e)},getAllCloudArea:()=>n.default.getAllCloudArea().then((function(e){return e.data})),getDetail(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return n.default.getDataById(e)},whiteDelete(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return n.default.deleteDataById(e)},whiteIpList(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;return n.default.getAll(e,t).then((function(e){var t=e.data;return t.data=t.data.map((function(e){return new o.default(s(s({},e),{},{canManage:e.canManage}))})),t}))},getScope(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return n.default.getActionScope(e).then((function(e){return e.data}))}};t.default=c},86930:function(e,t,a){"use strict";var i=a(22696);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a(70969);var r=i(a(24875));var n=new class{constructor(){this.module="/job-manage/web/whiteIP"}update(e){return r.default.post("".concat(this.module,"/"),{params:e})}getAllCloudArea(){return r.default.get("".concat(this.module,"/cloudAreas/list"))}getDataById(e){var t=e.id;return r.default.get("".concat(this.module,"/ids/").concat(t))}deleteDataById(e){var t=e.id;return r.default.delete("".concat(this.module,"/ids/").concat(t))}getAll(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return r.default.get("".concat(this.module,"/list"),{params:e,payload:t})}getActionScope(){return r.default.get("".concat(this.module,"/actionScope/list"))}};t.default=n},88902:function(){},18454:function(e,t,a){"use strict";a.r(t),a.d(t,{__esModule:function(){return r.X},default:function(){return l}});var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:e.isLoading},expression:"{ isLoading }"}]},[a("jb-form",{ref:"whiteIpForm",attrs:{"form-type":"vertical",model:e.formData,rules:e.rules}},[a("jb-form-item",{attrs:{label:"目标业务"}},[a("div",{staticClass:"app-wraper"},[a("bk-select",{staticClass:"app-select",attrs:{clearable:!1,multiple:"",searchable:""},model:{value:e.scopeLocalKeyList,callback:function(t){e.scopeLocalKeyList=t},expression:"scopeLocalKeyList"}},e._l(e.appList,(function(e){return a("bk-option",{key:e.localKey,attrs:{id:e.localKey,name:e.name}})})),1)],1)]),e._v(" "),a("jb-form-item",{attrs:{label:"云区域",required:"",property:"cloudAreaId"}},[a("bk-select",{staticClass:"input",attrs:{clearable:!1,searchable:""},model:{value:e.formData.cloudAreaId,callback:function(t){e.$set(e.formData,"cloudAreaId",t)},expression:"formData.cloudAreaId"}},e._l(e.cloudAreaList,(function(e){return a("bk-option",{key:e.id,attrs:{id:e.id,name:e.name}})})),1)],1),e._v(" "),a("jb-form-item",{attrs:{label:"IP",required:"",property:"ipStr"}},[a("bk-input",{staticClass:"input",attrs:{placeholder:"输入IP，以“回车”分隔",type:"textarea"},model:{value:e.formData.ipStr,callback:function(t){e.$set(e.formData,"ipStr",t)},expression:"formData.ipStr"}})],1),e._v(" "),a("jb-form-item",{attrs:{label:"备注",required:"",property:"remark"}},[a("bk-input",{staticClass:"input",attrs:{type:"textarea",maxlength:100},model:{value:e.formData.remark,callback:function(t){e.$set(e.formData,"remark",t)},expression:"formData.remark"}})],1),e._v(" "),a("jb-form-item",{staticStyle:{"margin-bottom":"0"},attrs:{label:"生效范围",required:"",property:"actionScopeIdList"}},[a("bk-checkbox-group",{on:{change:e.handleRangeChange},model:{value:e.formData.actionScopeIdList,callback:function(t){e.$set(e.formData,"actionScopeIdList",t)},expression:"formData.actionScopeIdList"}},e._l(e.actionScope,(function(t,i){return a("bk-checkbox",{key:t.id,class:{"scope-checkbox":i!==e.actionScope.length-1},attrs:{value:t.id}},[e._v("\n                    "+e._s(t.name)+"\n                ")])})),1)],1)],1)],1)};i._withStripped=!0;var r=a(42181),n=r.Z,o=(a(37153),(0,a(35471).Z)(n,i,[],!1,null,null,null));o.options.__file="src/views/white-ip/index/components/operation.vue";var l=o.exports},11701:function(e,t,a){"use strict";a.r(t),a.d(t,{__esModule:function(){return r.X},default:function(){return l}});var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("list-action-layout",{scopedSlots:e._u([{key:"right",fn:function(){return[a("jb-search-select",{ref:"search",staticStyle:{width:"480px"},attrs:{data:e.searchSelect,placeholder:"搜索IP，生效范围，目标业务"},on:{"on-change":e.handleSearch}})]},proxy:!0}])},[a("auth-button",{directives:[{name:"test",rawName:"v-test",value:{type:"button",value:"createWhiteIP"},expression:"{ type: 'button', value: 'createWhiteIP' }"}],staticClass:"w120",attrs:{theme:"primary",auth:"whitelist/create"},on:{click:e.handleCreate}},[e._v("\n            "+e._s("新建")+"\n        ")])],1),e._v(" "),a("render-list",{directives:[{name:"test",rawName:"v-test",value:{type:"list",value:"whiteIP"},expression:"{ type: 'list', value: 'whiteIP' }"}],ref:"list",attrs:{"data-source":e.getWhiteList,size:e.tableSize,"search-control":function(){return e.$refs.search}}},[e.allRenderColumnMap.ip?a("bk-table-column",{key:"IP",attrs:{label:"IP",align:"left"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row;return[i.ipList.length>1?[a("bk-popover",{attrs:{placement:"right",theme:"light"}},[a("span",[e._v(e._s(i.ip))]),e._v(" "),a("div",{attrs:{slot:"content"},slot:"content"},e._l(i.ipList,(function(t,i){return a("p",{key:i},[e._v(e._s(t))])})),0)])]:[a("span",[e._v(e._s(i.ip))])]]}}],null,!1,1462136596)}):e._e(),e._v(" "),e.allRenderColumnMap.scopeText?a("bk-table-column",{key:"scopeText",attrs:{label:"生效范围",prop:"scopeText",align:"left"}}):e._e(),e._v(" "),e.allRenderColumnMap.appText?a("bk-table-column",{key:"appText",attrs:{label:"目标业务",prop:"appText",align:"left"}}):e._e(),e._v(" "),e.allRenderColumnMap.creator?a("bk-table-column",{key:"creator",attrs:{label:"创建人",prop:"creator",align:"left"}}):e._e(),e._v(" "),e.allRenderColumnMap.createTime?a("bk-table-column",{key:"createTime",attrs:{label:"创建时间",prop:"createTime",align:"left"}}):e._e(),e._v(" "),e.allRenderColumnMap.lastModifier?a("bk-table-column",{key:"lastModifier",attrs:{label:"更新人",prop:"lastModifier",align:"left"}}):e._e(),e._v(" "),e.allRenderColumnMap.lastModifyTime?a("bk-table-column",{key:"lastModifyTime",attrs:{label:"更新时间",prop:"lastModifyTime",align:"left"}}):e._e(),e._v(" "),a("bk-table-column",{key:"action",attrs:{label:"操作",resizable:!1,prop:"action",fixed:"right",width:"150",align:"left"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row;return[a("auth-button",{directives:[{name:"test",rawName:"v-test",value:{type:"button",value:"createWhiteIP"},expression:"{ type: 'button', value: 'createWhiteIP' }"}],staticClass:"mr10",attrs:{permission:i.canManage,auth:"whitelist/edit",text:""},on:{click:function(t){return e.handleEdit(i)}}},[e._v("\n                    "+e._s("编辑")+"\n                ")]),e._v(" "),a("jb-popover-confirm",{attrs:{title:"确定删除该IP白名单？",content:"删除后不可恢复，请谨慎操作！","confirm-handler":function(){return e.handleDelete(i)}}},[a("auth-button",{directives:[{name:"test",rawName:"v-test",value:{type:"button",value:"deleteWhiteIP"},expression:"{ type: 'button', value: 'deleteWhiteIP' }"}],attrs:{permission:i.canManage,auth:"whitelist/delete",text:""}},[e._v("\n                        "+e._s("删除")+"\n                    ")])],1)]}}])}),e._v(" "),a("bk-table-column",{attrs:{type:"setting"}},[a("bk-table-setting-content",{attrs:{fields:e.tableColumn,selected:e.selectedTableColumn,size:e.tableSize},on:{"setting-change":e.handleSettingChange}})],1)],1),e._v(" "),a("jb-sideslider",e._b({attrs:{"is-show":e.isShowCreateWhiteIp,width:552},on:{"update:isShow":function(t){e.isShowCreateWhiteIp=t},"update:is-show":function(t){e.isShowCreateWhiteIp=t}}},"jb-sideslider",e.operationSidesliderInfo,!1),[a("operation",{ref:"whiteIp",attrs:{data:e.editInfo},on:{"on-update":e.handleWhiteIpUpdate}})],1)],1)};i._withStripped=!0;var r=a(38010),n=r.Z,o=(0,a(35471).Z)(n,i,[],!1,null,null,null);o.options.__file="src/views/white-ip/index/index.vue";var l=o.exports},37153:function(e,t,a){var i=a(88902);i.__esModule&&(i=i.default),"string"==typeof i&&(i=[[e.id,i,""]]),i.locals&&(e.exports=i.locals);(0,a(13570).Z)("6210103a",i,!1,{})}}]);