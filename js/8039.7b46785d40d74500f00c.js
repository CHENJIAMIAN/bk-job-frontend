(self.webpackChunkjob=self.webpackChunkjob||[]).push([[8039],{13114:function(e,t,a){"use strict";var r=a(70534);Object.defineProperty(t,"X",{value:!0}),t.Z=void 0;var n=r(a(78876)),i=a(11986),s={components:{AceEditor:n.default},props:{data:{type:Object,require:!0}},data:()=>({lang:"",scriptContent:""}),watch:{data:{handler(e){this.scriptContent=e.scriptContent,this.lang=(0,i.formatScriptTypeValue)(e.scriptLanguage)},immediate:!0}}};t.Z=s},77241:function(e,t,a){"use strict";a(87147),a(13118),a(59241),a(20767);var r=a(70534);Object.defineProperty(t,"X",{value:!0}),t.Z=void 0;var n=r(a(68203));a(70616),a(41336),a(14309);var i=a(11986),s=a(15513),l=r(a(31752)),o=r(a(75882)),c=r(a(90898)),u=r(a(84366)),d=r(a(98656)),p=r(a(88792)),h=r(a(27898)),m=r(a(42042));function f(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function b(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?f(Object(a),!0).forEach((function(t){(0,n.default)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):f(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var v="detect_records_list_columns",g={name:"detectRecordsList",components:{RenderList:u.default,JbSideslider:d.default,JbSearchSelect:p.default,ListActionLayout:h.default,RenderScriptContent:m.default},data:()=>({searchParams:{},defaultDateTime:["",""],selectedTableColumn:[],tableSize:"small",scriptData:{},isShowScriptContent:!1}),computed:{isSkeletonLoading(){return this.$refs.list.isLoading},allRenderColumnMap(){return this.selectedTableColumn.reduce((function(e,t){return e[t.id]=!0,e}),{})}},created(){this.parseDefaultDateTime(),this.fetchDetectRecordsList=c.default.recordList,this.searchSelect=[{name:"拦截ID",id:"id",default:!0},{name:"表达式",id:"ruleExpression"},{name:"业务",id:"appId",remoteMethod:function(){return o.default.fetchWholeAppList().then((function(e){return e.data}))}},{name:"执行人",id:"operator",remoteMethod:l.default.fetchUsersOfSearch,inputInclude:!0},{name:"执行方式",id:"startupMode",children:[{name:"页面执行",id:1},{name:"定时执行",id:3},{name:"API调用",id:2}]},{name:"调用方",id:"client"},{name:"动作",id:"action",children:[{name:"扫描",id:1},{name:"拦截",id:2}]}],this.shortcuts=[{text:"近1小时",value(){var e=new Date,t=new Date;return t.setTime(t.getTime()-36e5),[t,e]}},{text:"近12小时",value(){var e=new Date,t=new Date;return t.setTime(t.getTime()-432e5),[t,e]}},{text:"近1天",value(){var e=new Date,t=new Date;return t.setTime(t.getTime()-864e5),[t,e]}},{text:"近7天",value(){var e=new Date,t=new Date;return t.setTime(t.getTime()-6048e5),[t,e]}}],this.tableColumn=[{id:"id",label:"ID",disabled:!0},{id:"ruleExpression",label:"表达式"},{id:"appId",label:"业务"},{id:"operator",label:"执行人"},{id:"statusDesc",label:"执行时间"},{id:"startupMode",label:"执行方式"},{id:"client",label:"调用方"},{id:"action",label:"动作"},{id:"scriptLanguage",label:"脚本语言"}];var e=s.listColumnsCache.getItem(v);e?(this.selectedTableColumn=Object.freeze(e.columns),this.tableSize=e.size):this.selectedTableColumn=Object.freeze([{id:"id"},{id:"ruleExpression"},{id:"appId"},{id:"operator"},{id:"statusDesc"},{id:"startupMode"},{id:"client"},{id:"action"},{id:"scriptLanguage"}])},methods:{fetchData(){var e=b({},this.searchParams);this.$refs.list.$emit("onFetch",e)},setToNowText(e){this.$refs.datePicker.shortcut={text:"".concat(e[0]," ","至今")}},parseDefaultDateTime(){var e=this,t=["",""],a={startTime:"",endTime:""},r=(new Date).getTime();Object.prototype.hasOwnProperty.call(this.$route.query,"startTime")?t[0]=this.$route.query.startTime:t[0]=(0,i.prettyDateTimeFormat)(r-864e5),a.startTime=t[0],Object.prototype.hasOwnProperty.call(this.$route.query,"endTime")?(t[1]=this.$route.query.endTime,a.endTime=this.$route.query.endTime):(t[1]=(0,i.prettyDateTimeFormat)(r),a.endTime=""),this.defaultDateTime=t,this.searchParams=a,a.endTime||setTimeout((function(){e.setToNowText(e.defaultDateTime)}))},renderPatternHeader:(e,t)=>e("div",{class:"pattern-head"},[e("span",[t.column.label," "]),e("bk-popover",{attrs:{placement:"right-start",width:"290"}},[e("Icon",{attrs:{type:"info"},style:"color: #C4C6CC"}),e("div",{slot:"content"},[e("div",{class:"detect-records-tips-content"},[[{title:"【扫描】",content:"命中规则的脚本执行任务仅会做记录，不会拦截"},{title:"【拦截】",content:"命中规则的脚本执行任务会被记录，并中止运行"}].map((function(t){return e("div",{class:"item"},[e("p",[t.title]),e("p",[t.content])])}))])])])]),handleSearch(e){var t=this.searchParams,a=t.startTime,r=t.endTime;this.searchParams=b(b({},e),{},{startTime:a,endTime:r}),this.fetchData()},handleDateChange(e){this.searchParams.startTime=e[0],this.searchParams.endTime=e[1],this.fetchData()},handleSettingChange(e){var t=e.fields,a=e.size;this.selectedTableColumn=Object.freeze(t),this.tableSize=a,s.listColumnsCache.setItem(v,{columns:t,size:a})},handleShowScriptContent(e){this.isShowScriptContent=!0,this.scriptData=Object.freeze(e)}}};t.Z=g},10419:function(e,t,a){"use strict";var r=a(70534);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a(98495);var n=r(a(68203)),i=a(11986);class s{constructor(e){this.action=e.action,this.appId=e.appId,this.scopeType=e.scopeType,this.scopeId=e.scopeId,this.appName=e.appName,this.checkResultItems=e.checkResultItems,this.client=e.client,this.createTime=e.createTime,this.id=e.id,this.operator=e.operator,this.ruleExpression=e.ruleExpression,this.ruleId=e.ruleId,this.scriptContent=e.scriptContent,this.scriptLanguage=e.scriptLanguage,this.startupMode=e.startupMode}get getSctiptTypeHtml(){return s.scriptTypeMap[this.scriptLanguage]}get getActionHtml(){var e="display: inline-block; padding: 0 5px; line-height: 16px; font-size: 12px;";return 1===this.action?e+="background: #f0f1f5; color: #979ba5":e+="background: #ffebeb; color: #ea3636",'<span style="'.concat(e,'">').concat(s.actionMap[this.action],"<span>")}get getCreatTimes(){return(0,i.prettyDateTimeFormat)(this.createTime)}get getStartupModeHtml(){return s.startupModeMap[this.startupMode]}}t.default=s,(0,n.default)(s,"scriptTypeMap",{1:"Shell",2:"Bat",3:"Perl",4:"Python",5:"Powershell",6:"Sql"}),(0,n.default)(s,"actionMap",{1:"扫描",2:"拦截"}),(0,n.default)(s,"startupModeMap",{1:"Web",2:"API",3:"Cron"})},90898:function(e,t,a){"use strict";var r=a(70534);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a(14309);var n=r(a(2471)),i=r(a(10419)),s={recordList:(e,t)=>n.default.getDangerousRecordList(e,t).then((function(e){var t=e.data;return t.data?(t.data=t.data.map((function(e){return Object.freeze(new i.default(e))})),t):[]}))};t.default=s},2471:function(e,t,a){"use strict";var r=a(70534);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=r(a(37346)),i=r(a(27819));class s extends i.default{constructor(){super(),this.module="/job-execute/web/dangerous-record"}getDangerousRecordList(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return n.default.get("".concat(this.module,"/list"),{params:e,payload:t})}}var l=new s;t.default=l},93873:function(){},42042:function(e,t,a){"use strict";a.r(t),a.d(t,{__esModule:function(){return n.X},default:function(){return l}});var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"render-script-content"},[a("ace-editor",{attrs:{value:e.scriptContent,lang:e.lang,options:[e.lang],"custom-enable":!1,readonly:""}})],1)};r._withStripped=!0;var n=a(13114),i=n.Z,s=(0,a(51900).Z)(i,r,[],!1,null,null,null);s.options.__file="src/views/detect-records/list/components/render-script-content.vue";var l=s.exports},78039:function(e,t,a){"use strict";a.r(t),a.d(t,{__esModule:function(){return n.X},default:function(){return l}});var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"detect-records-list-page"},[a("list-action-layout",{scopedSlots:e._u([{key:"right",fn:function(){return[a("bk-date-picker",{ref:"datePicker",attrs:{value:e.defaultDateTime,placeholder:"选择日期",shortcuts:e.shortcuts,type:"datetimerange","shortcut-close":!0,"use-shortcut-text":!0,clearable:!1,"up-to-now":""},on:{change:e.handleDateChange}})]},proxy:!0}])},[a("jb-search-select",{ref:"search",staticStyle:{width:"480px"},attrs:{data:e.searchSelect,placeholder:"搜索拦截ID，表达式，业务，执行人，执行方式，调用方，动作…"},on:{"on-change":e.handleSearch}})],1),e._v(" "),a("render-list",{directives:[{name:"test",rawName:"v-test",value:{type:"list",value:"detectRecord"},expression:"{ type: 'list', value: 'detectRecord' }"}],ref:"list",attrs:{size:e.tableSize,"data-source":e.fetchDetectRecordsList,"search-control":function(){return e.$refs.search}}},[e.allRenderColumnMap.id?a("bk-table-column",{key:"id",attrs:{label:"ID",prop:"id",width:"80",align:"left"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v("\n                "+e._s(a.id)+"\n            ")]}}],null,!1,2377966962)}):e._e(),e._v(" "),e.allRenderColumnMap.ruleExpression?a("bk-table-column",{key:"ruleExpression",attrs:{label:"表达式",prop:"ruleExpression",align:"left","show-overflow-tooltip":""}}):e._e(),e._v(" "),e.allRenderColumnMap.appId?a("bk-table-column",{key:"appName",attrs:{label:"业务",prop:"appName",width:"200",align:"left"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("span",[e._v("["+e._s(r.appId)+"] "+e._s(r.appName))])]}}],null,!1,3811058794)}):e._e(),e._v(" "),e.allRenderColumnMap.operator?a("bk-table-column",{key:"operator",attrs:{label:"执行人",prop:"operator",width:"140",align:"left"}}):e._e(),e._v(" "),e.allRenderColumnMap.statusDesc?a("bk-table-column",{key:"createTime",attrs:{label:"执行时间",prop:"createTime",width:"200",align:"left"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v("\n                "+e._s(a.getCreatTimes)+"\n            ")]}}],null,!1,1419859470)}):e._e(),e._v(" "),e.allRenderColumnMap.startupMode?a("bk-table-column",{key:"startupMode",attrs:{label:"执行方式",prop:"startupMode",width:"140",align:"left"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v("\n                "+e._s(a.getStartupModeHtml)+"\n            ")]}}],null,!1,2606843314)}):e._e(),e._v(" "),e.allRenderColumnMap.client?a("bk-table-column",{key:"client",attrs:{label:"调用方",prop:"client",width:"150",align:"left"}}):e._e(),e._v(" "),e.allRenderColumnMap.action?a("bk-table-column",{key:"mode",attrs:{label:"动作","render-header":e.renderPatternHeader,prop:"mode",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("span",{domProps:{innerHTML:e._s(r.getActionHtml)}})]}}],null,!1,543757652)}):e._e(),e._v(" "),e.allRenderColumnMap.scriptLanguage?a("bk-table-column",{key:"scriptLanguage",attrs:{label:"脚本语言",prop:"scriptLanguage",width:"150",align:"left"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v("\n                "+e._s(a.getSctiptTypeHtml)+"\n            ")]}}],null,!1,346443397)}):e._e(),e._v(" "),a("bk-table-column",{key:"action",attrs:{label:"操作",fixed:"right",align:"left",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("bk-button",{directives:[{name:"test",rawName:"v-test",value:{type:"button",value:"viewDetectScript"},expression:"{ type: 'button', value: 'viewDetectScript' }"}],attrs:{text:""},on:{click:function(t){return e.handleShowScriptContent(r)}}},[e._v("\n                    "+e._s("查看脚本")+"\n                ")])]}}])}),e._v(" "),a("bk-table-column",{attrs:{type:"setting"}},[a("bk-table-setting-content",{attrs:{fields:e.tableColumn,selected:e.selectedTableColumn,size:e.tableSize},on:{"setting-change":e.handleSettingChange}})],1)],1),e._v(" "),a("jb-sideslider",{attrs:{"is-show":e.isShowScriptContent,title:"脚本内容","show-footer":!1,width:900},on:{"update:isShow":function(t){e.isShowScriptContent=t},"update:is-show":function(t){e.isShowScriptContent=t}}},[a("render-script-content",{attrs:{data:e.scriptData}})],1)],1)};r._withStripped=!0;var n=a(77241),i=n.Z,s=(a(24436),(0,a(51900).Z)(i,r,[],!1,null,null,null));s.options.__file="src/views/detect-records/list/index.vue";var l=s.exports},24436:function(e,t,a){var r=a(93873);r.__esModule&&(r=r.default),"string"==typeof r&&(r=[[e.id,r,""]]),r.locals&&(e.exports=r.locals);(0,a(18086).Z)("02c7ae06",r,!1,{})}}]);