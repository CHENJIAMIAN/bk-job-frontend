(self.webpackChunkjob=self.webpackChunkjob||[]).push([[2813],{98914:function(t,e,a){"use strict";a(45974),a(9042),a(43364);var r=a(22696);Object.defineProperty(e,"X",{value:!0}),e.Z=void 0;var n=r(a(33610));a(35927),a(6919),a(56259),a(63762),a(95179),a(87033),a(35948),a(94522),a(71959);var o=r(a(15399)),c=r(a(1249)),s=r(a(6089)),u=r(a(76830)),i=a(61681),l=r(a(86234)),d=r(a(64571)),p=r(a(61254)),f=r(a(94304));function m(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,r)}return a}function b(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?m(Object(a),!0).forEach((function(e){(0,n.default)(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):m(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}var h=function(){return{id:"",account:"",alias:"",category:u.default.OS,dbPassword:"",dbPort:"",dbSystemAccountId:"",grantees:[],os:"",password:"",remark:"",type:u.default.TYPE_LINUX,rePassword:""}},g={name:"OperationAccount",components:{JbInput:l.default,AccountSelect:d.default},props:{data:{type:Object,default:function(){return{}}}},data:()=>({isLoading:!0,isEdit:!1,isRulesLoadingError:!1,formData:h(),currentRules:Object.freeze({linux:{expression:"."},windows:{expression:"."},db:{expression:"."}})}),computed:{accountCom(){return{[u.default.OS]:f.default,[u.default.DB]:p.default}[this.formData.category]},namePlaceholder(){return this.isLoading?"":this.formData.category===u.default.DB?this.currentRules.db.description:this.formData.type===u.default.TYPE_LINUX?this.currentRules.linux.description:this.currentRules.windows.description},rules(){var t=this;if(this.isLoading)return{};var e={account:[{required:!0,message:o.default.t("account.名称必填"),trigger:"blur"}],alias:[{required:!0,message:o.default.t("account.别名必填"),trigger:"blur"},{validator:i.accountAliasNameRule.validator,message:i.accountAliasNameRule.message,trigger:"blur"}]};return this.formData.category===u.default.DB?(e.account.push({validator:function(e){return new RegExp(t.currentRules.db.expression).test(e)},message:this.currentRules.db.description,trigger:"blur"}),b(b({},e),{},{dbPassword:[{validator:function(t){return!/[\u4e00-\u9fa5]/.test(t)},message:o.default.t("account.密码不支持中文"),trigger:"blur"}],rePassword:[{validator:function(e){return t.formData.rePassword===t.formData.dbPassword},message:o.default.t("account.密码不一致"),trigger:"blur"}],dbPort:[{required:!0,message:o.default.t("account.端口必填"),trigger:"blur"}],dbSystemAccountId:[{required:!0,message:o.default.t("account.依赖系统账号必填"),trigger:"blur"}]})):this.formData.type===u.default.TYPE_LINUX?(e.account.push({validator:function(e){return new RegExp(t.currentRules.linux.expression).test(e)},message:this.currentRules.linux.description,trigger:"blur"}),e):(e.account.push({validator:function(e){return new RegExp(t.currentRules.windows.expression).test(e)},message:this.currentRules.windows.description,trigger:"blur"}),b(b({},e),{},{password:[{required:!0,message:o.default.t("account.密码必填"),trigger:"blur"},{validator:function(t){return!/[\u4e00-\u9fa5]/.test(t)},message:o.default.t("account.密码不支持中文"),trigger:"blur"}],rePassword:[{validator:function(e){return e===t.formData.password},message:o.default.t("account.密码不一致"),trigger:"blur"}]}))}},created(){if(this.fetchRules(),this.categoryList=[{value:u.default.OS,name:o.default.t("account.系统账号")},{value:u.default.DB,name:o.default.t("account.数据库账号")}],this.data.id){this.isEdit=!0;var t=this.data,e=t.id,a=t.account,r=t.alias,n=t.category,c=t.dbPassword,s=t.dbPort,i=t.dbSystemAccountId,l=t.grantees,d=t.os,p=t.password,f=t.remark,m=t.type,b=c;p&&(b=p),this.formData={id:e,account:a,alias:r,category:n,dbPassword:c,dbPort:s,dbSystemAccountId:i,grantees:l,os:d,password:p,remark:f,type:m,rePassword:b}}},methods:{fetchRules(){var t=this;return this.data.id?(this.isLoading=!1,Promise.resolve()):c.default.fetchAllNameRule().then((function(e){var a=e.currentRules;t.currentRules=Object.freeze(a.reduce((function(t,e){return t[e.osTypeKey]=e,t}),{}))})).catch((function(){t.isRulesLoadingError=!1})).finally((function(){t.isLoading=!1}))},createAccount(){var t=this,e=b({},this.formData);return delete e.rePassword,s.default.createAccount(e).then((function(){t.messageSuccess(o.default.t("account.新建账号成功")),t.$emit("on-change")}))},updateAccount(){var t=this,e=b({},this.formData);return delete e.rePassword,s.default.updateAccount(e).then((function(){t.messageSuccess(o.default.t("account.编辑账号成功")),t.$emit("on-change")}))},handleCategoryChange(t){this.formData=h(),this.formData.category=t;var e={[u.default.OS]:u.default.TYPE_LINUX,[u.default.DB]:u.default.TYPE_MYSQL};this.formData.type=e[t],this.$refs.operateAccountForm.clearError()},handleFieldChange(t,e){this.formData[t]=e},submit(){var t=this;return this.isRulesLoadingError?(this.messageWarn(o.default.t("account.命名规则请求失败无法执行当前操作，请刷新页面")),Promise.reject(Error("rule error"))):this.$refs.operateAccountForm.validate().then((function(){return t.formData.id?t.updateAccount():t.createAccount()}))}}};e.Z=g},33897:function(t,e,a){"use strict";a(35927),a(45974),a(9042),a(43364);var r=a(22696);Object.defineProperty(e,"X",{value:!0}),e.Z=void 0;var n=r(a(33610));a(71959),a(87033);var o=r(a(15399)),c=r(a(6089)),s=r(a(46117)),u=a(46790),i=r(a(80712)),l=r(a(27452)),d=r(a(2645)),p=r(a(76684));function f(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,r)}return a}var m="account_manage_columns",b={components:{ListActionLayout:i.default,RenderList:l.default,JbSearchSelect:d.default,Operation:p.default},data:()=>({showOperation:!1,editData:{},searchParams:[],searchValue:[],selectedTableColumn:[],tableSize:"small"}),computed:{isSkeletonLoading(){return this.$refs.list.isLoading},allRenderColumnMap(){return this.selectedTableColumn.reduce((function(t,e){return t[e.id]=!0,t}),{})},operationSidesliderInfo(){return this.editData.id?{title:o.default.t("account.编辑账号"),okText:o.default.t("account.保存")}:{title:o.default.t("account.新建账号"),okText:o.default.t("account.提交")}}},created(){this.dataSource=c.default.fetchAccountList,this.searchSelect=[{name:"ID",id:"id",description:o.default.t("account.将覆盖其它条件")},{name:o.default.t("account.账号别名.colHead"),id:"alias",default:!0},{name:o.default.t("account.账号名称.colHead"),id:"account"},{name:o.default.t("account.创建人"),id:"creator",remoteMethod:s.default.fetchUsersOfSearch,inputInclude:!0},{name:o.default.t("account.更新人.colHead"),id:"lastModifyUser",remoteMethod:s.default.fetchUsersOfSearch,inputInclude:!0}],this.tableColumn=[{id:"id",label:"ID"},{id:"alias",label:o.default.t("account.账号别名.colHead"),disabled:!0},{id:"account",label:o.default.t("account.账号名称.colHead"),disabled:!0},{id:"categoryName",label:o.default.t("account.账号用途.colHead")},{id:"typeName",label:o.default.t("account.账号类型.colHead"),disabled:!0},{id:"creator",label:o.default.t("account.创建人")},{id:"createTime",label:o.default.t("account.创建时间")},{id:"lastModifyUser",label:o.default.t("account.更新人.colHead")},{id:"lastModifyTime",label:o.default.t("account.更新时间")}];var t=u.listColumnsCache.getItem(m);t?(this.selectedTableColumn=Object.freeze(t.columns),this.tableSize=t.size):this.selectedTableColumn=Object.freeze([{id:"alias"},{id:"account"},{id:"categoryName"},{id:"typeName"},{id:"lastModifyUser"},{id:"lastModifyTime"}])},methods:{fetchData(){this.$refs.list.$emit("onFetch",this.searchParams)},handleSettingChange(t){var e=t.fields,a=t.size;this.selectedTableColumn=Object.freeze(e),this.tableSize=a,u.listColumnsCache.setItem(m,{columns:e,size:a})},handleSearch(t){this.searchParams=t,this.fetchData()},handleAdd(){this.editData={},this.showOperation=!0},handleEdit(t){this.editData=function(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?f(Object(a),!0).forEach((function(e){(0,n.default)(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):f(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}({},t),this.showOperation=!0},handleDelete(t){var e=this;return c.default.deleteAccount({id:t}).then((function(){return e.fetchData(),e.messageSuccess(o.default.t("account.删除成功")),!0}))},handleOperationSubmit(){this.fetchData()}}};e.Z=b},16481:function(){},61254:function(t,e,a){"use strict";a.r(e),a.d(e,{default:function(){return o}});var r=function(t,e){var a=e._c;return a("div",{key:"databaseAccount"},[a("jb-form-item",{attrs:{label:e.parent.$t("account.数据库类型"),required:""}},[a("bk-select",{staticStyle:{width:"100%"},attrs:{readonly:e.props.isEdit,clearable:!1,value:e.props.formData.type},on:{change:function(t){return e.props.change("type",t)}}},[a("bk-option",{attrs:{id:9,name:"Mysql"}}),e._v(" "),a("bk-option",{attrs:{id:10,name:"Oracle"}}),e._v(" "),a("bk-option",{attrs:{id:11,name:"DB2"}})],1)],1),e._v(" "),a("jb-form-item",{attrs:{label:e.parent.$t("account.名称"),required:"",property:"account"}},[a("jb-input",{attrs:{placeholder:e.props.namePlaceholder,readonly:e.props.isEdit,value:e.props.formData.account},on:{change:function(t){return e.props.change("account",t)}}})],1),e._v(" "),a("jb-form-item",{attrs:{label:e.parent.$t("account.别名"),required:"",property:"alias"}},[a("jb-input",{attrs:{placeholder:e.parent.$t("account.在出现同名账号的情况下，账号的别名显得格外重要..."),value:e.props.formData.alias,maxlength:32},on:{change:function(t){return e.props.change("alias",t)}}})],1),e._v(" "),a("jb-form-item",{attrs:{label:e.parent.$t("account.密码"),property:"dbPassword"}},[a("bk-input",{key:"database-password",attrs:{placeholder:e.parent.$t("account.输入密码"),type:"password",value:e.props.formData.dbPassword},on:{change:function(t){return e.props.change("dbPassword",t)}}})],1),e._v(" "),a("jb-form-item",{attrs:{label:e.parent.$t("account.确认密码"),property:"rePassword"}},[a("bk-input",{key:"database-repassword",attrs:{placeholder:e.parent.$t("account.输入确认密码"),type:"password",value:e.props.formData.rePassword},on:{change:function(t){return e.props.change("rePassword",t)}}})],1),e._v(" "),a("jb-form-item",{attrs:{label:e.parent.$t("account.端口"),required:"",property:"dbPort"}},[a("bk-input",{attrs:{placeholder:e.parent.$t("account.输入确认端口"),type:"number",value:e.props.formData.dbPort},on:{change:function(t){return e.props.change("dbPort",t)}}})],1),e._v(" "),a("jb-form-item",{attrs:{label:e.parent.$t("account.依赖系统账号"),required:"",property:"dbSystemAccountId"}},[a("account-select",{attrs:{placeholder:e.parent.$t("account.选择依赖系统账号"),value:e.props.formData.dbSystemAccountId,type:"system"},on:{change:function(t){return e.props.change("dbSystemAccountId",t)}}})],1),e._v(" "),a("jb-form-item",{attrs:{label:e.parent.$t("account.描述")}},[a("bk-input",{attrs:{placeholder:e.parent.$t("account.输入账号描述"),value:e.props.formData.remark,type:"textarea",maxlength:200},on:{change:function(t){return e.props.change("remark",t)}}})],1)],1)};r._withStripped=!0;var n=(0,a(35471).Z)({},r,[],!0,null,null,null);n.options.__file="src/views/account-manage/index/components/account-strategy/database-account.vue";var o=n.exports},94304:function(t,e,a){"use strict";a.r(e),a.d(e,{default:function(){return o}});var r=function(t,e){var a=e._c;return a("div",{key:"system-account"},[a("jb-form-item",{attrs:{label:e.parent.$t("account.类型"),required:""}},[a("div",{staticClass:"radio-button-group-wraper"},[a("bk-radio-group",{attrs:{value:e.props.formData.type},on:{change:function(t){return e.props.change("type",t)}}},[a("bk-radio-button",{staticClass:"account-type-radio",attrs:{value:1}},[e._v("\n                    Linux\n                ")]),e._v(" "),a("bk-radio-button",{staticClass:"account-type-radio",attrs:{value:2}},[e._v("\n                    Windows\n                ")])],1)],1)]),e._v(" "),a("jb-form-item",{attrs:{label:e.parent.$t("account.名称"),required:"",property:"account"}},[a("jb-input",{attrs:{placeholder:e.props.namePlaceholder,readonly:e.props.isEdit,value:e.props.formData.account},on:{change:function(t){return e.props.change("account",t)}}})],1),e._v(" "),a("jb-form-item",{attrs:{label:e.parent.$t("account.别名"),required:"",property:"alias"}},[a("jb-input",{attrs:{placeholder:e.parent.$t("account.在出现同名账号的情况下，账号的别名显得格外重要..."),value:e.props.formData.alias,maxlength:32},on:{change:function(t){return e.props.change("alias",t)}}})],1),e._v(" "),1!==e.props.formData.type?[a("jb-form-item",{key:"systemPassword",attrs:{label:e.parent.$t("account.密码"),required:"",property:"password"}},[a("bk-input",{attrs:{placeholder:e.parent.$t("account.输入密码"),type:"password",value:e.props.formData.password},on:{change:function(t){return e.props.change("password",t)}}})],1),e._v(" "),a("jb-form-item",{key:"systemRepassword",attrs:{label:e.parent.$t("account.确认密码"),required:"",property:"rePassword"}},[a("bk-input",{attrs:{placeholder:e.parent.$t("account.输入确认密码"),type:"password",value:e.props.formData.rePassword},on:{change:function(t){return e.props.change("rePassword",t)}}})],1)]:e._e(),e._v(" "),a("jb-form-item",{attrs:{label:e.parent.$t("account.描述")}},[a("bk-input",{attrs:{placeholder:e.parent.$t("account.输入账号描述"),value:e.props.formData.remark,type:"textarea",maxlength:200},on:{change:function(t){return e.props.change("remark",t)}}})],1)],2)};r._withStripped=!0;var n=(0,a(35471).Z)({},r,[],!0,null,null,null);n.options.__file="src/views/account-manage/index/components/account-strategy/os-account.vue";var o=n.exports},76684:function(t,e,a){"use strict";a.r(e),a.d(e,{__esModule:function(){return n.X},default:function(){return s}});var r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:t.isLoading},expression:"{ isLoading }"}],staticClass:"operation-account"},[a("jb-form",{directives:[{name:"test",rawName:"v-test",value:{type:"form",value:"createAccount"},expression:"{ type: 'form', value: 'createAccount' }"}],key:t.formData.category+"_"+t.formData.type,ref:"operateAccountForm",attrs:{model:t.formData,rules:t.rules,"form-type":"vertical"}},[a("jb-form-item",{staticStyle:{"margin-bottom":"20px"},attrs:{label:t.$t("account.用途"),required:""}},[a("div",{staticClass:"radio-button-group-wraper"},[a("bk-radio-group",{attrs:{value:t.formData.category},on:{change:t.handleCategoryChange}},t._l(t.categoryList,(function(e){return a("bk-radio-button",{key:e.value,staticClass:"account-type-radio",attrs:{value:e.value}},[t._v("\n                        "+t._s(e.name)+"\n                    ")])})),1)],1)]),t._v(" "),a(t.accountCom,{key:t.formData.category,tag:"component",attrs:{"form-data":t.formData,"is-edit":t.isEdit,"name-placeholder":t.namePlaceholder,change:t.handleFieldChange}})],1)],1)};r._withStripped=!0;var n=a(98914),o=n.Z,c=(a(60118),(0,a(35471).Z)(o,r,[],!1,null,null,null));c.options.__file="src/views/account-manage/index/components/operation.vue";var s=c.exports},62813:function(t,e,a){"use strict";a.r(e),a.d(e,{__esModule:function(){return n.X},default:function(){return s}});var r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("list-action-layout",{scopedSlots:t._u([{key:"right",fn:function(){return[a("jb-search-select",{ref:"search",staticStyle:{width:"420px"},attrs:{data:t.searchSelect,placeholder:t.$t("account.搜索账号别名，名称，更新人...")},on:{"on-change":t.handleSearch}})]},proxy:!0}])},[a("auth-button",{directives:[{name:"test",rawName:"v-test",value:{type:"button",value:"createAccount"},expression:"{ type: 'button', value: 'createAccount' }"}],staticStyle:{width:"120px"},attrs:{auth:"account/create",theme:"primary"},on:{click:t.handleAdd}},[t._v("\n            "+t._s(t.$t("account.新建"))+"\n        ")])],1),t._v(" "),a("render-list",{directives:[{name:"test",rawName:"v-test",value:{type:"list",value:"account"},expression:"{ type: 'list', value: 'account' }"}],ref:"list",attrs:{"data-source":t.dataSource,size:t.tableSize,"search-control":function(){return t.$refs.search}}},[t.allRenderColumnMap.id?a("bk-table-column",{key:"id",attrs:{label:"ID",prop:"id",sortable:"",width:"80",align:"left"}}):t._e(),t._v(" "),t.allRenderColumnMap.alias?a("bk-table-column",{key:"alias",attrs:{label:t.$t("account.账号别名.colHead"),prop:"alias","min-width":"180",sortable:"",align:"left"}}):t._e(),t._v(" "),t.allRenderColumnMap.account?a("bk-table-column",{key:"account",attrs:{label:t.$t("account.账号名称.colHead"),prop:"account","min-width":"180",sortable:"",align:"left"}}):t._e(),t._v(" "),t.allRenderColumnMap.categoryName?a("bk-table-column",{key:"categoryName",attrs:{label:t.$t("account.账号用途.colHead"),prop:"categoryName",width:"120",sortable:"",align:"left"}}):t._e(),t._v(" "),t.allRenderColumnMap.typeName?a("bk-table-column",{key:"typeName",attrs:{label:t.$t("account.账号类型.colHead"),prop:"typeName",width:"120",sortable:"",align:"left"}}):t._e(),t._v(" "),t.allRenderColumnMap.creator?a("bk-table-column",{key:"creator",attrs:{label:t.$t("account.创建人"),prop:"creator",width:"120",align:"left"}}):t._e(),t._v(" "),t.allRenderColumnMap.createTime?a("bk-table-column",{key:"createTime",attrs:{label:t.$t("account.创建时间"),prop:"createTime",width:"180",align:"left"}}):t._e(),t._v(" "),t.allRenderColumnMap.lastModifyUser?a("bk-table-column",{key:"lastModifyUser",attrs:{label:t.$t("account.更新人.colHead"),prop:"lastModifyUser",width:"120",align:"left"}}):t._e(),t._v(" "),t.allRenderColumnMap.lastModifyTime?a("bk-table-column",{key:"lastModifyTime",attrs:{label:t.$t("account.更新时间"),prop:"lastModifyTime",width:"180",align:"left"}}):t._e(),t._v(" "),a("bk-table-column",{key:"action",attrs:{label:t.$t("account.操作"),resizable:!1,fixed:"right",width:"120"},scopedSlots:t._u([{key:"default",fn:function(e){var r=e.row;return[a("auth-button",{directives:[{name:"test",rawName:"v-test",value:{type:"button",value:"editAccount"},expression:"{ type: 'button', value: 'editAccount' }"}],staticClass:"mr10",attrs:{theme:"primary",permission:r.canManage,auth:"account/edit","resource-id":r.id,text:""},on:{click:function(e){return t.handleEdit(r)}}},[t._v("\n                    "+t._s(t.$t("account.编辑"))+"\n                ")]),t._v(" "),a("jb-popover-confirm",{attrs:{title:t.$t("account.确定删除该账号？"),content:t.$t("account.删除后不可恢复，请谨慎操作！"),"confirm-handler":function(){return t.handleDelete(r.id)}}},[a("auth-button",{directives:[{name:"test",rawName:"v-test",value:{type:"button",value:"deleteAccount"},expression:"{ type: 'button', value: 'deleteAccount' }"}],attrs:{text:"",permission:r.canManage,auth:"account/delete","resource-id":r.id}},[t._v("\n                        "+t._s(t.$t("account.删除"))+"\n                    ")])],1)]}}])}),t._v(" "),a("bk-table-column",{attrs:{type:"setting"}},[a("bk-table-setting-content",{attrs:{fields:t.tableColumn,selected:t.selectedTableColumn,size:t.tableSize},on:{"setting-change":t.handleSettingChange}})],1)],1),t._v(" "),a("jb-sideslider",t._b({attrs:{"is-show":t.showOperation,width:540},on:{"update:isShow":function(e){t.showOperation=e},"update:is-show":function(e){t.showOperation=e}}},"jb-sideslider",t.operationSidesliderInfo,!1),[a("operation",{attrs:{data:t.editData},on:{"on-change":t.handleOperationSubmit}})],1)],1)};r._withStripped=!0;var n=a(33897),o=n.Z,c=(0,a(35471).Z)(o,r,[],!1,null,null,null);c.options.__file="src/views/account-manage/index/index.vue";var s=c.exports},60118:function(t,e,a){var r=a(16481);r.__esModule&&(r=r.default),"string"==typeof r&&(r=[[t.id,r,""]]),r.locals&&(t.exports=r.locals);(0,a(13570).Z)("3718efe9",r,!1,{})}}]);