(self.webpackChunkjob=self.webpackChunkjob||[]).push([[5608],{26370:function(e,t,a){"use strict";a(35927),a(43364);var i=a(22696);Object.defineProperty(t,"X",{value:!0}),t.Z=void 0,a(23232),a(80433),a(63762),a(2156),a(56259),a(95179),a(45974),a(87033),a(7170),a(9042),a(90004),a(71959),a(92974),a(57024),a(35948),a(94522);var s=i(a(33610)),n=i(a(97122)),r=i(a(36410)),l=a(30651),o=i(a(34601)),c=i(a(60299)),d=i(a(44068)),u=i(a(12e3)),h=a(41980);function p(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,i)}return a}function f(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?p(Object(a),!0).forEach((function(t){(0,s.default)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):p(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var g={components:{OperationTag:i(a(60174)).default},props:{scriptList:{type:Array,required:!0}},emit:["on-change"],setup(e,t){var a=(0,l.getCurrentInstance)().proxy,i=(0,l.reactive)({isLoading:!0,isShowCreate:!1,search:"",newTagList:[{},{},{}],wholeTagList:[{},{},{}],renderList:[{},{},{}],templateNums:e.scriptList.length,operationList:[{},{},{}],tagRelateNumMap:{},tagCheckInfoMap:{}}),s=(0,l.ref)(null),p=(0,h.checkPublicScript)(a.$route),g=p?u.default:d.default,m=p?o.default.fetchTagList:c.default.fetchWholeList,v={},b={},_={},y={},k=(0,l.computed)((function(){var e=[...i.newTagList,...i.wholeTagList];if(!i.search)return e;var t=new RegExp((0,h.encodeRegexp)(i.search),"i"),a=e.filter((function(e){return t.test(e.name)}));return Object.freeze(a)}));return(0,l.onBeforeMount)((function(){i.isLoading=!0,Promise.all([g.fetchBatchBasicInfo({ids:e.scriptList.map((function(e){return e.id})).join(",")}).then((function(e){e.forEach((function(e){e.tags.forEach((function(e){var t=e.id;v[t]?v[t]+=1:v[t]=1,y[t]||(y[t]={indeterminate:!0},_[t]=!0),v[t]===i.templateNums&&(delete _[t],b[t]=t,y[t]={checked:!0})}))})),i.tagRelateNumMap=Object.freeze(v),i.operationList=Object.values(b),i.tagCheckInfoMap=Object.freeze(y)})),m().then((function(e){i.wholeTagList=Object.freeze(e.reduce((function(e,t){return v[t.id]?e.unshift(t):e.push(t),e}),[]))}))]).finally((function(){i.isLoading=!1}))})),f(f({},(0,l.toRefs)(i)),{},{scrollRef:s,isPublicScript:p,renderList:k,handleSearch:function(e){i.search=(0,r.default)(e)},handleClearSearch:function(){i.search=""},handleNew:function(){i.isShowCreate=!0},handleTagCheckChange:function(e,t){var a=Object.assign({},i.tagCheckInfoMap);a[t]&&a[t].checked?a[t]={checked:!1}:a[t]={checked:!0},window.changeAlert=!0,i.tagCheckInfoMap=Object.freeze(a)},handleTagNew:function(e){s.value&&s.value.scrollTo(0,0),e.isNew=!0,i.newTagList.unshift(e),window.changeAlert=!0},submit:function(){var s=i.operationList.reduce((function(e,t){return e[t]=!0,e}),{}),r=[...i.operationList];(0,n.default)(r,(function(e){return b[e]}));var l=[];return Object.keys(b).forEach((function(e){s[e]||l.push(Number(e))})),Object.keys(_).forEach((function(e){i.tagCheckInfoMap[e].indeterminate||i.tagCheckInfoMap[e].checked||l.push(Number(e))})),g.batchUpdateTag({addTagIdList:r,deleteTagIdList:l,idList:e.scriptList.map((function(e){return e.id}))}).then((function(){a.messageSuccess("编辑标签成功"),t.emit("on-change")}))}})}};t.Z=g},39405:function(e,t,a){"use strict";Object.defineProperty(t,"X",{value:!0}),t.Z=void 0;var i=a(41980),s="script_list_tag_panel_toggle",n={data(){var e=localStorage.getItem(s);return{isOpen:e=!e||JSON.parse(e),styles:{}}},mounted(){var e=(0,i.getOffset)(this.$refs.handler).top;this.styles={height:"calc(100vh  - ".concat(e,"px)")}},methods:{handleToggle(){this.isOpen=!this.isOpen,localStorage.setItem(s,JSON.stringify(this.isOpen))}}};t.Z=n},52460:function(e,t,a){"use strict";var i=a(22696);Object.defineProperty(t,"X",{value:!0}),t.Z=void 0;var s=i(a(56318));a(87033),a(35948),a(94522),a(23232),a(80433),a(9042),a(85604);var n=i(a(44068)),r=i(a(12e3)),l=i(a(60299)),o=i(a(34601)),c=a(41980),d={name:"RenderTagTabItem",components:{TabItem:i(a(14564)).default},data:()=>({isLoading:!1,classesId:1,tagId:0,list:[{},{},{}],countMap:{},isNumberLoading:!1}),computed:{totalCount(){return this.countMap.total||0},unclassifiedCount(){return this.countMap.unclassified||0}},created(){this.isPublicScript=(0,c.checkPublicScript)(this.$route),this.init()},mounted(){this.parseDefaultValueFromURL()},methods:{fetchTagList(){return this.isPublicScript?o.default.fetchTagList():l.default.fetchWholeList()},fetchTagScriptNum(){return this.isPublicScript?r.default.fetchTagCount():n.default.fetchTagCount()},init(){var e=this;this.isLoading=!0,Promise.all([this.fetchTagList(),this.fetchTagScriptNum()]).then((function(t){var a=(0,s.default)(t,2),i=a[0],n=a[1];e.countMap=Object.freeze(n);var r=[];i.forEach((function(e){e.relatedScriptNum=n.tagCount[e.id]||0,r.push(e)})),e.list=Object.freeze(r),e.$emit("on-init",r)})).finally((function(){e.isLoading=!1}))},parseDefaultValueFromURL(){var e=1;if(this.$route.query.panelType)return e=~~this.$route.query.panelType||1,void this.handleClassesSelect(e);if(this.$route.query.panelTag){var t=parseInt(this.$route.query.panelTag,10);t>0&&(this.classesId=0,this.handleSelect(t))}},handleClassesSelect(e){this.classesId!==e&&(this.classesId=e,this.tagId=0,this.$emit("on-change",{panelType:this.classesId,panelTag:""}))},handleSelect(e){e!==this.tagId&&(this.tagId=e,this.classesId=0,this.$emit("on-change",{panelType:"",panelTag:this.tagId}))},handleEdit(e){var t=this;l.default.updateTag(e).then((function(){t.messageSuccess("标签名更新成功"),t.fetchTagList()}))}}};t.Z=d},52351:function(e,t,a){"use strict";var i=a(22696);Object.defineProperty(t,"X",{value:!0}),t.Z=void 0,a(57024),a(45974),a(87033),a(70969),a(58794);var s=i(a(93435)),n=i(a(18306)),r=a(61681),l={name:"",props:{icon:{type:String,default:"tag"},loading:{type:Boolean,default:!0},count:{type:Number,default:0},name:{type:String,default:""},value:{type:Number},description:String,tooltipsDisabled:{type:Boolean,default:!1},id:{type:Number},canEdit:{type:Boolean,default:!1},tagList:{type:Array,default:function(){return[]}}},data(){return{displayName:this.name,isEditable:!1,error:""}},computed:{checkRenameList(){var e=this;return this.tagList.filter((function(t){return t.name!==e.name}))},errorTipsConfig(){return{placement:"top-left",content:{1:"标签名不可为空",2:"标签名已存在，请重新输入",3:r.tagNameRule.message}[this.error],width:3===this.error?200:""}}},created(){this.sefId="tag_".concat((0,n.default)(1,1e3),"_").concat(Date.now())},mounted(){var e=this;document.body.addEventListener("click",this.hideEdit),this.$once("hook:beforeDestroy",(function(){document.body.removeEventListener("click",e.hideEdit)}))},methods:{handleSelect(){this.$emit("on-select",this.id,this.name)},triggerChange(){var e=this;this.displayName!==this.name?""!==this.displayName?(0,s.default)(this.checkRenameList,(function(t){return t.name===e.displayName}))?this.error=2:r.tagNameRule.validator(this.displayName)?(this.error="",this.isEditable=!1,this.$emit("on-edit",{id:this.id,name:this.displayName})):this.error=3:this.error=1:this.isEditable=!1},handleEdit(){var e=this;document.body.click(),this.isEditable=!0,this.$nextTick((function(){e.$refs.input.focus()}))},handleChange(e){this.displayName=e.trim()},handleBlur(){this.triggerChange()},handleEnter(e,t){this.isEditable&&"Enter"===t.key&&13===t.keyCode&&this.triggerChange()},hideEdit(){this.isEditable&&(this.error||(this.isEditable=!1))}}};t.Z=l},69937:function(e,t,a){"use strict";a(35927),a(45974),a(9042),a(43364);var i=a(22696);Object.defineProperty(t,"X",{value:!0}),t.Z=void 0;var s=i(a(33610));a(71959),a(87033);var n=i(a(60299)),r=i(a(34601)),l=i(a(44068)),o=i(a(12e3)),c=i(a(46117)),d=a(41980),u=a(61681),h=a(46790),p=i(a(80712)),f=i(a(27452)),g=i(a(2645)),m=i(a(36894)),v=i(a(53823)),b=i(a(78621)),_=i(a(25109)),y=i(a(33814)),k=i(a(5315));function S(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,i)}return a}function w(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?S(Object(a),!0).forEach((function(t){(0,s.default)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):S(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var C="script_list_columns",T={name:"",components:{ListActionLayout:p.default,RenderList:f.default,ScriptRelatedInfo:b.default,JbSearchSelect:g.default,JbEditInput:m.default,JbEditTag:v.default,Layout:_.default,TagPanel:y.default,BatchEditTag:k.default},data:()=>({showRelated:!1,isShowBatchEditTag:!1,listSelect:[],relatedScriptInfo:{id:0},searchParams:{},selectedTableColumn:[],tableSize:"small"}),computed:{isSkeletonLoading(){return this.$refs.list.isLoading},isBatchEditTagDisabled(){for(var e=0;e<this.listSelect.length;e++){if(!this.listSelect[e].canManage)return!0}return this.listSelect.length<1},allRenderColumnMap(){return this.selectedTableColumn.reduce((function(e,t){return e[t.id]=!0,e}),{})}},created(){this.isPublicScript=(0,d.checkPublicScript)(this.$route),this.serviceHandler=this.isPublicScript?o.default:l.default,this.tagSericeHandler=this.isPublicScript?r.default:n.default,this.getScriptList=this.serviceHandler.scriptList,this.searchClass={},this.searchSelect=[{name:"ID",id:"scriptId",description:"将覆盖其它条件"},{name:"脚本名称",id:"name",default:!0},{name:"脚本语言",id:"type",remoteMethod:o.default.scriptTypeList,remoteExecuteImmediate:!0},{name:"场景标签",id:"tags",remoteMethod:this.tagSericeHandler.fetchTagOfSearch,remoteExecuteImmediate:!0},{name:"创建人",id:"creator",remoteMethod:c.default.fetchUsersOfSearch,inputInclude:!0},{name:"更新人",id:"lastModifyUser",remoteMethod:c.default.fetchUsersOfSearch,inputInclude:!0}],this.tableColumn=[{id:"id",label:"ID"},{id:"name",label:"脚本名称",disabled:!0},{id:"tags",label:"场景标签",disabled:!0},{id:"type",label:"脚本语言"},{id:"related",label:"被引用"},{id:"version",label:"线上版本"},{id:"creator",label:"创建人"},{id:"createTime",label:"创建时间"},{id:"lastModifyUser",label:"更新人"},{id:"lastModifyTime",label:"更新时间"}];var e=h.listColumnsCache.getItem(C);e?(this.selectedTableColumn=Object.freeze(e.columns),this.tableSize=e.size):this.selectedTableColumn=Object.freeze([{id:"name"},{id:"tags"},{id:"type"},{id:"related"},{id:"version"},{id:"related"},{id:"version"},{id:"lastModifyUser"},{id:"lastModifyTime"}]),this.rules={name:[{required:!0,message:"脚本名称必填",trigger:"blur"},{validator:u.scriptNameRule.validator,message:u.scriptNameRule.message,trigger:"blur"}]}},methods:{fetchData(){var e=w({},this.searchParams);this.searchClass.panelType&&(e.panelType=this.searchClass.panelType),this.searchClass.panelTag&&(e.panelTag=this.searchClass.panelTag),this.$refs.list.$emit("onFetch",w({},e))},handleTagPlanChange(e){this.searchClass=e,this.fetchData()},handleBatchEditTag(){this.isShowBatchEditTag=!0},handleBatchEditChange(){this.fetchData(),this.$refs.tagPanelRef.init()},handleSearch(e){this.searchParams=e,this.fetchData()},handleCreate(){this.isPublicScript?this.$router.push({name:"createPublicScript"}):this.$router.push({name:"createScript"})},handleUpdateScript(e,t){var a=this;return this.serviceHandler.scriptUpdateMeta(w(w({id:e},t),{},{updateField:Object.keys(t)[0]})).then((function(){a.$refs.tagPanelRef&&a.$refs.tagPanelRef.init()}))},handleSelection(e){this.listSelect=Object.freeze(e)},handleSettingChange(e){var t=e.fields,a=e.size;this.selectedTableColumn=Object.freeze(t),this.tableSize=a,h.listColumnsCache.setItem(C,{columns:t,size:a})},handleVersion(e){this.isPublicScript?this.$router.push({name:"publicScriptVersion",params:{id:4}}):this.$router.push({name:"scriptVersion",params:{id:4}})},handleExec(e){this.$router.push({name:"fastExecuteScript",params:{taskInstanceId:0,scriptVersionId:0}})},handleDelete(e){var t=this;return e.isEnableRemove?this.serviceHandler.scriptDelete({id:e.id}).then((function(){return t.fetchData(),t.messageSuccess("删除成功"),!0})):(this.messageError("脚本正被作业引用中，无法删除"),!1)},handleShowRelated(e){this.showRelated=!0,this.relatedScriptInfo=e},renderHeader:(e,t)=>e("span",[e("span",[t.column.label]),e("bk-popover",[e("icon",{attrs:{type:"circle-italics-info"},style:"margin-left: 8px; font-size: 12px;"}),e("div",{slot:"content"},[e("div",["显示被作业引用的次数"]),e("div",["显示被执行方案引用的次数"])])])])}};t.Z=T},19759:function(){},4331:function(){},61640:function(){},25218:function(){},5315:function(e,t,a){"use strict";a.r(t),a.d(t,{__esModule:function(){return s.X},default:function(){return l}});var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:e.isLoading},expression:"{ isLoading }"}],staticClass:"script-manage-batch-edit-tag"},[a("div",{staticStyle:{"margin-bottom":"8px"}},[e._v("\n        "+e._s("范围")+"："+e._s("共")),a("span",{staticClass:"strong number"},[e._v(e._s(e.templateNums))]),e._v(e._s("个脚本")+"\n    ")]),e._v(" "),a("jb-form",{attrs:{"form-type":"vertical"}},[a("jb-form-item",{staticStyle:{"margin-bottom":"0"},attrs:{label:"标签",required:""}},[a("div",{staticClass:"tag-panel"},[a("bk-input",{staticClass:"tag-search",attrs:{value:e.search,spellcheck:!1,"left-icon":"bk-icon icon-search"},on:{change:e.handleSearch}}),e._v(" "),a("div",{staticClass:"wrapper",staticStyle:{height:"210px"}},[e.renderList.length>0?a("scroll-faker",{ref:"scrollRef"},[a("bk-checkbox-group",{staticClass:"tag-list",model:{value:e.operationList,callback:function(t){e.operationList=t},expression:"operationList"}},e._l(e.renderList,(function(t){return a("bk-checkbox",e._b({key:t.id,staticClass:"tag-item",attrs:{value:t.id},on:{change:function(a){return e.handleTagCheckChange(a,t.id)}}},"bk-checkbox",e.tagCheckInfoMap[t.id],!1),[e._v("\n                                "+e._s(t.name)+"\n                                "),e.tagCheckInfoMap[t.id]?[e.tagCheckInfoMap[t.id].checked?a("span",{directives:[{name:"bk-tooltips",rawName:"v-bk-tooltips.right",value:"勾选范围里，全部脚本使用",expression:"'勾选范围里，全部脚本使用'",modifiers:{right:!0}}],staticClass:"relate-all"},[e._v("\n                                        All\n                                    ")]):e._e(),e._v(" "),e.tagCheckInfoMap[t.id].indeterminate?a("span",{directives:[{name:"bk-tooltips",rawName:"v-bk-tooltips.right",value:"勾选范围里，有 "+e.tagRelateNumMap[t.id]+" 个脚本使用",expression:"`${'勾选范围里，有'} ${tagRelateNumMap[tagItem.id]} ${'个脚本使用'}`",modifiers:{right:!0}}],staticClass:"relate-nums"},[e._v("\n                                        "+e._s(e.tagRelateNumMap[t.id])+"/"+e._s(e.templateNums)+"\n                                    ")]):e._e()]:e._e(),e._v(" "),t.isNew?a("span",{staticClass:"new-tag-flag"},[e._v("\n                                    new\n                                ")]):e._e()],2)})),1)],1):e.search?a("Empty",{staticStyle:{"margin-top":"20px"},attrs:{type:"search"}},[a("span",[e._v(e._s("搜索结果为空")+"，")]),e._v(" "),a("bk-button",{attrs:{text:""},on:{click:e.handleClearSearch}},[e._v("\n                            "+e._s("清空搜索")+"\n                        ")])],1):e._e()],1),e._v(" "),e.isPublicScript?e._e():[a("auth-component",{attrs:{auth:"tag/create"}},[a("div",{staticClass:"tag-create",on:{click:e.handleNew}},[a("bk-icon",{staticStyle:{"margin-right":"8px","font-size":"16px"},attrs:{type:"plus-circle"}}),e._v(" "),a("span",[e._v(e._s("新建标签"))])],1),e._v(" "),a("div",{staticClass:"tag-create",attrs:{slot:"forbid"},slot:"forbid"},[a("bk-icon",{staticStyle:{"margin-right":"8px","font-size":"16px"},attrs:{type:"plus-circle"}}),e._v(" "),a("span",[e._v(e._s("新建标签"))])],1)])]],2)])],1),e._v(" "),a("lower-component",{attrs:{level:"custom",custom:e.isShowCreate}},[a("operation-tag",{on:{"on-change":e.handleTagNew},model:{value:e.isShowCreate,callback:function(t){e.isShowCreate=t},expression:"isShowCreate"}})],1)],1)};i._withStripped=!0;var s=a(26370),n=s.Z,r=(a(60844),(0,a(35471).Z)(n,i,[],!1,null,null,null));r.options.__file="src/views/script-manage/list/components/batch-edit-tag.vue";var l=r.exports},25109:function(e,t,a){"use strict";a.r(t),a.d(t,{__esModule:function(){return s.X},default:function(){return l}});var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{ref:"handler",staticClass:"script-manage-list-layout"},[e.$slots.tag?a("div",{class:{"layout-left":!0,expended:e.isOpen}},[a("scroll-faker",{style:e.styles},[e._t("tag")],2)],1):e._e(),e._v(" "),a("div",{staticClass:"layout-right",class:{"no-tag":!e.$slots.tag}},[e.$slots.tag?a("div",{staticClass:"toggle-button",on:{click:e.handleToggle}},[a("Icon",{staticClass:"toggle-arrow",class:{open:e.isOpen},attrs:{type:"down-small"}})],1):e._e(),e._v(" "),e._t("default")],2)])};i._withStripped=!0;var s=a(39405),n=s.Z,r=(a(25334),(0,a(35471).Z)(n,i,[],!1,null,null,null));r.options.__file="src/views/script-manage/list/components/layout.vue";var l=r.exports},33814:function(e,t,a){"use strict";a.r(t),a.d(t,{__esModule:function(){return s.X},default:function(){return l}});var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:e.isLoading},expression:"{ isLoading }"}],staticClass:"script-list-tag-panel"},[a("tab-item",{attrs:{name:"全部脚本",id:1,value:e.classesId,icon:"business-manage",count:e.totalCount,"tooltips-disabled":!0},on:{"on-select":e.handleClassesSelect}}),e._v(" "),a("tab-item",{attrs:{name:"未分类",id:2,value:e.classesId,icon:"unclassified",count:e.unclassifiedCount,"tooltips-disabled":!0},on:{"on-select":e.handleClassesSelect}}),e._v(" "),a("div",{staticClass:"line"}),e._v(" "),e._l(e.list,(function(t){return[t.relatedScriptNum>0?a("tab-item",{key:t.id,attrs:{id:t.id,count:t.relatedScriptNum,name:t.name,value:e.tagId,"can-edit":!0,"tag-list":e.list,description:t.description},on:{"on-select":e.handleSelect,"on-edit":e.handleEdit}}):e._e()]}))],2)};i._withStripped=!0;var s=a(52460),n=s.Z,r=(a(59233),(0,a(35471).Z)(n,i,[],!1,null,"824b094c",null));r.options.__file="src/views/script-manage/list/components/tag-panel/index.vue";var l=r.exports},14564:function(e,t,a){"use strict";a.r(t),a.d(t,{__esModule:function(){return s.X},default:function(){return l}});var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"script-list-tag-edit",class:{active:e.value===e.id,display:!e.canEdit,edit:e.canEdit,"edit-error":!!e.error},on:{click:function(e){e.stopPropagation()}}},[a("Icon",{staticClass:"tag-flag",attrs:{type:e.icon}}),e._v(" "),e.isEditable?[a("bk-input",{ref:"input",attrs:{placeholder:"请输入标签名...",value:e.displayName},on:{change:e.handleChange,blur:e.handleBlur,keyup:e.handleEnter}}),e._v(" "),e.error?a("div",{directives:[{name:"bk-tooltips",rawName:"v-bk-tooltips",value:e.errorTipsConfig,expression:"errorTipsConfig"}],staticClass:"input-edit-info"},[a("Icon",{attrs:{type:"info"}})],1):e._e()]:[a("div",{directives:[{name:"bk-tooltips",rawName:"v-bk-tooltips",value:{allowHtml:!0,width:240,distance:15,trigger:"mouseenter",theme:"light",content:"#"+e.sefId,placement:"right-start",boundary:"window",disabled:e.tooltipsDisabled},expression:"{\n                allowHtml: true,\n                width: 240,\n                distance: 15,\n                trigger: 'mouseenter',\n                theme: 'light',\n                content: `#${sefId}`,\n                placement: 'right-start',\n                boundary: 'window',\n                disabled: tooltipsDisabled,\n            }"}],staticClass:"tag-name",on:{click:e.handleSelect}},[a("div",{staticClass:"name-text"},[e._v(e._s(e.displayName))])]),e._v(" "),a("div",{staticClass:"tag-num-box"},[a("span",{staticClass:"tag-num"},[e._v(e._s(e.count))])]),e._v(" "),e.canEdit?a("auth-component",{attrs:{auth:"tag/edit","resource-id":e.id}},[a("div",{staticClass:"edit-action",on:{click:e.handleEdit}},[a("Icon",{attrs:{type:"edit-2"}})],1),e._v(" "),a("div",{staticClass:"edit-action",attrs:{slot:"forbid"},slot:"forbid"},[a("Icon",{attrs:{type:"edit-2"}})],1)]):e._e()],e._v(" "),a("div",{staticStyle:{display:"none"}},[a("table",{staticStyle:{"font-size":"12px","line-height":"24px",color:"#63656e"},attrs:{id:e.sefId}},[a("tr",[a("td",{staticStyle:{color:"#979ba5","text-align":"right","white-space":"nowrap","vertical-align":"top"}},[e._v("标签名称：")]),e._v(" "),a("td",{staticStyle:{"word-break":"break-all","vertical-align":"top"}},[e._v(e._s(e.displayName))])]),e._v(" "),a("tr",[a("td",{staticStyle:{color:"#979ba5","text-align":"right","white-space":"nowrap","vertical-align":"top"}},[e._v("标签描述：")]),e._v(" "),a("td",{staticStyle:{"word-break":"break-all","vertical-align":"top"}},[e._v(e._s(e.description||"--"))])])])])],2)};i._withStripped=!0;var s=a(52351),n=s.Z,r=(a(66493),(0,a(35471).Z)(n,i,[],!1,null,null,null));r.options.__file="src/views/script-manage/list/components/tag-panel/tab-item.vue";var l=r.exports},95608:function(e,t,a){"use strict";a.r(t),a.d(t,{__esModule:function(){return s.X},default:function(){return l}});var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("layout",{scopedSlots:e._u([{key:"tag",fn:function(){return[a("tag-panel",{ref:"tagPanelRef",on:{"on-change":e.handleTagPlanChange}})]},proxy:!0}])},[e._v(" "),a("list-action-layout",{scopedSlots:e._u([{key:"right",fn:function(){return[a("jb-search-select",{ref:"search",staticStyle:{width:"420px"},attrs:{data:e.searchSelect,placeholder:"搜索脚本名称，类型，场景标签，更新人..."},on:{"on-change":e.handleSearch}})]},proxy:!0}])},[a("auth-button",{staticClass:"w120",attrs:{theme:"primary",auth:"script/create"},on:{click:e.handleCreate}},[e._v("\n            "+e._s("新建")+"\n        ")]),e._v(" "),a("bk-button",{on:{click:e.handleBatchEditTag}},[e._v("\n            "+e._s("编辑标签")+"\n        ")])],1),e._v(" "),a("render-list",{ref:"list",attrs:{"data-source":e.getScriptList,size:e.tableSize,selectable:"","search-control":function(){return e.$refs.search}},on:{"on-selection-change":e.handleSelection}},[e.allRenderColumnMap.id?a("bk-table-column",{key:"id",attrs:{label:"ID",prop:"id",width:"300",align:"left"}}):e._e(),e._v(" "),a("bk-table-column",{key:"name",attrs:{label:"脚本名称",prop:"name","min-width":300,sortable:"",align:"left"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row;return[a("auth-component",{attrs:{permission:i.canView,auth:"script/view","resource-id":i.id}},[a("jb-edit-input",{key:i.id,attrs:{field:"scriptName",rules:e.rules.name,value:i.name,"remote-hander":function(t){return e.handleUpdateScript(i.id,t)}},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.value;return[a("span",{staticStyle:{color:"#3a84ff",cursor:"pointer"},on:{click:function(t){return e.handleVersion(i)}}},[e._v("\n                            "+e._s(s)+"\n                        ")])]}}],null,!0)}),e._v(" "),a("span",{attrs:{slot:"forbid"},slot:"forbid"},[e._v(e._s(i.name))])],1)]}}])}),e._v(" "),e.allRenderColumnMap.type?a("bk-table-column",{key:"type",attrs:{label:"脚本语言",sortable:"",prop:"type",width:"120",align:"left"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row;return[a("span",[e._v(e._s(i.typeName))])]}}],null,!1,3662136475)}):e._e(),e._v(" "),a("bk-table-column",{key:"tags",attrs:{label:"场景标签",sortable:"",prop:"tags",width:"200",align:"left","class-name":"edit-tag-column"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row;return[a("auth-component",{attrs:{permission:i.canManage,auth:"script/edit","resource-id":i.id}},[a("jb-edit-tag",{key:i.id,attrs:{field:"scriptTags",value:i.tags,shortcurt:"","remote-hander":function(t){return e.handleUpdateScript(i.id,t)}}}),e._v(" "),a("div",{attrs:{slot:"forbid"},slot:"forbid"},[e._v(e._s(i.tagsText))])],1)]}}])}),e._v(" "),e.allRenderColumnMap.related?a("bk-table-column",{key:"related",attrs:{label:"被引用",prop:"related",width:"120","render-header":e.renderHeader,align:"right"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row;return[a("bk-button",{directives:[{name:"bk-tooltips",rawName:"v-bk-tooltips.right.allowHtml",value:"\n                                <div>作业模板引用: "+i.relatedTaskTemplateNum+"</div>\n                                <div>执行方案引用: "+i.relatedTaskPlanNum+"</div>",expression:"`\n                                <div>${'作业模板引用'}: ${row.relatedTaskTemplateNum}</div>\n                                <div>${'执行方案引用'}: ${row.relatedTaskPlanNum}</div>`",modifiers:{right:!0,allowHtml:!0}}],staticClass:"mr20",attrs:{text:""},on:{click:function(t){return e.handleShowRelated(i)}}},[a("span",[e._v(e._s(i.relatedTaskTemplateNum))]),e._v(" "),a("span",[e._v(" / ")]),e._v(" "),a("span",[e._v(e._s(i.relatedTaskPlanNum))])])]}}],null,!1,33583878)}):e._e(),e._v(" "),e.allRenderColumnMap.version?a("bk-table-column",{key:"version",attrs:{label:"线上版本","show-overflow-tooltip":"",prop:"version",width:"140",align:"left"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row;return[a("span",[e._v(" "+e._s(i.version||"--")+" ")])]}}],null,!1,1631662558)}):e._e(),e._v(" "),e.allRenderColumnMap.creator?a("bk-table-column",{key:"creator",attrs:{label:"创建人",sortable:"","show-overflow-tooltip":"",prop:"creator",width:"140",align:"left"}}):e._e(),e._v(" "),e.allRenderColumnMap.createTime?a("bk-table-column",{key:"createTime",attrs:{label:"创建时间",prop:"createTime",width:"180",align:"left"}}):e._e(),e._v(" "),e.allRenderColumnMap.lastModifyUser?a("bk-table-column",{key:"lastModifyUser",attrs:{label:"更新人",width:"160",prop:"lastModifyUser",align:"left"}}):e._e(),e._v(" "),e.allRenderColumnMap.lastModifyTime?a("bk-table-column",{key:"lastModifyTime",attrs:{label:"更新时间",width:"180",prop:"lastModifyTime",align:"left"}}):e._e(),e._v(" "),a("bk-table-column",{key:"action",attrs:{label:"操作",resizable:!1,fixed:"right",width:"170",align:"left"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row;return[a("auth-button",{staticClass:"mr10",attrs:{text:"",permission:i.canView,auth:"script/view","resource-id":i.id},on:{click:function(t){return e.handleVersion(i)}}},[e._v("\n                    "+e._s("版本管理")+"\n                ")]),e._v(" "),a("span",{staticClass:"mr10",attrs:{"tippy-tips":i.isExecuteDisable?"该脚本没有 “线上版本” 可执行，请前往版本管理内设置。":""}},[a("auth-button",{attrs:{text:"",permission:i.canView,auth:"script/execute","resource-id":i.id},on:{click:function(t){return e.handleExec(i)}}},[e._v("\n                        "+e._s("去执行")+"\n                    ")])],1),e._v(" "),a("jb-popover-confirm",{attrs:{title:"确定删除该脚本？",content:"注意！脚本内的所有版本也将被清除","confirm-handler":function(){return e.handleDelete(i)}}},[a("auth-button",{attrs:{permission:i.canManage,auth:"script/delete","resource-id":i.id,text:""}},[e._v("\n                        "+e._s("删除")+"\n                    ")])],1)]}}])}),e._v(" "),a("bk-table-column",{attrs:{type:"setting"}},[a("bk-table-setting-content",{attrs:{fields:e.tableColumn,selected:e.selectedTableColumn,size:e.tableSize},on:{"setting-change":e.handleSettingChange}})],1)],1),e._v(" "),a("jb-dialog",{attrs:{title:"编辑标签","header-position":"left","ok-text":"确定",width:480},model:{value:e.isShowBatchEditTag,callback:function(t){e.isShowBatchEditTag=t},expression:"isShowBatchEditTag"}},[e.isShowBatchEditTag?a("batch-edit-tag",{attrs:{"script-list":e.listSelect},on:{"on-change":e.handleBatchEditChange}}):e._e()],1),e._v(" "),a("jb-sideslider",{attrs:{"is-show":e.showRelated,"show-footer":!1,"quick-close":"",title:"被引用",width:695},on:{"update:isShow":function(t){e.showRelated=t},"update:is-show":function(t){e.showRelated=t}}},[a("script-related-info",{attrs:{from:"scriptList",info:e.relatedScriptInfo}})],1)],1)};i._withStripped=!0;var s=a(69937),n=s.Z,r=(0,a(35471).Z)(n,i,[],!1,null,null,null);r.options.__file="src/views/script-manage/list/index.vue";var l=r.exports},60844:function(e,t,a){var i=a(19759);i.__esModule&&(i=i.default),"string"==typeof i&&(i=[[e.id,i,""]]),i.locals&&(e.exports=i.locals);(0,a(13570).Z)("38ca70ca",i,!1,{})},25334:function(e,t,a){var i=a(4331);i.__esModule&&(i=i.default),"string"==typeof i&&(i=[[e.id,i,""]]),i.locals&&(e.exports=i.locals);(0,a(13570).Z)("3c8a1adb",i,!1,{})},59233:function(e,t,a){var i=a(61640);i.__esModule&&(i=i.default),"string"==typeof i&&(i=[[e.id,i,""]]),i.locals&&(e.exports=i.locals);(0,a(13570).Z)("db80f542",i,!1,{})},66493:function(e,t,a){var i=a(25218);i.__esModule&&(i=i.default),"string"==typeof i&&(i=[[e.id,i,""]]),i.locals&&(e.exports=i.locals);(0,a(13570).Z)("2fdd50b4",i,!1,{})}}]);