(self.webpackChunkjob=self.webpackChunkjob||[]).push([[3025],{59326:function(t,e,a){"use strict";Object.defineProperty(e,"X",{value:!0}),e.Z=void 0,a(57024);var s=a(41980),i={name:"",props:{total:{type:Number,required:!0},current:{type:Number,required:!0}},mounted(){var t=this;this.timer=setTimeout((function(){t.handleScrollToCurrentStep()}),1e3)},beforeDestroy(){clearTimeout(this.timer)},methods:{handleScrollToCurrentStep(){var t=document.querySelector(".container-content");if(t){var e=document.querySelectorAll(".execution-step-box")[this.current],a=(0,s.getOffset)(e).top,i=(window.innerHeight-e.getBoundingClientRect().height)/2;(0,s.scrollTopSmooth)(t,a-i)}}}};e.Z=i},48295:function(t,e,a){"use strict";var s=a(22696);Object.defineProperty(e,"X",{value:!0}),e.Z=void 0;var i=s(a(15399)),n=s(a(67713)),o=s(a(45139)),r=s(a(26005)),l={name:"TaskStep",components:{StepAction:s(a(1156)).default},props:{data:{type:Object,required:!0}},computed:{themeCom(){return this.data.isApproval&&!this.data.isNotStart?r.default:o.default}},methods:{handleChoose(){this.data.isApproval||(this.data.isNotStart?this.$bkMessage({theme:"warning",message:i.default.t("history.该步骤还未执行"),limit:1}):this.$emit("on-select",this.data))},handleChangeStatus(t,e){var a=this;return n.default.updateTaskExecutionStepOperate({id:this.data.stepInstanceId,operationCode:t,confirmReason:e}).then((function(){return a.$bkMessage({limit:1,theme:"success",message:i.default.t("history.操作成功")}),a.$emit("on-update"),!0}))}}};e.Z=l},64198:function(t,e,a){"use strict";var s=a(22696);Object.defineProperty(e,"X",{value:!0}),e.Z=void 0;var i={components:{StepAction:s(a(1156)).default},props:{data:{type:Object,required:!0},choose:{type:Function,default:function(){}},handleChangeStatus:{type:Function,default:function(){}}},data:()=>({confirmReason:""})};e.Z=i},14394:function(t,e,a){"use strict";var s=a(22696);Object.defineProperty(e,"X",{value:!0}),e.Z=void 0;var i=s(a(15621)),n=s(a(4027)),o=s(a(1156)),r={components:{DetailLayout:i.default,DetailItem:n.default,StepAction:o.default},props:{data:{type:Object},choose:{type:Function},handleChangeStatus:{type:Function}}};e.Z=r},30986:function(t,e,a){"use strict";var s=a(22696);Object.defineProperty(e,"X",{value:!0}),e.Z=void 0,a(87033),a(35948),a(94522),a(61026);var i=s(a(15399)),n=s(a(67713)),o=s(a(41641)),r=s(a(18818)),l=s(a(24787)),c=s(a(28445)),u=s(a(3851)),d=s(a(19553)),p=s(a(41547)),h=s(a(1156)),f=s(a(59362)),v={name:"",components:{BackTop:o.default,TaskStep:r.default,ExecutionProcess:l.default,GlobalVariable:d.default,OperationRecord:p.default,StepAction:h.default,TaskStepStart:c.default,TaskStepEnd:u.default,ExecutionStatusBar:f.default},data:()=>({isLoading:!0,taskInstanceId:0,isShowGlobalVariable:!1,isShowOperationRecord:!1,formData:{finished:!0,totalStep:0,currentStepRunningOrder:0,taskExecution:{},stepExecution:[]}}),computed:{isSkeletonLoading(){return this.isLoading}},created(){var t=this;this.timer="",this.taskPollingQueue=[],this.taskInstanceId=this.$route.params.id,this.isForceing=!1,this.fetchData(),this.startTimer(),this.$once("hook:beforeDestroy",(function(){t.clearTimer()}))},methods:{fetchData(){var t=this;(!(arguments.length>0&&void 0!==arguments[0])||arguments[0])&&(this.isLoading=!0),n.default.fetchTaskExecutionResult({id:this.taskInstanceId},{permission:"page"}).then((function(e){t.isForceing||(t.formData=e,e.finished?t.taskPollingQueue=[]:t.taskPollingQueue.push((function(){return t.fetchData(!1)})))})).catch((function(e){t.taskPollingQueue=[],[400,1244006].includes(e.code)&&setTimeout((function(){t.$router.push({name:"historyList"})}),3e3)})).finally((function(){t.isLoading=!1}))},startTimer(){var t=this;if(!this.timerClear){if(this.taskPollingQueue.length>0)this.taskPollingQueue.shift()();setTimeout((function(){t.startTimer()}),1e3)}},clearTimer(){this.timerClear=!0,this.taskPollingQueue=[]},handleSelectStep(t){this.$router.push({name:"historyStep",params:{taskInstanceId:this.taskInstanceId},query:{stepInstanceId:t.stepInstanceId,retryCount:t.retryCount,from:this.$route.query.from||"historyTask"}})},handleStartForceTask(){this.isForceing=!0},handleCancelForceTask(){this.isForceing=!1,this.fetchData()},handleForceTask(){var t=this;return n.default.updateTaskExecutionStepOperateTerminate({taskInstanceId:this.taskInstanceId}).then((function(){return t.isForceing=!1,t.fetchData(),t.messageSuccess(i.default.t("history.操作成功")),!0}))},handleUpdateStepStatus(){this.fetchData()},handleGoRetry(){var t=this;this.isLoading=!0,n.default.fetchTaskInstance({id:this.taskInstanceId}).then((function(e){e.variables.length>0?t.$router.push({name:"redoTask",params:{taskInstanceId:t.taskInstanceId}}):t.$bkInfo({title:i.default.t("history.确认执行？"),subTitle:i.default.t("history.该方案未设置全局变量，点击确认将直接执行。"),confirmFn:function(){t.isLoading=!0,n.default.redoTask({taskInstanceId:t.taskInstanceId,taskVariables:[]}).then((function(e){var a=e.taskInstanceId;t.$bkMessage({theme:"success",message:i.default.t("history.执行成功")}),t.$router.push({name:"historyTask",params:{id:a}}),t.taskInstanceId=a})).finally((function(){t.isLoading=!1}))}})})).finally((function(){t.isLoading=!1}))},handleShowGlobalVariable(){this.isShowGlobalVariable=!0},handleShowOperationRecord(){this.isShowOperationRecord=!0},handleGoPlan(){var t={};t=this.formData.taskExecution.debugTask?this.$router.resolve({name:"debugPlan",params:{id:this.formData.taskExecution.templateId},query:{from:"historyTask"}}):this.$router.resolve({name:"viewPlan",params:{templateId:this.formData.taskExecution.templateId},query:{from:"historyTask",viewPlanId:this.formData.taskExecution.taskId,taskInstanceId:this.taskInstanceId}}),window.open(t.href)},routerBack(){var t=this.$route.query.from;"viewPlan"!==t?"planList"!==t?this.$router.push({name:"historyList"}):this.$router.push({name:"planList",query:{viewTemplateId:this.formData.taskExecution.templateId,viewPlanId:this.formData.taskExecution.taskId}}):this.$router.push({name:"viewPlan",params:{templateId:this.formData.taskExecution.templateId},query:{viewPlanId:this.formData.taskExecution.taskId}})}}};e.Z=v},58649:function(){},89285:function(){},62893:function(){},24787:function(t,e,a){"use strict";a.r(e),a.d(e,{__esModule:function(){return i.X},default:function(){return r}});var s=function(){var t=this,e=t.$createElement;return(t._self._c||e)("div",{directives:[{name:"bk-tooltips",rawName:"v-bk-tooltips",value:t.$t("history.定位到当前步骤"),expression:"$t('history.定位到当前步骤')"}],staticClass:"task-exeution-process",on:{click:t.handleScrollToCurrentStep}},[t._v("\n    "+t._s(t.current)+" / "+t._s(t.total)+"\n")])};s._withStripped=!0;var i=a(59326),n=i.Z,o=(a(11239),(0,a(35471).Z)(n,s,[],!1,null,null,null));o.options.__file="src/views/executive-history/task-detail/components/execution-process/index.vue";var r=o.exports},18818:function(t,e,a){"use strict";a.r(e),a.d(e,{__esModule:function(){return i.X},default:function(){return r}});var s=function(){var t=this,e=t.$createElement;return(t._self._c||e)(t.themeCom,t._b({tag:"component",attrs:{data:t.data,choose:t.handleChoose,"handle-change-status":t.handleChangeStatus}},"component",t.$attrs,!1))};s._withStripped=!0;var i=a(48295),n=i.Z,o=(a(77542),(0,a(35471).Z)(n,s,[],!1,null,null,null));o.options.__file="src/views/executive-history/task-detail/components/task-step/index.vue";var r=o.exports},26005:function(t,e,a){"use strict";a.r(e),a.d(e,{__esModule:function(){return i.X},default:function(){return r}});var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"execution-step-box theme-approval",class:[t.data.displayStyle],on:{click:t.choose}},[a("div",{staticClass:"step-desc"},[a("div",{staticClass:"step-icon"},[a("Icon",{attrs:{type:t.data.icon}})],1),t._v(" "),a("div",[t._v(t._s(t.data.name))]),t._v(" "),a("div",{staticClass:"confirm-flag"},[t._v(t._s(t.$t("history.已确认")))])]),t._v(" "),a("div",{staticClass:"approval-container"},[a("div",{staticClass:"approval-info"},[t.data.roleNameList.length||t.data.userList.length?a("div",{staticClass:"approval-person"},[a("span",{staticClass:"persion-label"},[t._v(t._s(t.$t("history.确认人"))+"：")]),t._v(" "),t._l(t.data.roleNameList,(function(e){return a("div",{key:"role_"+e,staticClass:"person"},[a("Icon",{staticClass:"role-flag",attrs:{type:"user-group-gray"}}),t._v("\n                    "+t._s(e)+"\n                ")],1)})),t._v(" "),t._l(t.data.userList,(function(e){return a("div",{key:"user_"+e,staticClass:"person"},[a("Icon",{staticClass:"role-flag",attrs:{type:"user"}}),t._v("\n                    "+t._s(e)+"\n                ")],1)}))],2):t._e(),t._v(" "),t.data.notifyChannelNameList.length>0?a("div",{staticClass:"approval-channel"},[t._v("\n                "+t._s(t.$t("history.通知方式"))+"："),a("span",[t._v(t._s(t.data.notifyChannelNameList.join("，")))])]):t._e()]),t._v(" "),t.data.confirmMessage?a("div",{staticClass:"step-message"},[t._v(t._s(t.data.confirmMessage))]):t._e(),t._v(" "),t.data.isApprovaling?a("bk-input",{staticClass:"confirm-reason",attrs:{type:"textarea",rows:3,maxlength:100,placeholder:t.$t("history.可在此处输入确认或终止的因由")},model:{value:t.confirmReason,callback:function(e){t.confirmReason=e},expression:"confirmReason"}}):t.data.operator?a("div",{staticClass:"confirm-reason-text"},[a("div",{staticClass:"person"},[t._v(t._s(t.data.operator))]),t._v(" "),a("span",{domProps:{innerHTML:t._s(t.data.confirmReasonHtml)}})]):t._e(),t._v(" "),a("div",{staticClass:"step-action",on:{click:function(t){t.stopPropagation()}}},t._l(t.data.actions,(function(e){return a("step-action",{key:e,attrs:{name:e,"confirm-handler":function(e){return t.handleChangeStatus(e,t.confirmReason)}}})})),1)],1),t._v(" "),a("Icon",{staticClass:"step-process",attrs:{type:t.data.lastStepIcon,svg:""}})],1)};s._withStripped=!0;var i=a(64198),n=i.Z,o=(0,a(35471).Z)(n,s,[],!1,null,null,null);o.options.__file="src/views/executive-history/task-detail/components/task-step/theme/approval.vue";var r=o.exports},3851:function(t,e,a){"use strict";a.r(e),a.d(e,{default:function(){return n}});var s=function(t,e){var a=e._c;return a("div",{staticClass:"execution-step-box theme-end",class:{disabled:!e.props.finished}},[a("div",{staticClass:"step-icon"},[e._v(e._s(e.parent.$t("history.终")))])])};s._withStripped=!0;var i=(0,a(35471).Z)({},s,[],!0,null,null,null);i.options.__file="src/views/executive-history/task-detail/components/task-step/theme/end.vue";var n=i.exports},45139:function(t,e,a){"use strict";a.r(e),a.d(e,{__esModule:function(){return i.X},default:function(){return r}});var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"execution-step-box theme-normal",class:[t.data.displayStyle]},[a("div",{staticClass:"step-icon"},[a("Icon",{attrs:{type:t.data.icon}})],1),t._v(" "),a("div",{staticClass:"theme-normal-wraper",on:{click:t.choose}},[a("div",{staticClass:"step-desc"},[a("div",{staticClass:"name-text"},[t._v(t._s(t.data.name))]),t._v(" "),t.data.isNotStart?t._e():a("div",{staticClass:"step-status-desc"},[t.data.totalTime?a("span",{staticClass:"time"},[t._v(t._s(t.data.totalTimeText))]):t._e(),t._v(" "),["fail","forced"].includes(t.data.displayStyle)?a("Icon",{staticClass:"step-error-flag",attrs:{type:"close"}}):t._e()],1)]),t._v(" "),t.data.isNotStart?t._e():a("div",{staticClass:"step-info"},[a("detail-layout",[a("detail-item",{attrs:{label:t.$t("history.步骤名称")+"："}},[t._v("\n                    "+t._s(t.data.name)+"\n                ")]),t._v(" "),a("detail-item",{attrs:{label:t.$t("history.开始时间.label")+"："}},[t._v("\n                    "+t._s(t.data.startTime)+"\n                ")]),t._v(" "),a("detail-item",{attrs:{label:t.$t("history.结束时间")+"："}},[t._v("\n                    "+t._s(t.data.endTime||"--")+"\n                ")])],1)],1)]),t._v(" "),a("Icon",{staticClass:"step-process",class:t.data.lastStepIcon,attrs:{type:t.data.lastStepIcon,svg:""}}),t._v(" "),t.data.isDoing?a("img",{staticClass:"loading-progress",attrs:{src:"/static/images/task-loading.png"}}):t._e(),t._v(" "),a("div",{staticClass:"step-action",on:{click:function(t){t.stopPropagation()}}},t._l(t.data.actions,(function(e){return a("step-action",{key:e,attrs:{name:e,"confirm-handler":function(e){return t.handleChangeStatus(e)}}})})),1)],1)};s._withStripped=!0;var i=a(14394),n=i.Z,o=(0,a(35471).Z)(n,s,[],!1,null,null,null);o.options.__file="src/views/executive-history/task-detail/components/task-step/theme/normal.vue";var r=o.exports},28445:function(t,e,a){"use strict";a.r(e),a.d(e,{default:function(){return n}});var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"execution-step-box theme-start"},[a("div",{staticClass:"step-icon"},[t._v(t._s(t.$t("history.始")))]),t._v(" "),a("Icon",{staticClass:"step-process",attrs:{type:"step-next",svg:""}})],1)};s._withStripped=!0;var i=(0,a(35471).Z)({},s,[],!1,null,null,null);i.options.__file="src/views/executive-history/task-detail/components/task-step/theme/start.vue";var n=i.exports},93025:function(t,e,a){"use strict";a.r(e),a.d(e,{__esModule:function(){return i.X},default:function(){return r}});var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:t.isLoading},expression:"{ isLoading }"}],key:t.taskInstanceId,staticClass:"executive-history-task"},[a("div",{staticClass:"step-list"},[a("task-step-start",{key:"start"}),t._v(" "),t._l(t.formData.stepExecution,(function(e,s){return a("task-step",{key:s,attrs:{data:e},on:{"on-select":t.handleSelectStep,"on-update":t.handleUpdateStepStatus}})})),t._v(" "),a("task-step-end",{key:"end",attrs:{finished:t.formData.taskExecution.isSuccess}})],2),t._v(" "),a("div",{staticClass:"step-list-action"},[a("back-top",{attrs:{size:"small",fixed:!1}}),t._v(" "),t.isLoading?t._e():a("execution-process",{staticClass:"execution-process",attrs:{total:t.formData.totalStep,current:t.formData.currentStepRunningOrder}})],1),t._v(" "),a("div",{staticClass:"task-action"},[a("auth-component",{attrs:{auth:"task_instance/redo","resource-id":t.taskInstanceId}},[a("div",{directives:[{name:"bk-tooltips",rawName:"v-bk-tooltips.bottom",value:t.$t("history.去重做"),expression:"$t('history.去重做')",modifiers:{bottom:!0}}],staticClass:"action-btn",on:{click:t.handleGoRetry}},[a("Icon",{attrs:{type:"redo"}})],1),t._v(" "),a("div",{staticClass:"action-btn",attrs:{slot:"forbid"},slot:"forbid"},[a("Icon",{attrs:{type:"redo"}})],1)]),t._v(" "),a("div",{directives:[{name:"bk-tooltips",rawName:"v-bk-tooltips.bottom",value:t.$t("history.全局变量"),expression:"$t('history.全局变量')",modifiers:{bottom:!0}}],staticClass:"action-btn",on:{click:t.handleShowGlobalVariable}},[a("Icon",{attrs:{type:"global-var"}})],1),t._v(" "),a("div",{directives:[{name:"bk-tooltips",rawName:"v-bk-tooltips.bottom",value:t.$t("history.执行方案"),expression:"$t('history.执行方案')",modifiers:{bottom:!0}}],staticClass:"action-btn",on:{click:t.handleGoPlan}},[a("Icon",{attrs:{type:"flow"}})],1),t._v(" "),a("div",{directives:[{name:"bk-tooltips",rawName:"v-bk-tooltips.bottom",value:t.$t("history.操作记录"),expression:"$t('history.操作记录')",modifiers:{bottom:!0}}],staticClass:"action-btn",on:{click:t.handleShowOperationRecord}},[a("Icon",{attrs:{type:"clock"}})],1)],1),t._v(" "),a("execution-status-bar",{attrs:{type:"task",data:t.formData.taskExecution}},[t.formData.taskExecution.isForcedEnable?a("step-action",{attrs:{name:"forced","confirm-handler":t.handleForceTask},on:{"on-cancel":t.handleCancelForceTask,"on-show":t.handleStartForceTask}}):t._e()],1),t._v(" "),a("jb-sideslider",{attrs:{"is-show":t.isShowGlobalVariable,"show-footer":!1,"quick-close":!0,title:t.$t("history.全局变量"),width:960},on:{"update:isShow":function(e){t.isShowGlobalVariable=e},"update:is-show":function(e){t.isShowGlobalVariable=e}}},[a("global-variable",{attrs:{id:t.taskInstanceId}})],1),t._v(" "),a("jb-sideslider",{attrs:{"is-show":t.isShowOperationRecord,"show-footer":!1,"quick-close":!0,title:t.$t("history.操作记录"),width:900},on:{"update:isShow":function(e){t.isShowOperationRecord=e},"update:is-show":function(e){t.isShowOperationRecord=e}}},[a("operation-record",{attrs:{id:t.taskInstanceId,from:"historyTask"}})],1)],1)};s._withStripped=!0;var i=a(30986),n=i.Z,o=(a(50021),(0,a(35471).Z)(n,s,[],!1,null,null,null));o.options.__file="src/views/executive-history/task-detail/index.vue";var r=o.exports},11239:function(t,e,a){var s=a(58649);s.__esModule&&(s=s.default),"string"==typeof s&&(s=[[t.id,s,""]]),s.locals&&(t.exports=s.locals);(0,a(13570).Z)("40a7ab14",s,!1,{})},77542:function(t,e,a){var s=a(89285);s.__esModule&&(s=s.default),"string"==typeof s&&(s=[[t.id,s,""]]),s.locals&&(t.exports=s.locals);(0,a(13570).Z)("45fe9c50",s,!1,{})},50021:function(t,e,a){var s=a(62893);s.__esModule&&(s=s.default),"string"==typeof s&&(s=[[t.id,s,""]]),s.locals&&(t.exports=s.locals);(0,a(13570).Z)("4479fda0",s,!1,{})}}]);