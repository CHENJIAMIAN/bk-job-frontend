(self.webpackChunkjob=self.webpackChunkjob||[]).push([[3654],{1422:function(e,t,a){"use strict";var n=a(70534);Object.defineProperty(t,"X",{value:!0}),t.Z=void 0,a(41336),a(91981),a(63898),a(79951),a(45680),a(70616),a(59241),a(14309);var i=n(a(13030)),r=n(a(31752)),s=n(a(51391)),o=n(a(89825)),l=n(a(70481)),c=n(a(28033)),u=n(a(9202)),d=n(a(49822)),f={name:"TimeTaskDetail",components:{DetailLayout:o.default,DetailItem:l.default,RenderStrategy:d.default,GlobalVariableLayout:c.default,GlobalVariable:u.default},props:{data:{type:Object,default:function(){return{}}}},data:()=>({isLoading:!0,isVarLoading:!1,renderRoleList:[{},{},{}],renderChannel:"",currentPlanVariableList:[{},{},{}]}),created(){var e=this;Promise.all([this.fetchData(),this.fetchRoleList(),this.fetchAllChannel()]).finally((function(){e.isLoading=!1}))},methods:{fetchData(){var e=this;s.default.fetchPlanDetailInfo({templateId:this.data.taskTemplateId,id:this.data.taskPlanId}).then((function(t){var a=t.variableList,n=e.data.variableValue.reduce((function(e,t){return e[t.id]=t,e}),{});a.forEach((function(e){if(n[e.id]){var t=n[e.id],a=t.value,i=t.targetValue;e.defaultValue=a,e.defaultTargetValue=i}})),e.currentPlanVariableList=Object.freeze(a)}))},fetchRoleList(){var e=this;r.default.fetchRoleList().then((function(t){var a={};t.forEach((function(e){a[e.code]=e.name})),e.renderRoleList=e.data.notifyUser.roleList.map((function(e){return a[e]}))}))},fetchAllChannel(){var e=this;i.default.fetchActiveNotifyChannel().then((function(t){var a={};t.forEach((function(e){a[e.code]=e.name})),e.renderChannel=e.data.notifyChannel.map((function(e){return a[e]})).join("，")}))}}};t.Z=f},32923:function(e,t,a){"use strict";var n=a(70534);Object.defineProperty(t,"X",{value:!0}),t.Z=void 0,a(41336),a(91981),a(63898);var i=n(a(56762)),r=n(a(66662)),s=n(a(1221)),o=n(a(83688)),l={launch:s.default,unlaunch:o.default},c={name:"",props:{data:{type:Object,required:!0}},data:()=>({listTab:"launch",isLaunchLoading:!0,isUnlaunchLoading:!0,launchNums:0,unLaunchNums:0}),computed:{listCom(){return l[this.listTab]}},created(){this.fetchData()},methods:{handleTabChange(e){this.listTab=e},fetchData(){var e=this;i.default.fetchExecutionHistoryList({cronTaskId:this.data.id,startTime:"",endTime:"",start:0,pageSize:1,timeRange:30}).then((function(t){e.launchNums=t.total})).finally((function(){e.isLaunchLoading=!1})),r.default.fetchUnlaunchHistory({cronTaskId:this.data.id,start:0,pageSize:1,timeRange:30}).then((function(t){e.unLaunchNums=t.total})).finally((function(){e.isUnlaunchLoading=!1}))}}};t.Z=c},20635:function(e,t,a){"use strict";a(87147),a(13118),a(59241),a(20767);var n=a(70534);Object.defineProperty(t,"X",{value:!0}),t.Z=void 0,a(41336),a(32106);var i=n(a(68203)),r=n(a(17434)),s=n(a(56762)),o=n(a(31752)),l=a(11986),c=n(a(88792)),u=n(a(27898)),d=n(a(84366));function f(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function h(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?f(Object(a),!0).forEach((function(t){(0,i.default)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):f(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var m={name:"",components:{JbSearchSelect:c.default,ListActionLayout:u.default,RenderList:d.default},props:{data:{type:Object,required:!0},showFaild:{type:Boolean,default:!1}},data:()=>({searchParams:{},defaultDateTime:[(0,l.prettyDateTimeFormat)(Date.now()-25056e5),""],searchAppendValue:[]}),created(){this.fetchExecutionHistoryList=s.default.fetchExecutionHistoryList,this.showFaild&&(this.searchParams.status=4,this.searchAppendValue=[{name:"任务状态",id:"status",values:[{id:this.searchParams.status,name:"执行失败"}]}]);var e=(0,r.default)(this.defaultDateTime,2),t=e[0],a=e[1];this.searchParams.startTime=t,this.searchParams.endTime=a,this.searchSelect=[{name:"ID",id:"taskInstanceId",description:"搜索条件带任务ID时，将自动忽略其他条件",default:!0,validate:(e,t)=>!!(e||[]).every((function(e){return/^(\d*)$/.test(e.name)}))||"ID只支持数字"},{name:"任务状态",id:"status",children:[{name:"等待执行",id:1},{name:"正在执行",id:2},{name:"执行成功",id:3},{name:"执行失败",id:4},{name:"等待确认",id:7},{name:"强制终止中",id:10},{name:"强制终止成功",id:11},{name:"强制终止失败",id:12},{name:"确认终止",id:13}]},{name:"执行人",id:"operator",remoteMethod:o.default.fetchUsersOfSearch,inputInclude:!0}],this.shortcuts=[{text:"近1小时",value(){var e=new Date,t=new Date;return t.setTime(t.getTime()-36e5),[t,e]}},{text:"近12小时",value(){var e=new Date,t=new Date;return t.setTime(t.getTime()-432e5),[t,e]}},{text:"近1天",value(){var e=new Date,t=new Date;return t.setTime(t.getTime()-864e5),[t,e]}},{text:"近7天",value(){var e=new Date,t=new Date;return t.setTime(t.getTime()-6048e5),[t,e]}}]},mounted(){this.fetchData(),this.$refs.datePicker.shortcut={text:"".concat(this.defaultDateTime[0]," ","至今")}},methods:{fetchData(){var e=h(h({},this.searchParams),{},{cronTaskId:this.data.id});this.$refs.list.$emit("onFetch",e)},handleSearch(e){var t=this.searchParams,a=t.startTime,n=t.endTime;this.searchParams=h(h({},e),{},{startTime:a,endTime:n}),this.fetchData()},handleDateChange(e,t){"upToNow"===t&&this.setToNowText(e),this.searchParams.startTime=e[0],this.searchParams.endTime="upToNow"===t?"":e[1],this.fetchData()},handleGoDetail(e){var t=null;t=e.isTask?this.$router.resolve({name:"historyTask",params:{id:e.id}}):this.$router.resolve({name:"historyStep",params:{taskInstanceId:e.id},query:{from:"historyList"}}),window.open(t.href)}}};t.Z=m},77199:function(e,t,a){"use strict";var n=a(70534);Object.defineProperty(t,"X",{value:!0}),t.Z=void 0;var i=n(a(66662)),r={name:"",components:{RenderList:n(a(84366)).default},props:{data:{type:Object,required:!0}},data:()=>({searchParams:{}}),created(){this.searchParams.cronTaskId=this.data.id,this.fetchUnlaunchHistory=i.default.fetchUnlaunchHistory},mounted(){this.fetchData()},methods:{fetchData(){this.$refs.list.$emit("onFetch",this.searchParams)}}};t.Z=r},29758:function(e,t,a){"use strict";var n=a(70534);Object.defineProperty(t,"X",{value:!0}),t.Z=void 0,a(89242),a(41336),a(84367),a(32106),a(9158),a(17450),a(58701),a(94354);var i=n(a(30723)),r=n(a(25992)),s=n(a(2829)),o=n(a(22061)),l=a(11986),c={minute:0,hour:1,dayOfMonth:2,month:3,dayOfWeek:4,0:"minute",1:"hour",2:"dayOfMonth",3:"month",4:"dayOfWeek"},u={name:"",props:{value:{type:String,default:""}},data(){return{selectIndex:"",nativeValue:this.value,nextTime:[],parseValue:[],errorField:"",isError:!1,isTimeMore:!1}},mounted(){this.nativeValue&&this.checkAndTranslate(this.nativeValue)},methods:{checkAndTranslate(e){var t=s.default.parse("0 ".concat(e.trim()),{currentDate:new Date}),a=5;for(this.nextTime=[];a>0;)this.nextTime.push((0,l.prettyDateTimeFormat)(t.next().toString())),a-=1;this.errorField="",this.isError=!1,this.parseValue=(0,o.default)(e)},handleTimeTextChange(e){var t=this;if(this.nativeValue){var a=this.nativeValue.split(" "),n=c[e];if(!(a.length<n)){var i=a.slice(0,n).join("").length+n,r=i+a[n].length;setTimeout((function(){t.selectIndex=e,t.$refs.input.focus(),t.$refs.input.selectionStart=i,t.$refs.input.selectionEnd=r}))}}},handleBlur(){this.selectIndex=""},handleSelectText(e){var t=this,a=e.target,n=(0,r.default)(a.value);this.nativeValue=n,n&&setTimeout((function(){var e=a.selectionStart,i=n.slice(0,e).match(/ /g);t.selectIndex=i?c[i.length]:c[0]}))},handleInput:(0,i.default)((function(e){var t=e.target.value;this.nativeValue=t;try{this.checkAndTranslate(t),this.$emit("change",t),this.$emit("input",t)}catch(e){this.parseValue=[],this.nextTime=[];["minute","hour","dayOfMonth","month","dayOfWeek"].includes(e.message)&&(this.errorField=e.message),this.isError=!0,this.$emit("change",""),this.$emit("input","")}}),200),handleShowMore(){this.isTimeMore=!this.isTimeMore}}};t.Z=u},47756:function(e,t,a){"use strict";var n=a(70534);Object.defineProperty(t,"X",{value:!0}),t.Z=void 0,a(75328),a(41336),a(91981),a(63898),a(14309);var i=n(a(13030)),r={name:"",components:{JbUserSelector:n(a(7861)).default},props:{notifyOffsetLabel:{type:String,required:!0},formData:{type:Object,required:!0},mode:{type:String,default:"finish-before"}},data:()=>({isLoading:!1,channleList:[{},{},{}]}),computed:{isChannelAll(){return!(this.channleList.length<1)&&this.formData.notifyChannel.length===this.channleList.length},isChannelIndeterminate(){return!(this.formData.notifyChannel.length<1)&&this.formData.notifyChannel.length!==this.channleList.length}},created(){var e=this;this.fetchAllChannel(),this.$emit("on-change",{notifyOffset:10}),this.rules={notifyOffset:[]},"execute-beofre"===this.mode&&(this.rules.notifyOffset=[{validator:function(){return new Date(e.formData.executeTime).getTime()-6e3*parseInt(e.formData.notifyOffset,10)>Date.now()},message:"设置的提醒时间已过期",trigger:"change"}])},beforeDestroy(){this.$emit("on-change",{notifyOffset:0,notifyUser:{userList:[{},{},{}],roleList:[{},{},{}]},notifyChannel:[]})},methods:{fetchAllChannel(){var e=this;i.default.fetchActiveNotifyChannel().then((function(t){e.channleList=t})).finally((function(){e.isLoading=!1}))},handleToggleAllChannel(){this.isChannelAll?this.handleNotifyChannelChange([]):this.handleNotifyChannelChange(this.channleList.map((function(e){return e.code})))},handleNotifyOffsetChange(e){this.$emit("on-change",{notifyOffset:e})},handleApprovalUserChange(e,t){this.$emit("on-change",{notifyUser:{userList:e,roleList:t}})},handleNotifyChannelChange(e){this.$emit("on-change",{notifyChannel:e})}}};t.Z=r},16262:function(e,t,a){"use strict";Object.defineProperty(t,"X",{value:!0}),t.Z=void 0;var n=a(11986),i={name:"",props:{formData:{type:Object,required:!0}},data:()=>({isEndTime:!1}),watch:{formData:{handler(e){this.formData.endTime&&(this.isEndTime=!0)},immediate:!0}},created(){this.dateOptions={disabledDate:e=>e.valueOf()<Date.now()-864e5}},methods:{handleChange(e){this.isEndTime=e;var t=e?(0,n.prettyDateTimeFormat)(Date.now()+864e5):"";this.handleEndTimeChange(t)},handleEndTimeChange(e){this.$emit("on-change",{endTime:e})}}};t.Z=i},83673:function(e,t,a){"use strict";var n=a(70534);Object.defineProperty(t,"X",{value:!0}),t.Z=void 0;var i=n(a(49822)),r=n(a(72885)),s={name:"",components:{RenderStrategy:i.default,ExecuteNotify:r.default},props:{formData:{type:Object,required:!0}},data:()=>({executeBeforeNotify:!1}),watch:{formData:{handler(e){(this.formData.notifyOffset||this.formData.notifyChannel.length>0||this.formData.notifyUser.roleList.length>0||this.formData.notifyUser.userList.length>0)&&(this.executeBeforeNotify=!0)},immediate:!0}}};t.Z=s},233:function(e,t,a){"use strict";var n=a(70534);Object.defineProperty(t,"X",{value:!0}),t.Z=void 0;var i=n(a(49822)),r=n(a(72885)),s={name:"",components:{RenderStrategy:i.default,ExecuteNotify:r.default},props:{formData:{type:Object,required:!0}},data:()=>({isFinishBeforeNotify:!1}),computed:{isShowNotify(){return!!this.formData.endTime&&(this.isFinishBeforeNotify,!0)}},watch:{formData:{handler(e){(this.formData.notifyOffset||this.formData.notifyChannel.length>0||this.formData.notifyUser.roleList.length>0||this.formData.notifyUser.userList.length>0)&&(this.isFinishBeforeNotify=!0)},immediate:!0}}};t.Z=s},35598:function(e,t,a){"use strict";var n=a(70534);Object.defineProperty(t,"X",{value:!0}),t.Z=void 0;var i=n(a(12692)),r=n(a(48518)),s=n(a(57931)),o={executeBeforeNotify:i.default,finishBeforeNotify:r.default,endTime:s.default},l={name:"",props:{name:{type:String,required:!0}},computed:{com(){return Object.prototype.hasOwnProperty.call(o,this.name)?o[this.name]:"div"}}};t.Z=l},39644:function(e,t,a){"use strict";a(87147),a(20767);var n=a(70534);Object.defineProperty(t,"X",{value:!0}),t.Z=void 0;var i=n(a(68203)),r=n(a(17434));a(85376),a(13118),a(41336),a(70616),a(59241),a(75328),a(33303),a(91981),a(63898),a(79951),a(45680);var s=n(a(74650)),o=n(a(51391)),l=n(a(66662)),c=a(11986),u=a(2938),d=n(a(28033)),f=n(a(14590)),h=n(a(35543)),m=n(a(76960)),p=n(a(49822)),v=n(a(93075)),b=n(a(19350));function y(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function g(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?y(Object(a),!0).forEach((function(t){(0,i.default)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):y(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var _=["executeBeforeNotify"],k=["endTime","finishBeforeNotify"],T={name:"",components:{GlobalVariableLayout:d.default,GlobalVariable:f.default,ToggleDisplay:h.default,RenderStrategy:p.default,JbInput:m.default,FormItemFactory:v.default,CronJob:b.default},props:{data:{type:Object,default:function(){return{}}},id:{type:[String,Number],default:""}},data(){return this.rules={},{isLoading:!1,isTemplateLoading:!1,isPlanLoading:!1,strategy:"period",formData:{id:0,executeBeforeNotify:!1,cronExpression:"* * * * *",enable:!1,endTime:"",executeTime:(0,c.generatorDefaultCronTime)(),isEnable:!1,name:"",notifyChannel:[],notifyOffset:0,notifyUser:{roleList:[{},{},{}],userList:[{},{},{}]},taskPlanId:0,taskTemplateId:0,variableValue:[]},templateList:[{},{},{}],planList:[{},{},{}],planStepList:[{},{},{}],isVariableLoading:!1,currentPlanVariableList:[{},{},{}],currentRenderPlanId:0,usedList:[{},{},{}],unusedList:[{},{},{}],isRepeat:!1,dateOptions:{disabledDate:e=>e.valueOf()<Date.now()-864e5}}},computed:{strategyFormItemList(){return"once"===this.strategy?_:k},strategyField(){return"once"===this.strategy?"executeTime":"cronExpression"},hasTemplate(){return!!this.formData.taskTemplateId},hasPlan(){return!!this.formData.taskPlanId},hasVariabel(){return this.currentPlanVariableList.length<1},isVariabelEmpty(){return this.currentPlanVariableList.length<1}},watch:{strategy:{handler(e){"once"===e?(delete this.rules.cronExpression,this.rules.executeTime=[{required:!0,message:"单次执行时间必填",trigger:"blur"},{validator:function(e){return new Date(e).getTime()>Date.now()},message:"执行时间无效（早于当前时间）",trigger:"blur"}]):(delete this.rules.executeTime,this.rules.cronExpression=[{required:!0,message:"请输入正确时间表达式",trigger:"blur"}])},immediate:!0},currentPlanVariableList(e){var t=this.planStepList.filter((function(e){return 1===e.enable})),a=(0,c.findUsedVariable)(t).reduce((function(e,t){return e[t]=!0,e}),{}),n=[],i=[];e.forEach((function(e){a[e.name]?n.push(e):i.push(e)})),this.usedList=Object.freeze(n),this.unusedList=Object.freeze(i)}},created(){if(this.fetchTemplateList(),this.data.id)this.formData.id=this.data.id,this.formData.name=this.data.name,this.formData.taskTemplateId=this.data.taskTemplateId,this.formData.taskPlanId=this.data.taskPlanId,this.fetchData(),this.fetchTemplatePlanList();else{var e=this.$route.query,t=e.templateId,a=e.planId;parseInt(t,10)>0&&(this.formData.taskTemplateId=parseInt(t,10),this.fetchTemplatePlanList(),parseInt(a,10)>0&&(this.formData.taskPlanId=parseInt(a,10),this.fetchPlanDetailInfo()))}this.rules=Object.assign({},this.rules,{name:[{required:!0,message:"任务名称必填",trigger:"blur"},{validator:u.timeTaskNameRule.validator,message:u.timeTaskNameRule.message,trigger:"blur"},{validator:this.checkName,message:"任务名称已存在，请重新输入",trigger:"blur"}],taskTemplateId:[{required:!0,message:"作业模板必填",trigger:"blur"}],taskPlanId:[{required:!0,message:"执行方案必填",trigger:"blur"}]})},methods:{fetchData(){var e=this;this.isLoading=!0,Promise.all([l.default.getDetail({id:this.formData.id}),o.default.fetchPlanDetailInfo({templateId:this.formData.taskTemplateId,id:this.formData.taskPlanId})]).then((function(t){var a=(0,r.default)(t,2),n=a[0],i=a[1],s=n.cronExpression,o=n.enable,l=n.endTime,c=n.executeTime,u=n.name,d=n.notifyChannel,f=n.notifyOffset,h=n.notifyUser,m=n.scriptId,p=n.scriptVersionId,v=n.taskPlanId,b=n.taskTemplateId;if(c&&(e.strategy="once"),e.formData=g(g({},e.formData),{},{cronExpression:s,enable:o,endTime:l,executeTime:c,name:u,notifyChannel:d,notifyOffset:f,notifyUser:h,scriptId:m,scriptVersionId:p,taskPlanId:v,taskTemplateId:b,variableValue:[]}),i){e.planStepList=Object.freeze(i.stepList);var y=[...n.variableValue].reduce((function(e,t){return e[t.id]=t,e}),{}),_=i.variableList;_.forEach((function(e){if(y[e.id]){var t=y[e.id],a=t.value,n=t.targetValue;e.defaultValue=a,e.defaultTargetValue=n}})),e.currentPlanVariableList=Object.freeze(_)}})).finally((function(){e.isLoading=!1})).catch((function(t){1238001===t.code&&(e.formData.taskTemplateId="",e.formData.taskPlanId="")}))},fetchTemplateList(){var e=this;this.isTemplateLoading=!0,s.default.taskList({pageSize:-1,start:-1}).then((function(t){var a=t.data;e.templateList=Object.freeze(a)})).finally((function(){e.isTemplateLoading=!1}))},fetchTemplatePlanList(){var e=this;this.isPlanLoading=!0,o.default.fetchTaskPlan({id:this.formData.taskTemplateId}).then((function(t){e.planList=Object.freeze(t)})).finally((function(){e.isPlanLoading=!1}))},fetchPlanDetailInfo(){var e=this;this.isVariableLoading=!0,o.default.fetchPlanDetailInfo({templateId:this.formData.taskTemplateId,id:this.formData.taskPlanId}).then((function(t){e.currentPlanVariableList=Object.freeze(t.variableList),e.currentRenderPlanId=e.formData.taskPlanId,e.planStepList=Object.freeze(t.stepList)})).finally((function(){e.isVariableLoading=!1}))},checkName(e){return l.default.timeTaskCheckName({id:this.formData.id,name:e})},handleStrategyChange(e){this.strategy=e,"once"===e?(this.$refs.timeTaskForm.clearError("cronExpression"),this.formData.executeTime=(0,c.generatorDefaultCronTime)()):this.formData.cronExpression="* * * * *",this.formData.endTime="",this.formData.notifyChannel=[],this.formData.notifyOffset=0,this.formData.notifyUser={roleList:[{},{},{}],userList:[{},{},{}]}},handleFormItemChange(e){this.formData=g(g({},this.formData),e)},handleTemplateChange(e){this.formData.taskPlanId="",e&&this.fetchTemplatePlanList()},handlePlanChange(e){e&&this.fetchPlanDetailInfo()},handleGoPlan(){var e=this.$router.resolve({name:"viewPlan",params:{templateId:this.formData.taskTemplateId},query:{from:"cronJob",viewPlanId:this.formData.taskPlanId}});window.open(e.href,"_blank")},submit(){var e=this;return this.$refs.timeTaskForm.validate().then((function(){if(e.currentPlanVariableList.length<1)return Promise.resolve([]);var t=[];return e.$refs.usedVariable&&e.$refs.usedVariable.forEach((function(e){t.push(e.validate())})),e.$refs.unusedVariable&&e.$refs.unusedVariable.forEach((function(e){t.push(e.validate())})),Promise.all(t)})).then((function(t){var a=g({},e.formData);return"period"===e.strategy?a.executeTime="":(a.cronExpression="",a.executeTime=new Date(a.executeTime).getTime()/1e3),a.endTime&&(a.endTime=new Date(a.endTime).getTime()/1e3),l.default.timeTaskUpdate(g(g({},a),{},{variableValue:t})).then((function(){a.id?e.messageSuccess("定时任务编辑成功"):e.messageSuccess("定时任务创建成功(默认关闭，请手动开启)"),e.$emit("on-change")}))}))}}};t.Z=T},85508:function(e,t){"use strict";Object.defineProperty(t,"X",{value:!0}),t.Z=void 0;var a={props:{left:String}};t.Z=a},18589:function(e,t,a){"use strict";var n=a(70534);Object.defineProperty(t,"X",{value:!0}),t.Z=void 0,a(70616),a(41336),a(32106);var i=n(a(66662)),r=n(a(31752)),s=a(15513),o=n(a(27898)),l=n(a(84366)),c=n(a(88792)),u=n(a(98656)),d=n(a(35549)),f=n(a(85920)),h=n(a(64909)),m=n(a(17598)),p="cron_list_columns",v={name:"",components:{ListActionLayout:o.default,RenderList:l.default,JbSearchSelect:c.default,JbSideslider:u.default,JbPopoverConfirm:d.default,TaskOperation:f.default,TaskDetail:h.default,HistoryRecord:m.default},data:()=>({showOperation:!1,showDetail:!1,showHistoryRecord:!1,showHistoryFailedRecord:!1,searchParams:[],cronData:{},loading:!1,editTaskId:"",cronJobDetailInfo:{},currentOperate:"create",historyRecordDialogTitle:"",selectedTableColumn:[],tableSize:"small"}),computed:{isSkeletonLoading(){return this.$refs.list.isLoading},allRenderColumnMap(){return this.selectedTableColumn.reduce((function(e,t){return e[t.id]=!0,e}),{})},operationSidesliderInfo(){return this.cronJobDetailInfo.id?{title:"编辑定时任务",okText:"保存"}:{title:"新建定时任务",okText:"提交"}}},watch:{$route(){this.initParseURL()}},created(){this.getCronJobList=i.default.timeTaskList,this.searchSelect=[{name:"ID",id:"cronJobId",description:"将覆盖其它条件",validate:(e,t)=>!!(e||[]).every((function(e){return/^(\d*)$/.test(e.name)}))||"ID只支持数字"},{name:"任务名称",id:"name",default:!0},{name:"执行方案ID",id:"planId",default:!0},{name:"创建人",id:"creator",remoteMethod:r.default.fetchUsersOfSearch,inputInclude:!0},{name:"更新人",id:"lastModifyUser",remoteMethod:r.default.fetchUsersOfSearch,inputInclude:!0}],this.tableColumn=[{id:"id",label:"ID"},{id:"name",label:"任务名称",disabled:!0},{id:"planName",label:"执行方案名称"},{id:"policeText",label:"执行策略",disabled:!0},{id:"creator",label:"创建人"},{id:"createTime",label:"创建时间"},{id:"lastModifyUser",label:"更新人"},{id:"lastModifyTime",label:"更新时间"},{id:"lastExecuteStatus",label:"最新执行结果",disabled:!0},{id:"successRateText",label:"周期成功率",disabled:!0}];var e=s.listColumnsCache.getItem(p);e?(this.selectedTableColumn=Object.freeze(e.columns),this.tableSize=e.size):this.selectedTableColumn=Object.freeze([{id:"name"},{id:"planName"},{id:"policeText"},{id:"lastModifyUser"},{id:"lastModifyTime"},{id:"lastExecuteStatus"},{id:"successRateText"}])},mounted(){this.initParseURL()},methods:{fetchData(){this.$refs.list.$emit("onFetch",this.searchParams)},initParseURL(){var e=this,t=this.$route.query,a=t.name,n=t.cronJobId,i=t.mode;if("create"!==i){if(a||n)var r=this.$watch((function(){return e.$refs.list.isLoading}),(function(t){t||("detail"===i?setTimeout((function(){var t=e.$refs.list.$el.querySelector(".time-task-name");t&&t.click()})):"edit"===i&&setTimeout((function(){var t=e.$refs.list.$el.querySelector(".time-task-edit");t&&t.click()})),r())}))}else this.handleCreate()},renderHeader:(e,t)=>e("span",[e("span",[t.column.label]),e("bk-popover",[e("icon",{attrs:{type:"circle-italics-info"},style:"margin-left: 8px; font-size: 12px;"}),e("div",{slot:"content"},[e("div",{style:"font-weight: bold"},["「周期成功率」采样规则和计算公式"]),e("div",{style:"margin-top: 8px; font-weight: bold"},["采样规则："]),e("div",["近 24小时执行次数 ＞10，则 “分母” 为近 24 小时执行总数"]),e("div",["近 24小时执行次数 ≤ 10，则 “分母” 为近 10 次执行任务"]),e("div",{style:"margin-top: 6px; font-weight: bold"},["计算公式："]),e("div",["成功次数(分子) / 分母 * 100 = 周期成功率（%）"])])])]),handleSettingChange(e){var t=e.fields,a=e.size;this.selectedTableColumn=Object.freeze(t),this.tableSize=a,s.listColumnsCache.setItem(p,{columns:t,size:a})},handleSearch(e){this.searchParams=e,this.fetchData()},handleHistoryRecord(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.cronJobDetailInfo=e,this.showHistoryFailedRecord=t,this.historyRecordDialogTitle="定时执行记录".concat(e.name),this.showHistoryRecord=!0},handleViewDetail(e){this.cronJobDetailInfo=e,this.showDetail=!0},handleCreate(){this.cronJobDetailInfo={},this.showOperation=!0},handleEdit(e){this.cronJobDetailInfo=e,this.showOperation=!0},handleToggelEdit(){this.showDetail=!1,this.showOperation=!0},handleCronChange(){this.fetchData()},handleStatusChange(e,t){var a=this,n=t.enable;t.enable=e,i.default.timeTaskStatusUpdate({id:t.id,enable:e}).then((function(){a.messageSuccess(e?"开启成功":"关闭成功")})).catch((function(){t.enable=n}))},handleDelete(e){var t=this;return i.default.timeTaskDelete({id:e.id}).then((function(){return t.messageSuccess("删除定时任务成功"),t.fetchData(),!0}))}}};t.Z=v},58808:function(){},17149:function(){},16662:function(){},43688:function(){},44384:function(){},20770:function(){},79068:function(){},39719:function(){},53584:function(){},11294:function(e,t,a){var n={"./zh-cn":12042,"./zh-cn.js":12042,"moment/locale/zh-cn":12042,"moment/locale/zh-cn.js":12042};function i(e){var t=r(e);return a(t)}function r(e){if(!a.o(n,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return n[e]}i.keys=function(){return Object.keys(n)},i.resolve=r,e.exports=i,i.id=11294},64909:function(e,t,a){"use strict";a.r(t),a.d(t,{__esModule:function(){return i.X},default:function(){return o}});var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("detail-layout",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:e.isLoading},expression:"{ isLoading }"}],staticClass:"detail-layout-wrapper",attrs:{mode:"see"}},[a("detail-item",{attrs:{label:"任务名称："}},[e._v("\n        "+e._s(e.data.name)+"\n    ")]),e._v(" "),a("detail-item",{attrs:{label:"执行策略："}},[e._v("\n        "+e._s(e.data.executeStrategyText)+"\n    ")]),e._v(" "),a("detail-item",{attrs:{label:"执行时间："}},[a("span",{directives:[{name:"bk-tooltips",rawName:"v-bk-tooltips.right",value:e.data.executeTimeTips,expression:"data.executeTimeTips",modifiers:{right:!0}}],staticClass:"tips"},[e._v("\n            "+e._s(e.data.policeText)+"\n        ")])]),e._v(" "),e.data.endTime?a("detail-item",{attrs:{label:"结束时间："}},[e._v("\n        "+e._s(e.data.endTime)+"\n    ")]):e._e(),e._v(" "),e.data.notifyOffset?a("detail-item",{attrs:{label:"once"===e.data.executeStrategy?"执行前通知：":"结束前通知："}},[e._v("\n        "+e._s(e.data.notifyOffset)+e._s("分钟")+"\n    ")]):e._e(),e._v(" "),e.renderRoleList.length>0||e.data.notifyUser.userList.length>0?a("detail-item",{attrs:{label:"通知对象："}},[a("div",{staticClass:"approval-wraper"},[e._l(e.renderRoleList,(function(t){return a("div",{key:t,staticClass:"item"},[a("Icon",{staticClass:"approval-flag",attrs:{type:"user-group-gray"}}),e._v("\n                "+e._s(t)+"\n            ")],1)})),e._v(" "),e._l(e.data.notifyUser.userList,(function(t){return a("div",{key:t,staticClass:"item"},[a("Icon",{staticClass:"approval-flag",attrs:{type:"user"}}),e._v("\n                "+e._s(t)+"\n            ")],1)}))],2)]):e._e(),e._v(" "),e.renderChannel?a("detail-item",{attrs:{label:"通知方式："}},[e._v("\n        "+e._s(e.renderChannel)+"\n    ")]):e._e(),e._v(" "),a("detail-item",{attrs:{label:"执行方案："}},[e._v("\n        "+e._s(e.data.taskPlanName)+"\n    ")]),e._v(" "),a("render-strategy",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isVarLoading:e.isVarLoading},expression:"{ isVarLoading }"}],attrs:{left:"20"}},[e.isVarLoading?e._e():[e.currentPlanVariableList.length<1?a("span",{staticClass:"plan-variable-empty"},[e._v("\n                "+e._s("该执行方案无全局变量")+"\n            ")]):a("global-variable-layout",e._l(e.currentPlanVariableList,(function(e){return a("global-variable",{key:e.id+e.name,attrs:{"value-width":"100%",type:e.type,layout:3===e.type?"vertical":"",data:e}})})),1)]],2)],1)};n._withStripped=!0;var i=a(1422),r=i.Z,s=(a(26862),(0,a(51900).Z)(r,n,[],!1,null,"88708980",null));s.options.__file="src/views/cron-job/list/components/detail.vue";var o=s.exports},17598:function(e,t,a){"use strict";a.r(t),a.d(t,{__esModule:function(){return i.X},default:function(){return o}});var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"cron-job-history-record"},[a("div",{staticClass:"record-tab-wraper"},[a("div",{staticClass:"tab-item",class:{active:"launch"===e.listTab},on:{click:function(t){return e.handleTabChange("launch")}}},[a("div",{staticClass:"tab-name"},[e._v(e._s("任务正常启动"))]),e._v(" "),e.isLaunchLoading?a("Icon",{staticClass:"loading-flag",attrs:{type:"sync-pending",svg:""}}):a("div",{staticClass:"tab-nums"},[e._v(e._s(e.launchNums))])],1),e._v(" "),a("div",{staticClass:"tab-item",class:{active:"unlaunch"===e.listTab},on:{click:function(t){return e.handleTabChange("unlaunch")}}},[a("div",{staticClass:"tab-name"},[e._v(e._s("任务未能启动"))]),e._v(" "),e.isUnlaunchLoading?a("Icon",{staticClass:"loading-flag",attrs:{type:"sync-pending",svg:""}}):a("div",{staticClass:"tab-nums"},[e._v(e._s(e.unLaunchNums))])],1)]),e._v(" "),a(e.listCom,e._g(e._b({tag:"component",attrs:{data:e.data}},"component",e.$attrs,!1),e.$listeners))],1)};n._withStripped=!0;var i=a(32923),r=i.Z,s=(a(69168),(0,a(51900).Z)(r,n,[],!1,null,"f1600a48",null));s.options.__file="src/views/cron-job/list/components/history-record/index.vue";var o=s.exports},1221:function(e,t,a){"use strict";a.r(t),a.d(t,{__esModule:function(){return i.X},default:function(){return o}});var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"cron-job-history-launch-record"},[a("list-action-layout",{scopedSlots:e._u([{key:"right",fn:function(){return[a("bk-date-picker",{ref:"datePicker",attrs:{value:e.defaultDateTime,placeholder:"选择日期",shortcuts:e.shortcuts,type:"datetimerange","shortcut-close":!0,"use-shortcut-text":!0,clearable:!1,"up-to-now":""},on:{change:e.handleDateChange}})]},proxy:!0}])},[a("jb-search-select",{ref:"search",staticStyle:{width:"510px"},attrs:{data:e.searchSelect,"parse-url":!1,placeholder:"搜索指定任务ID 或 根据字段筛选结果","append-value":e.searchAppendValue},on:{"on-change":e.handleSearch}})],1),e._v(" "),a("render-list",{ref:"list",staticClass:"executive-history-table",attrs:{"data-source":e.fetchExecutionHistoryList,"search-control":function(){return e.$refs.search},"ignore-url":""}},[a("bk-table-column",{key:"id",attrs:{label:"ID",prop:"id",width:"130",align:"left"},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.row;return[a("bk-button",{attrs:{text:""},on:{click:function(t){return e.handleGoDetail(n)}}},[e._v(e._s(n.id))])]}}])}),e._v(" "),a("bk-table-column",{key:"statusDesc",attrs:{label:"任务状态",prop:"statusDesc",align:"left"},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.row;return[a("span",{domProps:{innerHTML:e._s(n.statusDescHtml)}})]}}])}),e._v(" "),a("bk-table-column",{key:"operator",attrs:{label:"执行人",prop:"operator",width:"160",align:"left"}}),e._v(" "),a("bk-table-column",{key:"createTime",attrs:{label:"开始时间",prop:"createTime",width:"180",align:"left"}}),e._v(" "),a("bk-table-column",{key:"totalTimeText",attrs:{label:"耗时时长",prop:"totalTimeText",width:"160",align:"right"}})],1)],1)};n._withStripped=!0;var i=a(20635),r=i.Z,s=(0,a(51900).Z)(r,n,[],!1,null,null,null);s.options.__file="src/views/cron-job/list/components/history-record/launch-list.vue";var o=s.exports},83688:function(e,t,a){"use strict";a.r(t),a.d(t,{__esModule:function(){return i.X},default:function(){return o}});var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("render-list",{ref:"list",attrs:{"ignore-url":"","data-source":e.fetchUnlaunchHistory}},[a("bk-table-column",{key:"scheduledTime",attrs:{label:"唤起时间",prop:"scheduledTime",width:"180",align:"left"}}),e._v(" "),a("bk-table-column",{key:"executor",attrs:{label:"执行人",prop:"executor",width:"180",align:"left"}}),e._v(" "),a("bk-table-column",{key:"errorMsg",attrs:{label:"原因",prop:"errorMsg",align:"left"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v("\n            "+e._s(a.errorMsg||"--")+"\n        ")]}}])})],1)};n._withStripped=!0;var i=a(77199),r=i.Z,s=(0,a(51900).Z)(r,n,[],!1,null,null,null);s.options.__file="src/views/cron-job/list/components/history-record/unlaunch-list.vue";var o=s.exports},19350:function(e,t,a){"use strict";a.r(t),a.d(t,{__esModule:function(){return i.X},default:function(){return o}});var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"cron-job",class:[{"is-error":e.isError},"error-"+e.errorField,"select-"+e.selectIndex]},[a("div",{staticClass:"time-describe"},[a("span",{staticClass:"time-text minute",on:{click:function(t){return e.handleTimeTextChange("minute")}}},[e._v(e._s("分"))]),e._v(" "),a("span",{staticClass:"time-text hour",on:{click:function(t){return e.handleTimeTextChange("hour")}}},[e._v(e._s("时"))]),e._v(" "),a("span",{staticClass:"time-text dayOfMonth",on:{click:function(t){return e.handleTimeTextChange("dayOfMonth")}}},[e._v(e._s("日"))]),e._v(" "),a("span",{staticClass:"time-text month",on:{click:function(t){return e.handleTimeTextChange("month")}}},[e._v(e._s("月"))]),e._v(" "),a("span",{staticClass:"time-text dayOfWeek",on:{click:function(t){return e.handleTimeTextChange("dayOfWeek")}}},[e._v(e._s("周"))])]),e._v(" "),a("div",{staticClass:"time-input"},[a("input",{ref:"input",staticClass:"input",attrs:{type:"text"},domProps:{value:e.nativeValue},on:{input:e.handleInput,blur:e.handleBlur,keyup:[function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"left",37,t.key,["Left","ArrowLeft"])||"button"in t&&0!==t.button?null:e.handleSelectText.apply(null,arguments)},function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"right",39,t.key,["Right","ArrowRight"])||"button"in t&&2!==t.button?null:e.handleSelectText.apply(null,arguments)}],mousedown:e.handleSelectText}})]),e._v(" "),e.parseValue.length>1?a("div",{staticClass:"time-parse"},[e.parseValue[0]?[a("span",{staticClass:"month"},[e._v(e._s(e.parseValue[0]))])]:e._e(),e._v(" "),e.parseValue[1]?[a("span",{staticClass:"dayOfMonth"},[e._v(e._s(e.parseValue[1]))]),e._v(" "),e.parseValue[2]?a("span",[e._v("以及当月")]):e._e()]:e._e(),e._v(" "),e.parseValue[2]?[a("span",{staticClass:"dayOfWeek"},[e._v(e._s(e.parseValue[2]))])]:e._e(),e._v(" "),e.parseValue[3]?[a("span",{staticClass:"hour"},[e._v(e._s(e.parseValue[3]))])]:e._e(),e._v(" "),a("span",{staticClass:"minute"},[e._v(e._s(e.parseValue[4]))])],2):e._e(),e._v(" "),e.nextTime.length>0?a("div",{staticClass:"time-next",class:{active:e.isTimeMore}},[a("div",{staticClass:"label"},[e._v(e._s("下次："))]),e._v(" "),a("div",{staticClass:"value"},e._l(e.nextTime,(function(t,n){return a("div",{key:t+"_"+n},[e._v(e._s(t))])})),0),e._v(" "),a("div",{staticClass:"arrow",on:{click:e.handleShowMore}},[a("Icon",{staticClass:"arrow-button",attrs:{type:"angle-double-down"}})],1)]):e._e()])};n._withStripped=!0;var i=a(29758),r=i.Z,s=(a(36512),(0,a(51900).Z)(r,n,[],!1,null,null,null));s.options.__file="src/views/cron-job/list/components/operation/cron-job.vue";var o=s.exports},72885:function(e,t,a){"use strict";a.r(t),a.d(t,{__esModule:function(){return i.X},default:function(){return o}});var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:e.isLoading},expression:"{ isLoading }"}],staticClass:"execute-notify-box"},[a("jb-form-item",{attrs:{label:e.notifyOffsetLabel,layout:"inline",rules:e.rules.notifyOffset}},[a("bk-select",{staticClass:"time-select",attrs:{value:e.formData.notifyOffset},on:{change:e.handleNotifyOffsetChange}},[a("bk-option",{attrs:{id:10,name:"10 分钟"}},[e._v("10 "+e._s("分钟"))]),e._v(" "),a("bk-option",{attrs:{id:30,name:"30 分钟"}},[e._v("30 "+e._s("分钟"))]),e._v(" "),a("bk-option",{attrs:{id:45,name:"45 分钟"}},[e._v("45 "+e._s("分钟"))]),e._v(" "),a("bk-option",{attrs:{id:60,name:"1 小时"}},[e._v("1 "+e._s("小时"))])],1)],1),e._v(" "),a("jb-form-item",{attrs:{label:"通知对象",layout:"inline"}},[a("jb-user-selector",{staticClass:"input",attrs:{placeholder:"输入通知对象",user:e.formData.notifyUser.userList,role:e.formData.notifyUser.roleList,"filter-list":["JOB_EXTRA_OBSERVER"]},on:{"on-change":e.handleApprovalUserChange}})],1),e._v(" "),a("jb-form-item",{staticStyle:{"margin-bottom":"0"},attrs:{label:"通知方式",layout:"inline"}},[a("div",{staticClass:"notify-channel-wraper"},[a("bk-checkbox",{attrs:{checked:e.isChannelAll,indeterminate:e.isChannelIndeterminate},nativeOn:{click:function(t){return e.handleToggleAllChannel.apply(null,arguments)}}},[e._v("\n                "+e._s("全部")+"\n            ")]),e._v(" "),a("bk-checkbox-group",{staticClass:"all-channel",attrs:{value:e.formData.notifyChannel},on:{change:e.handleNotifyChannelChange}},e._l(e.channleList,(function(t){return a("bk-checkbox",{key:t.code,attrs:{value:t.code}},[e._v("\n                    "+e._s(t.name)+"\n                ")])})),1)],1)])],1)};n._withStripped=!0;var i=a(47756),r=i.Z,s=(a(48875),(0,a(51900).Z)(r,n,[],!1,null,null,null));s.options.__file="src/views/cron-job/list/components/operation/execute-notify.vue";var o=s.exports},57931:function(e,t,a){"use strict";a.r(t),a.d(t,{__esModule:function(){return i.X},default:function(){return o}});var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("jb-form-item",[a("bk-checkbox",{attrs:{value:e.isEndTime},on:{change:e.handleChange}},[e._v(e._s("设置结束时间"))]),e._v(" "),e.isEndTime?a("div",[a("bk-date-picker",{staticStyle:{width:"100%"},attrs:{value:e.formData.endTime,options:e.dateOptions,transfer:!0,clearable:!1,type:"datetime",placeholder:"选择日期时间"},on:{change:e.handleEndTimeChange}})],1):e._e()],1)};n._withStripped=!0;var i=a(16262),r=i.Z,s=(0,a(51900).Z)(r,n,[],!1,null,null,null);s.options.__file="src/views/cron-job/list/components/operation/form-item-strategy/end-time.vue";var o=s.exports},12692:function(e,t,a){"use strict";a.r(t),a.d(t,{__esModule:function(){return i.X},default:function(){return o}});var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("jb-form-item",[a("bk-checkbox",{model:{value:e.executeBeforeNotify,callback:function(t){e.executeBeforeNotify=t},expression:"executeBeforeNotify"}},[e._v(e._s("执行前通知"))])],1),e._v(" "),e.executeBeforeNotify?a("render-strategy",{staticClass:"notify-wraper",attrs:{left:"55"}},[a("execute-notify",e._g(e._b({attrs:{mode:"execute-beofre","form-data":e.formData,"notify-offset-label":"执行前"}},"execute-notify",e.$attrs,!1),e.$listeners))],1):e._e()],1)};n._withStripped=!0;var i=a(83673),r=i.Z,s=(a(95809),(0,a(51900).Z)(r,n,[],!1,null,null,null));s.options.__file="src/views/cron-job/list/components/operation/form-item-strategy/execute-before-notify.vue";var o=s.exports},48518:function(e,t,a){"use strict";a.r(t),a.d(t,{__esModule:function(){return i.X},default:function(){return o}});var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return e.isShowNotify?a("div",[a("jb-form-item",[a("bk-checkbox",{model:{value:e.isFinishBeforeNotify,callback:function(t){e.isFinishBeforeNotify=t},expression:"isFinishBeforeNotify"}},[e._v(e._s("结束前通知"))])],1),e._v(" "),e.isFinishBeforeNotify?a("render-strategy",{staticClass:"notify-wraper",attrs:{left:"55"}},[a("execute-notify",e._g(e._b({attrs:{"form-data":e.formData,"notify-offset-label":"结束前"}},"execute-notify",e.$attrs,!1),e.$listeners))],1):e._e()],1):e._e()};n._withStripped=!0;var i=a(233),r=i.Z,s=(a(12462),(0,a(51900).Z)(r,n,[],!1,null,null,null));s.options.__file="src/views/cron-job/list/components/operation/form-item-strategy/finish-before-notify.vue";var o=s.exports},93075:function(e,t,a){"use strict";a.r(t),a.d(t,{__esModule:function(){return i.X},default:function(){return o}});var n=function(){var e=this,t=e.$createElement;return(e._self._c||t)(e.com,e._g(e._b({tag:"component"},"component",e.$attrs,!1),e.$listeners))};n._withStripped=!0;var i=a(35598),r=i.Z,s=(0,a(51900).Z)(r,n,[],!1,null,null,null);s.options.__file="src/views/cron-job/list/components/operation/form-item-strategy/index.vue";var o=s.exports},85920:function(e,t,a){"use strict";a.r(t),a.d(t,{__esModule:function(){return i.X},default:function(){return o}});var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:e.isLoading},expression:"{ isLoading }"}],staticClass:"time-task-operation",class:{loading:e.isLoading}},[e.isLoading?e._e():a("jb-form",{ref:"timeTaskForm",attrs:{model:e.formData,rules:e.rules,"form-type":"vertical"}},[a("jb-form-item",{attrs:{label:"任务名称",required:"",property:"name"}},[a("jb-input",{attrs:{placeholder:"推荐按照该定时执行的实际场景来取名...",maxlength:60},model:{value:e.formData.name,callback:function(t){e.$set(e.formData,"name",t)},expression:"formData.name"}})],1),e._v(" "),a("jb-form-item",{attrs:{label:"执行策略",required:"",property:e.strategyField}},[a("bk-radio-group",{attrs:{value:e.strategy},on:{change:e.handleStrategyChange}},[a("bk-radio-button",{attrs:{value:"once"}},[e._v("\n                    "+e._s("单次执行")+"\n                ")]),e._v(" "),a("bk-radio-button",{attrs:{value:"period"}},[e._v("\n                    "+e._s("周期执行")+"\n                ")])],1),e._v(" "),a("div",{staticClass:"strategy-wraper"},["once"===e.strategy?a("render-strategy",{attrs:{left:"40"}},[a("bk-date-picker",{staticStyle:{width:"100%"},attrs:{transfer:!0,clearable:!1,options:e.dateOptions,type:"datetime",placeholder:"选择日期时间"},model:{value:e.formData.executeTime,callback:function(t){e.$set(e.formData,"executeTime",t)},expression:"formData.executeTime"}})],1):a("render-strategy",{attrs:{left:"135"}},[a("cron-job",{staticClass:"cron-task",model:{value:e.formData.cronExpression,callback:function(t){e.$set(e.formData,"cronExpression",t)},expression:"formData.cronExpression"}})],1)],1)],1),e._v(" "),e._l(e.strategyFormItemList,(function(t){return a("form-item-factory",{key:t,attrs:{name:t,"form-data":e.formData},on:{"on-change":e.handleFormItemChange}})})),e._v(" "),a("jb-form-item",{attrs:{label:"作业模板",required:"",property:"taskTemplateId"}},[a("bk-select",{attrs:{placeholder:"选择作业模板",clearable:!1,searchable:"",loading:e.isTemplateLoading},on:{selected:e.handleTemplateChange},model:{value:e.formData.taskTemplateId,callback:function(t){e.$set(e.formData,"taskTemplateId",t)},expression:"formData.taskTemplateId"}},e._l(e.templateList,(function(e){return a("auth-option",{key:e.id,attrs:{id:e.id,name:e.name,permission:e.canView,"resource-id":e.id,auth:"job_template/view"}})})),1)],1),e._v(" "),a("jb-form-item",{attrs:{label:"执行方案",required:"",property:"taskPlanId"}},[a("div",{staticClass:"plan-select",class:e.hasPlan?"new-width":""},[a("bk-select",{attrs:{placeholder:"选择执行方案",clearable:!1,loading:e.isPlanLoading,searchable:""},on:{selected:e.handlePlanChange},model:{value:e.formData.taskPlanId,callback:function(t){e.$set(e.formData,"taskPlanId",t)},expression:"formData.taskPlanId"}},e._l(e.planList,(function(e){return a("auth-option",{key:e.id,attrs:{id:e.id,name:e.name,permission:e.canView,"resource-id":e.id,auth:"job_plan/view"}})})),1)],1),e._v(" "),e.hasPlan?a("div",{staticClass:"plan-icon"},[a("Icon",{directives:[{name:"bk-tooltips",rawName:"v-bk-tooltips",value:"查看执行方案",expression:"'查看执行方案'"}],attrs:{type:"audit"},on:{click:e.handleGoPlan}})],1):e._e()]),e._v(" "),e.hasPlan?a("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:e.isVariableLoading},expression:"{ isLoading: isVariableLoading }"}],staticClass:"global-variable-content"},[a("render-strategy",{attrs:{left:"70"}},[e.isVariabelEmpty?a("span",{staticClass:"plan-variable-empty"},[e._v("\n                    "+e._s("该执行方案无全局变量")+"\n                ")]):a("global-variable-layout",{attrs:{type:"vertical"}},[e._l(e.usedList,(function(t){return a("global-variable",{key:e.currentRenderPlanId+"_"+t.id+"_"+t.name,ref:"usedVariable",refInFor:!0,attrs:{"value-width":"100%",type:t.type,data:t}})})),e._v(" "),e.unusedList.length>0?a("toggle-display",{staticStyle:{"max-width":"960px","margin-top":"20px"},attrs:{count:e.unusedList.length}},[a("div",{staticStyle:{"margin-top":"20px"}},e._l(e.unusedList,(function(t){return a("global-variable",{key:e.currentRenderPlanId+"_"+t.id+"_"+t.name,ref:"unusedVariable",refInFor:!0,attrs:{"value-width":"100%",type:t.type,data:t}})})),1)]):e._e()],2)],1)],1):e._e()],2)],1)};n._withStripped=!0;var i=a(39644),r=i.Z,s=(a(16380),(0,a(51900).Z)(r,n,[],!1,null,"0de1e8cb",null));s.options.__file="src/views/cron-job/list/components/operation/index.vue";var o=s.exports},49822:function(e,t,a){"use strict";a.r(t),a.d(t,{__esModule:function(){return i.X},default:function(){return o}});var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"cron-item"},[a("div",{staticClass:"triangle",style:{left:e.left+"px"}}),e._v(" "),a("div",[e._t("default")],2)])};n._withStripped=!0;var i=a(85508),r=i.Z,s=(a(39042),(0,a(51900).Z)(r,n,[],!1,null,null,null));s.options.__file="src/views/cron-job/list/components/render-strategy.vue";var o=s.exports},74537:function(e,t,a){"use strict";a.r(t),a.d(t,{__esModule:function(){return i.X},default:function(){return o}});var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"cron-job-manage"},[a("list-action-layout",{scopedSlots:e._u([{key:"right",fn:function(){return[a("jb-search-select",{ref:"search",staticStyle:{width:"480px"},attrs:{data:e.searchSelect,placeholder:"搜索任务ID，任务名称，更新人..."},on:{"on-change":e.handleSearch}})]},proxy:!0}])},[a("auth-button",{directives:[{name:"test",rawName:"v-test",value:{type:"button",value:"createCrontab"},expression:"{ type: 'button', value: 'createCrontab' }"}],ref:"create",staticClass:"w120",attrs:{theme:"primary",auth:"cron/create"},on:{click:e.handleCreate}},[e._v("\n            "+e._s("新建")+"\n        ")])],1),e._v(" "),a("render-list",{directives:[{name:"test",rawName:"v-test",value:{type:"list",value:"crontab"},expression:"{ type: 'list', value: 'crontab' }"}],ref:"list",attrs:{"data-source":e.getCronJobList,size:e.tableSize,"search-control":function(){return e.$refs.search}}},[e.allRenderColumnMap.id?a("bk-table-column",{key:"id",attrs:{label:"ID",prop:"id",width:"100",align:"left"}}):e._e(),e._v(" "),e.allRenderColumnMap.name?a("bk-table-column",{key:"name",attrs:{label:"任务名称",sortable:"",prop:"name",align:"left","min-width":"200","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.row;return[a("auth-component",{attrs:{permission:n.canManage,"resource-id":n.id,auth:"cron/view"}},[a("span",{staticClass:"time-task-name",on:{click:function(t){return e.handleViewDetail(n)}}},[e._v("\n                        "+e._s(n.name)+"\n                    ")]),e._v(" "),a("span",{attrs:{slot:"forbid"},slot:"forbid"},[e._v(e._s(n.name))])])]}}],null,!1,1726186688)}):e._e(),e._v(" "),e.allRenderColumnMap.planName?a("bk-table-column",{key:"planName",attrs:{label:"执行方案名称","min-width":"200",align:"left","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.row;return[n.isPlanLoading?a("div",{staticClass:"sync-fetch"},[a("div",{staticClass:"sync-fetch-loading"},[a("Icon",{staticStyle:{color:"#3a84ff"},attrs:{type:"sync-pending",svg:""}})],1)]):a("router-link",{staticClass:"task-plan-text",attrs:{to:{name:"viewPlan",params:{templateid:4},query:{from:"cronJob",viewPlanid:4}}}},[e._v("\n                    "+e._s(n.taskPlanName)+"\n                ")])]}}],null,!1,947218515)}):e._e(),e._v(" "),e.allRenderColumnMap.policeText?a("bk-table-column",{key:"policeText",attrs:{label:"执行策略",prop:"policeText",width:"180",align:"left"},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.row;return[a("span",{directives:[{name:"bk-tooltips",rawName:"v-bk-tooltips.right",value:n.executeTimeTips,expression:"row.executeTimeTips",modifiers:{right:!0}}],staticClass:"tips"},[e._v("\n                    "+e._s(n.policeText)+"\n                ")])]}}],null,!1,1082110162)}):e._e(),e._v(" "),e.allRenderColumnMap.creator?a("bk-table-column",{key:"creator",attrs:{label:"创建人",prop:"creator",width:"120",align:"left"}}):e._e(),e._v(" "),e.allRenderColumnMap.createTime?a("bk-table-column",{key:"createTime",attrs:{label:"创建时间",prop:"createTime",width:"180",align:"left"}}):e._e(),e._v(" "),e.allRenderColumnMap.lastModifyUser?a("bk-table-column",{key:"lastModifyUser",attrs:{label:"更新人",sortable:"",prop:"lastModifyUser",width:"140",align:"left"}}):e._e(),e._v(" "),e.allRenderColumnMap.lastModifyTime?a("bk-table-column",{key:"lastModifyTime",attrs:{label:"更新时间",prop:"lastModifyTime",width:"180",align:"left"}}):e._e(),e._v(" "),e.allRenderColumnMap.lastExecuteStatus?a("bk-table-column",{key:"lastExecuteStatus",attrs:{label:"最新执行结果",sortable:"",prop:"lastExecuteStatus",width:"150",align:"left"},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.row;return[a("Icon",{staticStyle:{"font-size":"16px","vertical-align":"middle"},attrs:{svg:"",type:n.statusIconType}}),e._v(" "),a("span",{staticStyle:{"vertical-align":"middle"}},[e._v(e._s(n.statusText))])]}}],null,!1,3322389844)}):e._e(),e._v(" "),e.allRenderColumnMap.successRateText?a("bk-table-column",{key:"successRateText",attrs:{label:"周期成功率","render-header":e.renderHeader,width:"150",align:"left"},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.row;return[n.isStatictisLoading?a("div",{staticClass:"sync-fetch"},[a("div",{staticClass:"sync-fetch-loading"},[a("Icon",{staticStyle:{color:"#3a84ff"},attrs:{type:"sync-pending",svg:""}})],1)]):[n.isRateEmpty?[a("p",{domProps:{innerHTML:e._s(n.successRateText)}})]:[a("bk-popover",{attrs:{placement:"right",theme:"light"}},[a("p",{staticStyle:{"padding-right":"10px"},domProps:{innerHTML:e._s(n.successRateText)}}),e._v(" "),a("div",{staticStyle:{color:"#63656e"},attrs:{slot:"content"},slot:"content"},[a("div",{domProps:{innerHTML:e._s(n.successRateTips)}}),e._v(" "),n.showMoreFailAcion?a("div",{staticClass:"more-fail-action"},[a("bk-button",{attrs:{text:""},on:{click:function(t){return e.handleHistoryRecord(n,!0)}}},[e._v("\n                                        "+e._s("更多失败记录")+"\n                                    ")])],1):e._e()])])]]]}}],null,!1,2199010973)}):e._e(),e._v(" "),a("bk-table-column",{key:"action",attrs:{label:"操作",resizable:!1,width:"200",fixed:"right",align:"left"},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.row;return[a("bk-switcher",{directives:[{name:"test",rawName:"v-test",value:{type:"button",value:"toggleCrontabStatus"},expression:"{ type: 'button', value: 'toggleCrontabStatus' }"}],staticClass:"mr10",attrs:{value:n.enable,size:"small",theme:"primary"},on:{change:function(t){return e.handleStatusChange(t,n)}}}),e._v(" "),a("auth-button",{directives:[{name:"test",rawName:"v-test",value:{type:"button",value:"editCrontab"},expression:"{ type: 'button', value: 'editCrontab' }"}],staticClass:"time-task-edit mr10",attrs:{auth:"cron/edit","resource-id":n.id,permission:n.canManage,text:""},on:{click:function(t){return e.handleEdit(n)}}},[e._v("\n                    "+e._s("编辑")+"\n                ")]),e._v(" "),a("jb-popover-confirm",{attrs:{title:"确定删除该定时任务？",content:"删除后不可恢复，请谨慎操作！","confirm-handler":function(t){return e.handleDelete(n)}}},[a("auth-button",{directives:[{name:"test",rawName:"v-test",value:{type:"button",value:"deleteCrontab"},expression:"{ type: 'button', value: 'deleteCrontab' }"}],attrs:{auth:"cron/delete","resource-id":n.id,permission:n.canManage,text:""}},[e._v("\n                        "+e._s("删除")+"\n                    ")])],1),e._v(" "),a("bk-button",{directives:[{name:"test",rawName:"v-test",value:{type:"button",value:"crontabExecRecord"},expression:"{ type: 'button', value: 'crontabExecRecord' }"}],attrs:{text:""},on:{click:function(t){return e.handleHistoryRecord(n)}}},[e._v("\n                    "+e._s("执行记录")+"\n                ")])]}}])}),e._v(" "),a("bk-table-column",{attrs:{type:"setting"}},[a("bk-table-setting-content",{attrs:{fields:e.tableColumn,selected:e.selectedTableColumn,size:e.tableSize},on:{"setting-change":e.handleSettingChange}})],1)],1),e._v(" "),a("jb-sideslider",e._b({attrs:{"is-show":e.showOperation,width:960},on:{"update:isShow":function(t){e.showOperation=t},"update:is-show":function(t){e.showOperation=t}}},"jb-sideslider",e.operationSidesliderInfo,!1),[e.showOperation?a("task-operation",{attrs:{id:e.editTaskId,data:e.cronJobDetailInfo},on:{"on-change":e.handleCronChange}}):e._e()],1),e._v(" "),a("jb-sideslider",{attrs:{"is-show":e.showDetail,title:"定时任务详情",width:960},on:{"update:isShow":function(t){e.showDetail=t},"update:is-show":function(t){e.showDetail=t}},scopedSlots:e._u([{key:"footer",fn:function(){return[a("bk-button",{directives:[{name:"test",rawName:"v-test",value:{type:"button",value:"showCrontabDetail"},expression:"{ type: 'button', value: 'showCrontabDetail' }"}],attrs:{theme:"primary"},on:{click:e.handleToggelEdit}},[e._v("\n                "+e._s("编辑")+"\n            ")])]},proxy:!0}])},[a("task-detail",{attrs:{data:e.cronJobDetailInfo}})],1),e._v(" "),a("jb-sideslider",{attrs:{"is-show":e.showHistoryRecord,"show-footer":!1,"quick-close":"",transfer:"",width:960},on:{"update:isShow":function(t){e.showHistoryRecord=t},"update:is-show":function(t){e.showHistoryRecord=t}}},[a("div",{attrs:{slot:"header"},slot:"header"},[a("span",[e._v(e._s("定时执行记录"))]),e._v(" "),a("span",{staticStyle:{"font-size":"12px",color:"#313238"}},[e._v("（"+e._s(e.cronJobDetailInfo.name)+"）")])]),e._v(" "),e.showHistoryRecord?a("history-record",{attrs:{"show-faild":e.showHistoryFailedRecord,data:e.cronJobDetailInfo},on:{"on-change":e.handleCronChange}}):e._e()],1)],1)};n._withStripped=!0;var i=a(18589),r=i.Z,s=(a(17862),(0,a(51900).Z)(r,n,[],!1,null,null,null));s.options.__file="src/views/cron-job/list/index.vue";var o=s.exports},26862:function(e,t,a){var n=a(58808);n.__esModule&&(n=n.default),"string"==typeof n&&(n=[[e.id,n,""]]),n.locals&&(e.exports=n.locals);(0,a(18086).Z)("2ff079d6",n,!1,{})},69168:function(e,t,a){var n=a(17149);n.__esModule&&(n=n.default),"string"==typeof n&&(n=[[e.id,n,""]]),n.locals&&(e.exports=n.locals);(0,a(18086).Z)("033b670c",n,!1,{})},36512:function(e,t,a){var n=a(16662);n.__esModule&&(n=n.default),"string"==typeof n&&(n=[[e.id,n,""]]),n.locals&&(e.exports=n.locals);(0,a(18086).Z)("caca5e04",n,!1,{})},48875:function(e,t,a){var n=a(43688);n.__esModule&&(n=n.default),"string"==typeof n&&(n=[[e.id,n,""]]),n.locals&&(e.exports=n.locals);(0,a(18086).Z)("82100e44",n,!1,{})},95809:function(e,t,a){var n=a(44384);n.__esModule&&(n=n.default),"string"==typeof n&&(n=[[e.id,n,""]]),n.locals&&(e.exports=n.locals);(0,a(18086).Z)("7f03af06",n,!1,{})},12462:function(e,t,a){var n=a(20770);n.__esModule&&(n=n.default),"string"==typeof n&&(n=[[e.id,n,""]]),n.locals&&(e.exports=n.locals);(0,a(18086).Z)("66cf4710",n,!1,{})},16380:function(e,t,a){var n=a(79068);n.__esModule&&(n=n.default),"string"==typeof n&&(n=[[e.id,n,""]]),n.locals&&(e.exports=n.locals);(0,a(18086).Z)("f641ef3a",n,!1,{})},39042:function(e,t,a){var n=a(39719);n.__esModule&&(n=n.default),"string"==typeof n&&(n=[[e.id,n,""]]),n.locals&&(e.exports=n.locals);(0,a(18086).Z)("9e48af4a",n,!1,{})},17862:function(e,t,a){var n=a(53584);n.__esModule&&(n=n.default),"string"==typeof n&&(n=[[e.id,n,""]]),n.locals&&(e.exports=n.locals);(0,a(18086).Z)("5f6591d2",n,!1,{})}}]);