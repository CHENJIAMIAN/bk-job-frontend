(self.webpackChunkjob=self.webpackChunkjob||[]).push([[4059],{63074:function(t,e,s){"use strict";var i=s(22696);Object.defineProperty(e,"X",{value:!0}),e.Z=void 0,s(57024),s(87033),s(35948),s(94522);var r=i(s(44068)),a=i(s(12e3)),n=s(41980),c={name:"",components:{ScriptDetail:i(s(98336)).default},props:{isShow:{type:Boolean,default:!1},scriptVersionId:{type:Number,required:!0}},data:()=>({isLoading:!1,scriptInfo:{}}),watch:{isShow(t){t&&this.scriptVersionId>0&&this.fetchScriptDetail()}},created(){this.publicScript=(0,n.checkPublicScript)(this.$route),this.serviceHandler=this.publicScript?a.default:r.default},methods:{fetchScriptDetail(){var t=this;this.isLoading=!0,this.serviceHandler.versionDetail({id:this.scriptVersionId}).then((function(e){t.scriptInfo=Object.freeze(e)})).finally((function(){t.isLoading=!1}))},handleCancel(){this.$emit("update:isShow",!1)}}};e.Z=c},35438:function(t,e,s){"use strict";var i=s(22696);Object.defineProperty(e,"X",{value:!0}),e.Z=void 0,s(87033),s(35948),s(94522),s(77036),s(7170),s(71959);var r=i(s(15399)),a=s(41980),n=i(s(44068)),c=i(s(12e3)),l=i(s(84484)),o={components:{ScriptDetail:i(s(82951)).default},data:()=>({data:[{},{},{}],isLoading:!1,isShowDetail:!1,selectScriptVersionId:0,lastVersionScriptInfo:{}}),computed:{isRetryAllDisable(){for(var t=0;t<this.data.length;t++)if(this.data[t].isSyncFailed)return!1;return!0}},created(){this.statusFilters=[{value:0,text:r.default.t("script.未上线")},{value:1,text:r.default.t("script.已上线")},{value:2,text:r.default.t("script.已下线")},{value:3,text:r.default.t("script.已禁用")}],this.publicScript=(0,a.checkPublicScript)(this.$route),this.serviceHandler=this.publicScript?c.default:n.default,this.scriptId=this.$route.params.scriptId,this.scriptVersionId=this.$route.params.scriptVersionId,this.stepList=JSON.parse(localStorage.getItem("SYNC_TEMPLATE_STEP_SCRIPT")),this.stepList.length<1?this.messageError(r.default.t("script.请先选择作业模板步骤")):(this.fetchData(),this.fetchLastScriptVersionDetail())},methods:{fetchData(){var t=this;this.isLoading=!0,this.serviceHandler.scriptVersionSync({scriptId:this.scriptId,scriptVersionId:this.scriptVersionId,steps:this.stepList}).then((function(e){t.data=e})).finally((function(){t.isLoading=!1}))},fetchLastScriptVersionDetail(){var t=this;this.serviceHandler.versionDetail({id:this.$route.params.scriptVersionId}).then((function(e){t.lastVersionScriptInfo=Object.freeze(e)}))},handleShowDetail(t){this.selectScriptVersionId=t,this.isShowDetail=!0},handleAllRetry(){this.fetchData()},handleRetry(t,e){var s=this;this.serviceHandler.scriptVersionSync({scriptId:this.scriptId,scriptVersionId:this.scriptVersionId,steps:[{templateid:4,stepid:4}]}).then((function(t){s.data.splice(e,1,t[0])}))},statusFilterMethod:(t,e)=>e.scriptStatus===t,handleFinish(){this.routerBack()},routerBack(){var t=this,e=this.$createElement;window.changeAlert=!this.isRetryAllDisable,this.isSyncPlanLoading=!1,(0,a.leaveConfirm)(r.default.t("script.部分作业模板同步失败，请留意")).then((function(){t.$bkInfo({title:r.default.t("script.是否需要进行执行方案同步？"),closeIcon:!1,subHeader:e("div",[e("span",[r.default.t("script.点击")]),e("span",{style:"font-weight: bold"},[" ",r.default.t("script.“立即前往”")," "]),e("span",[r.default.t("script.将进入关联的执行方案同步确认页面，点击")]),e("span",{style:"font-weight: bold"},[" ",r.default.t("script.“暂时不用”")," "]),e("span",[r.default.t("script.结束本次操作并退出。")])]),okText:r.default.t("script.立即前往"),cancelText:r.default.t("script.暂时不用"),confirmFn:function(){return l.default.fetchBatchTaskPlan({templateIds:t.stepList.map((function(t){return t.templateId})).join(",")}).then((function(e){t.$router.push({name:"syncPlanBatch",query:{planIds:e.reduce((function(t,e){return e.needUpdate&&t.push(e.id),t}),[]).join(",")}})}))},cancelFn:function(){var e=t.publicScript?"publicScriptVersion":"scriptVersion";t.$router.push({name:e,params:{id:t.scriptId}})}})}))}}};e.Z=o},9312:function(){},45156:function(){},82951:function(t,e,s){"use strict";s.r(e),s.d(e,{__esModule:function(){return r.X},default:function(){return c}});var i=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("jb-sideslider",{attrs:{"is-show":t.isShow,"show-footer":!1,"quick-close":!0,width:900,title:t.$t("script.查看脚本")},on:{"update:isShow":t.handleCancel}},[t.isShow?s("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:t.isLoading},expression:"{ isLoading }"}]},[t.isLoading?t._e():s("script-detail",{attrs:{"script-info":t.scriptInfo,"offset-bottom":0}})],1):t._e()])};i._withStripped=!0;var r=s(63074),a=r.Z,n=(s(91790),(0,s(35471).Z)(a,i,[],!1,null,"06891118",null));n.options.__file="src/views/script-manage/sync-task/components/script-detail.vue";var c=n.exports},84059:function(t,e,s){"use strict";s.r(e),s.d(e,{__esModule:function(){return r.X},default:function(){return c}});var i=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:t.isLoading},expression:"{ isLoading }"}],staticClass:"script-manage-sync-task-page"},[s("div",{staticClass:"retry-btn"},[s("bk-button",{on:{click:t.handleAllRetry}},[t._v(t._s(t.$t("script.全部重试")))])],1),t._v(" "),s("div",{staticClass:"table-top"},[t._v("\n        "+t._s(t.$t("script.同步作业模板"))+"\n        "),s("span",{staticClass:"version-sum"},[t._v("\n            （"+t._s(t.$t("script.共"))+" "+t._s(t.data.length)+" "+t._s(t.$t("script.个.result"))+"）\n        ")])]),t._v(" "),s("bk-table",{attrs:{data:t.data,"row-class-name":"sync-script-record"}},[s("bk-table-column",{attrs:{label:t.$t("script.作业模板名称"),prop:"name",sortable:""},scopedSlots:t._u([{key:"default",fn:function(e){var i=e.row;return[s("router-link",{attrs:{target:"_blank",to:{name:"templateDetail",params:{id:4}}}},[t._v("\n                    "+t._s(i.templateName)+"\n                    "),s("Icon",{staticClass:"template-link",attrs:{type:"edit"}})],1)]}}])}),t._v(" "),s("bk-table-column",{attrs:{label:t.$t("script.步骤名称"),prop:"stepName"}}),t._v(" "),s("bk-table-column",{attrs:{label:t.$t("script.引用的版本号"),prop:"version"},scopedSlots:t._u([{key:"default",fn:function(e){var i=e.row;return[s("bk-button",{attrs:{text:""},on:{click:function(e){return t.handleShowDetail(i.scriptVersionId)}}},[t._v("\n                    "+t._s(i.scriptVersion)+"\n                ")])]}}])}),t._v(" "),s("bk-table-column",{attrs:{label:t.$t("script.引用版本状态"),prop:"status",filters:t.statusFilters,"filter-method":t.statusFilterMethod,"filter-multiple":!0},scopedSlots:t._u([{key:"default",fn:function(e){var i=e.row;return[s("span",{domProps:{innerHTML:t._s(i.statusHtml)}})]}}])}),t._v(" "),s("bk-table-column",{attrs:{label:t.$t("script.状态"),width:"350",prop:"syncStatus"},scopedSlots:t._u([{key:"default",fn:function(e){var i=e.row,r=e.$index;return[s("Icon",{staticClass:"mr10",attrs:{type:i.syncIcon,svg:""}}),t._v(" "),s("span",[t._v(t._s(i.syncStatusMsg))]),t._v(" "),i.isSyncFailed?s("bk-button",{staticStyle:{"margin-left":"15px"},attrs:{"tippy-tips":i.failMsg,text:""},on:{click:function(e){return t.handleRetry(i,r)}}},[t._v("\n                    "+t._s(t.$t("script.重试"))+"\n                ")]):t._e()]}}])})],1),t._v(" "),s("div",{staticClass:"footer-action"},[s("bk-button",{staticClass:"w120",attrs:{theme:"primary"},on:{click:t.handleFinish}},[t._v("\n            "+t._s(t.$t("script.完成"))+"\n        ")])],1),t._v(" "),s("script-detail",{attrs:{"is-show":t.isShowDetail,"script-version-id":t.selectScriptVersionId},on:{"update:isShow":function(e){t.isShowDetail=e},"update:is-show":function(e){t.isShowDetail=e}}}),t._v(" "),t.lastVersionScriptInfo.version?s("element-teleport",[s("span",[t._v(" - "+t._s(t.$t("script.同步至")))]),t._v(" "),s("span",[t._v(t._s(t.lastVersionScriptInfo.version))])]):t._e()],1)};i._withStripped=!0;var r=s(35438),a=r.Z,n=(s(89002),(0,s(35471).Z)(a,i,[],!1,null,null,null));n.options.__file="src/views/script-manage/sync-task/index.vue";var c=n.exports},91790:function(t,e,s){var i=s(9312);i.__esModule&&(i=i.default),"string"==typeof i&&(i=[[t.id,i,""]]),i.locals&&(t.exports=i.locals);(0,s(13570).Z)("f3a71766",i,!1,{})},89002:function(t,e,s){var i=s(45156);i.__esModule&&(i=i.default),"string"==typeof i&&(i=[[t.id,i,""]]),i.locals&&(t.exports=i.locals);(0,s(13570).Z)("2391cd86",i,!1,{})}}]);