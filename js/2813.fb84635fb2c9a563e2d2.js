(self.webpackChunkjob=self.webpackChunkjob||[]).push([[2813],{98914:function(e,t,a){"use strict";a(45974),a(9042),a(43364);var r=a(22696);Object.defineProperty(t,"X",{value:!0}),t.Z=void 0;var n=r(a(33610));a(35927),a(6919),a(56259),a(63762),a(95179),a(87033),a(35948),a(94522),a(71959);var o=r(a(1249)),s=r(a(6089)),i=r(a(76830)),l=a(61681),c=r(a(86234)),u=r(a(64571)),d=r(a(61254)),p=r(a(94304));function m(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function f(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?m(Object(a),!0).forEach((function(t){(0,n.default)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):m(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var b=function(){return{id:"",account:"",alias:"",category:i.default.OS,dbPassword:"",dbPort:"",dbSystemAccountId:"",grantees:[],os:"",password:"",remark:"",type:i.default.TYPE_LINUX,rePassword:""}},h={name:"OperationAccount",components:{JbInput:c.default,AccountSelect:u.default},props:{data:{type:Object,default:function(){return{}}}},data:()=>({isLoading:!0,isEdit:!1,isRulesLoadingError:!1,formData:b(),currentRules:Object.freeze({linux:{expression:"."},windows:{expression:"."},db:{expression:"."}})}),computed:{accountCom(){return{[i.default.OS]:p.default,[i.default.DB]:d.default}[this.formData.category]},namePlaceholder(){return this.isLoading?"":this.formData.category===i.default.DB?this.currentRules.db.description:this.formData.type===i.default.TYPE_LINUX?this.currentRules.linux.description:this.currentRules.windows.description},rules(){var e=this;if(this.isLoading)return{};var t={account:[{required:!0,message:"名称必填",trigger:"blur"}],alias:[{required:!0,message:"别名必填",trigger:"blur"},{validator:l.accountAliasNameRule.validator,message:l.accountAliasNameRule.message,trigger:"blur"}]};return this.formData.category===i.default.DB?(t.account.push({validator:function(t){return new RegExp(e.currentRules.db.expression).test(t)},message:this.currentRules.db.description,trigger:"blur"}),f(f({},t),{},{dbPassword:[{validator:function(e){return!/[\u4e00-\u9fa5]/.test(e)},message:"密码不支持中文",trigger:"blur"}],rePassword:[{validator:function(t){return e.formData.rePassword===e.formData.dbPassword},message:"密码不一致",trigger:"blur"}],dbPort:[{required:!0,message:"端口必填",trigger:"blur"}],dbSystemAccountId:[{required:!0,message:"依赖系统账号必填",trigger:"blur"}]})):this.formData.type===i.default.TYPE_LINUX?(t.account.push({validator:function(t){return new RegExp(e.currentRules.linux.expression).test(t)},message:this.currentRules.linux.description,trigger:"blur"}),t):(t.account.push({validator:function(t){return new RegExp(e.currentRules.windows.expression).test(t)},message:this.currentRules.windows.description,trigger:"blur"}),f(f({},t),{},{password:[{required:!0,message:"密码必填",trigger:"blur"},{validator:function(e){return!/[\u4e00-\u9fa5]/.test(e)},message:"密码不支持中文",trigger:"blur"}],rePassword:[{validator:function(t){return t===e.formData.password},message:"密码不一致",trigger:"blur"}]}))}},created(){if(this.fetchRules(),this.categoryList=[{value:i.default.OS,name:"系统账号"},{value:i.default.DB,name:"数据库账号"}],this.data.id){this.isEdit=!0;var e=this.data,t=e.id,a=e.account,r=e.alias,n=e.category,o=e.dbPassword,s=e.dbPort,l=e.dbSystemAccountId,c=e.grantees,u=e.os,d=e.password,p=e.remark,m=e.type,f=o;d&&(f=d),this.formData={id:t,account:a,alias:r,category:n,dbPassword:o,dbPort:s,dbSystemAccountId:l,grantees:c,os:u,password:d,remark:p,type:m,rePassword:f}}},methods:{fetchRules(){var e=this;return this.data.id?(this.isLoading=!1,Promise.resolve()):o.default.fetchAllNameRule().then((function(t){var a=t.currentRules;e.currentRules=Object.freeze(a.reduce((function(e,t){return e[t.osTypeKey]=t,e}),{}))})).catch((function(){e.isRulesLoadingError=!1})).finally((function(){e.isLoading=!1}))},createAccount(){var e=this,t=f({},this.formData);return delete t.rePassword,s.default.createAccount(t).then((function(){e.messageSuccess("新建账号成功"),e.$emit("on-change")}))},updateAccount(){var e=this,t=f({},this.formData);return delete t.rePassword,s.default.updateAccount(t).then((function(){e.messageSuccess("编辑账号成功"),e.$emit("on-change")}))},handleCategoryChange(e){this.formData=b(),this.formData.category=e;var t={[i.default.OS]:i.default.TYPE_LINUX,[i.default.DB]:i.default.TYPE_MYSQL};this.formData.type=t[e],this.$refs.operateAccountForm.clearError()},handleFieldChange(e,t){this.formData[e]=t},submit(){var e=this;return this.isRulesLoadingError?(this.messageWarn("命名规则请求失败无法执行当前操作，请刷新页面"),Promise.reject(Error("rule error"))):this.$refs.operateAccountForm.validate().then((function(){return e.formData.id?e.updateAccount():e.createAccount()}))}}};t.Z=h},33897:function(e,t,a){"use strict";a(35927),a(45974),a(9042),a(43364);var r=a(22696);Object.defineProperty(t,"X",{value:!0}),t.Z=void 0;var n=r(a(33610));a(71959),a(87033);var o=r(a(6089)),s=r(a(46117)),i=a(46790),l=r(a(80712)),c=r(a(27452)),u=r(a(2645)),d=r(a(76684));function p(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}var m="account_manage_columns",f={components:{ListActionLayout:l.default,RenderList:c.default,JbSearchSelect:u.default,Operation:d.default},data:()=>({showOperation:!1,editData:{},searchParams:[],searchValue:[],selectedTableColumn:[],tableSize:"small"}),computed:{isSkeletonLoading(){return this.$refs.list.isLoading},allRenderColumnMap(){return this.selectedTableColumn.reduce((function(e,t){return e[t.id]=!0,e}),{})},operationSidesliderInfo(){return this.editData.id?{title:"编辑账号",okText:"保存"}:{title:"新建账号",okText:"提交"}}},created(){this.dataSource=o.default.fetchAccountList,this.searchSelect=[{name:"ID",id:"id",description:"将覆盖其它条件"},{name:"账号别名",id:"alias",default:!0},{name:"账号名称",id:"account"},{name:"创建人",id:"creator",remoteMethod:s.default.fetchUsersOfSearch,inputInclude:!0},{name:"更新人",id:"lastModifyUser",remoteMethod:s.default.fetchUsersOfSearch,inputInclude:!0}],this.tableColumn=[{id:"id",label:"ID"},{id:"alias",label:"账号别名",disabled:!0},{id:"account",label:"账号名称",disabled:!0},{id:"categoryName",label:"账号用途"},{id:"typeName",label:"账号类型",disabled:!0},{id:"creator",label:"创建人"},{id:"createTime",label:"创建时间"},{id:"lastModifyUser",label:"更新人"},{id:"lastModifyTime",label:"更新时间"}];var e=i.listColumnsCache.getItem(m);e?(this.selectedTableColumn=Object.freeze(e.columns),this.tableSize=e.size):this.selectedTableColumn=Object.freeze([{id:"alias"},{id:"account"},{id:"categoryName"},{id:"typeName"},{id:"lastModifyUser"},{id:"lastModifyTime"}])},methods:{fetchData(){this.$refs.list.$emit("onFetch",this.searchParams)},handleSettingChange(e){var t=e.fields,a=e.size;this.selectedTableColumn=Object.freeze(t),this.tableSize=a,i.listColumnsCache.setItem(m,{columns:t,size:a})},handleSearch(e){this.searchParams=e,this.fetchData()},handleAdd(){this.editData={},this.showOperation=!0},handleEdit(e){this.editData=function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?p(Object(a),!0).forEach((function(t){(0,n.default)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):p(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({},e),this.showOperation=!0},handleDelete(e){var t=this;return o.default.deleteAccount({id:e}).then((function(){return t.fetchData(),t.messageSuccess("删除成功"),!0}))},handleOperationSubmit(){this.fetchData()}}};t.Z=f},16481:function(){},61254:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return o}});var r=function(e,t){var a=t._c;return a("div",{key:"databaseAccount"},[a("jb-form-item",{attrs:{label:"数据库类型",required:""}},[a("bk-select",{staticStyle:{width:"100%"},attrs:{readonly:t.props.isEdit,clearable:!1,value:t.props.formData.type},on:{change:function(e){return t.props.change("type",e)}}},[a("bk-option",{attrs:{id:9,name:"Mysql"}}),t._v(" "),a("bk-option",{attrs:{id:10,name:"Oracle"}}),t._v(" "),a("bk-option",{attrs:{id:11,name:"DB2"}})],1)],1),t._v(" "),a("jb-form-item",{attrs:{label:"名称",required:"",property:"account"}},[a("jb-input",{attrs:{placeholder:t.props.namePlaceholder,readonly:t.props.isEdit,value:t.props.formData.account},on:{change:function(e){return t.props.change("account",e)}}})],1),t._v(" "),a("jb-form-item",{attrs:{label:"别名",required:"",property:"alias"}},[a("jb-input",{attrs:{placeholder:"在出现同名账号的情况下，账号的别名显得格外重要...",value:t.props.formData.alias,maxlength:32},on:{change:function(e){return t.props.change("alias",e)}}})],1),t._v(" "),a("jb-form-item",{attrs:{label:"密码",property:"dbPassword"}},[a("bk-input",{key:"database-password",attrs:{placeholder:"输入密码",type:"password",value:t.props.formData.dbPassword},on:{change:function(e){return t.props.change("dbPassword",e)}}})],1),t._v(" "),a("jb-form-item",{attrs:{label:"确认密码",property:"rePassword"}},[a("bk-input",{key:"database-repassword",attrs:{placeholder:"输入确认密码",type:"password",value:t.props.formData.rePassword},on:{change:function(e){return t.props.change("rePassword",e)}}})],1),t._v(" "),a("jb-form-item",{attrs:{label:"端口",required:"",property:"dbPort"}},[a("bk-input",{attrs:{placeholder:"输入确认端口",type:"number",value:t.props.formData.dbPort},on:{change:function(e){return t.props.change("dbPort",e)}}})],1),t._v(" "),a("jb-form-item",{attrs:{label:"依赖系统账号",required:"",property:"dbSystemAccountId"}},[a("account-select",{attrs:{placeholder:"选择依赖系统账号",value:t.props.formData.dbSystemAccountId,type:"system"},on:{change:function(e){return t.props.change("dbSystemAccountId",e)}}})],1),t._v(" "),a("jb-form-item",{attrs:{label:"描述"}},[a("bk-input",{attrs:{placeholder:"输入账号描述",value:t.props.formData.remark,type:"textarea",maxlength:200},on:{change:function(e){return t.props.change("remark",e)}}})],1)],1)};r._withStripped=!0;var n=(0,a(35471).Z)({},r,[],!0,null,null,null);n.options.__file="src/views/account-manage/index/components/account-strategy/database-account.vue";var o=n.exports},94304:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return o}});var r=function(e,t){var a=t._c;return a("div",{key:"system-account"},[a("jb-form-item",{attrs:{label:"类型",required:""}},[a("div",{staticClass:"radio-button-group-wraper"},[a("bk-radio-group",{attrs:{value:t.props.formData.type},on:{change:function(e){return t.props.change("type",e)}}},[a("bk-radio-button",{staticClass:"account-type-radio",attrs:{value:1}},[t._v("\n                    Linux\n                ")]),t._v(" "),a("bk-radio-button",{staticClass:"account-type-radio",attrs:{value:2}},[t._v("\n                    Windows\n                ")])],1)],1)]),t._v(" "),a("jb-form-item",{attrs:{label:"名称",required:"",property:"account"}},[a("jb-input",{attrs:{placeholder:t.props.namePlaceholder,readonly:t.props.isEdit,value:t.props.formData.account},on:{change:function(e){return t.props.change("account",e)}}})],1),t._v(" "),a("jb-form-item",{attrs:{label:"别名",required:"",property:"alias"}},[a("jb-input",{attrs:{placeholder:"在出现同名账号的情况下，账号的别名显得格外重要...",value:t.props.formData.alias,maxlength:32},on:{change:function(e){return t.props.change("alias",e)}}})],1),t._v(" "),1!==t.props.formData.type?[a("jb-form-item",{key:"systemPassword",attrs:{label:"密码",required:"",property:"password"}},[a("bk-input",{attrs:{placeholder:"输入密码",type:"password",value:t.props.formData.password},on:{change:function(e){return t.props.change("password",e)}}})],1),t._v(" "),a("jb-form-item",{key:"systemRepassword",attrs:{label:"确认密码",required:"",property:"rePassword"}},[a("bk-input",{attrs:{placeholder:"输入确认密码",type:"password",value:t.props.formData.rePassword},on:{change:function(e){return t.props.change("rePassword",e)}}})],1)]:t._e(),t._v(" "),a("jb-form-item",{attrs:{label:"描述"}},[a("bk-input",{attrs:{placeholder:"输入账号描述",value:t.props.formData.remark,type:"textarea",maxlength:200},on:{change:function(e){return t.props.change("remark",e)}}})],1)],2)};r._withStripped=!0;var n=(0,a(35471).Z)({},r,[],!0,null,null,null);n.options.__file="src/views/account-manage/index/components/account-strategy/os-account.vue";var o=n.exports},76684:function(e,t,a){"use strict";a.r(t),a.d(t,{__esModule:function(){return n.X},default:function(){return i}});var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:e.isLoading},expression:"{ isLoading }"}],staticClass:"operation-account"},[a("jb-form",{directives:[{name:"test",rawName:"v-test",value:{type:"form",value:"createAccount"},expression:"{ type: 'form', value: 'createAccount' }"}],key:e.formData.category+"_"+e.formData.type,ref:"operateAccountForm",attrs:{model:e.formData,rules:e.rules,"form-type":"vertical"}},[a("jb-form-item",{staticStyle:{"margin-bottom":"20px"},attrs:{label:"用途",required:""}},[a("div",{staticClass:"radio-button-group-wraper"},[a("bk-radio-group",{attrs:{value:e.formData.category},on:{change:e.handleCategoryChange}},e._l(e.categoryList,(function(t){return a("bk-radio-button",{key:t.value,staticClass:"account-type-radio",attrs:{value:t.value}},[e._v("\n                        "+e._s(t.name)+"\n                    ")])})),1)],1)]),e._v(" "),a(e.accountCom,{key:e.formData.category,tag:"component",attrs:{"form-data":e.formData,"is-edit":e.isEdit,"name-placeholder":e.namePlaceholder,change:e.handleFieldChange}})],1)],1)};r._withStripped=!0;var n=a(98914),o=n.Z,s=(a(60118),(0,a(35471).Z)(o,r,[],!1,null,null,null));s.options.__file="src/views/account-manage/index/components/operation.vue";var i=s.exports},62813:function(e,t,a){"use strict";a.r(t),a.d(t,{__esModule:function(){return n.X},default:function(){return i}});var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("list-action-layout",{scopedSlots:e._u([{key:"right",fn:function(){return[a("jb-search-select",{ref:"search",staticStyle:{width:"420px"},attrs:{data:e.searchSelect,placeholder:"搜索账号别名，名称，更新人..."},on:{"on-change":e.handleSearch}})]},proxy:!0}])},[a("auth-button",{directives:[{name:"test",rawName:"v-test",value:{type:"button",value:"createAccount"},expression:"{ type: 'button', value: 'createAccount' }"}],staticStyle:{width:"120px"},attrs:{auth:"account/create",theme:"primary"},on:{click:e.handleAdd}},[e._v("\n            "+e._s("新建")+"\n        ")])],1),e._v(" "),a("render-list",{directives:[{name:"test",rawName:"v-test",value:{type:"list",value:"account"},expression:"{ type: 'list', value: 'account' }"}],ref:"list",attrs:{"data-source":e.dataSource,size:e.tableSize,"search-control":function(){return e.$refs.search}}},[e.allRenderColumnMap.id?a("bk-table-column",{key:"id",attrs:{label:"ID",prop:"id",sortable:"",width:"80",align:"left"}}):e._e(),e._v(" "),e.allRenderColumnMap.alias?a("bk-table-column",{key:"alias",attrs:{label:"账号别名",prop:"alias","min-width":"180",sortable:"",align:"left"}}):e._e(),e._v(" "),e.allRenderColumnMap.account?a("bk-table-column",{key:"account",attrs:{label:"账号名称",prop:"account","min-width":"180",sortable:"",align:"left"}}):e._e(),e._v(" "),e.allRenderColumnMap.categoryName?a("bk-table-column",{key:"categoryName",attrs:{label:"账号用途",prop:"categoryName",width:"120",sortable:"",align:"left"}}):e._e(),e._v(" "),e.allRenderColumnMap.typeName?a("bk-table-column",{key:"typeName",attrs:{label:"账号类型",prop:"typeName",width:"120",sortable:"",align:"left"}}):e._e(),e._v(" "),e.allRenderColumnMap.creator?a("bk-table-column",{key:"creator",attrs:{label:"创建人",prop:"creator",width:"120",align:"left"}}):e._e(),e._v(" "),e.allRenderColumnMap.createTime?a("bk-table-column",{key:"createTime",attrs:{label:"创建时间",prop:"createTime",width:"180",align:"left"}}):e._e(),e._v(" "),e.allRenderColumnMap.lastModifyUser?a("bk-table-column",{key:"lastModifyUser",attrs:{label:"更新人",prop:"lastModifyUser",width:"120",align:"left"}}):e._e(),e._v(" "),e.allRenderColumnMap.lastModifyTime?a("bk-table-column",{key:"lastModifyTime",attrs:{label:"更新时间",prop:"lastModifyTime",width:"180",align:"left"}}):e._e(),e._v(" "),a("bk-table-column",{key:"action",attrs:{label:"操作",resizable:!1,fixed:"right",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("auth-button",{directives:[{name:"test",rawName:"v-test",value:{type:"button",value:"editAccount"},expression:"{ type: 'button', value: 'editAccount' }"}],staticClass:"mr10",attrs:{theme:"primary",permission:r.canManage,auth:"account/edit","resource-id":r.id,text:""},on:{click:function(t){return e.handleEdit(r)}}},[e._v("\n                    "+e._s("编辑")+"\n                ")]),e._v(" "),a("jb-popover-confirm",{attrs:{title:"确定删除该账号？",content:"删除后不可恢复，请谨慎操作！","confirm-handler":function(){return e.handleDelete(r.id)}}},[a("auth-button",{directives:[{name:"test",rawName:"v-test",value:{type:"button",value:"deleteAccount"},expression:"{ type: 'button', value: 'deleteAccount' }"}],attrs:{text:"",permission:r.canManage,auth:"account/delete","resource-id":r.id}},[e._v("\n                        "+e._s("删除")+"\n                    ")])],1)]}}])}),e._v(" "),a("bk-table-column",{attrs:{type:"setting"}},[a("bk-table-setting-content",{attrs:{fields:e.tableColumn,selected:e.selectedTableColumn,size:e.tableSize},on:{"setting-change":e.handleSettingChange}})],1)],1),e._v(" "),a("jb-sideslider",e._b({attrs:{"is-show":e.showOperation,width:540},on:{"update:isShow":function(t){e.showOperation=t},"update:is-show":function(t){e.showOperation=t}}},"jb-sideslider",e.operationSidesliderInfo,!1),[a("operation",{attrs:{data:e.editData},on:{"on-change":e.handleOperationSubmit}})],1)],1)};r._withStripped=!0;var n=a(33897),o=n.Z,s=(0,a(35471).Z)(o,r,[],!1,null,null,null);s.options.__file="src/views/account-manage/index/index.vue";var i=s.exports},60118:function(e,t,a){var r=a(16481);r.__esModule&&(r=r.default),"string"==typeof r&&(r=[[e.id,r,""]]),r.locals&&(e.exports=r.locals);(0,a(13570).Z)("3718efe9",r,!1,{})}}]);