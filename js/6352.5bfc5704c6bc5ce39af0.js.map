{"version":3,"file":"js/6352.5bfc5704c6bc5ce39af0.js","mappings":"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","sources":["webpack://job/src/views/task-manage/template-detail/index.vue","webpack://job/./src/views/task-manage/template-detail/index.vue?3698","webpack://job/./src/views/task-manage/template-detail/index.vue?e5d3","webpack://job/./src/views/task-manage/template-detail/index.vue?7fab","webpack://job/./src/views/task-manage/template-detail/index.vue?f9af"],"sourcesContent":["<template>\r\n    <smart-action class=\"task-template-detail\" offset-target=\"detail-content\">\r\n        <detail-layout class=\"task-template-detail-layout\" mode=\"see\">\r\n            <detail-item :label=\"'模板名称：'\">\r\n                <auth-component\r\n                    auth=\"job_template/edit\"\r\n                    :resource-id=\"taskId\">\r\n                    <jb-edit-input\r\n                        class=\"input\"\r\n                        field=\"name\"\r\n                        :value=\"formData.name\"\r\n                        :rules=\"rules.name\"\r\n                        :remote-hander=\"handleUpdateTemplate\" />\r\n                    <div slot=\"forbid\">{{ formData.name }}</div>\r\n                </auth-component>\r\n            </detail-item>\r\n            <detail-item :label=\"'场景标签：'\">\r\n                <auth-component\r\n                    auth=\"job_template/edit\"\r\n                    :resource-id=\"taskId\">\r\n                    <jb-edit-tag\r\n                        class=\"input\"\r\n                        field=\"tags\"\r\n                        :value=\"formData.tags\"\r\n                        :remote-hander=\"handleUpdateTemplate\" />\r\n                    <div slot=\"forbid\">{{ formData.tagText }}</div>\r\n                </auth-component>\r\n            </detail-item>\r\n            <detail-item :label=\"'模板描述：'\">\r\n                <auth-component\r\n                    auth=\"job_template/edit\"\r\n                    :resource-id=\"taskId\">\r\n                    <jb-edit-textarea\r\n                        class=\"input\"\r\n                        field=\"description\"\r\n                        :placeholder=\"'填写该模板的功能介绍等详细描述...'\"\r\n                        :maxlength=\"500\"\r\n                        :value=\"formData.description\"\r\n                        :remote-hander=\"handleUpdateTemplate\" />\r\n                    <div slot=\"forbid\">{{ formData.description || '--' }}</div>\r\n                </auth-component>\r\n            </detail-item>\r\n            <detail-item :label=\"'全局变量：'\" class=\"gloval-var-item\">\r\n                <render-global-var :list=\"formData.variables\" />\r\n            </detail-item>\r\n            <detail-item :label=\"'作业步骤：'\" class=\"task-step-item\">\r\n                <render-task-step\r\n                    ref=\"step\"\r\n                    :list=\"formData.stepList\"\r\n                    :variable=\"formData.variables\" />\r\n            </detail-item>\r\n        </detail-layout>\r\n        <template #action>\r\n            <div class=\"action-box\">\r\n                <bk-button\r\n                    theme=\"primary\"\r\n                    class=\"w120 mr10\"\r\n                    @click=\"handleGoExec\"\r\n                    v-test=\"{ type: 'button', value: 'planList' }\">\r\n                    {{ '选择方案' }}\r\n                </bk-button>\r\n                <auth-button\r\n                    class=\"mr10\"\r\n                    :resource-id=\"taskId\"\r\n                    auth=\"job_template/debug\"\r\n                    @click=\"handleGoDebug\"\r\n                    v-test=\"{ type: 'button', value: 'debugTemplate' }\">\r\n                    {{ '调试' }}\r\n                </auth-button>\r\n                <auth-button\r\n                    class=\"mr10\"\r\n                    :resource-id=\"taskId\"\r\n                    auth=\"job_template/edit\"\r\n                    @click=\"handleGoEdit\"\r\n                    v-test=\"{ type: 'button', value: 'editTemplate' }\">\r\n                    {{ '编辑' }}\r\n                </auth-button>\r\n                <span v-bk-tooltips=\"notNeedUpdateTips\">\r\n                    <bk-button\r\n                        class=\"action-sync mr10\"\r\n                        :loading=\"isPlanListLoading\"\r\n                        @click=\"handleGoSyncPlan\"\r\n                        v-test=\"{ type: 'button', value: 'syncPlan' }\">\r\n                        {{ '同步方案' }}\r\n                        <div v-if=\"!isNotNeedUpdate\" class=\"update-flag\" v-bk-tooltips=\"'待同步'\">\r\n                            <Icon type=\"sync-8\" />\r\n                        </div>\r\n                    </bk-button>\r\n                </span>\r\n                <jb-popover-confirm\r\n                    class=\"action-del\"\r\n                    :title=\"'确定删除该作业模板？'\"\r\n                    :content=\"'注意！模板下关联的所有执行方案也将被清除'\"\r\n                    :confirm-handler=\"handleDelete\">\r\n                    <auth-button\r\n                        class=\"delete-btn\"\r\n                        :resource-id=\"taskId\"\r\n                        auth=\"job_template/delete\"\r\n                        v-test=\"{ type: 'button', value: 'deleteTemplate' }\">\r\n                        {{ '删除' }}\r\n                    </auth-button>\r\n                </jb-popover-confirm>\r\n            </div>\r\n        </template>\r\n        <element-teleport v-if=\"formData.name\">\r\n            <div style=\"font-size: 12px; color: #63656e;\">（{{ formData.name }}）</div>\r\n        </element-teleport>\r\n        <back-top />\r\n    </smart-action>\r\n</template>\r\n<script>\r\n    import _ from 'lodash';\r\n       import TaskManageService from '@service/task-manage';\r\n    import TaskPlanService from '@service/task-plan';\r\n    import { taskTemplateName } from '@utils/validator';\r\n    import DetailLayout from '@components/detail-layout';\r\n    import DetailItem from '@components/detail-layout/item';\r\n    import BackTop from '@components/back-top';\r\n    import JbEditInput from '@components/jb-edit/input';\r\n    import JbEditTag from '@components/jb-edit/tag';\r\n    import JbEditTextarea from '@components/jb-edit/textarea';\r\n    import JbPopoverConfirm from '@components/jb-popover-confirm';\r\n    import RenderGlobalVar from '../common/render-global-var';\r\n    import RenderTaskStep from '../common/render-task-step';\r\n\r\n    const getDefaultData = () => ({\r\n        createTime: '',\r\n        creator: '',\r\n        description: '',\r\n        favored: false,\r\n        id: 0,\r\n        lastModifyTime: '',\r\n        lastModifyUser: '',\r\n        name: '',\r\n        needUpdate: false,\r\n        status: 0,\r\n        stepList: [{},{},{}],\r\n        tags: [],\r\n        variables: [],\r\n    });\r\n    export default {\r\n        name: 'TemplateDetail',\r\n        components: {\r\n            DetailLayout,\r\n            DetailItem,\r\n            BackTop,\r\n            RenderGlobalVar,\r\n            RenderTaskStep,\r\n            JbEditInput,\r\n            JbEditTag,\r\n            JbEditTextarea,\r\n            JbPopoverConfirm,\r\n        },\r\n        data () {\r\n            return {\r\n                isLoading: true,\r\n                isPlanListLoading: true,\r\n                formData: getDefaultData(),\r\n                planList: [{},{},{}],\r\n                deleteLoading: false,\r\n            };\r\n        },\r\n        computed: {\r\n            isSkeletonLoading () {\r\n                return this.isLoading;\r\n            },\r\n            /**\r\n             * @desc 模板关联的执行方案是否需要同步\r\n             * @returns { Boolean }\r\n             */\r\n            isNotNeedUpdate () {\r\n                return !this.planList.some(_ => _.needUpdate);\r\n            },\r\n            /**\r\n             * @desc 模板关联的执行方案同步 tips\r\n             * @returns { Boolean }\r\n             */\r\n            notNeedUpdateTips () {\r\n                if (this.planList.length < 1) {\r\n                    return '该模板下面没有执行方案';\r\n                }\r\n                if (this.planList.every(_ => !_.needUpdate)) {\r\n                    return '该模板下面的所有执行方案已是最新版';\r\n                }\r\n                return '';\r\n            },\r\n        },\r\n        created () {\r\n            this.taskId = this.$route.params.id;\r\n            // 是否默认显示需要更新脚本的执行脚本步骤\r\n            this.initShowScriptUpdateStep = this.$route.query.mode === 'scriptUpdate';\r\n            this.formDataLocal = {};\r\n\r\n            this.fetchData();\r\n            this.fetchPlanList();\r\n            \r\n            this.rules = {\r\n                name: [\r\n                    {\r\n                        required: true,\r\n                        message: '模板名称必填',\r\n                        trigger: 'blur',\r\n                    },\r\n                    {\r\n                        validator: taskTemplateName.validator,\r\n                        message: taskTemplateName.message,\r\n                        trigger: 'blur',\r\n                    },\r\n                    {\r\n                        validator: this.checkName,\r\n                        message: '模板名称已存在，请重新输入',\r\n                        trigger: 'blur',\r\n                    },\r\n                ],\r\n            };\r\n        },\r\n        methods: {\r\n            /**\r\n             * @desc 获取作业模板详情\r\n             * @param {Boolean} refresh 更新元数据重新获取\r\n             */\r\n            fetchData (refresh = false) {\r\n                TaskManageService.taskDetail({\r\n                    id: this.taskId,\r\n                }, {\r\n                    permission: 'page',\r\n                })\r\n                    .then((data) => {\r\n                        if (refresh) {\r\n                            // 编辑（name, description, tags）导致的更新，只更新元数据\r\n                            const { name, description, tags } = data;\r\n                            this.formData.name = name;\r\n                            this.formData.description = description;\r\n                            this.formData.tags = tags;\r\n                            this.formDataLocal = data;\r\n                        } else {\r\n                            this.formData = data;\r\n                            this.formDataLocal = { ...data };\r\n                            // 查看脚本更新模式，执行脚本步骤的脚本有更新或者禁用默认展示第一个脚本步骤详情\r\n                            if (this.initShowScriptUpdateStep) {\r\n                                setTimeout(() => {\r\n                                    const { stepList } = data;\r\n                                    const index = _.findIndex(stepList, step => step.isScriptDisabled\r\n                                        || step.isScriptNeedUpdate);\r\n                                    if (index > -1) {\r\n                                        this.$refs.step.clickStepByIndex(index);\r\n                                    }\r\n                                });\r\n                            }\r\n                        }\r\n                    })\r\n                    .catch((error) => {\r\n                        if ([\r\n                            1,\r\n                            400,\r\n                        ].includes(error.code)) {\r\n                            setTimeout(() => {\r\n                                this.$router.push({\r\n                                    name: 'taskList',\r\n                                });\r\n                            }, 3000);\r\n                        }\r\n                    })\r\n                    .finally(() => {\r\n                        this.isLoading = false;\r\n                    });\r\n            },\r\n            /**\r\n             * @desc 获取作业模板关联的执行方案列表\r\n             */\r\n            fetchPlanList () {\r\n                this.isPlanListLoading = true;\r\n                TaskPlanService.fetchTaskPlan({\r\n                    id: this.taskId,\r\n                }).then((data) => {\r\n                    this.planList = Object.freeze(data);\r\n                })\r\n                    .finally(() => {\r\n                        this.isPlanListLoading = false;\r\n                    });\r\n            },\r\n            /**\r\n             * @desc 检测作业模板名是否存在\r\n             */\r\n            checkName (name) {\r\n                return TaskManageService.taskCheckName({\r\n                    id: this.taskId,\r\n                    name,\r\n                });\r\n            },\r\n            /**\r\n             * @desc 更新作业模板元数据\r\n             * @param {Object} payload 将要更新的字段名和值\r\n             */\r\n            handleUpdateTemplate (payload) {\r\n                const { name, description, tags } = this.formDataLocal;\r\n                return TaskManageService.taskUpdateBasic({\r\n                    id: this.taskId,\r\n                    name,\r\n                    description,\r\n                    tags,\r\n                    ...payload,\r\n                }).then(() => {\r\n                    this.fetchData(true);\r\n                });\r\n            },\r\n            /**\r\n             * @desc 执行执行方案\r\n             */\r\n            handleGoExec () {\r\n                this.$router.push({\r\n                    name: 'viewPlan',\r\n                    params: {\r\n                        templateId: this.taskId,\r\n                    },\r\n                    query: {\r\n                        from: 'templateDetail',\r\n                    },\r\n                });\r\n            },\r\n            /**\r\n             * @desc 调试执行方案\r\n             */\r\n            handleGoDebug () {\r\n                this.$router.push({\r\n                    name: 'debugPlan',\r\n                    params: {\r\n                        id: this.taskId,\r\n                    },\r\n                    query: {\r\n                        from: 'templateDetail',\r\n                    },\r\n                });\r\n            },\r\n            /**\r\n             * @desc 同步执行方案\r\n             */\r\n            handleGoSyncPlan () {\r\n                this.$router.push({\r\n                    name: 'syncPlanBatch',\r\n                    query: {\r\n                        planIds: this.planList.map(_ => _.id).join(','),\r\n                        from: 'templateDetail',\r\n                    },\r\n                });\r\n            },\r\n            /**\r\n             * @desc 编辑作业模板\r\n             */\r\n            handleGoEdit () {\r\n                this.$router.push({\r\n                    name: 'templateEdit',\r\n                    params: {\r\n                        id: this.taskId,\r\n                    },\r\n                    query: {\r\n                        from: 'templateDetail',\r\n                    },\r\n                });\r\n            },\r\n            /**\r\n             * @desc 删除作业模板，然后路由回退\r\n             */\r\n            handleDelete () {\r\n                return TaskManageService.taskDelete({\r\n                    id: this.taskId,\r\n                }).then(() => {\r\n                    this.routerBack();\r\n                    return true;\r\n                });\r\n            },\r\n            /**\r\n             * @desc 路由回退\r\n             */\r\n            routerBack () {\r\n                this.$router.push({\r\n                    name: 'taskList',\r\n                });\r\n            },\r\n        },\r\n    };\r\n</script>\r\n<style lang='postcss'>\r\n    @import \"@/css/mixins/media\";\r\n\r\n    .task-template-detail {\r\n        .task-template-detail-layout {\r\n            margin-bottom: 30px;\r\n        }\r\n\r\n        .detail-item {\r\n            justify-content: flex-start;\r\n            margin-bottom: 8px;\r\n\r\n            .label {\r\n                width: 76px;\r\n            }\r\n        }\r\n\r\n        .gloval-var-item {\r\n            margin-top: 20px;\r\n            margin-bottom: 30px;\r\n        }\r\n\r\n        .task-step-item {\r\n            margin-bottom: 20px;\r\n        }\r\n\r\n        .input,\r\n        .action-box {\r\n            width: 500px;\r\n\r\n            @media (--small-viewports) {\r\n                width: 500px;\r\n            }\r\n\r\n            @media (--medium-viewports) {\r\n                width: 560px;\r\n            }\r\n\r\n            @media (--large-viewports) {\r\n                width: 620px;\r\n            }\r\n\r\n            @media (--huge-viewports) {\r\n                width: 680px;\r\n            }\r\n        }\r\n\r\n        .action-box {\r\n            display: flex;\r\n        }\r\n\r\n        .action-button {\r\n            margin-right: 10px;\r\n        }\r\n\r\n        .action-del {\r\n            margin-left: auto;\r\n        }\r\n\r\n        .action-sync {\r\n            position: relative;\r\n\r\n            .update-flag {\r\n                position: absolute;\r\n                top: -9px;\r\n                right: -9px;\r\n                font-size: 16px;\r\n                line-height: 0;\r\n                color: #ea3636;\r\n                background: #fff;\r\n                border: 1px solid #fff;\r\n                border-radius: 50%;\r\n            }\r\n        }\r\n\r\n        .delete-btn {\r\n            &:hover {\r\n                color: #fff;\r\n                background: #ea3636;\r\n                border-color: transparent;\r\n            }\r\n        }\r\n    }\r\n</style>\r\n","var render = function () {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n  return _c(\n    \"smart-action\",\n    {\n      staticClass: \"task-template-detail\",\n      attrs: { \"offset-target\": \"detail-content\" },\n      scopedSlots: _vm._u([\n        {\n          key: \"action\",\n          fn: function () {\n            return [\n              _c(\n                \"div\",\n                { staticClass: \"action-box\" },\n                [\n                  _c(\n                    \"bk-button\",\n                    {\n                      directives: [\n                        {\n                          name: \"test\",\n                          rawName: \"v-test\",\n                          value: { type: \"button\", value: \"planList\" },\n                          expression: \"{ type: 'button', value: 'planList' }\",\n                        },\n                      ],\n                      staticClass: \"w120 mr10\",\n                      attrs: { theme: \"primary\" },\n                      on: { click: _vm.handleGoExec },\n                    },\n                    [\n                      _vm._v(\n                        \"\\n                \" +\n                          _vm._s(\"选择方案\") +\n                          \"\\n            \"\n                      ),\n                    ]\n                  ),\n                  _vm._v(\" \"),\n                  _c(\n                    \"auth-button\",\n                    {\n                      directives: [\n                        {\n                          name: \"test\",\n                          rawName: \"v-test\",\n                          value: { type: \"button\", value: \"debugTemplate\" },\n                          expression:\n                            \"{ type: 'button', value: 'debugTemplate' }\",\n                        },\n                      ],\n                      staticClass: \"mr10\",\n                      attrs: {\n                        \"resource-id\": _vm.taskId,\n                        auth: \"job_template/debug\",\n                      },\n                      on: { click: _vm.handleGoDebug },\n                    },\n                    [\n                      _vm._v(\n                        \"\\n                \" + _vm._s(\"调试\") + \"\\n            \"\n                      ),\n                    ]\n                  ),\n                  _vm._v(\" \"),\n                  _c(\n                    \"auth-button\",\n                    {\n                      directives: [\n                        {\n                          name: \"test\",\n                          rawName: \"v-test\",\n                          value: { type: \"button\", value: \"editTemplate\" },\n                          expression:\n                            \"{ type: 'button', value: 'editTemplate' }\",\n                        },\n                      ],\n                      staticClass: \"mr10\",\n                      attrs: {\n                        \"resource-id\": _vm.taskId,\n                        auth: \"job_template/edit\",\n                      },\n                      on: { click: _vm.handleGoEdit },\n                    },\n                    [\n                      _vm._v(\n                        \"\\n                \" + _vm._s(\"编辑\") + \"\\n            \"\n                      ),\n                    ]\n                  ),\n                  _vm._v(\" \"),\n                  _c(\n                    \"span\",\n                    {\n                      directives: [\n                        {\n                          name: \"bk-tooltips\",\n                          rawName: \"v-bk-tooltips\",\n                          value: _vm.notNeedUpdateTips,\n                          expression: \"notNeedUpdateTips\",\n                        },\n                      ],\n                    },\n                    [\n                      _c(\n                        \"bk-button\",\n                        {\n                          directives: [\n                            {\n                              name: \"test\",\n                              rawName: \"v-test\",\n                              value: { type: \"button\", value: \"syncPlan\" },\n                              expression:\n                                \"{ type: 'button', value: 'syncPlan' }\",\n                            },\n                          ],\n                          staticClass: \"action-sync mr10\",\n                          attrs: { loading: _vm.isPlanListLoading },\n                          on: { click: _vm.handleGoSyncPlan },\n                        },\n                        [\n                          _vm._v(\n                            \"\\n                    \" +\n                              _vm._s(\"同步方案\") +\n                              \"\\n                    \"\n                          ),\n                          !_vm.isNotNeedUpdate\n                            ? _c(\n                                \"div\",\n                                {\n                                  directives: [\n                                    {\n                                      name: \"bk-tooltips\",\n                                      rawName: \"v-bk-tooltips\",\n                                      value: \"待同步\",\n                                      expression: \"'待同步'\",\n                                    },\n                                  ],\n                                  staticClass: \"update-flag\",\n                                },\n                                [_c(\"Icon\", { attrs: { type: \"sync-8\" } })],\n                                1\n                              )\n                            : _vm._e(),\n                        ]\n                      ),\n                    ],\n                    1\n                  ),\n                  _vm._v(\" \"),\n                  _c(\n                    \"jb-popover-confirm\",\n                    {\n                      staticClass: \"action-del\",\n                      attrs: {\n                        title: \"确定删除该作业模板？\",\n                        content: \"注意！模板下关联的所有执行方案也将被清除\",\n                        \"confirm-handler\": _vm.handleDelete,\n                      },\n                    },\n                    [\n                      _c(\n                        \"auth-button\",\n                        {\n                          directives: [\n                            {\n                              name: \"test\",\n                              rawName: \"v-test\",\n                              value: {\n                                type: \"button\",\n                                value: \"deleteTemplate\",\n                              },\n                              expression:\n                                \"{ type: 'button', value: 'deleteTemplate' }\",\n                            },\n                          ],\n                          staticClass: \"delete-btn\",\n                          attrs: {\n                            \"resource-id\": _vm.taskId,\n                            auth: \"job_template/delete\",\n                          },\n                        },\n                        [\n                          _vm._v(\n                            \"\\n                    \" +\n                              _vm._s(\"删除\") +\n                              \"\\n                \"\n                          ),\n                        ]\n                      ),\n                    ],\n                    1\n                  ),\n                ],\n                1\n              ),\n            ]\n          },\n          proxy: true,\n        },\n      ]),\n    },\n    [\n      _c(\n        \"detail-layout\",\n        { staticClass: \"task-template-detail-layout\", attrs: { mode: \"see\" } },\n        [\n          _c(\n            \"detail-item\",\n            { attrs: { label: \"模板名称：\" } },\n            [\n              _c(\n                \"auth-component\",\n                {\n                  attrs: {\n                    auth: \"job_template/edit\",\n                    \"resource-id\": _vm.taskId,\n                  },\n                },\n                [\n                  _c(\"jb-edit-input\", {\n                    staticClass: \"input\",\n                    attrs: {\n                      field: \"name\",\n                      value: _vm.formData.name,\n                      rules: _vm.rules.name,\n                      \"remote-hander\": _vm.handleUpdateTemplate,\n                    },\n                  }),\n                  _vm._v(\" \"),\n                  _c(\"div\", { attrs: { slot: \"forbid\" }, slot: \"forbid\" }, [\n                    _vm._v(_vm._s(_vm.formData.name)),\n                  ]),\n                ],\n                1\n              ),\n            ],\n            1\n          ),\n          _vm._v(\" \"),\n          _c(\n            \"detail-item\",\n            { attrs: { label: \"场景标签：\" } },\n            [\n              _c(\n                \"auth-component\",\n                {\n                  attrs: {\n                    auth: \"job_template/edit\",\n                    \"resource-id\": _vm.taskId,\n                  },\n                },\n                [\n                  _c(\"jb-edit-tag\", {\n                    staticClass: \"input\",\n                    attrs: {\n                      field: \"tags\",\n                      value: _vm.formData.tags,\n                      \"remote-hander\": _vm.handleUpdateTemplate,\n                    },\n                  }),\n                  _vm._v(\" \"),\n                  _c(\"div\", { attrs: { slot: \"forbid\" }, slot: \"forbid\" }, [\n                    _vm._v(_vm._s(_vm.formData.tagText)),\n                  ]),\n                ],\n                1\n              ),\n            ],\n            1\n          ),\n          _vm._v(\" \"),\n          _c(\n            \"detail-item\",\n            { attrs: { label: \"模板描述：\" } },\n            [\n              _c(\n                \"auth-component\",\n                {\n                  attrs: {\n                    auth: \"job_template/edit\",\n                    \"resource-id\": _vm.taskId,\n                  },\n                },\n                [\n                  _c(\"jb-edit-textarea\", {\n                    staticClass: \"input\",\n                    attrs: {\n                      field: \"description\",\n                      placeholder: \"填写该模板的功能介绍等详细描述...\",\n                      maxlength: 500,\n                      value: _vm.formData.description,\n                      \"remote-hander\": _vm.handleUpdateTemplate,\n                    },\n                  }),\n                  _vm._v(\" \"),\n                  _c(\"div\", { attrs: { slot: \"forbid\" }, slot: \"forbid\" }, [\n                    _vm._v(_vm._s(_vm.formData.description || \"--\")),\n                  ]),\n                ],\n                1\n              ),\n            ],\n            1\n          ),\n          _vm._v(\" \"),\n          _c(\n            \"detail-item\",\n            { staticClass: \"gloval-var-item\", attrs: { label: \"全局变量：\" } },\n            [\n              _c(\"render-global-var\", {\n                attrs: { list: _vm.formData.variables },\n              }),\n            ],\n            1\n          ),\n          _vm._v(\" \"),\n          _c(\n            \"detail-item\",\n            { staticClass: \"task-step-item\", attrs: { label: \"作业步骤：\" } },\n            [\n              _c(\"render-task-step\", {\n                ref: \"step\",\n                attrs: {\n                  list: _vm.formData.stepList,\n                  variable: _vm.formData.variables,\n                },\n              }),\n            ],\n            1\n          ),\n        ],\n        1\n      ),\n      _vm._v(\" \"),\n      _vm._v(\" \"),\n      _vm.formData.name\n        ? _c(\"element-teleport\", [\n            _c(\n              \"div\",\n              { staticStyle: { \"font-size\": \"12px\", color: \"#63656e\" } },\n              [_vm._v(\"（\" + _vm._s(_vm.formData.name) + \"）\")]\n            ),\n          ])\n        : _vm._e(),\n      _vm._v(\" \"),\n      _c(\"back-top\"),\n    ],\n    1\n  )\n}\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns }","import mod from \"-!../../../../node_modules/_babel-loader@8.2.5@babel-loader/lib/index.js??clonedRuleSet-1[0].rules[0].use[0]!../../../../node_modules/_vue-loader@15.9.8@vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../node_modules/_babel-loader@8.2.5@babel-loader/lib/index.js??clonedRuleSet-1[0].rules[0].use[0]!../../../../node_modules/_vue-loader@15.9.8@vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./index.vue?vue&type=template&id=69f3acfb&\"\nimport script from \"./index.vue?vue&type=script&lang=js&\"\nexport * from \"./index.vue?vue&type=script&lang=js&\"\nimport style0 from \"./index.vue?vue&type=style&index=0&lang=postcss&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../node_modules/_vue-loader@15.9.8@vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\n/* hot reload */\nif (module.hot) {\n  var api = require(\"D:\\\\Desktop\\\\bk-job-frontend\\\\node_modules\\\\_vue-hot-reload-api@2.3.4@vue-hot-reload-api\\\\dist\\\\index.js\")\n  api.install(require('vue'))\n  if (api.compatible) {\n    module.hot.accept()\n    if (!api.isRecorded('69f3acfb')) {\n      api.createRecord('69f3acfb', component.options)\n    } else {\n      api.reload('69f3acfb', component.options)\n    }\n    module.hot.accept(\"./index.vue?vue&type=template&id=69f3acfb&\", function () {\n      api.rerender('69f3acfb', {\n        render: render,\n        staticRenderFns: staticRenderFns\n      })\n    })\n  }\n}\ncomponent.options.__file = \"src/views/task-manage/template-detail/index.vue\"\nexport default component.exports","// style-loader: Adds some css to the DOM by adding a <style> tag\n\n// load the styles\nvar content = require(\"!!../../../../node_modules/_mini-css-extract-plugin@2.6.0@mini-css-extract-plugin/dist/loader.js??clonedRuleSet-3[0].rules[0].use[1]!../../../../node_modules/_css-loader@6.7.1@css-loader/dist/cjs.js??clonedRuleSet-3[0].rules[0].use[2]!../../../../node_modules/_vue-loader@15.9.8@vue-loader/lib/loaders/stylePostLoader.js!../../../../node_modules/_postcss-loader@6.2.1@postcss-loader/dist/cjs.js!../../../../node_modules/_vue-loader@15.9.8@vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=style&index=0&lang=postcss&\");\nif(content.__esModule) content = content.default;\nif(typeof content === 'string') content = [[module.id, content, '']];\nif(content.locals) module.exports = content.locals;\n// add the styles to the DOM\nvar add = require(\"!../../../../node_modules/_vue-style-loader@4.1.3@vue-style-loader/lib/addStylesClient.js\").default\nvar update = add(\"01dacf59\", content, false, {});\n// Hot Module Replacement\nif(module.hot) {\n // When the styles change, update the <style> tags\n if(!content.locals) {\n   module.hot.accept(\"!!../../../../node_modules/_mini-css-extract-plugin@2.6.0@mini-css-extract-plugin/dist/loader.js??clonedRuleSet-3[0].rules[0].use[1]!../../../../node_modules/_css-loader@6.7.1@css-loader/dist/cjs.js??clonedRuleSet-3[0].rules[0].use[2]!../../../../node_modules/_vue-loader@15.9.8@vue-loader/lib/loaders/stylePostLoader.js!../../../../node_modules/_postcss-loader@6.2.1@postcss-loader/dist/cjs.js!../../../../node_modules/_vue-loader@15.9.8@vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=style&index=0&lang=postcss&\", function() {\n     var newContent = require(\"!!../../../../node_modules/_mini-css-extract-plugin@2.6.0@mini-css-extract-plugin/dist/loader.js??clonedRuleSet-3[0].rules[0].use[1]!../../../../node_modules/_css-loader@6.7.1@css-loader/dist/cjs.js??clonedRuleSet-3[0].rules[0].use[2]!../../../../node_modules/_vue-loader@15.9.8@vue-loader/lib/loaders/stylePostLoader.js!../../../../node_modules/_postcss-loader@6.2.1@postcss-loader/dist/cjs.js!../../../../node_modules/_vue-loader@15.9.8@vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=style&index=0&lang=postcss&\");\n     if(newContent.__esModule) newContent = newContent.default;\n     if(typeof newContent === 'string') newContent = [[module.id, newContent, '']];\n     update(newContent);\n   });\n }\n // When the module is disposed, remove the <style> tags\n module.hot.dispose(function() { update(); });\n}"],"names":["name","components","DetailLayout","DetailItem","BackTop","RenderGlobalVar","RenderTaskStep","JbEditInput","JbEditTag","JbEditTextarea","JbPopoverConfirm","data","isLoading","isPlanListLoading","createTime","creator","description","favored","id","lastModifyTime","lastModifyUser","needUpdate","status","stepList","tags","variables","planList","deleteLoading","computed","required","message","trigger","validator","methods","TaskManageService","permission","then","setTimeout","step","catch","includes","error","finally","TaskPlanService","checkName","handleUpdateTemplate","payload","params","templateId","query","from","planIds","render","_vm","this","_h","$createElement","_c","_self","staticClass","attrs","scopedSlots","_u","key","fn","directives","rawName","value","type","expression","theme","on","click","handleGoExec","_v","_s","taskId","auth","handleGoDebug","handleGoEdit","notNeedUpdateTips","loading","handleGoSyncPlan","isNotNeedUpdate","_e","title","content","handleDelete","proxy","mode","label","field","formData","rules","slot","tagText","placeholder","maxlength","list","ref","variable","staticStyle","color","_withStripped","component","options","__file","__esModule","default","module","locals","exports","add"],"sourceRoot":""}