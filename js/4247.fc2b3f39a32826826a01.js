(self.webpackChunkjob=self.webpackChunkjob||[]).push([[4247],{66641:function(e,t,n){"use strict";var a=n(70534);Object.defineProperty(t,"X",{value:!0}),t.Z=void 0,n(41336),n(59241),n(33303),n(94354),n(25910);a(n(64244));var s=n(11986),o={name:"Service",data:()=>({isLoading:!1,tableSize:"small",serviceData:[],expandRow:[],timer:null,showFirstExpandRow:!0}),computed:{isSkeletonLoading(){return this.isLoading}},created(){this.fetchData()},destroyed(){clearInterval(this.timer)},methods:{fetchData(){var e=this,t=[{},{},{}];t.length<1||(this.serviceData=Object.freeze(t),this.showFirstExpandRow&&this.expandRow.push(this.serviceData[0].name),this.serviceData.forEach((function(t){var n=0,a=0,s=0;t.instanceList.forEach((function(e){1===e.status?a+=1:-1===e.status?s+=1:0===e.status&&(n+=1)}));var o={abnormalNum:n,normalNum:a,unknownNum:s};Object.assign(t,o),e.showFirstExpandRow=!1,clearInterval(e.timer),e.timer=setInterval((function(){e.fetchData()}),3e3)})),this.isLoading=!1)},toggleRowExpansion(e){this.expandRow.includes(e.name)?this.expandRow=[]:this.expandRow=[e.name]},onBeforeExpandChange(e){var t=e.row;this.toggleRowExpansion(t)},statusHtml(e){var t="color: #aaacb5";return{0:"<span>".concat("异常",'<span style="',t,'"> #SERVICE UNAVAILABLE (503)</span></span>'),1:"<span>".concat("正常","</span>"),"-1":"<span>".concat("未知",'<span style="',t,'"> #NO MAPPING</span></span>')}[e.status]},statusIcon:e=>({0:"abnormal",1:"normal","-1":"unknown"}[e.status]),instanceTips(e){var t="";return e.abnormalNum&&(t="异常".concat(": ",e.abnormalNum)),e.unknownNum&&(t+=" ".concat("未知",": ",e.unknownNum)),e.normalNum&&(t+=" ".concat("正常",": ",e.normalNum)),{content:t,placement:"top"}},handleCopyIp(e){(0,s.execCopy)(e,"复制成功")}}};t.Z=o},61879:function(e,t,n){"use strict";var a=n(70534);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s=a(n(98913));class o extends s.default{constructor(e){super(),this.name=e.name,this.instanceList=e.instanceList,this.version=e.version||"--",this.versionConsistent=e.versionConsistent}get versionHtml(){return this.versionConsistent?"<span>".concat(this.version,"</span>"):'<i class="job-icon job-icon-script-disable" style="color: #EA3636;" svg /><span style="color: #63656E;">存在不同版本</span>'}}t.default=o},64244:function(e,t,n){"use strict";var a=n(70534);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,n(14309);var s=a(n(43179)),o=a(n(61879)),r={serviceList(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return s.default.getList(e,t).then((function(e){return e.data.map((function(e){return new o.default(e)}))}))}};t.default=r},43179:function(e,t,n){"use strict";var a=n(70534);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s=a(n(37346)),o=a(n(27819));class r extends o.default{constructor(){super(),this.module="/job-manage/web/serviceInfo"}getList(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return s.default.get("".concat(this.module,"/listAll"),{params:e,payload:t})}}var i=new r;t.default=i},8743:function(){},14247:function(e,t,n){"use strict";n.r(t),n.d(t,{__esModule:function(){return s.X},default:function(){return i}});var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:e.isLoading},expression:"{ isLoading }"}],staticClass:"service-state-info"},[n("bk-table",{attrs:{data:e.serviceData,size:e.tableSize,"row-key":"name","ext-cls":"service-table","expand-row-keys":e.expandRow},on:{"row-click":e.toggleRowExpansion}},[n("bk-table-column",{key:"expand",attrs:{type:"expand","before-expand-change":e.onBeforeExpandChange},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[n("bk-table",{attrs:{"ext-cls":"service-expand-table",data:a.instanceList,"outer-border":!1,"header-border":!1}},[n("bk-table-column",{key:"index",attrs:{width:"60",label:"序号"},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.$index;return[e._v("\n                            #"+e._s(n+1)+"\n                        ")]}}],null,!0)}),e._v(" "),n("bk-table-column",{key:"name",attrs:{prop:"name",width:"420",label:"实例名"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                            "+e._s(t.row.name)+"\n                        ")]}}],null,!0)}),e._v(" "),n("bk-table-column",{key:"version",attrs:{prop:"version",width:"310",label:"版本号"}}),e._v(" "),n("bk-table-column",{key:"status",attrs:{prop:"status",label:"状态"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("Icon",{attrs:{type:e.statusIcon(t.row),svg:""}}),e._v(" "),n("span",{domProps:{innerHTML:e._s(e.statusHtml(t.row))}})]}}],null,!0)}),e._v(" "),n("bk-table-column",{key:"ip",attrs:{prop:"ip",width:"150",label:"绑定IP"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("span",{staticClass:"service-ip",on:{click:function(n){return e.handleCopyIp(t.row.ip)}}},[e._v("\n                                "+e._s(t.row.ip)+"\n                                "),n("Icon",{staticClass:"ml5 copy-ip-icon",attrs:{type:"step-copy",svg:""}})],1)]}}],null,!0)}),e._v(" "),n("bk-table-column",{key:"port",attrs:{prop:"port",width:"100",label:"端口"}})],1)]}}])}),e._v(" "),n("bk-table-column",{key:"name",attrs:{label:"服务名",prop:"name",width:"480",align:"left"}}),e._v(" "),n("bk-table-column",{key:"version",attrs:{label:"版本号",prop:"version",width:"310",align:"left"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[n("span",{domProps:{innerHTML:e._s(a.versionHtml)}})]}}])}),e._v(" "),n("bk-table-column",{key:"instanceList",attrs:{label:"实例状态",prop:"instanceList",align:"left"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[n("div",{directives:[{name:"bk-tooltips",rawName:"v-bk-tooltips",value:e.instanceTips(a),expression:"instanceTips(row)"}]},[a.abnormalNum?n("span",{staticClass:"service-instance-num abnormal"},[e._v(e._s(a.abnormalNum))]):e._e(),e._v(" "),a.unknownNum?n("span",{staticClass:"service-instance-num unknown"},[e._v(e._s(a.unknownNum))]):e._e(),e._v(" "),a.normalNum?n("span",{staticClass:"service-instance-num normal"},[e._v(e._s(a.normalNum))]):e._e()])]}}])})],1)],1)};a._withStripped=!0;var s=n(66641),o=s.Z,r=(n(60428),(0,n(51900).Z)(o,a,[],!1,null,null,null));r.options.__file="src/views/service-state/list/index.vue";var i=r.exports},60428:function(e,t,n){var a=n(8743);a.__esModule&&(a=a.default),"string"==typeof a&&(a=[[e.id,a,""]]),a.locals&&(e.exports=a.locals);(0,n(18086).Z)("aab29dfc",a,!1,{})}}]);