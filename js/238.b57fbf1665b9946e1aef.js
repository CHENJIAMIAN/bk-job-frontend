(self.webpackChunkjob=self.webpackChunkjob||[]).push([[238],{82287:function(e,t,i){"use strict";i(35927),i(45974),i(9042),i(43364);var s=i(22696);Object.defineProperty(t,"X",{value:!0}),t.Z=void 0,i(71959),i(87033),i(35948),i(94522),i(23232),i(80433);var n=s(i(33610)),r=s(i(77094)),a=s(i(45812)),o=s(i(44068)),l=s(i(12e3)),c=s(i(86234)),d=s(i(45673)),u=i(41980),p=i(46790),h=i(61681),f=s(i(2317));function v(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,s)}return i}function m(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?v(Object(i),!0).forEach((function(t){(0,n.default)(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):v(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}var b=function(){return{id:"",typeName:"Shell",version:(0,u.genDefaultScriptVersion)(),versionDesc:"",type:1,content:""}},g={name:"",components:{JbInput:c.default,AceEditor:d.default,Layout:f.default},inheritAttrs:!1,props:{scriptInfo:{type:Object,required:!0},scriptVersionList:{type:Array,default:function(){return[]}}},data:()=>({isLoading:!0,isSubmiting:!1,formData:b(),contentHeight:0}),computed:{versionMap(){return this.scriptVersionList.reduce((function(e,t){return t.scriptVersionId<1||(e[t.version]=!0),e}),{})}},watch:{scriptInfo:{handler(e){if(e.id){var t=e.content,i=e.id,s=e.name,n=e.versionDesc,r=e.type,a=e.typeName;this.formData=m(m({},b()),{},{id:i,name:s,versionDesc:n,type:r,typeName:a,content:t})}},immediate:!0}},created(){var e=this;this.publicScript=(0,u.checkPublicScript)(this.$route),this.scriptManageServiceHandler=this.publicScript?l.default:o.default,this.rules={version:[{required:!0,message:"版本号必填",trigger:"blur"},{validator:h.scriptVersionRule.validator,message:h.scriptVersionRule.message,trigger:"blur"},{validator:function(t){return!e.versionMap[t]},message:"版本号已存在，请重新输入",trigger:"blur"}],content:[{required:!0,message:"脚本内容不能为空",trigger:"change"},{validator:function(t){return o.default.getScriptValidation({content:t,scriptType:e.formData.type}).then((function(t){return e.$store.commit("setScriptCheckError",t.some((function(e){return e.isDangerous}))),!0}))},message:"脚本内容检测失败",trigger:"blur"}]}},mounted(){this.calcContentHeight();var e=(0,a.default)(this.calcContentHeight,60);window.addEventListener("resize",e),this.$once("hook:beforeDestroy",(function(){window.removeEventListener("resize",e)}))},methods:{calcContentHeight(){var e=(0,u.getOffset)(this.$refs.content).top;this.contentHeight=window.innerHeight-e-66},handleUploadScript(){this.$refs.aceEditor.handleUploadScript()},handleShowHistory(){this.$refs.aceEditor.handleShowHistory()},handleFullScreen(){this.$refs.aceEditor.handleFullScreen()},handleVersionChange:(0,r.default)((function(e){this.formData.version=e;var t=this.scriptInfo.scriptVersionId;this.$emit("on-create-change",t,{version:e})}),100),handleTypeChange(e){this.formData.type=(0,u.formatScriptTypeValue)(e)},handleSubmit(){var e=this;this.formData.content?(this.isSubmiting=!0,Promise.all([this.$refs.form.validate(),o.default.getScriptValidation({content:this.formData.content,scriptType:this.formData.type}).then((function(t){return e.$store.commit("setScriptCheckError",t.some((function(e){return e.isDangerous}))),!0}))]).then((function(){e.$store.state.scriptCheckError?(0,u.scriptErrorAlert)():e.scriptManageServiceHandler.scriptUpdate(m({},e.formData)).then((function(t){e.$emit("on-create",{scriptVersionId:t.scriptVersionId}),window.changeAlert=!1,e.messageSuccess("操作成功")}))})).finally((function(){e.isSubmiting=!1}))):this.messageError("脚本内容不能为空")},handleDebugScript(){p.debugScriptCache.setItem(this.formData.content);var e=this.$router.resolve({name:"fastExecuteScript",query:{model:"debugScript"}}).href;window.open(e)},handleCancel(){var e=this;(0,u.leaveConfirm)().then((function(){e.$emit("on-create-cancel")}))}}};t.Z=g},87161:function(e,t,i){"use strict";i(35927),i(45974),i(9042),i(43364);var s=i(22696);Object.defineProperty(t,"X",{value:!0}),t.Z=void 0,i(87033),i(35948),i(94522),i(23232),i(80433);var n=s(i(33610)),r=s(i(45812)),a=s(i(44068)),o=s(i(12e3)),l=s(i(45673)),c=i(41980),d=i(46790),u=s(i(2317));function p(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,s)}return i}function h(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?p(Object(i),!0).forEach((function(t){(0,n.default)(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):p(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}var f={name:"",components:{AceEditor:l.default,Layout:u.default},inheritAttrs:!1,props:{scriptInfo:{type:Object,required:!0}},data:()=>({isSubmiting:!1,contentHeight:0,formData:{}}),watch:{scriptInfo:{handler(e){if(e.id){var t=e.id,i=e.name,s=e.scriptVersionId,n=e.version,r=e.versionDesc,a=e.type,o=e.typeName,l=e.content;this.formData=h(h({},{id:"",name:"",scriptVersionId:"",typeName:"Shell",version:"",versionDesc:"",type:1,content:""}),{},{id:t,name:i,scriptVersionId:s,version:n,versionDesc:r,type:a,typeName:o,content:l})}},immediate:!0}},created(){var e=this;this.publicScript=(0,c.checkPublicScript)(this.$route),this.serviceHandler=this.publicScript?o.default:a.default,this.rules={content:[{required:!0,message:"脚本内容不能为空",trigger:"change"},{validator:function(t){return a.default.getScriptValidation({content:t,scriptType:e.formData.type}).then((function(t){return e.$store.commit("setScriptCheckError",t.some((function(e){return e.isDangerous}))),!0}))},message:"脚本内容检测失败",trigger:"blur"}]},window.addEventListener("resize",this.init),this.$once("hook:beforeDestroy",(function(){window.removeEventListener("resize",e.init)}))},mounted(){this.calcContentHeight();var e=(0,r.default)(this.calcContentHeight,60);window.addEventListener("resize",e),this.$once("hook:beforeDestroy",(function(){window.removeEventListener("resize",e)}))},methods:{calcContentHeight(){var e=(0,c.getOffset)(this.$refs.content).top;this.contentHeight=window.innerHeight-e-26},handleUploadScript(){this.$refs.aceEditor.handleUploadScript()},handleShowHistory(){this.$refs.aceEditor.handleShowHistory()},handleFullScreen(){this.$refs.aceEditor.handleFullScreen()},handleSubmit(){var e=this;this.formData.content?(this.isSubmiting=!0,Promise.all([this.$refs.form.validate(),a.default.getScriptValidation({content:this.formData.content,scriptType:this.formData.type}).then((function(t){return e.$store.commit("setScriptCheckError",t.some((function(e){return e.isDangerous}))),!0}))]).then((function(){e.$store.state.scriptCheckError?(0,c.scriptErrorAlert)():e.serviceHandler.scriptUpdate(h(h({},e.formData),{},{scriptVersionId:e.scriptInfo.scriptVersionId})).then((function(){window.changeAlert=!1,e.$emit("on-edit",{scriptVersionId:e.scriptInfo.scriptVersionId}),e.messageSuccess("操作成功")}))})).finally((function(){e.isSubmiting=!1}))):this.messageError("脚本内容不能为空")},handleDebugScript(){d.debugScriptCache.setItem(this.formData.content);var e=this.$router.resolve({name:"fastExecuteScript",query:{model:"debugScript"}}).href;window.open(e)},handleCancel(){var e=this;(0,c.leaveConfirm)().then((function(){e.$emit("on-edit-cancel",{scriptVersionId:e.scriptInfo.scriptVersionId})}))}}};t.Z=f},57634:function(e,t,i){"use strict";var s=i(22696);Object.defineProperty(t,"X",{value:!0}),t.Z=void 0,i(57024),i(30254),i(87033),i(9042);var n=s(i(93435)),r=i(1064),a={props:{data:{type:Array,required:!0},title:{type:String,default:""},oldVersionId:{type:Number,required:!0},newVersionId:{type:Number,required:!0}},data(){return{oldVersion:this.oldVersionId,newVersion:this.newVersionId,zIndex:"auto",del:0,ins:0,change:0}},computed:{language(){return this.data.length<1?"":this.data[0].typeName.toLocaleLowerCase()},oldContent(){var e=this,t=(0,n.default)(this.data,(function(t){return t.scriptVersionId===e.oldVersion}));return t?r.Base64.decode(t.content):""},newContent(){var e=this,t=(0,n.default)(this.data,(function(t){return t.scriptVersionId===e.newVersion}));return t?r.Base64.decode(t.content):""}},watch:{oldContent(){this.statisticsDiff()},newContent(){this.statisticsDiff()}},created(){this.scrollTopMemo=0,this.insElements=[],this.insIndex=0,this.delElements=[],this.delIndex=0,this.changeElements=[],this.changeIndex=0},mounted(){var e=this;this.zIndex=window.__bk_zIndex_manager.nextZIndex(),document.body.append(this.$el),window.addEventListener("keydown",this.handleEsc),this.resetBodyStyle(),this.statisticsDiff(),this.$once("hook:beforeDestroy",(function(){window.removeEventListener("keydown",e.handleEsc);try{document.body.removeChild(e.$el)}catch(e){}}))},methods:{statisticsDiff(){var e=this;this.$nextTick((function(){var t=e.$refs.diff.$el.querySelectorAll(".d2h-file-side-diff")[1],i=Array.from(t.querySelectorAll("td.d2h-code-side-linenumber.d2h-ins"));i.pop(),e.insElements=[],e.ins=0,e.insIndex=0,e.changeElements=[],e.change=0,e.changeIndex=0,i.forEach((function(t){t.classList.contains("d2h-change")?(e.changeElements.push(t),e.change+=1):(e.insElements.push(t),e.ins+=1)}));var s=t.querySelectorAll("td.d2h-code-side-linenumber.d2h-code-side-emptyplaceholder");e.delElements=s,e.del=s.length,e.delIndex=0,e.lineElements=t.querySelectorAll("td.d2h-code-side-linenumber")}))},lineViewReset(){this.lineElements.forEach((function(e){e.classList.remove("active")}))},handleViewDel(){if(this.lineViewReset(),!(this.del<1)){var e=this.delElements[this.delIndex];e.scrollIntoView(),e.classList.add("active"),this.changeIndex=0,this.insIndex=0,this.delIndex+=1,this.delIndex>=this.del&&(this.delIndex=0)}},handleViewChange(){if(this.lineViewReset(),!(this.change<1)){var e=this.changeElements[this.changeIndex];e.scrollIntoView(),e.classList.add("active"),this.insIndex=0,this.delIndex=0,this.changeIndex+=1,this.changeIndex>=this.change&&(this.changeIndex=0)}},handleViewIns(){if(this.lineViewReset(),!(this.ins<1)){var e=this.insElements[this.insIndex];e.scrollIntoView(),e.classList.add("active"),this.delIndex=0,this.changeIndex=0,this.insIndex+=1,this.insIndex>=this.ins&&(this.insIndex=0)}},handleEsc(e){e&&"Escape"===e.code&&this.handleClose()},handleClose(){this.$emit("on-change",{[this.oldVersion]:!0,[this.newVersion]:!0}),this.$emit("close")},resetBodyStyle(){this.scrollTopMemo=document.scrollingElement.scrollTop,document.scrollingElement.style.overflow="hidden"},recoveryBodyStyle(){document.scrollingElement.style.overflow="initial",document.scrollingElement.scrollTop=this.scrollTopMemo}}};t.Z=a},39902:function(e,t,i){"use strict";Object.defineProperty(t,"X",{value:!0}),t.Z=void 0;var s=i(41980),n={name:"",props:{flod:{type:Boolean,default:!1}},data:()=>({isShowRight:!1,isOpen:!1,layoutWidth:"auto",layoutOffsetTop:0}),computed:{styles(){return this.flod?{width:"360px"}:{width:this.layoutWidth}},rightStyles(){return{height:"calc(100vh -  ".concat(this.layoutOffsetTop+20,"px)")}}},watch:{flod:{handler(e){var t=this;e?setTimeout((function(){t.isShowRight=e}),110):this.isShowRight=!1},immediate:!0}},mounted(){var e=this;this.init(),window.addEventListener("resize",this.init),this.$once("hook:beforeDestroy",(function(){window.removeEventListener("resize",e.init)}))},methods:{init(){var e=this.$refs.layout.getBoundingClientRect().width;this.layoutWidth="".concat(e,"px");var t=(0,s.getOffset)(this.$refs.layout).top;this.layoutOffsetTop=t},handleToggle(){this.isOpen=!this.isOpen},handleClose(){var e=this;(0,s.leaveConfirm)().then((function(){e.isOpen=!1,e.$emit("on-flod"),e.$emit("update:flod",!1)}))}}};t.Z=n},76824:function(e,t,i){"use strict";var s=i(22696);Object.defineProperty(t,"X",{value:!0}),t.Z=void 0;var n=s(i(93435)),r={name:"",props:{versionList:{type:Array,require:!0}},data:()=>({renderList:[{},{},{}],formData:{scriptVersionId:""}}),watch:{versionList:{handler(e){this.renderList=Object.freeze(e),this.formData.scriptVersionId=""},immediate:!0}},created(){this.rules={scriptVersionId:[{required:!0,message:"脚本版本必填",trigger:"blur"}]}},methods:{submit(){var e=this;return this.$refs.form.validate().then((function(){var t=(0,n.default)(e.renderList,(function(t){return t.scriptVersionId===e.formData.scriptVersionId}));e.$emit("on-create",t)}))},reset(){this.formData.scriptVersionId="",this.$refs.form.clearError()}}};t.Z=r},63665:function(e,t,i){"use strict";i(35927),i(45974),i(43364);var s=i(22696);Object.defineProperty(t,"X",{value:!0}),t.Z=void 0;var n=s(i(33610));i(87033),i(35948),i(94522),i(9042);var r=s(i(44068)),a=s(i(12e3)),o=i(41980),l=s(i(36894)),c=s(i(53823)),d=s(i(28877));function u(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,s)}return i}function p(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?u(Object(i),!0).forEach((function(t){(0,n.default)(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):u(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}var h={name:"",components:{JbEditInput:l.default,JbEditTag:c.default,JbEditTextarea:d.default},data:()=>({isLoading:!0,data:{}}),created(){this.publicScript=(0,o.checkPublicScript)(this.$route),this.serviceHandler=this.publicScript?a.default:r.default,this.scriptId=this.$route.params.id,this.fetchScriptBasic()},methods:{fetchScriptBasic(){var e=this;this.isLoading=!0,this.serviceHandler.fetchBasicInfo({id:this.scriptId}).then((function(t){e.data=Object.freeze(t),e.calcLableWidth()})).finally((function(){e.isLoading=!1}))},calcLableWidth(){this.$refs.wraper.querySelectorAll(".detail-column").forEach((function(e){var t=e.querySelectorAll(".item-label"),i=0;t.forEach((function(e){var t=e.getBoundingClientRect().width;i=Math.max(i,t)})),t.forEach((function(e){e.style.width="".concat(i+2,"px")}))}))},handleUpdateScript(e,t){return this.serviceHandler.scriptUpdateMeta(p(p({id:this.scriptId},t),{},{updateField:e}))}}};t.Z=h},65386:function(e,t,i){"use strict";i(35927),i(43364);var s=i(22696);Object.defineProperty(t,"X",{value:!0}),t.Z=void 0,i(23232),i(80433),i(85604),i(71959),i(87033),i(35948),i(94522),i(9042),i(56259),i(63762),i(95179),i(45974),i(47140),i(92974);var n=s(i(33610)),r=s(i(93435)),a=s(i(5068)),o=s(i(44068)),l=s(i(12e3)),c=s(i(46117)),d=s(i(68830)),u=s(i(2645)),p=s(i(80712)),h=s(i(93962)),f=i(41980),v=i(46790),m=s(i(78621)),b=s(i(98336)),g=s(i(65540)),y=s(i(45874)),w=s(i(16410)),_=s(i(23044)),C=s(i(66966)),S=s(i(49824));function I(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,s)}return i}function k(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?I(Object(i),!0).forEach((function(t){(0,n.default)(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):I(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}var V="script_version_list_columns",D={name:"ScriptVersion",components:{ListActionLayout:p.default,JbPopoverConfirm:h.default,JbSearchSelect:u.default,ScriptRelatedInfo:m.default,Diff:C.default,Layout:w.default,DetailScript:b.default,Edit:g.default,CopyCreate:y.default,ScriptBasic:_.default,NewVersion:S.default},data:()=>({isLoading:!1,isListFlod:!1,isShowNewVersion:!1,showDiff:!1,data:[{},{},{}],dataAppendList:[{},{},{}],scriptDetailInfo:{},tableHeight:"",selectedTableColumn:[],selectVersionId:"",choosedMap:{},showRelated:!1,relatedScriptInfo:[],displayCom:"",tableSize:"small"}),computed:{isSkeletonLoading(){return this.isLoading},curCom(){return this.displayCom?{detail:b.default,edit:g.default,copyCreate:y.default}[this.displayCom]:"div"},renderList(){return[...this.dataAppendList,...this.data]},isCopyCreateDisabled(){return!!(0,r.default)(this.dataMemo,(function(e){return e.isDraft}))},selectVersion(){var e=this,t=(0,r.default)(this.renderList,(function(t){return t.scriptVersionId===e.selectVersionId}));return t||{}},disableDiff(){return Object.keys(this.choosedMap).length<2},diffInfo(){var e=Object.keys(this.choosedMap);return{oldVersionId:parseInt(e[0],10)||"",newVersionId:parseInt(e[1],10)||""}},currentVersionName(){return this.dataMemo.length<1?"":this.dataMemo[0].name},allColumnMap(){return this.isListFlod?{version:!0,statusDesc:!0}:this.selectedTableColumn.reduce((function(e,t){return e[t.id]=!0,e}),{})}},watch:{displayCom(e){"copyCreate"!==e&&(this.dataAppendList=[])}},created(){this.lastSelectScriptVersionId="",this.dataMemo=[],this.publicScript=(0,f.checkPublicScript)(this.$route),this.serviceHandler=this.publicScript?l.default:o.default,this.scriptId=this.$route.params.id,this.fetchData(!0),this.searchSelect=[{name:"版本号",id:"version",default:!0},{name:"更新人",id:"lastModifyUser",remoteMethod:c.default.fetchUsersOfSearch,inputInclude:!0}],this.tableColumn=[{id:"scriptVersionId",label:"版本 ID"},{id:"version",label:"版本号",disabled:!0},{id:"relatedTaskNum",label:"被引用",disabled:!0},{id:"lastModifyUser",label:"更新人"},{id:"lastModifyTime",label:"更新时间"},{id:"statusDesc",label:"状态",disabled:!0}];var e=v.listColumnsCache.getItem(V);e?(this.selectedTableColumn=Object.freeze(e.columns),this.tableSize=e.size):this.selectedTableColumn=Object.freeze([{id:"version"},{id:"relatedTaskNum"},{id:"lastModifyUser"},{id:"lastModifyTime"},{id:"statusDesc"}])},mounted(){var e=this;this.calcTableHeight(),window.addEventListener("resize",this.calcTableHeight),this.$once("hook:beforeDestroy",(function(){window.removeEventListener("resize",e.calcTableHeight)}))},methods:{fetchData(e){var t=this;return this.isLoading=!0,this.serviceHandler.scriptVersionList({id:this.scriptId},{permission:"page"}).then((function(i){t.dataMemo=Object.freeze([...i]),t.data=Object.freeze(i),e&&t.parseUrl()})).finally((function(){t.isLoading=!1}))},parseUrl(){var e=parseInt(this.$route.query.scriptVersionId,10);e&&this.handleShowDetail({scriptVersionId:e})},calcTableHeight(){var e=(0,f.getOffset)(this.$refs.list).top,t=window.innerHeight;this.tableHeight=t-e-20},rowClassName(e){return e.row.scriptVersionId===this.selectVersionId?"active":""},handlNewVersion(){var e=this;this.isCopyCreateDisabled?(this.newVersionPopperInstance||(this.newVersionPopperInstance=(0,a.default)(this.$refs.newVersion.$el,{arrow:!0,width:192,placement:"bottom-start",trigger:"manual",theme:"light",interactive:!0,animation:"slide-toggle",content:document.querySelector("#newVersionDisableActions"),boundary:"window",distance:20,zIndex:window.__bk_zIndex_manager.nextZIndex()}),this.$once("hook:beforeDestroy",(function(){e.newVersionPopperInstance.hide(),e.newVersionPopperInstance.destroy()}))),this.newVersionPopperInstance.show()):this.isShowNewVersion=!0},handleEditDraftVersion(){var e=(0,r.default)(this.dataMemo,(function(e){return e.isDraft}));this.handleEdit(e),this.newVersionPopperInstance.hide()},handleNewVersionClose(){this.newVersionPopperInstance&&this.newVersionPopperInstance.hide(),this.isShowNewVersion=!1},handleSearch(e){var t=this.dataMemo;Object.keys(e).forEach((function(i){var s=new RegExp((0,f.encodeRegexp)(e[i]));t=t.filter((function(e){return s.test(e[i])}))})),this.data=Object.freeze(t),this.handleLayoutFlod()},handleSortChange(e){if(e.prop){var t=e.prop;[...this.data].sort((function(i,s){return"descending"===e.order?i[t]-s[t]:s[t]-i[t]}))}},handleSettingChange(e){var t=e.fields,i=e.size;this.selectedTableColumn=Object.freeze(t),this.tableSize=i,v.listColumnsCache.setItem(V,{columns:t,size:i})},handleLayoutFlod(){this.displayCom="",this.isListFlod=!1,-1===this.selectVersionId&&this.handleCreateCancel(),this.selectVersionId=""},handleSelectionChange(e,t){t?this.choosedMap[e.scriptVersionId]=!0:delete this.choosedMap[e.scriptVersionId],this.choosedMap=k({},this.choosedMap)},handleShowDetail(e){var t=this;(0,f.leaveConfirm)().then((function(){t.selectVersionId=e.scriptVersionId,t.isListFlod=!0,t.displayCom="detail"}))},handleRowSelect(e){this.isListFlod&&this.handleShowDetail(e)},handleOffline(e,t){var i=this;return this.serviceHandler.scriptVersionOffline({id:e,versionId:t}).then((function(){i.messageSuccess("操作成功"),i.fetchData()}))},handleOnline(e,t){var i=this;return this.serviceHandler.scriptVersionOnline({id:e,versionId:t}).then((function(){i.messageSuccess("操作成功"),i.fetchData()}))},handleRemove(e){var t=this;return this.serviceHandler.scriptVersionRemove({versionId:e}).then((function(){t.messageSuccess("删除成功"),t.fetchData()}))},handleGoExce(e){this.$router.push({name:"fastExecuteScript",params:{taskInstanceId:0,scriptVersionId:e.scriptVersionId},query:{from:"scriptDetail"}})},handleSync(e){var t=this.publicScript?"scriptPublicSync":"scriptSync";this.$router.push({name:t,params:{scriptId:4,scriptVersionid:4}})},handleEdit(e){this.selectVersionId=e.scriptVersionId,this.displayCom="edit",this.isListFlod=!0,this.isShowNewVersion=!1},handleShowRelated(e){this.showRelated=!0,this.relatedScriptInfo=e},handlShowDiff(){this.showDiff=!0},handleDiffVersionChange(e){this.choosedMap=e},handleDiffClose(){this.showDiff=!1},handleScriptChangeSubmit(){this.fetchData()},handleDeleteSubmit(){this.handleLayoutFlod(),this.fetchData()},handleToggleCopyCreate(e){var t=e.scriptVersionId;this.selectVersionId=t;var i=(0,r.default)(this.dataMemo,(function(e){return e.scriptVersionId===t})),s=new d.default(k(k({},i),{},{scriptVersionId:-1,status:-1,version:(0,f.genDefaultScriptVersion)()}));this.isListFlod=!0,this.lastSelectScriptVersionId=this.selectVersionId,this.selectVersionId=-1,this.displayCom="copyCreate",this.dataAppendList=Object.freeze([s])},handleToggleEdit(){this.displayCom="edit"},handleCreateCancel(){this.displayCom="detail",this.selectVersionId=this.lastSelectScriptVersionId},handleCreateSubmit(e){var t=this,i=e.scriptVersionId;this.fetchData().then((function(){setTimeout((function(){t.displayCom="detail",t.selectVersionId=i}))}))},handleCreateValueChange(e,t){var i=[...this.dataAppendList],s=(0,r.default)(i,(function(t){return t.scriptVersionId===e}));s&&(Object.assign(s,t),this.dataAppendList=Object.freeze(i))},handleEditSubmit(){this.displayCom="detail",this.fetchData()},handleEditCancel(){this.displayCom="detail"},isRowSelectable(e){return!!this.disableDiff||this.choosedMap[e.scriptVersionId]},isRowChecked(e){return this.choosedMap[e.scriptVersionId]},renderHeader:(e,t)=>e("span",[e("span",[t.column.label]),e("bk-popover",[e("icon",{attrs:{type:"circle-italics-info"},style:"margin-left: 8px; font-size: 12px;"}),e("div",{slot:"content"},[e("div",["显示被作业引用的次数"]),e("div",["显示被执行方案引用的次数"])])])]),routerBack(){this.publicScript?this.$router.push({name:"publicScriptList"}):this.$router.push({name:"scriptList"})}}};t.Z=D},24620:function(){},8972:function(){},72269:function(){},18759:function(){},43125:function(){},45874:function(e,t,i){"use strict";i.r(t),i.d(t,{__esModule:function(){return n.X},default:function(){return o}});var s=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("layout",{staticClass:"script-manage-copy-create-box",scopedSlots:e._u([{key:"footer",fn:function(){return[i("bk-button",{directives:[{name:"test",rawName:"v-test",value:{type:"button",value:"copyCreateScriptSubmit"},expression:"{ type: 'button', value: 'copyCreateScriptSubmit' }"}],staticClass:"w120 mr10",attrs:{loading:e.isSubmiting,theme:"primary"},on:{click:e.handleSubmit}},[e._v("\n            "+e._s("提交")+"\n        ")]),e._v(" "),i("bk-button",{directives:[{name:"test",rawName:"v-test",value:{type:"button",value:"debugScript"},expression:"{ type: 'button', value: 'debugScript' }"}],staticClass:"mr10",on:{click:e.handleDebugScript}},[e._v("\n            "+e._s("调试")+"\n        ")]),e._v(" "),i("bk-button",{directives:[{name:"test",rawName:"v-test",value:{type:"button",value:"copyCreateScriptCancel"},expression:"{ type: 'button', value: 'copyCreateScriptCancel' }"}],on:{click:e.handleCancel}},[e._v("\n            "+e._s("取消")+"\n        ")])]},proxy:!0}])},[i("div",{attrs:{slot:"title"},slot:"title"},[e._v(e._s("新建脚本"))]),e._v(" "),i("template",{slot:"sub-header"},[i("Icon",{directives:[{name:"bk-tooltips",rawName:"v-bk-tooltips",value:"上传脚本",expression:"'上传脚本'"},{name:"test",rawName:"v-test",value:{type:"button",value:"uploadScript"},expression:"{ type: 'button', value: 'uploadScript' }"}],attrs:{type:"upload"},on:{click:e.handleUploadScript}}),e._v(" "),i("Icon",{directives:[{name:"bk-tooltips",rawName:"v-bk-tooltips",value:"历史缓存",expression:"'历史缓存'"},{name:"test",rawName:"v-test",value:{type:"button",value:"scriptEditHistory"},expression:"{ type: 'button', value: 'scriptEditHistory' }"}],attrs:{type:"history"},on:{click:function(t){return t.stopPropagation(),e.handleShowHistory.apply(null,arguments)}}}),e._v(" "),i("Icon",{directives:[{name:"bk-tooltips",rawName:"v-bk-tooltips",value:"全屏",expression:"'全屏'"},{name:"test",rawName:"v-test",value:{type:"button",value:"scriptEditFullscreen"},expression:"{ type: 'button', value: 'scriptEditFullscreen' }"}],attrs:{type:"full-screen"},on:{click:e.handleFullScreen}})],1),e._v(" "),i("div",{attrs:{slot:"left"},slot:"left"},[i("jb-form",{directives:[{name:"test",rawName:"v-test",value:{type:"form",value:"copyCreateScript"},expression:"{ type: 'form', value: 'copyCreateScript' }"}],ref:"form",attrs:{model:e.formData,"form-type":"vertical",rules:e.rules}},[i("jb-form-item",{attrs:{label:"版本号",required:"",property:"version"}},[i("div",{staticClass:"script-version"},[i("jb-input",{attrs:{value:e.formData.version,placeholder:"输入版本号",maxlength:30,property:"version"},on:{change:e.handleVersionChange}}),e._v(" "),i("Icon",{staticClass:"new-flag",attrs:{type:"new-dark",svg:""}})],1)]),e._v(" "),i("jb-form-item",{attrs:{label:"版本日志"}},[i("bk-input",{attrs:{type:"textarea",maxlength:100,rows:5},model:{value:e.formData.versionDesc,callback:function(t){e.$set(e.formData,"versionDesc",t)},expression:"formData.versionDesc"}})],1)],1)],1),e._v(" "),i("div",{ref:"content"},[e.contentHeight>0?i("ace-editor",{ref:"aceEditor",attrs:{lang:e.formData.typeName,height:e.contentHeight,options:e.formData.typeName},on:{"on-mode-change":e.handleTypeChange},model:{value:e.formData.content,callback:function(t){e.$set(e.formData,"content",t)},expression:"formData.content"}}):e._e()],1)],2)};s._withStripped=!0;var n=i(82287),r=n.Z,a=(i(30790),(0,i(35471).Z)(r,s,[],!1,null,null,null));a.options.__file="src/views/script-manage/common/copy-create.vue";var o=a.exports},65540:function(e,t,i){"use strict";i.r(t),i.d(t,{__esModule:function(){return n.X},default:function(){return o}});var s=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("layout",{scopedSlots:e._u([{key:"footer",fn:function(){return[i("bk-button",{directives:[{name:"test",rawName:"v-test",value:{type:"button",value:"editScriptSubmit"},expression:"{ type: 'button', value: 'editScriptSubmit' }"}],staticClass:"w120 mr10",attrs:{theme:"primary",loading:e.isSubmiting},on:{click:e.handleSubmit}},[e._v("\n            "+e._s("提交")+"\n        ")]),e._v(" "),i("bk-button",{directives:[{name:"test",rawName:"v-test",value:{type:"button",value:"debugScript"},expression:"{ type: 'button', value: 'debugScript' }"}],staticClass:"mr10",on:{click:e.handleDebugScript}},[e._v("\n            "+e._s("调试")+"\n        ")]),e._v(" "),i("bk-button",{directives:[{name:"test",rawName:"v-test",value:{type:"button",value:"editScriptCancel"},expression:"{ type: 'button', value: 'editScriptCancel' }"}],on:{click:e.handleCancel}},[e._v("\n            "+e._s("取消")+"\n        ")])]},proxy:!0}])},[i("div",{attrs:{slot:"title"},slot:"title"},[e._v(e._s("编辑脚本"))]),e._v(" "),i("template",{slot:"sub-header"},[i("Icon",{directives:[{name:"bk-tooltips",rawName:"v-bk-tooltips",value:"上传脚本",expression:"'上传脚本'"},{name:"test",rawName:"v-test",value:{type:"button",value:"uploadScript"},expression:"{ type: 'button', value: 'uploadScript' }"}],attrs:{type:"upload"},on:{click:e.handleUploadScript}}),e._v(" "),i("Icon",{directives:[{name:"bk-tooltips",rawName:"v-bk-tooltips",value:"历史缓存",expression:"'历史缓存'"},{name:"test",rawName:"v-test",value:{type:"button",value:"scriptEditHistory"},expression:"{ type: 'button', value: 'scriptEditHistory' }"}],attrs:{type:"history"},on:{click:function(t){return t.stopPropagation(),e.handleShowHistory.apply(null,arguments)}}}),e._v(" "),i("Icon",{directives:[{name:"bk-tooltips",rawName:"v-bk-tooltips",value:"全屏",expression:"'全屏'"},{name:"test",rawName:"v-test",value:{type:"button",value:"scriptEditFullscreen"},expression:"{ type: 'button', value: 'scriptEditFullscreen' }"}],attrs:{type:"full-screen"},on:{click:e.handleFullScreen}})],1),e._v(" "),i("div",{attrs:{slot:"left"},slot:"left"},[i("jb-form",{directives:[{name:"test",rawName:"v-test",value:{type:"form",value:"editScript"},expression:"{ type: 'form', value: 'editScript' }"}],ref:"form",staticClass:"edit-script-form",attrs:{model:e.formData,rules:e.rules,"form-type":"vertical"}},[i("jb-form-item",{attrs:{label:"版本号",required:""}},[i("bk-input",{attrs:{value:e.formData.version,readonly:""}})],1),e._v(" "),i("jb-form-item",{attrs:{label:"版本日志"}},[i("bk-input",{attrs:{type:"textarea",rows:5,maxlength:100},model:{value:e.formData.versionDesc,callback:function(t){e.$set(e.formData,"versionDesc",t)},expression:"formData.versionDesc"}})],1)],1)],1),e._v(" "),i("div",{ref:"content"},[i("ace-editor",{ref:"aceEditor",attrs:{lang:e.formData.typeName,height:e.contentHeight,readonly:!e.scriptInfo.isDraft,options:e.formData.typeName},model:{value:e.formData.content,callback:function(t){e.$set(e.formData,"content",t)},expression:"formData.content"}})],1)],2)};s._withStripped=!0;var n=i(87161),r=n.Z,a=(0,i(35471).Z)(r,s,[],!1,null,null,null);a.options.__file="src/views/script-manage/common/edit.vue";var o=a.exports},66966:function(e,t,i){"use strict";i.r(t),i.d(t,{__esModule:function(){return n.X},default:function(){return o}});var s=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"jb-diff-layout",style:{"z-index":e.zIndex}},[i("div",{staticClass:"header"},[i("div",{staticClass:"title"},[e._v(e._s(e.title))]),e._v(" "),i("div",{staticClass:"diff-info"},[i("div",{staticClass:"diff-del",on:{click:e.handleViewDel}},[i("span",{staticClass:"before"}),e._v(" "),i("span",{staticClass:"after"}),e._v(" "),i("span",[e._v(e._s("删除")+"（"+e._s(e.del)+"）")])]),e._v(" "),i("div",{staticClass:"diff-change",on:{click:e.handleViewChange}},[i("span",{staticClass:"before"}),e._v(" "),i("span",{staticClass:"after"}),e._v(" "),i("span",[e._v(e._s("变换")+"（"+e._s(e.change)+"）")])]),e._v(" "),i("div",{staticClass:"diff-ins",on:{click:e.handleViewIns}},[i("span",{staticClass:"before"}),e._v(" "),i("span",{staticClass:"after"}),e._v(" "),i("span",[e._v(e._s("新增")+"（"+e._s(e.ins)+"）")])])])]),e._v(" "),i("div",{staticClass:"version-select-layout"},[i("div",{staticClass:"version-left"},[i("bk-select",{staticClass:"version-selector",attrs:{clearable:!1},model:{value:e.oldVersion,callback:function(t){e.oldVersion=t},expression:"oldVersion"}},e._l(e.data,(function(e){return i("bk-option",{key:e.scriptVersionId,attrs:{id:e.scriptVersionId,name:e.version}})})),1)],1),e._v(" "),i("div",{staticClass:"version-right"},[i("bk-select",{staticClass:"version-selector",attrs:{clearable:!1},model:{value:e.newVersion,callback:function(t){e.newVersion=t},expression:"newVersion"}},e._l(e.data,(function(e){return i("bk-option",{key:e.scriptVersionId,attrs:{id:e.scriptVersionId,name:e.version}})})),1)],1)]),e._v(" "),i("scroll-faker",{staticClass:"content-wraper"},[i("jb-diff",{ref:"diff",staticClass:"diff-details",attrs:{format:"side-by-side",theme:"dark",language:e.language,context:1/0,"old-content":e.oldContent,"new-content":e.newContent}})],1),e._v(" "),i("i",{staticClass:"bk-icon icon-close",on:{click:e.handleClose}})],1)};s._withStripped=!0;var n=i(57634),r=n.Z,a=(i(77402),(0,i(35471).Z)(r,s,[],!1,null,null,null));a.options.__file="src/views/script-manage/version/components/diff.vue";var o=a.exports},16410:function(e,t,i){"use strict";i.r(t),i.d(t,{__esModule:function(){return n.X},default:function(){return o}});var s=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{ref:"layout",staticClass:"script-version-page-layout",class:{"is-flod":e.flod,toggled:e.isOpen}},[i("div",{staticClass:"layout-left"},[i("div",{staticClass:"left-wraper",style:e.styles},[e._t("default")],2),e._v(" "),e.isShowRight?i("div",{staticClass:"toggle-button",on:{click:e.handleToggle}},[i("Icon",{staticClass:"toggle-arrow",attrs:{type:"down-small"}})],1):e._e()]),e._v(" "),e.flod?i("div",{staticClass:"layout-right",style:e.rightStyles},[i("div",{staticClass:"right-wraper",class:{active:e.isShowRight}},[e.isShowRight?e._t("flod"):e._e()],2),e._v(" "),i("div",{staticClass:"close-btn",on:{click:e.handleClose}},[i("Icon",{attrs:{type:"close-big"}})],1)]):e._e()])};s._withStripped=!0;var n=i(39902),r=n.Z,a=(i(53413),(0,i(35471).Z)(r,s,[],!1,null,null,null));a.options.__file="src/views/script-manage/version/components/layout.vue";var o=a.exports},49824:function(e,t,i){"use strict";i.r(t),i.d(t,{__esModule:function(){return n.X},default:function(){return o}});var s=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"script-manage-new-version"},[i("jb-form",{ref:"form",attrs:{"form-type":"vertical",model:e.formData,rules:e.rules}},[i("jb-form-item",{staticStyle:{"margin-bottom":"0"},attrs:{label:"选择载入版本",required:"",property:"scriptVersionId"}},[i("bk-select",{model:{value:e.formData.scriptVersionId,callback:function(t){e.$set(e.formData,"scriptVersionId",t)},expression:"formData.scriptVersionId"}},e._l(e.renderList,(function(t){return i("bk-option",{key:t.scriptVersionId,attrs:{id:t.scriptVersionId,name:t.version}},[i("span",[e._v(e._s(t.version))]),e._v(" "),i("span",{domProps:{innerHTML:e._s(t.statusHtml)}})])})),1)],1)],1)],1)};s._withStripped=!0;var n=i(76824),r=n.Z,a=(0,i(35471).Z)(r,s,[],!1,null,null,null);a.options.__file="src/views/script-manage/version/components/new-version.vue";var o=a.exports},23044:function(e,t,i){"use strict";i.r(t),i.d(t,{__esModule:function(){return n.X},default:function(){return o}});var s=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:e.isLoading},expression:"{ isLoading }"}],ref:"wraper",staticClass:"script-version-basic-box"},[e.data.id?[i("div",{staticClass:"script-type-flag"},[i("img",{attrs:{src:"/static/images/script/"+e.data.typeName+".svg"}})]),e._v(" "),i("div",{staticClass:"detail-column",staticStyle:{width:"270px"}},[i("div",{staticClass:"detail-col"},[i("div",{staticClass:"item-label"},[e._v(e._s("脚本名："))]),e._v(" "),i("div",{staticClass:"item-value"},[i("auth-component",{attrs:{auth:"script/edit","resource-id":e.data.id}},[i("jb-edit-input",{staticStyle:{width:"100%"},attrs:{field:"scriptName",value:e.data.name,"remote-hander":function(t){return e.handleUpdateScript("scriptName",t)}}}),e._v(" "),i("div",{attrs:{slot:"forbid"},slot:"forbid"},[e._v(e._s(e.data.name))])],1)],1)]),e._v(" "),i("div",{staticClass:"detail-col"},[i("div",{staticClass:"item-label"},[e._v(e._s("更新人："))]),e._v(" "),i("div",{staticClass:"item-value"},[i("div",{directives:[{name:"bk-overflow-tips",rawName:"v-bk-overflow-tips"}],staticClass:"text-box"},[e._v(e._s(e.data.lastModifyUser))])])]),e._v(" "),i("div",{staticClass:"detail-col"},[i("div",{staticClass:"item-label"},[e._v(e._s("创建人："))]),e._v(" "),i("div",{staticClass:"item-value"},[i("div",{directives:[{name:"bk-overflow-tips",rawName:"v-bk-overflow-tips"}],staticClass:"text-box"},[e._v(e._s(e.data.creator))])])])]),e._v(" "),i("div",{staticClass:"detail-column",staticStyle:{width:"282px"}},[i("div",{staticClass:"detail-col"},[i("div",{staticClass:"item-label"},[e._v(e._s("脚本语言："))]),e._v(" "),i("div",{staticClass:"item-value"},[i("div",{staticClass:"text-box"},[e._v(e._s(e.data.typeName))])])]),e._v(" "),i("div",{staticClass:"detail-col"},[i("div",{staticClass:"item-label"},[e._v(e._s("更新时间："))]),e._v(" "),i("div",{staticClass:"item-value"},[i("div",{directives:[{name:"bk-overflow-tips",rawName:"v-bk-overflow-tips"}],staticClass:"text-box"},[e._v(e._s(e.data.lastModifyTime))])])]),e._v(" "),i("div",{staticClass:"detail-col"},[i("div",{staticClass:"item-label"},[e._v(e._s("创建时间："))]),e._v(" "),i("div",{directives:[{name:"bk-overflow-tips",rawName:"v-bk-overflow-tips"}],staticClass:"item-value"},[i("div",{staticClass:"text-box"},[e._v(e._s(e.data.createTime))])])])]),e._v(" "),i("div",{staticClass:"detail-column last"},[i("div",{staticClass:"detail-col"},[i("div",{staticClass:"item-label"},[e._v(e._s("场景标签："))]),e._v(" "),i("div",{staticClass:"item-value"},[i("auth-component",{attrs:{auth:"script/edit","resource-id":e.data.id}},[i("jb-edit-tag",{staticClass:"input",attrs:{field:"scriptTags",rows:1,value:e.data.tags,"remote-hander":function(t){return e.handleUpdateScript("scriptTags",t)}}}),e._v(" "),i("div",{attrs:{slot:"forbid"},slot:"forbid"},[e._v(e._s(e.data.tagText))])],1)],1)]),e._v(" "),i("div",{staticClass:"detail-col"},[i("div",{staticClass:"item-label"},[e._v(e._s("脚本描述："))]),e._v(" "),i("div",{staticClass:"item-value"},[i("jb-edit-textarea",{attrs:{field:"scriptDesc","single-row-render":"",placeholder:"在此处标注该脚本的备注和使用说明",maxlength:500,rows:1,value:e.data.description,"remote-hander":function(t){return e.handleUpdateScript("scriptDesc",t)}}})],1)])])]:e._e()],2)};s._withStripped=!0;var n=i(63665),r=n.Z,a=(i(37395),(0,i(35471).Z)(r,s,[],!1,null,null,null));a.options.__file="src/views/script-manage/version/components/script-basic.vue";var o=a.exports},50238:function(e,t,i){"use strict";i.r(t),i.d(t,{__esModule:function(){return n.X},default:function(){return o}});var s=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"script-manage-version-page"},[i("script-basic"),e._v(" "),i("div",{staticClass:"version-list-wraper"},[i("list-action-layout",{scopedSlots:e._u([{key:"right",fn:function(){return[i("jb-search-select",{staticStyle:{width:"420px"},attrs:{data:e.searchSelect,placeholder:"直接输入 版本号 或 更新人 进行全局模糊搜索","show-condition":!1},on:{"on-change":e.handleSearch}})]},proxy:!0}])},[i("bk-button",{ref:"newVersion",on:{click:e.handlNewVersion}},[e._v("\n                "+e._s("新建版本")+"\n            ")]),e._v(" "),i("bk-button",{on:{click:e.handlShowDiff}},[e._v("\n                "+e._s("版本对比")+"\n            ")])],1),e._v(" "),i("div",{ref:"list"},[i("layout",{attrs:{flod:e.isListFlod},on:{"on-flod":e.handleLayoutFlod}},[e.tableHeight?i("bk-table",{staticClass:"script-version-list",attrs:{data:e.renderList,"outer-border":!1,"max-height":e.tableHeight,size:e.tableSize,"row-class-name":e.rowClassName},on:{"row-click":e.handleRowSelect,"sort-change":e.handleSortChange}},[i("bk-table-column",{key:"selection",attrs:{width:"47",align:"center",resizable:!1},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.row;return[i("bk-checkbox",{attrs:{checked:e.isRowChecked(s)},on:{change:function(t){return e.handleSelectionChange(s,t)}}})]}}],null,!1,175312358)}),e._v(" "),e.allColumnMap.scriptVersionId?i("bk-table-column",{key:"scriptVersionId",attrs:{label:"版本 ID",prop:"scriptVersionId",align:"left",width:"100"}}):e._e(),e._v(" "),e.allColumnMap.version?i("bk-table-column",{key:"version",attrs:{label:"版本号",prop:"version",align:"left","show-overflow-tooltip":"",sortable:!0},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.row;return[i("a",{on:{click:function(t){return e.handleShowDetail(s)}}},[e._v(e._s(s.version||"--"))])]}}],null,!1,1975994852)}):e._e(),e._v(" "),e.allColumnMap.relatedTaskNum?i("bk-table-column",{key:"relatedTaskNum",attrs:{label:"被引用",prop:"relatedTaskNum","render-header":e.renderHeader,align:"right",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.row;return[i("bk-button",{directives:[{name:"bk-tooltips",rawName:"v-bk-tooltips.allowHtml",value:"\n                                <div>作业模板引用: "+s.relatedTaskTemplateNum+"</div>\n                                <div>执行方案引用: "+s.relatedTaskPlanNum+"</div>",expression:"`\n                                <div>${'作业模板引用'}: ${row.relatedTaskTemplateNum}</div>\n                                <div>${'执行方案引用'}: ${row.relatedTaskPlanNum}</div>`",modifiers:{allowHtml:!0}}],staticClass:"mr20",attrs:{text:""},on:{click:function(t){return e.handleShowRelated(s)}}},[i("span",[e._v("\n                                    "+e._s(s.relatedTaskTemplateNum)+"\n                                ")]),e._v(" "),i("span",[e._v(" / ")]),e._v(" "),i("span",[e._v("\n                                    "+e._s(s.relatedTaskPlanNum)+"\n                                ")])])]}}],null,!1,4235941448)}):e._e(),e._v(" "),e.allColumnMap.lastModifyUser?i("bk-table-column",{key:"lastModifyUser",attrs:{label:"更新人",prop:"lastModifyUser",align:"left",width:"160"}}):e._e(),e._v(" "),e.allColumnMap.lastModifyTime?i("bk-table-column",{key:"lastModifyTime",attrs:{label:"更新时间",prop:"lastModifyTime",align:"left",width:"200",sortable:!0}}):e._e(),e._v(" "),e.allColumnMap.statusDesc?i("bk-table-column",{key:"statusDesc",attrs:{label:"状态",prop:"statusDesc",align:"left",width:"120",sortable:!0},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.row;return[i("span",{domProps:{innerHTML:e._s(s.statusHtml)}}),e._v(" "),i("Icon",{directives:[{name:"show",rawName:"v-show",value:s.scriptVersionId===e.selectVersionId,expression:"row.scriptVersionId === selectVersionId"}],staticClass:"select-flag",attrs:{type:"arrow-full-right"}})]}}],null,!1,2485370968)}):e._e(),e._v(" "),e.isListFlod?e._e():i("bk-table-column",{key:"action",attrs:{label:"操作",prop:"action",align:"left",width:"400"},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.row;return i("div",{on:{click:function(e){e.stopPropagation()}}},[s.isOnline?e._e():i("jb-popover-confirm",{staticClass:"mr10",attrs:{title:"确定上线该版本？",content:"上线后，之前的线上版本将被置为「已下线」状态，但不影响作业使用","confirm-handler":function(){return e.handleOnline(s.id,s.scriptVersionId)}}},[i("auth-button",{attrs:{permission:s.canManage,"resource-id":s.id,auth:"script/edit",text:""}},[e._v("\n                                    "+e._s("上线")+"\n                                ")])],1),e._v(" "),i("jb-popover-confirm",{staticClass:"mr10",attrs:{title:"确定禁用该版本？",content:"一旦禁用成功，线上引用该版本的作业脚本步骤都会执行失败，请务必谨慎操作！","confirm-handler":function(){return e.handleOffline(s.id,s.scriptVersionId)}}},[i("auth-button",{attrs:{permission:s.canManage,"resource-id":s.id,auth:"script/edit",text:""}},[e._v("\n                                    "+e._s("禁用")+"\n                                ")])],1),e._v(" "),i("auth-button",{staticClass:"mr10",attrs:{permission:s.canManage,"resource-id":s.id,auth:"script/edit",text:""},on:{click:function(t){return e.handleEdit(s)}}},[e._v("\n                                "+e._s("编辑")+"\n                            ")]),e._v(" "),i("span",{staticClass:"mr10",attrs:{"tippy-tips":e.isCopyCreateDisabled?"已有[未上线]版本":""}},[i("auth-button",{attrs:{permission:s.canClone,"resource-id":s.id,auth:"script/clone",text:""},on:{click:function(t){return e.handleToggleCopyCreate(s)}}},[e._v("\n                                    "+e._s("复制并新建")+"\n                                ")])],1),e._v(" "),i("auth-button",{attrs:{text:"",permission:s.canManage,auth:"script/execute","resource-id":s.id},on:{click:function(t){return e.handleGoExce(s)}}},[e._v("\n                                "+e._s("去执行")+"\n                            ")]),e._v(" "),i("span",{attrs:{"tippy-tips":s.syncEnabled?"":"所有关联作业模板已是当前版本"}},[i("auth-button",{staticClass:"ml10",attrs:{permission:s.canManage,"resource-id":s.id,auth:"script/edit",text:""},on:{click:function(t){return e.handleSync(s)}}},[e._v("\n                                    "+e._s("同步")+"\n                                ")])],1),e._v(" "),i("jb-popover-confirm",{attrs:{title:"确定删除该版本？",content:"删除后不可恢复，请谨慎操作！","confirm-handler":function(){return e.handleRemove(s.scriptVersionId)}}},[i("auth-button",{attrs:{permission:s.canManage,"resource-id":s.id,auth:"script/delete",text:""}},[e._v("\n                                    "+e._s("删除")+"\n                                ")])],1)],1)}}],null,!1,1480834419)}),e._v(" "),i("bk-table-column",{attrs:{type:"setting"}},[i("bk-table-setting-content",{attrs:{fields:e.tableColumn,selected:e.selectedTableColumn,size:e.tableSize},on:{"setting-change":e.handleSettingChange}})],1)],1):e._e(),e._v(" "),i("template",{slot:"flod"},[i(e.curCom,{tag:"component",attrs:{"script-version-list":e.data,"script-info":e.selectVersion},on:{"on-edit-change":e.handleScriptChangeSubmit,"on-go-copy-create":e.handleToggleCopyCreate,"on-go-edit":e.handleToggleEdit,"on-delete":e.handleDeleteSubmit,"on-create-change":e.handleCreateValueChange,"on-create":e.handleCreateSubmit,"on-create-cancel":e.handleCreateCancel,"on-edit":e.handleEditSubmit,"on-edit-cancel":e.handleEditCancel}})],1)],2)],1)],1),e._v(" "),i("div",{staticStyle:{display:"none"}},[i("div",{staticStyle:{padding:"16px 12px"},attrs:{id:"newVersionDisableActions"}},[i("div",{staticStyle:{"margin-bottom":"17px","font-size":"14px","line-height":"22px",color:"#313238"}},[e._v("\n                "+e._s("已有[未上线]版本")+"\n            ")]),e._v(" "),i("div",[i("bk-button",{staticStyle:{"margin-right":"8px"},attrs:{theme:"primary",size:"small"},on:{click:e.handleEditDraftVersion}},[e._v("\n                    "+e._s("前往编辑")+"\n                ")]),e._v(" "),i("bk-button",{attrs:{size:"small"},on:{click:e.handleNewVersionClose}},[e._v("\n                    "+e._s("取消")+"\n                ")])],1)])]),e._v(" "),e.currentVersionName?i("element-teleport",[i("span",[e._v(" - "+e._s(e.currentVersionName))])]):e._e(),e._v(" "),e.showDiff?i("Diff",{attrs:{title:"版本对比",data:e.dataMemo,"old-version-id":e.diffInfo.oldVersionId,"new-version-id":e.diffInfo.newVersionId},on:{"on-change":e.handleDiffVersionChange,close:e.handleDiffClose}}):e._e(),e._v(" "),i("jb-sideslider",{attrs:{"is-show":e.showRelated,"show-footer":!1,"quick-close":"",title:"被引用",width:695},on:{"update:isShow":function(t){e.showRelated=t},"update:is-show":function(t){e.showRelated=t}}},[i("script-related-info",{attrs:{info:e.relatedScriptInfo,mode:"scriptVersionList"}})],1),e._v(" "),i("jb-dialog",{attrs:{"header-position":"left",title:"新建版本","ok-text":"确定","mask-close":!1,width:480},model:{value:e.isShowNewVersion,callback:function(t){e.isShowNewVersion=t},expression:"isShowNewVersion"}},[i("new-version",{attrs:{"version-list":e.data},on:{"on-close":e.handleNewVersionClose,"on-create":e.handleToggleCopyCreate}})],1)],1)};s._withStripped=!0;var n=i(65386),r=n.Z,a=(i(65008),(0,i(35471).Z)(r,s,[],!1,null,null,null));a.options.__file="src/views/script-manage/version/index.vue";var o=a.exports},30790:function(e,t,i){var s=i(24620);s.__esModule&&(s=s.default),"string"==typeof s&&(s=[[e.id,s,""]]),s.locals&&(e.exports=s.locals);(0,i(13570).Z)("1e28ab96",s,!1,{})},77402:function(e,t,i){var s=i(8972);s.__esModule&&(s=s.default),"string"==typeof s&&(s=[[e.id,s,""]]),s.locals&&(e.exports=s.locals);(0,i(13570).Z)("0b614b9a",s,!1,{})},53413:function(e,t,i){var s=i(72269);s.__esModule&&(s=s.default),"string"==typeof s&&(s=[[e.id,s,""]]),s.locals&&(e.exports=s.locals);(0,i(13570).Z)("387a3d93",s,!1,{})},37395:function(e,t,i){var s=i(18759);s.__esModule&&(s=s.default),"string"==typeof s&&(s=[[e.id,s,""]]),s.locals&&(e.exports=s.locals);(0,i(13570).Z)("681ae15a",s,!1,{})},65008:function(e,t,i){var s=i(43125);s.__esModule&&(s=s.default),"string"==typeof s&&(s=[[e.id,s,""]]),s.locals&&(e.exports=s.locals);(0,i(13570).Z)("b5f9c6b2",s,!1,{})}}]);